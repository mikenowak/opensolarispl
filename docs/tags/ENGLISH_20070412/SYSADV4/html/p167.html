<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Debugging the FTP Server - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Network Services<?GenHTML /ReferencePage> > <a href="p158.html">28.&nbsp;&nbsp;Administering the FTP Server (Tasks)</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p166.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p168.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="wuftp-210"></a><h3>Debugging the FTP Server</h3>
<p>This section describes some of the ways to debug problems with the FTP
server.</p>
<a name="wuftp-proc-221"></a><h4><img src="graphics/procedure.gif"> How to Check <tt>syslogd</tt> for
FTP Server Messages</h4>
<p>The FTP server writes messages that are useful for debugging to the
location that is specified for daemon messages in the <tt>/etc/syslog.conf</tt> file.
If a problem occurs with the FTP server, check this file first for such messages.</p>
<p>The FTP server messages are controlled by facility daemon and level
information. To send messages from the FTP server to <tt>/var/adm/message</tt> and
have <tt>syslogd</tt> reread its configuration file, follow these
instructions:</p>
<ol><li><a name="wuftp-step-222"></a><b>Add an entry such as the following to the <tt>/etc/syslog.conf</tt> file.</b><pre>daemon.info /var/adm/message</pre></li><li><a name="wuftp-step-223"></a><b>Signal <tt>syslogd</tt> to reread
its configuration.</b><pre># <tt><b>svcadm refresh system/system-log</b></tt></pre><p>This action causes informational messages from the FTP Sever to be written
to <tt>/var/adm/messages</tt>.</p></li></ol><a name="wuftp-proc-211"></a><h4><img src="graphics/procedure.gif"> How to Use <tt>greeting text</tt> to
Verify <tt>ftpaccess</tt></h4>
<p>To use the <tt>greeting text</tt> capability to check that
the correct <tt>ftpaccess</tt> file is being used, do the following:</p>
<ol><li><a name="wuftp-step-212"></a><b>Add the following directive to the ftpaccess
file.</b><pre>greeting text <i>message</i></pre></li><li><a name="wuftp-step-213"></a><b>Connect to the FTP server.</b></li><li><a name="wuftp-step-214"></a><b>If the message fails to appear, do the following:</b><ol><li><a name="wuftp-step-215"></a><b>Confirm that the <tt>ftpaccess</tt> file
is in the correct location. Use the <tt>strings</tt>(1) command to obtain the location
of the file from the FTP server binary.</b><pre># strings /usr/sbin/in.ftpd | grep "^/.*ftpaccess"</pre></li><li><a name="wuftp-step-216"></a><b>Check the <tt>ftpservers</tt> file
to see if virtual hosting has been configured.</b><p>For further information,
see <tt>ftpaccess</tt>(4), <tt>ftpservers</tt>(4), <tt>strings</tt>(1), <tt>syslog.conf</tt>(4), and <tt>pgrep</tt>(1).</p></li></ol></li></ol><a name="wuftp-proc-217"></a><h4><img src="graphics/procedure.gif"> How to Check the Commands Executed by FTP
Users</h4>
<p>To see what commands are being executed by FTP users, use the <tt>log
commands</tt> logging capability in <tt>ftpaccess</tt>.</p>
<ol><li><a name="wuftp-step-218"></a><b>Add the following directive to the <tt>ftpaccess</tt> file to log individual commands by users who are specified in <i>typelist</i>.</b><pre>log commands <i>typelist</i></pre></li><li><a name="wuftp-step-226a"></a><b>Check messages that are written to the location
specified in the <tt>/etc/syslog.conf</tt>.</b></li></ol><a name="egcom"></a><h3>Configuration Help for Busy Sites</h3>
<p>The following list includes some suggestions to improve performance
on busy FTP sites.</p>
<ol><li><p>Sites which typically support many simultaneous connections
should run the FTP server in standalone mode, see <a href="p165.html#wuftp-189">Starting the FTP Server Automatically</a>.</p>
</li>
<li><p>Use <tt>vmstat</tt> and other system utilities to
monitor the system hosting the FTP server. If the system runs low on resources
place a limit on the number of simultaneous connections, see <a href="p159.html">How to Set User Login Limits</a>. For more information
on system monitoring, see Chapter 20, Monitoring System Performance (Tasks), in <i>System Administration Guide: Advanced Administration</i>.</p>
</li>
<li><p>If you impose a connection limit, consider using the <tt>limit-time</tt> and <tt>timeout idle</tt> capabilities in the <tt>ftpaccess</tt> file to stop users from hogging connections. If you don't impose
a connection limit, specify the <tt>-Q</tt> option to <tt>in.ftpd</tt>.</p>
</li>
<li><p>If you don't need ftp login and logout records in <tt>/var/adm/wtmpx</tt>, specify the <tt>-W</tt> option to <tt>in.ftpd</tt>.</p>
</li>
<li><p>To reduce the load on the system hosting the FTP server, increase
the transfer buffer sizes using the <tt>recvbuf</tt> and <tt>sendbuf</tt> capabilities in the <tt>ftpaccess</tt> file. If large
buffer sizes are selected it may be necessary to increase the data activity
timeout using the <tt>timeout data</tt> capability in the <tt>ftpaccess</tt> file.</p>
</li>
<li><p>The FTP server reads from various databases including the
hosts, passwd, group and services. Slow lookups may cause a significant delay
logging into the FTP server, configuring the <tt>files</tt> source
first in <tt>nsswitch.conf</tt> minimizes the lookup times. For
more information, see the <tt>nsswitch.conf</tt>(4) man page.</p>
</li>
<li><p>By default the FTP server attempts to lookup the remote host's
name, which can be slow causing a significant delay logging in. The <tt>rhostlookup</tt> capability in the <tt>ftpaccess</tt> file can be used
to stop this lookup. However be aware that if the remote host's name is not
looked up, only its IP address is matched when using other capabilities in
the <tt>ftpaccess</tt> file and when matching entries in the <tt>ftphosts</tt> file. Also the remote host's IP address will be used in
messages and in place of the %R magic cookie. See the description of the <tt>rhostlookup</tt> capability in the <tt>ftpaccess</tt>(4) man page for more details.</p>
</li>
<li><p>Retrieving quota information may also cause a significant
delay when logging into the FTP server, so only use the <tt>quota-info</tt> capability
in the <tt>ftpaccess</tt> file if you make use of the quota magic
cookies. See the <tt>ftpaccess</tt>(4) man
page for a list of the quota magic cookies.</p>
</li>
</ol>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p166.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p168.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

