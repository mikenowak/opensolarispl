<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title><tt>snoop</tt> Command - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Network Services<?GenHTML /ReferencePage> > <a href="p31.html">6.&nbsp;&nbsp;Accessing Network File Systems (Reference)</a> > <a href="p46.html">Commands for Troubleshooting NFS Problems</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p46.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p48.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="rfsrefer-43"></a><h4><tt>snoop</tt> Command</h4>
<a name="indexterm-670"></a><p>This command is often used to watch for packets on the network. The <tt>snoop</tt> command must be run as <tt>root</tt>. The use of
this command is a good way to ensure that the network hardware is functioning
on both the client and the server. Many options are available. See the <tt>snoop</tt>(1M) man page. A shortened synopsis
of the command follows:</p>
<p><tt>snoop</tt>  <tt>[</tt> <tt>-d</tt> <i>device</i> <tt>]</tt> <tt>[</tt> <tt>-o</tt> <i>filename</i> <tt>]</tt> <tt>[</tt> <tt>host</tt> <i>hostname</i> <tt>]</tt>  </p>
<dl><dt><tt>-d</tt> <i>device</i></dt>
<dd><p>Specifies the local network interface</p>
</dd>
<dt><tt>-o</tt> <i>filename</i></dt>
<dd><p>Stores all the captured packets into the named file</p>
</dd>
<dt><i>hostname</i></dt>
<dd><p>Displays packets going to and from a specific host only</p>
</dd>
</dl>
<p>The <tt>-d</tt> <i>device</i> option is useful
on those servers that have multiple network interfaces. You can use many expressions
 other than setting the host. A combination of command expressions with <tt>grep</tt> can often generate data that is specific enough to be useful.</p>
<p>When troubleshooting, make sure that packets are going to and from the
proper host. Also, look for error messages. Saving the packets to a file can
simplify the review of the data.</p>
<a name="rfsrefer-44"></a><h4><tt>truss</tt> Command</h4>
<a name="indexterm-671"></a><p>You can use this command to check if a process is hung. The <tt>truss</tt> command
must be run by the owner of the process or by <tt>root</tt>. You
can use many options with this command. See the <tt>truss</tt>(1) man page. A shortened syntax
of the command follows.</p>
<p><tt>truss</tt> <tt>[</tt> <tt>-t</tt> <i>syscall</i> <tt>]</tt> <tt>-p</tt> <i>pid</i></p>
<dl><dt><tt>-t</tt> <i>syscall</i></dt>
<dd><p>Selects system calls to trace</p>
</dd>
<dt><tt>-p</tt> <i>pid</i></dt>
<dd><p>Indicates the PID of the process to be traced</p>
</dd>
</dl>
<p>The <i>syscall</i> can be a comma-separated list
of system calls to be traced. Also, starting <i>syscall</i> with
an <tt>!</tt> selects to exclude the listed system calls from the
trace.</p>
<p>This example shows that the process is waiting for another connection
request from a new client. </p>
<pre># <tt><b>/usr/bin/truss -p 243</b></tt>
poll(0x00024D50, 2, -1)         (sleeping...)</pre><p>The previous example shows a normal response. If the response does not
change after a new connection request has been made, the process could be
hung. Follow the instructions in <a href="p28.html#rfsadmin-240">How to Restart NFS Services</a> to fix the hung program. Review the instructions in <a href="p27.html#rfsadmin-215">NFS Troubleshooting Procedures</a> to fully verify
that your problem is a hung program.</p>
<a name="rfsrefer-154"></a><h3>NFS Over RDMA</h3>
<p>Starting in the Solaris 10 release, the default transport for NFS is
the Remote Direct Memory Access (RDMA) protocol, which is a technology for
memory-to-memory transfer of data over high-speed networks. Specifically,
RDMA provides remote data transfer directly to and from memory without CPU
intervention. RDMA also provides direct data placement, which eliminates 
data copies and, therefore, further eliminates CPU intervention. Thus, RDMA
relieves not only the host CPU, but also reduces contention for the host memory
and I/O buses.  To provide this capability, RDMA combines the interconnect
I/O technology of InfiniBand on SPARC platforms with the Solaris operating
system. The following figure shows the relationship of RDMA to other protocols,
such as UDP and TCP.</p>
<a name="rfsrefer-fig-155"></a>Figure 6-1 Relationship of RDMA to Other Protocols<img src="figures/nfs-diagram.gif" alt=""></img><p>Because RDMA is the default transport protocol for NFS, no special <tt>share</tt> or <tt>mount</tt> options are required to use RDMA
on a client or server. The existing automounter maps, vfstab and dfstab, work
with the RDMA transport. NFS mounts over the RDMA transport occur transparently
when InfiniBand connectivity exists on SPARC platforms between the client
and the server. If the RDMA transport is not available on both the client
and the server, the TCP transport is the initial fallback, followed by UDP
if TCP is unavailable. Note, however, that if you use the <tt>proto=rdma</tt> mount option, NFS mounts are forced to use RDMA only.</p>
<p>To specify that TCP and UDP be used only, you can use the <tt>proto=tcp/udp</tt> <tt>mount</tt> option. This
option disables RDMA on an NFS client. For more information about NFS mount
options, see the <tt>mount_nfs</tt>(1M) man
page and <a href="p36.html#rfsrefer-15"><tt>mount</tt> Command</a>.</p>
<hr>
<p><b>Note - </b>RDMA for InfiniBand uses the IP addressing format and the IP lookup
infrastructure to specify peers. However, because RDMA is a separate protocol
stack, it does not fully implement all IP semantics. For example, RDMA does
not use IP addressing to communicate with peers. Therefore, RDMA might bypass
configurations for various security policies that are based on IP addresses.
However, the NFS and RPC administrative policies, such as <tt>mount</tt> restrictions
and secure RPC, are not bypassed.</p>
<hr>
<a name="rfsrefer-45"></a><h3>How the NFS Service Works</h3>
<p>The following sections describe some of the complex functions of the
NFS software. Note that some of the feature descriptions in this section are
exclusive to NFS version 4.</p>
<ul><li><p><a href="p47.html#rfsrefer-147">Version Negotiation in NFS</a></p>
</li>
<li><p><a href="p48.html">Features in NFS Version 4</a></p>
</li>
<li><p><a href="p49.html#rfsrefer-47">UDP and TCP Negotiation</a></p>
</li>
<li><p><a href="p50.html">File Transfer Size Negotiation</a></p>
</li>
<li><p><a href="p50.html#rfsrefer-49">How File Systems Are Mounted</a></p>
</li>
<li><p><a href="p50.html#rfsrefer-50">Effects of the <tt>-public</tt> Option and NFS URLs When Mounting</a></p>
</li>
<li><p><a href="p50.html#rfsrefer-51">Client-Side Failover</a></p>
</li>
<li><p><a href="p51.html">Large Files</a></p>
</li>
<li><p><a href="p51.html#rfsrefer-105">How NFS Server Logging Works</a></p>
</li>
<li><p><a href="p51.html#rfsrefer-56">How the WebNFS Service Works</a></p>
</li>
<li><p><a href="p51.html#rfsrefer-57">WebNFS Limitations With Web Browser Use</a></p>
</li>
<li><p><a href="p51.html#rfsrefer-58">Secure NFS System</a></p>
</li>
<li><p><a href="p51.html#rfsrefer-59">Secure RPC</a></p>
</li>
</ul>
<hr>
<p><b>Note - </b>If your system has zones enabled and you want to use this feature
in a non-global zone, see <i>System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</i> for
more information.</p>
<hr>
<a name="rfsrefer-147"></a><h4>Version Negotiation in NFS</h4>
<a name="indexterm-672"></a><a name="indexterm-673"></a><a name="indexterm-674"></a><p>The NFS initiation process includes negotiating the protocol levels
for servers and clients.  If you do not specify the version level, then the
best level is selected by default. For example, if both the client and the
server can support version 3, then version 3 is used. If the client or the
server can only support version 2, then version 2 is used.</p>
<p>Starting in the Solaris 10 release, you can set the keywords NFS_CLIENT_VERSMIN,
NFS_CLIENT_VERSMAX, NFS_SERVER_VERSMIN, NFS_SERVER_VERSMAX in the <tt>/etc/default/nfs</tt> file. Your specified minimum and maximum values for the server
and the client would replace the default values for these keywords. For both
the client and the server the default minimum value is 2 and the default maximum
value is 4.  See <a href="p31.html#rfsrefer-133">Keywords for the <tt>/etc/default/nfs</tt> File</a>. To find the version supported by the server, the NFS client
begins with the setting for NFS_CLIENT_VERSMAX and continues to try each version
until reaching the version setting for NFS_CLIENT_VERSMIN.  As soon as the
supported version is found, the process terminates.  For example, if NFS_CLIENT_VERSMAX=4
and NFS_CLIENT_VERSMIN=2, then the client attempts version 4 first, then version
3, and finally version 2. If NFS_CLIENT_VERSMIN and NFS_CLIENT_VERSMAX are
set to the same value, then the client always uses this version and does not
attempt any other version.  If the server does not offer this version, the
mount fails.</p>
<hr>
<p><b>Note - </b>You can override the values that are determined by the negotiation
by using the <tt>vers</tt> option with the <tt>mount</tt> command.
 See the <tt>mount_nfs</tt>(1M) man
page.</p>
<hr>
<p>For procedural information, refer to <a href="p19.html">Setting Up NFS Services</a>.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p46.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p48.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

