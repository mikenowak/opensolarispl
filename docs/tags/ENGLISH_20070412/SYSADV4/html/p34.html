<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Configuration Files and <tt>nfsmapid</tt> - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Network Services<?GenHTML /ReferencePage> > <a href="p31.html">6.&nbsp;&nbsp;Accessing Network File Systems (Reference)</a> > <a href="p33.html">NFS Daemons</a> > <a href="p33.html#rfsrefer-118"><tt>nfsmapid</tt> Daemon</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p33.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p35.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="epubq"></a><h5>Configuration Files and <tt>nfsmapid</tt></h5>
<a name="indexterm-534"></a><p>The following describes how the <tt>nfsmapid</tt> daemon uses
the <tt>/etc/nsswitch.conf</tt> and <tt>/etc/resolv.conf</tt> files:</p>
<ul><li><p><tt>nfsmapid</tt> uses standard C library functions
to request password and group information from back-end name services. These
name services are controlled by the settings in the <tt>/etc/nsswitch.conf</tt> file.
Any changes to the <tt>nsswitch.conf</tt> file affect <tt>nfsmapid</tt> operations. For more information about the <tt>nsswitch.conf</tt> file,
see the <tt>nsswitch.conf</tt>(4) man page.</p>
</li>
<li><p>To ensure that the NFS version 4 clients are capable of mounting
file systems from different domains, <tt>nfsmapid</tt> relies on
the configuration of the DNS TXT resource record (RR), <tt>_nfsv4idmapdomain</tt>. For more information about configuring the <tt>_nfsv4idmapdomain</tt> resource record, see <a href="p34.html#epubp"><tt>nfsmapid</tt> and DNS TXT Records</a>. Also, note the following:</p>
<ul><li><p>The DNS TXT RR should be explicitly configured on the DNS
server with the desired domain information.</p>
</li>
<li><p>The <tt>/etc/resolv.conf</tt> file should be configured
with the desired parameters to enable the <tt>resolver</tt> to find
the DNS server and search the TXT records for client and server NFS version
4 domains.</p>
</li>
</ul>
<p>For more information, see the following:</p>
<ul><li><p><a href="p34.html#epubt">Precedence Rules</a></p>
</li>
<li><p><a href="p34.html#gbvgf">Configuring the NFS Version 4 Default Domain</a></p>
</li>
<li><p><tt>resolv.conf</tt>(4) man page</p>
</li>
</ul>
</li>
</ul>
<a name="epubt"></a><h5>Precedence Rules</h5>
<a name="indexterm-535"></a><p>For <tt>nfsmapid</tt> to work properly, NFS version 4 clients
and servers must have the same domain. To ensure matching NFS version 4 domains, <tt>nfsmapid</tt> follows these strict precedence rules:</p>
<ol><li><p>The daemon first checks the <tt>/etc/default/nfs</tt> file
for a value that has been assigned to the NFSMAPID_DOMAIN keyword. If a value
is found, the assigned value takes precedence over any other settings. The
assigned value is appended to the outbound attribute strings and is compared
against inbound attribute strings. For more information about keywords in
the <tt>/etc/default/nfs</tt> file, see <a href="p31.html#rfsrefer-133">Keywords for the <tt>/etc/default/nfs</tt> File</a>. For
procedural information, see <a href="p19.html">Setting Up NFS Services</a>.</p>
<hr>
<p><b>Note - </b>The use of the NFSMAPID_DOMAIN setting is not scalable and is
not recommended for large deployments.</p>
<hr>
</li>
<li><p>If no value has been assigned to NFSMAPID_DOMAIN, then the
daemon checks for a domain name from a DNS TXT RR. <tt>nfsmapid</tt> relies
on directives in the <tt>/etc/resolv.conf</tt> file that are used
by the set of routines in the <tt>resolver</tt>. The <tt>resolver</tt> searches
through the configured DNS servers for the <tt>_nfsv4idmapdomain</tt> TXT
RR. Note that the use of DNS TXT records is more scalable. For this reason,
continued use of TXT records is much preferred over setting the keyword in
the <tt>/etc/default/nfs</tt> file.</p>
</li>
<li><p>If no DNS TXT record provides a domain name, then by default
the <tt>nfsmapid</tt> daemon uses the configured DNS domain.</p>
</li>
<li><p>If the <tt>/etc/resolv.conf</tt> file does not
exist, <tt>nfsmapid</tt> obtains the NFS version 4 domain name by
following the behavior of the <tt>domainname</tt> command. Specifically,
if the <tt>/etc/defaultdomain</tt> file exists, <tt>nfsmapid</tt> uses
the contents of that file for the NFS version 4 domain. If the <tt>/etc/defaultdomain</tt> file does not exist, <tt>nfsmapid</tt> uses the domain
name that is provided by the network's configured naming service. For more
information, see the <tt>domainname</tt>(1M) man page.</p>
</li>
</ol>
<a name="epubp"></a><h5><tt>nfsmapid</tt> and DNS TXT Records</h5>
<a name="indexterm-536"></a><p>The ubiquitous nature of DNS provides an efficient storage and distribution
mechanism for the NFS version 4 domain name. Additionally, because of the
inherent scalability of DNS, the use of DNS TXT resource records is the preferred
method for configuring the NFS version 4 domain name for large deployments.
You should configure the <tt>_nfsv4idmapdomain</tt> TXT record on
enterprise-level DNS servers. Such configurations ensure that any NFS version
4 client or server can find its NFS version 4 domain by traversing the DNS
tree.</p>
<p>The following is an example of a preferred entry for enabling the DNS
server to provide the NFS version 4 domain name:</p>
<pre>_nfsv4idmapdomain		IN		TXT			"foo.bar"</pre><p>In this example, the domain name to configure is the value that is enclosed
in  double-quotes. Note that no <tt>ttl</tt> field is specified
and that no domain is appended to <tt>_nfsv4idmapdomain</tt>, which
is the value in the <tt>owner</tt> field. This configuration enables
the TXT record to use the zone's <tt>${ORIGIN}</tt> entry from the
Start-Of-Authority (SOA) record. For example, at different levels of the domain
namespace, the record could read as follows:</p>
<pre>_nfsv4idmapdomain.subnet.yourcorp.com.    IN    TXT    "foo.bar"
_nfsv4idmapdomain.yourcorp.com.           IN    TXT    "foo.bar"</pre><p>This configuration provides DNS clients with the added flexibility of
using the <tt>resolv.conf</tt> file to search up the DNS tree
hierarchy. See the <tt>resolv.conf</tt>(4) man page. This capability provides a higher probability
of finding the TXT record. For even more flexibility, lower level DNS sub-domains
can define their own DNS TXT resource  records (RRs). This capability enables
lower level DNS sub-domains to override the TXT record that is defined by
the top level DNS domain.</p>
<hr>
<p><b>Note - </b>The domain that is specified by the TXT record can be an arbitrary
string that does not necessarily match the DNS domain for clients and servers
that use NFS version 4. You have the option of not sharing NFS version 4 data
with other DNS domains.</p>
<hr>
<a name="gcpfe"></a><h5>Checking for the NFS Version 4 Domain</h5>
<a name="indexterm-537"></a><p>Before assigning a value for your network's NFS version 4 domain, check
to see if an NFS version 4 domain has already been configured for your network.
The  following examples provide ways of identifying your network's NFS version
4 domain.</p>
<ul><li><p>To identify the NFS version 4 domain from a DNS TXT RR, use
either the <tt>nslookup</tt> or the <tt>dig</tt> command:</p>
<p>The following provides sample output for the <tt>nslookup</tt> command:</p>
<pre># <tt><b>nslookup -q=txt _nfsv4idmapdomain</b></tt>
Server:         10.255.255.255
Address:        10.255.255.255#53

_nfsv4idmapdomain.example.company.com text = "company.com"</pre><p>See this sample output for the <tt>dig</tt> command:</p>
<pre># <tt><b>dig +domain=</tt><i>example.company.com</i><tt> -t TXT _nfsv4idmapdomain</b></tt>
...
;; QUESTION SECTION:
;_nfsv4idmapdomain.example.company.com. IN    TXT

;; ANSWER SECTION:
_nfsv4idmapdomain.example.company.com. 21600 IN TXT   "company.com"

;; AUTHORITY SECTION:
...</pre><p>For information about setting up a DNS TXT RR, see <a href="p34.html#epubp"><tt>nfsmapid</tt> and DNS TXT Records</a>.</p>
</li>
<li><p>If your network is not setup with a NFS version 4 DNS TXT
RR, use the following command to identify your NFS version 4 domain from the
DNS domain name:</p>
<pre># <tt><b>egrep domain /etc/resolv.conf</b></tt>
domain example.company.com</pre></li>
<li><p>If the <tt>/etc/resolv.conf</tt> file is not configured
to provide a DNS domain name for the client, use the following command to
identify the domain from the network's NFS version 4 domain configuration:</p>
<pre># <tt><b>cat /var/run/nfs4_domain</b></tt>
company.com</pre></li>
<li><p>If you are using a different naming service, such as NIS,
use the following command to identify the domain for the naming service configured
for your network:</p>
<pre><tt><b># domainname</b></tt>
it.example.company.com</pre></li>
</ul>
<p>For more information, see the following man pages:</p>
<ul><li><p><tt>nslookup</tt>(1M)</p>
</li>
<li><p><tt>dig</tt>(1M)</p>
</li>
<li><p><tt>resolv.conf</tt>(4)</p>
</li>
<li><p><tt>domainname</tt>(1M)</p>
</li>
</ul>
<a name="gbvgf"></a><h5>Configuring the NFS Version 4 Default Domain</h5>
<a name="indexterm-538"></a><p>This section describes how the network obtains the desired default domain:</p>
<ul><li><p>For the Solaris Express 5/06 release, see <a href="p35.html">Configuring an NFS Version 4 Default Domain in the Solaris Express 5/06 Release</a>.</p>
</li>
<li><p>For the initial Solaris 10 release, see <a href="p35.html#gbvgu">Configuring an NFS Version 4 Default Domain in the Solaris 10 Release</a>.</p>
</li>
</ul>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p33.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p35.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

