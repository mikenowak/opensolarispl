<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Using the SSL Kernel Proxy in Zones - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Network Services<?GenHTML /ReferencePage> > <a href="p6.html">2.&nbsp;&nbsp;Managing Web Cache Servers</a> > <a href="p7.html">Administering the Caching of Web Pages (Tasks)</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p8.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p10.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="gcdwj"></a><h4>Using the SSL Kernel Proxy in Zones</h4>
<p>The SSL Kernel Proxy works in zones with the following limitations:</p>
<ul><li><p>All of the kernel SSL administration must be done
from the global zone. The global zone administrator needs access
to the local zone certificate and key files. The local zone web
server can be started once the service instance is configured using
the <tt>ksslcfg</tt> command in the global zone.</p>
</li>
<li><p>A specific host name or IP address must be specified
when running the <tt>ksslcfg</tt> command to configure
the instance. In particular, the instance can not use INADDR_ANY.</p>
</li>
</ul>
<a name="gcdwx"></a>Example 2-5 Configuring an Apache Web Server in a
Local Zone to Use the SSL Kernel Proxy<p>In the local zone, first stop the web server. In the global
zone do all of the steps to configure the service. To create a instance
for a local zone called <tt>apache-zone</tt>, use the
following command:</p>
<pre># <tt><b>ksslcfg create -f pem -i /zone/apache-zone/root/keypair.pem -p /zone/apache-zone/root/pass \
    -x 8080 apache-zone 443</b></tt></pre><p>In the local zone, run the following command to enable the
service instance:</p>
<pre># <tt><b>svcadm enable svc:/network/http:apache2</b></tt></pre><a name="nca-27"></a><h3>Caching Web Pages (Reference)</h3>
<p>The following sections cover the files and the components
that are needed to use NCA. Also, specifics about how NCA interacts
with the web server are included.</p>
<a name="nca-25"></a><h4>NCA Files</h4>
<p><a name="indexterm-23"></a>You need several files to support the NCA feature. Many
of these files are ASCII, but some of the files are binary. The
following table lists all of the files.</p>
<a name="nca-tbl-26"></a>Table 2-1 NCA Files<table><tr><th><p>File Name</p>
</th><th><p>Function</p>
</th></tr>
<tr><td><p><a name="indexterm-24"></a><tt>/dev/nca</tt> </p>
</td><td><p>The path name for the NCA device.</p>
</td></tr>
<tr><td><p><a name="indexterm-25"></a><a name="indexterm-26"></a><tt>/etc/hostname.</tt><i>*</i><tt></tt>  </p>
</td><td><p>File that lists all physical interfaces that are configured
on the server.</p>
</td></tr>
<tr><td><p><a name="indexterm-27"></a><a name="indexterm-28"></a><tt>/etc/hosts</tt>  </p>
</td><td><p>File that lists all host names that are associated with the
server. Entries in this file must match entries in <tt>/etc/hostname.</tt><i>*</i><tt></tt> files for NCA to function.</p>
</td></tr>
<tr><td><p><a name="indexterm-29"></a><a name="indexterm-30"></a><tt>/etc/init.d/ncakmod</tt>  </p>
</td><td><p>Script that starts the NCA server. This script is run when
a server is booted.</p>
</td></tr>
<tr><td><p><a name="indexterm-31"></a><a name="indexterm-32"></a><tt>/etc/init.d/ncalogd</tt>  </p>
</td><td><p>Script that starts NCA logging. This script is run when a
server is booted.</p>
</td></tr>
<tr><td><p><a name="indexterm-33"></a><a name="indexterm-34"></a><tt>/etc/nca/nca.if</tt>  </p>
</td><td><p>File that lists the interfaces on which NCA is run. See the <tt>nca.if</tt>(4) man
page for more information.</p>
</td></tr>
<tr><td><p><a name="indexterm-35"></a><a name="indexterm-36"></a><tt>/etc/nca/ncakmod.conf</tt>  </p>
</td><td><p>File that lists configuration parameters for NCA. See the <tt>ncakmod.conf</tt>(4) man page for more information.</p>
</td></tr>
<tr><td><p><a name="indexterm-37"></a><a name="indexterm-38"></a><tt>/etc/nca/ncalogd.conf</tt>   </p>
</td><td><p>File that lists configuration parameters for NCA logging.
See the <tt>ncalogd.conf</tt>(4) man page for more information.</p>
</td></tr>
<tr><td><p><a name="indexterm-39"></a><a name="indexterm-40"></a><tt>/etc/nca/ncaport.conf</tt>   </p>
</td><td><p>File that lists the IP addresses and the ports for NCA. See
the <tt>ncaport.conf</tt>(4) man page for more information.</p>
</td></tr>
<tr><td><p><a name="indexterm-41"></a><a name="indexterm-42"></a><tt>/usr/bin/ncab2clf</tt>   </p>
</td><td><p>Command that is used to convert data in the log file to the
common log format. See the <tt>ncab2clf</tt>(1) man page for more
information.</p>
</td></tr>
<tr><td><p><a name="indexterm-43"></a><a name="indexterm-44"></a><tt>/usr/lib/net/ncaconfd</tt>   </p>
</td><td><p>Command that is used to configure NCA to run on multiple interfaces
during boot. See the <tt>ncaconfd</tt>(1M) man page for more
information.</p>
</td></tr>
<tr><td><p><a name="indexterm-45"></a><a name="indexterm-46"></a><tt>/usr/lib/nca_addr.so</tt>   </p>
</td><td><p>Library that uses AF_NCA sockets instead of AF_INET sockets.
This library must be used on web servers that use AF_INET sockets.
See the <tt>ncad_addr</tt>(4) man page for more information.</p>
</td></tr>
<tr><td><p><a name="indexterm-47"></a><a name="indexterm-48"></a><a name="indexterm-49"></a><tt>/var/nca/log</tt>   </p>
</td><td><p>File that holds the log file data. The file is in binary format,
so do not edit it.</p>
</td></tr>
<tr><td><p><a name="indexterm-50"></a><a name="indexterm-51"></a><tt>/var/run/nca_httpd_1.door</tt>   </p>
</td><td><p>The door path name.</p>
</td></tr>
</table><a name="nca-28"></a><h4>NCA Architecture</h4>
<a name="indexterm-52"></a><a name="indexterm-53"></a><a name="indexterm-54"></a><a name="indexterm-55"></a><a name="indexterm-56"></a><p>The NCA feature includes the following components.</p>
<ul><li><p>Kernel module, <tt>ncakmod</tt></p>
</li>
<li><p>Web server, <tt>httpd</tt></p>
</li>
</ul>
<p>The kernel module <tt>ncakmod</tt> maintains the
cache of web pages in system memory. The module communicates with
a web server, <tt>httpd</tt>, through a sockets interface.
The family type is PF_NCA.</p>
<p>The kernel module also provides a logging facility that logs
all HTTP cache hits. NCA logging writes HTTP data to the disk in
binary format. NCA provides a conversion utility for converting
binary log files to common log format (CLF).</p>
<p>The following figure shows the flow of data for the conventional
path and the path that is used when NCA is enabled.</p>
<a name="nca-fig-42"></a>Figure 2-1 Data Flow With the NCA Service<img src="figures/nca-kern-stack.gif" alt=""></img><a name="nca-30"></a><h5>NCA to Httpd Request Flow</h5>
<p>The following list shows the request flow between the client
and the web server.</p>
<ol><li><p>An HTTP request is made from the client to the web
server.</p>
</li>
<li><p>If the page is in cache, the in-kernel cache web
page is returned.</p>
</li>
<li><p>If the page is not in cache, the request goes to
the web server to retrieve or update the page.</p>
</li>
<li><p>Depending on the HTTP protocol semantics that are
used in the response, the page is cached or not. Then the page is
returned to the client. If the Pragma: No-cache header is included
in the HTTP request, the page is not cached.</p>
</li>
</ol>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p8.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p10.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

