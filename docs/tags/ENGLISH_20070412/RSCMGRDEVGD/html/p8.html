<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Using the C Interface
to Extended Accounting - Solaris Containers: Resource Management and Solaris Zones Developer's Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-05-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >Solaris Containers: Resource Management and Solaris Zones Developer's Guide<?GenHTML /ReferencePage>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p7.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p9.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="ext-acctg-11"></a>Chapter&nbsp;3<h3>Using the C Interface
to Extended Accounting</h3><p>This chapter describes the C interface to extended accounting and covers
the following topics:</p>
<ul><li><p><a href="p8.html#ext-acctg-12">Overview of the C Interface to Extended Accounting</a></p>
</li>
<li><p><a href="p8.html#ext-acctg-16">Extended Accounting API Functions</a></p>
</li>
<li><p><a href="p9.html">C Code Examples for Accessing <tt>exacct</tt> Files</a></p>
</li>
</ul>
<a name="ext-acctg-12"></a><h3>Overview of the C Interface to Extended Accounting</h3>
<p>Projects and tasks are used to label and separate workloads. The extended
accounting subsystem is used to monitor resource consumption by workloads
that are running on the system. Extended accounting produces accounting records
for the workload tasks and processes.</p>
<p>For an overview of extended accounting and example procedures for administering
extended accounting, see Chapter 4, Extended Accounting (Overview), in <i>System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</i> and Chapter 5, Administering Extended Accounting (Tasks), in <i>System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</i>.</p>
<p>The extended accounting framework has been expanded for zones. Each
zone has its own extended accounting files for task and process-based accounting.
The extended accounting files in the global zone contain accounting records
for the global zone and for all non-global zones. The accounting records contain
a zone name tag. The global zone administrator can use the tag during the
extraction of per zone accounting data from the accounting files in the global
zone.</p>
<a name="ext-acctg-16"></a><h3>Extended Accounting API Functions</h3>
<p>The extended accounting API contains functions that perform the following: </p>
<ul><li><p><tt>exacct</tt> system calls</p>
</li>
<li><p>Operations on the <tt>exacct</tt> file</p>
</li>
<li><p>Operations on <tt>exacct</tt> objects</p>
</li>
<li><p>Miscellaneous Operations</p>
</li>
</ul>
<a name="ext-acctg-17"></a><h4><tt>exacct</tt> System Calls</h4>
<table><tr><td><p></p>
</td></tr>
<tr><td><p></p>
</td></tr>
<tr><td><p></p>
</td></tr>
</table><p>The following table lists the system calls that interact with the extended
accounting subsystem.</p>
<a name="fygec"></a>Table 3-1 Extended Accounting System Calls<table><tr><th><p>Function</p>
</th><th><p>Description</p>
</th></tr>
<tr><td><p><tt>putacct</tt>(2)</p>
</td><td><p>Provides privileged processes with the ability to tag accounting records
with additional data that is specific to the process</p>
</td></tr>
<tr><td><p><tt>getacct</tt>(2)</p>
</td><td><p>Enables privileged processes to request extended accounting buffers
from the kernel for currently executing tasks and processes</p>
</td></tr>
<tr><td><p><tt>wracct</tt>(2)</p>
</td><td><p>Requests the kernel to write resource usage data for a specified task
or process</p>
</td></tr>
</table><a name="ext-acctg-18"></a><h4>Operations on the <tt>exacct</tt> File</h4>
<p>These functions provide access to the <tt>exacct</tt> files:</p>
<a name="fygdy"></a>Table 3-2 <tt>exacct</tt> File Functions<table><tr><th><p>Function</p>
</th><th><p>Description</p>
</th></tr>
<tr><td><p><tt>ea_open</tt>(3EXACCT)</p>
</td><td><p>Opens an <tt>exacct</tt> file.</p>
</td></tr>
<tr><td><p><tt>ea_close</tt>(3EXACCT)</p>
</td><td><p>Closes an <tt>exacct</tt> file.</p>
</td></tr>
<tr><td><p><tt>ea_get_object</tt>(3EXACCT)</p>
</td><td><p>First time use on a group of objects reads data into an <tt>ea_object_t</tt> structure. Subsequent use on the group cycles through the objects
in the group.</p>
</td></tr>
<tr><td><p><tt>ea_write_object</tt>(3EXACCT)</p>
</td><td><p>Appends the specified object to the open <tt>exacct</tt> file.</p>
</td></tr>
<tr><td><p><tt>ea_next_object</tt>(3EXACCT)</p>
</td><td><p>Reads the basic fields (<tt>eo_catalog</tt> and <tt>eo_type</tt>)
into an <tt>ea_object_t</tt> structure and rewinds to the
head of the record.</p>
</td></tr>
<tr><td><p><tt>ea_previous_object</tt>(3EXACCT)</p>
</td><td><p>Skips back one object in the <tt>exacct</tt> file and reads
the basic fields (<tt>eo_catalog</tt> and <tt>eo_type</tt>)
into an <tt>ea_object_t</tt>.</p>
</td></tr>
<tr><td><p><tt>ea_get_hostname</tt>(3EXACCT)</p>
</td><td><p>Gets the name of the host on which the <tt>exacct</tt> file
was created.</p>
</td></tr>
<tr><td><p><tt>ea_get_creator</tt>(3EXACCT)</p>
</td><td><p>Determines the creator of the <tt>exacct</tt> file.</p>
</td></tr>
</table><a name="ext-acctg-19"></a><h4>Operations on <tt>exacct</tt> Objects</h4>
<p>These functions are used to access <tt>exacct</tt> objects:</p>
<a name="fygjd"></a>Table 3-3 <tt>exacct</tt> Object Functions<table><tr><th><p>Function</p>
</th><th><p>Description</p>
</th></tr>
<tr><td><p><tt>ea_set_item</tt>(3EXACCT)</p>
</td><td><p>Assigns an <tt>exacct</tt> object and sets the value(s).</p>
</td></tr>
<tr><td><p><tt>ea_set_group</tt>(3EXACCT)</p>
</td><td><p>Sets the values of a group of <tt>exacct</tt> objects.</p>
</td></tr>
<tr><td><p><tt>ea_match_object_catalog</tt>(3EXACCT)</p>
</td><td><p>Checks an <tt>exacct</tt> object's mask to see if that object
has a specific catalog tag.</p>
</td></tr>
<tr><td><p><tt>ea_attach_to_object</tt>(3EXACCT)</p>
</td><td><p>Attaches an <tt>exacct</tt> object to a specified <tt>exacct</tt> object.</p>
</td></tr>
<tr><td><p><tt>ea_attach_to_group</tt>(3EXACCT)</p>
</td><td><p>Attaches a chain of <tt>exacct</tt> objects as member items
of a specified group.</p>
</td></tr>
<tr><td><p><tt>ea_free_item</tt>(3EXACCT)</p>
</td><td><p>Frees the <tt>value</tt> fields in the specified <tt>exacct</tt> object.</p>
</td></tr>
<tr><td><p><tt>ea_free_object</tt>(3EXACCT)</p>
</td><td><p>Frees the specified <tt>exacct</tt> object and any attached
hierarchies of objects.</p>
</td></tr>
</table><a name="ext-acctg-20"></a><h4>Memory Management</h4>
<p>The following table lists the functions associated with extended accounting
memory management. The function name is a link to its man page.</p>
<a name="ext-acctg-tbl-4"></a>Table 3-4 Extended Accounting Memory
Management Functions<table><tr><th><p>Link to man page</p>
</th><th><p>Description</p>
</th></tr>
<tr><td><p><a name="indexterm-4"></a><tt>ea_pack_object</tt>(3EXACCT)</p>
</td><td><p>Converts an <tt>exacct</tt> object from unpacked (in-memory)
representation to packed (in-file) representation.</p>
</td></tr>
<tr><td><p><a name="indexterm-5"></a><tt>ea_unpack_object</tt>(3EXACCT)</p>
</td><td><p>Converts an <tt>exacct</tt> object from packed (in-file) representation
to unpacked (in-memory) representation.</p>
</td></tr>
<tr><td><p><a name="indexterm-6"></a><tt>ea_strdup</tt>(3EXACCT)</p>
</td><td><p>Duplicates a string that is to be stored inside an <tt>ea_object_t</tt> structure.</p>
</td></tr>
<tr><td><p><a name="indexterm-7"></a><tt>ea_strfree</tt>(3EXACCT)</p>
</td><td><p>Frees a string previously copied by <tt>ea_strdup()</tt>.</p>
</td></tr>
<tr><td><p><a name="indexterm-8"></a><tt>ea_alloc</tt>(3EXACCT)</p>
</td><td><p>Allocates a block of memory of the requested size. This block can be
safely passed to <tt>libexacct</tt> functions, and can be safely
freed by any of  the <tt>ea_free</tt> functions.</p>
</td></tr>
<tr><td><p><a name="indexterm-9"></a><tt>ea_free</tt>(3EXACCT)</p>
</td><td><p>Frees a block of memory previously allocated by <tt>ea_alloc()</tt>.</p>
</td></tr>
<tr><td><p><a name="indexterm-10"></a><tt>ea_free_object</tt>(3EXACCT)</p>
</td><td><p>Frees variable-length data in object hierarchy.</p>
</td></tr>
<tr><td><p><a name="indexterm-11"></a><tt>ea_free_item</tt>(3EXACCT)</p>
</td><td><p>Frees value fields of designated object, if EUP_ALLOC is specified.
The object  is not freed.  <tt>ea_free_object()</tt> frees the specified
object and any attached hierarchy of objects. If the flag argument is set
to EUP_ALLOC, <tt>ea_free_object()</tt> also frees any variable-length
data in the object hierarchy. If the flag argument is set to EUP_NOALLOC, <tt>ea_free_object()</tt> does not free the variable-length data. In particular,
these flags should correspond to the flags specified in calls to <tt>ea_unpack_object</tt>(3EXACCT).</p>
</td></tr>
<tr><td><p><a name="indexterm-12"></a><tt>ea_copy_object</tt>(3EXACCT)</p>
</td><td><p>Copies an <tt>ea_object_t</tt>. If  the source object is part
of a chain, only the current object is copied. If the source object is a group,
only  the group object is copied without its list of members. The group object <tt>eg_nobjs</tt> and <tt>eg_objs fields</tt> are set to 0 and
NULL respectively. Use <tt>ea_copy_tree()</tt> to copy recursively
a group or a list of items.</p>
</td></tr>
<tr><td><p><a name="indexterm-13"></a><tt>ea_copy_object_tree</tt>(3EXACCT)</p>
</td><td><p><tt>ea_copy_object_tree</tt> recursively copies an <tt>ea_object_t</tt>. All elements in the <tt>eo_next</tt> list are copied.
Any group objects are recursively copied. The returned object can be completely
freed with <tt>ea_free_object</tt>(3EXACCT) by specifying the EUP_ALLOC
flag. </p>
</td></tr>
<tr><td><p><a name="indexterm-14"></a><tt>ea_get_object_tree()</tt></p>
</td><td><p>Reads in nobj top-level objects  from the file, returning the same data
structure that would have originally been passed to <tt>ea_write_object()</tt>.
On encountering a group object,<tt>ea_get_object()</tt> reads only
the group header part of the group. <tt>ea_get_object_tree()</tt> reads
 the group and all its member items, recursing into subrecords if necessary.
The returned object data structure can be completely freed with <tt>ea_free_object()</tt> by specifying the EUP_ALLOC flag.</p>
</td></tr>
</table><a name="ext-acctg-21"></a><h4>Miscellaneous Operations</h4>
<p>These functions are associated with miscellaneous operations:</p>
<table><tr><td><p><tt>ea_error</tt>(3EXACCT)</p>
</td></tr>
<tr><td><p><tt>ea_match_object_catalog</tt>(3EXACCT)</p>
</td></tr>
</table>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p7.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p9.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

