<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Type and Constant Definitions - Solaris Dynamic Tracing Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2005-09-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >Solaris Dynamic Tracing Guide<?GenHTML /ReferencePage>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p17.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p19.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="chp-types"></a>Chapter&nbsp;8<h3>Type and Constant Definitions</h3><p>This chapter describes how to declare type aliases and named constants in D. This chapter also discusses D type and namespace management for program and operating system types and identifiers.</p>
<a name="chp-types-1"></a><h3>Typedef</h3>
<p><a name="indexterm-137"></a><a name="indexterm-138"></a><a name="indexterm-139"></a>The <tt>typedef</tt> keyword is used to declare an identifier as an alias for an existing type. Like all D type declarations, the <tt>typedef</tt> keyword is used outside probe clauses in a declaration of the form:</p>
<pre>typedef <i>existing-type</i> <i>new-type</i> ;</pre><p>where <i>existing-type</i> is any type declaration and <i>new-type</i> is an identifier to be used as the alias for this type. For example, the declaration:</p>
<pre>typedef unsigned char uint8_t;</pre><p>is used internally by the D compiler to create the <tt>uint8_t</tt> type alias. Type aliases can be used anywhere that a normal type can be used, such as the type of a variable or associative array value or tuple member. You can also combine <tt>typedef</tt> with more elaborate declarations such as the definition of a new <tt>struct</tt>:</p>
<pre>typedef struct foo {
	int x;
	int y;
} foo_t;</pre><p>In this example, <tt>struct foo</tt> is defined as the same type as its alias, <tt>foo_t</tt>. Solaris C system headers often use the suffix <tt>_t</tt> to denote a <tt>typedef</tt> alias.</p>
<a name="chp-types-2"></a><h3>Enumerations</h3>
<p><a name="indexterm-140"></a><a name="indexterm-141"></a>Defining symbolic names for constants in a program eases readability and simplifies the process of maintaining the program in the future. One method is to define an enumeration, which associates a set of integers with a set of identifiers called enumerators that the compiler recognizes and replaces with the corresponding integer value. An enumeration is defined using a declaration such as:</p>
<pre>enum colors {
	RED,
	GREEN,
	BLUE
};</pre><p>The first enumerator in the enumeration, <tt>RED</tt>, is assigned the value zero and each subsequent identifier is assigned the next integer value. You can also specify an explicit integer value for any enumerator by suffixing it with an equal sign and an integer constant, as in the following example:</p>
<pre>enum colors {
	RED = 7,
	GREEN = 9,
	BLUE
};</pre><p>The enumerator <tt>BLUE</tt> is assigned the value 10 by the compiler because it has no value specified and the previous enumerator is set to 9. Once an enumeration is defined, the enumerators can be used anywhere in a D program that an integer constant can be used. In addition, the enumeration <tt>enum colors</tt> is also defined as a type that is equivalent to an <tt>int</tt>. The D compiler will allow a variable of <tt>enum</tt> type to be used anywhere an <tt>int</tt> can be used, and will allow any integer value to be assigned to a variable of <tt>enum</tt> type. You can also omit the <tt>enum</tt> name in the declaration if the type name is not needed.</p>
<p>Enumerators are visible in all subsequent clauses and declarations in your program, so you cannot define the same enumerator identifier in more than one enumeration. However, you may define more than one enumerator that has the same value in either the same or different enumerations. You may also assign integers that have no corresponding enumerator to a variable of the enumeration type.</p>
<p><a name="indexterm-142"></a>The D enumeration syntax is the same as the corresponding syntax in ANSI-C. D also provides access to enumerations defined in the operating system kernel and its loadable modules, but these enumerators are not globally visible in your D program. Kernel enumerators are only visible when used as an argument to one of the binary comparison operators when compared to an object of the corresponding enumeration type. For example, the function <tt>uiomove</tt>(9F) has a parameter of type <tt>enum uio_rw</tt> defined as follows:</p>
<pre>enum uio_rw { UIO_READ, UIO_WRITE };</pre><p><a name="indexterm-143"></a><a name="indexterm-144"></a> <a name="indexterm-145"></a>The enumerators <tt>UIO_READ</tt> and <tt>UIO_WRITE</tt> are not normally visible in your D program, but you can promote them to global visibility by comparing one a value of type <tt>enum uio_rw</tt>, as shown in the following example clause:</p>
<pre>fbt::uiomove:entry
/args[2] == UIO_WRITE/
{
	...
}</pre><p>This example traces calls to the <tt>uiomove</tt>(9F) function for write requests by comparing <tt>args[2]</tt>, a variable of type <tt>enum uio_rw</tt>, to the enumerator <tt>UIO_WRITE</tt>. Because the left-hand argument is an enumeration type, the D compiler searches the enumeration when attempting to resolve the right-hand identifier. This feature protects your D programs against inadvertent identifier name conflicts with the large collection of enumerations defined in the operating system kernel.</p>
<a name="chp-types-3"></a><h3>Inlines</h3>
<p><a name="indexterm-146"></a>D named constants can also be defined using <tt>inline</tt> directives, which provide a more general means of creating identifiers that are replaced by predefined values or expressions during compilation. Inline directives are a more powerful form of lexical replacement than the <tt>#define</tt> directive provided by the C preprocessor because the replacement is assigned an actual type and is performed using the compiled syntax tree and not simply a set of lexical tokens. An inline directive is specified using a declaration of the form:</p>
<pre>inline <i>type</i> <i>name</i> = <i>expression</i> ;</pre><p>where <i>type</i> is a type declaration of an existing type, <i>name</i> is any valid D identifier that is not previously defined as an inline or global variable, and <i>expression</i> is any valid D expression. Once the inline directive is processed, the D compiler substitutes the compiled form of <i>expression</i> for each subsequent instance of <i>name</i> in the program source. For example, the following D program would trace the string <tt>"hello"</tt> and integer value <tt>123</tt>:</p>
<pre>inline string hello = "hello";
inline int number = 100 + 23;

BEGIN
{
	trace(hello);
	trace(number);
}</pre><p>An inline name may be used anywhere a global variable of the corresponding type can be used. If the inline expression can be evaluated to an integer or string constant at compile time, then the inline name can also be used in contexts that require constant expressions, such as scalar array dimensions.</p>
<p>The inline expression is validated for syntax errors as part of evaluating the directive. The expression result type must be compatible with the type defined by the inline, according to the same rules used for the D assignment operator (<tt>=</tt>). An inline expression may not reference the inline identifier itself: recursive definitions are not permitted.</p>
<p>The DTrace software packages install a number of D source files in the system directory <tt>/usr/lib/dtrace</tt> that contain inline directives you can use in your D programs. For example, the <tt>signal.d</tt> library includes directives of the form:</p>
<pre>inline int SIGHUP = 1;
inline int SIGINT = 2;
inline int SIGQUIT = 3;
...</pre><p>These inline definitions provide you access to the current set of Solaris signal names described in <tt>signal</tt>(3HEAD). Similarly, the <tt>errno.d</tt> library contains inline directives for the C <tt>errno</tt> constants described in <tt>Intro</tt>(2).</p>
<p>By default, the D compiler includes all of the provided D library files automatically so you can use these definitions in any D program.</p>
<a name="chp-types-4"></a><h3>Type Namespaces</h3>
<p><a name="indexterm-147"></a>This section discusses D namespaces and namespace issues related to types. In traditional languages such as ANSI-C, type visibility is determined by whether a type is nested inside of a function or other declaration. Types declared at the outer scope of a C program are associated with a single global namespace and are visible throughout the entire program. Types defined in C header files are typically included in this outer scope. Unlike these languages, D provides access to types from multiple outer scopes.</p>
<p>D is a language that facilitates dynamic observability across multiple layers of a software stack, including the operating system kernel, an associated set of loadable kernel modules, and user processes running on the system. A single D program may instantiate probes to gather data from multiple kernel modules or other software entities that are compiled into independent binary objects. Therefore, more than one data type of the same name, perhaps with different definitions, might be present in the universe of types available to DTrace and the D compiler. To manage this situation, the D compiler associates each type with a namespace identified by the containing program object. Types from a particular program object can be accessed by specifying the object name and backquote (<tt>`</tt>) scoping operator in any type name.</p>
<p>For example, if a kernel module named <tt>foo</tt> contains the following C type declaration:</p>
<pre>typedef struct bar {
	int x;
} bar_t;</pre><p>then the types <tt>struct bar</tt> and <tt>bar_t</tt> could be accessed from D using the type names:</p>
<pre>struct foo`bar				foo`bar_t</pre><p>The backquote operator can be used in any context where a type name is appropriate, including when specifying the type for D variable declarations or cast expressions in D probe clauses.</p>
<p><a name="indexterm-148"></a>The D compiler also provides two special built-in type namespaces that use the names <tt>C</tt> and <tt>D</tt> respectively. The C type namespace is initially populated with the standard ANSI-C intrinsic types such as <tt>int</tt>. In addition, type definitions acquired using the C preprocessor <tt>cpp</tt>(1) using the <tt>dtrace</tt> <tt>-C</tt> option will be processed by and added to the C scope. As a result, you can include C header files containing type declarations which are already visible in another type namespace without causing a compilation error.</p>
<p>The D type namespace is initially populated with the D type intrinsics such as <tt>int</tt> and <tt>string</tt> as well as the built-in D type aliases such as <tt>uint32_t</tt>. Any new type declarations that appear in the D program source are automatically added to the D type namespace. If you create a complex type such as a <tt>struct</tt> in your D program consisting of member types from other namespaces, the member types will be copied into the D namespace by the declaration.</p>
<p>When the D compiler encounters a type declaration that does not specify an explicit namespace using the backquote operator, the compiler searches the set of active type namespaces to find a match using the specified type name. The C namespace is always searched first, followed by the D namespace. If the type name is not found in either the C or D namespace, the type namespaces of the active kernel modules are searched in ascending order by kernel module ID. This ordering guarantees that the binary objects that form the core kernel are searched before any loadable kernel modules, but does not guarantee any ordering properties among the loadable modules. You should use the scoping operator when accessing types defined in loadable kernel modules to avoid type name conflicts with other kernel modules.</p>
<p>The D compiler uses compressed ANSI-C debugging information provided with the core Solaris kernel modules in order to automatically access the types associated with the operating system source code without the need for accessing the corresponding C include files. This symbolic debugging information might not be available for all kernel modules on your system. The D compiler will report an error if you attempt to access a type within the namespace of a module that lacks compressed C debugging information intended for use with DTrace.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p17.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p19.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

