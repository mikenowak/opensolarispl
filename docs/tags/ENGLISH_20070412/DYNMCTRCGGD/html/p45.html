<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title><tt>vminfo</tt> Provider - Solaris Dynamic Tracing Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2005-09-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >Solaris Dynamic Tracing Guide<?GenHTML /ReferencePage>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p44.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p46.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="chp-vminfo"></a>Chapter&nbsp;24<h3><tt>vminfo</tt> Provider</h3><p>The <tt>vminfo</tt> provider makes available probes that correspond to the <tt>vm</tt> kernel statistics. Because these statistics provide the input for system monitoring utilities like <tt>vmstat</tt>(1M), the <tt>vminfo</tt> provider enables quick exploration of observed aberrant behavior.</p>
<a name="chp-vminfo-1"></a><h3>Probes</h3>
<p><a name="indexterm-365"></a><a name="indexterm-366"></a>The <tt>vminfo</tt> provider makes available probes that correspond to the fields in the <tt>vm</tt> named kernel statistic: a probe provided by <tt>vminfo</tt> fires immediately before the corresponding <tt>vm</tt> value is incremented. To display both the names and the current values of the <tt>vm</tt> named kernel statistic, use the <tt>kstat</tt>(1M) command, as shown in the following example:</p>
<pre><tt><b>$ kstat -n vm</b></tt>
module: cpu                             instance: 0
name:   vm                              class:    misc
        anonfree                        13
        anonpgin                        2620
        anonpgout                       13
        as_fault                        12528831
        cow_fault                       2278711
        crtime                          202.10625712
        dfree                           1328740
        execfree                        0
        execpgin                        5541
        ...</pre><p>The <tt>vminfo</tt> probes are described in <a href="p45.html#tbl-vminfo">Table 24-1</a>.</p>
<a name="tbl-vminfo"></a>Table 24-1 <tt>vminfo</tt> Probes<table><tr><td><p><tt>anonfree</tt></p>
</td><td><p>Probe that fires whenever an unmodified anonymous page is freed as part of paging activity. Anonymous pages are those that are not associated with a file. Memory containing such pages includes heap memory, stack memory, or memory obtained by explicitly mapping <tt>zero</tt>(7D).</p>
</td></tr>
<tr><td><p><tt>anonpgin</tt></p>
</td><td><p>Probe that fires whenever an anonymous page is paged in from a swap device.</p>
</td></tr>
<tr><td><p><tt>anonpgout</tt></p>
</td><td><p>Probe that fires whenever a modified anonymous page is paged out to a swap device.</p>
</td></tr>
<tr><td><p><tt>as_fault</tt></p>
</td><td><p>Probe that fires whenever a fault is taken on a page and the fault is neither a protection fault nor a copy-on-write fault.</p>
</td></tr>
<tr><td><p><tt>cow_fault</tt></p>
</td><td><p>Probe that fires whenever a copy-on-write fault is taken on a page. <tt>arg0</tt> contains the number of pages that are created as a result of the copy-on-write.</p>
</td></tr>
<tr><td><p><tt>dfree</tt></p>
</td><td><p>Probe that fires whenever a page is freed as a result of paging activity. Whenever <tt>dfree</tt> fires, exactly one of <tt>anonfree</tt>, <tt>execfree</tt> or <tt>fsfree</tt> will also subsequently fire.</p>
</td></tr>
<tr><td><p><tt>execfree</tt></p>
</td><td><p>Probe that fires whenever an unmodified executable page is freed as a result of paging activity.</p>
</td></tr>
<tr><td><p><tt>execpgin</tt></p>
</td><td><p>Probe that fires whenever an executable page is paged in from the backing store.</p>
</td></tr>
<tr><td><p><tt>execpgout</tt></p>
</td><td><p>Probe that fires whenever a modified executable page is paged out to the backing store. Most paging of executable pages occurs in terms of <tt>execfree</tt>. <tt>execpgout</tt> can only fire if an executable page is modified in memory, an uncommon occurrence in most systems.</p>
</td></tr>
<tr><td><p><tt>fsfree</tt></p>
</td><td><p>Probe that fires whenever an unmodified file system data page is freed as part of paging activity.</p>
</td></tr>
<tr><td><p><tt>fspgin</tt></p>
</td><td><p>Probe that fires whenever a file system page is paged in from the backing store.</p>
</td></tr>
<tr><td><p><tt>fspgout</tt></p>
</td><td><p>Probe that fires whenever a modified file system page is paged out to the backing store.</p>
</td></tr>
<tr><td><p><tt>kernel_asflt</tt></p>
</td><td><p>Probe that fires whenever a page fault is taken by the kernel on a page in its own address space. Whenever <tt>kernel_asflt</tt> fires, it will be immediately preceded by a firing of the <tt>as_fault</tt> probe.</p>
</td></tr>
<tr><td><p><tt>maj_fault</tt></p>
</td><td><p>Probe that fires whenever a page fault is taken that results in I/O from a backing store or swap device. Whenever <tt>maj_fault</tt> fires, it will be immediately preceded by a firing of the <tt>pgin</tt> probe.</p>
</td></tr>
<tr><td><p><tt>pgfrec</tt></p>
</td><td><p>Probe that fires whenever a page is reclaimed off of the free page list.</p>
</td></tr>
<tr><td><p><tt>pgin</tt></p>
</td><td><p>Probe that fires whenever a page is paged in from the backing store or from a swap device. This probe differs from <tt>maj_fault</tt> in that <tt>maj_fault</tt> only fires when a page is paged in as a result of a page fault. <tt>pgin</tt> fires every time a page is paged in, regardless of the reason.</p>
</td></tr>
<tr><td><p><tt>pgout</tt></p>
</td><td><p>Probe that fires whenever a page is paged out to the backing store or to a swap device.</p>
</td></tr>
<tr><td><p><tt>pgpgin</tt></p>
</td><td><p>Probe that fires whenever a page is paged in from the backing store or from a swap device. The only difference between <tt>pgpgin</tt> and <tt>pgin</tt> is that <tt>pgpgin</tt> contains the number of pages paged in as <tt>arg0</tt>. <tt>pgin</tt> always contains 1 in <tt>arg0</tt>.</p>
</td></tr>
<tr><td><p><tt>pgpgout</tt></p>
</td><td><p>Probe that fires whenever a page is paged out to the backing store or to a swap device. The only difference between <tt>pgpgout</tt> and <tt>pgout</tt> is that <tt>pgpgout</tt> contains the number of pages paged out as <tt>arg0</tt>. (<tt>pgout</tt> always contains 1 in <tt>arg0</tt>.)</p>
</td></tr>
<tr><td><p><tt>pgrec</tt></p>
</td><td><p>Probe that fires whenever a page is reclaimed.</p>
</td></tr>
<tr><td><p><tt>pgrrun</tt></p>
</td><td><p>Probe that fires whenever the pager is scheduled.</p>
</td></tr>
<tr><td><p><tt>pgswapin</tt></p>
</td><td><p>Probe that fires whenever pages from a swapped-out process are swapped in. The number of pages swapped in is contained in <tt>arg0</tt>.</p>
</td></tr>
<tr><td><p><tt>pgswapout</tt></p>
</td><td><p>Probe that fires whenever pages are swapped out as part of swapping out a process. The number of pages swapped out is contained in <tt>arg0</tt>.</p>
</td></tr>
<tr><td><p><tt>prot_fault</tt></p>
</td><td><p>Probe that fires whenever a page fault is taken due to a protection violation.</p>
</td></tr>
<tr><td><p><tt>rev</tt></p>
</td><td><p>Probe that fires whenever the page daemon begins a new revolution through all pages.</p>
</td></tr>
<tr><td><p><tt>scan</tt></p>
</td><td><p>Probe that fires whenever the page daemon examines a page.</p>
</td></tr>
<tr><td><p><tt>softlock</tt></p>
</td><td><p>Probe that fires whenever a page is faulted as a part of placing a software lock on the page.</p>
</td></tr>
<tr><td><p><tt>swapin</tt></p>
</td><td><p>Probe that fires whenever a swapped-out process is swapped back in.</p>
</td></tr>
<tr><td><p><tt>swapout</tt></p>
</td><td><p>Probe that fires whenever a process is swapped out.</p>
</td></tr>
<tr><td><p><tt>zfod</tt></p>
</td><td><p>Probe that fires whenever a zero-filled page is created on demand.</p>
</td></tr>
</table><a name="chp-vminfo-2"></a><h3>Arguments</h3>
<a name="indexterm-367"></a><a name="indexterm-368"></a><table><tr><td><p><tt>arg0</tt></p>
</td><td><p>The value by which the statistic is to be incremented. For most probes, this argument is always 1, but for some it may take other values; these probes are noted in <a href="p45.html#tbl-vminfo">Table 24-1</a>.</p>
</td></tr>
<tr><td><p><tt>arg1</tt></p>
</td><td><p>A pointer to the current value of the statistic to be incremented. This value is a 64&ndash;bit quantity that will be incremented by the value in <tt>arg0</tt>. Dereferencing this pointer allows consumers to determine the current count of the statistic corresponding to the probe.</p>
</td></tr>
</table><a name="chp-vminfo-3"></a><h3>Example</h3>
<p><a name="indexterm-369"></a><a name="indexterm-370"></a>Examine the following output from <tt>vmstat</tt>(1M):</p>
<pre>kthr      memory            page            disk          faults      cpu
 r b w   swap  free  re  mf pi po fr de sr cd s0 &mdash; &mdash;   in   sy   cs us sy id
 0 1 0 1341844 836720 26 311 1644 0 0 0  0 216 0  0  0  797  817  697  9 10 81
 0 1 0 1341344 835300 238 934 1576 0 0 0 0 194 0  0  0  750 2795  791  7 14 79
 0 1 0 1340764 833668 24 165 1149 0 0 0  0 133 0  0  0  637  813  547  5  4 91
 0 1 0 1340420 833024 24 394 1002 0 0 0  0 130 0  0  0  621 2284  653 14  7 79
 0 1 0 1340068 831520 14 202 380 0 0  0  0 59  0  0  0  482 5688 1434 25  7 68</pre><p>The <tt>pi</tt> column in the above output denotes the number of pages paged in. The <tt>vminfo</tt> provider enables you to learn more about the source of these page-ins, as shown in the following example:</p>
<pre><tt><b>dtrace -n pgin'{@[execname] = count()}'</b></tt>
dtrace: description 'pgin' matched 1 probe
<tt><b>^C</b></tt>
  xterm                                                             1
  ksh                                                               1
  ls                                                                2
  lpstat                                                            7
  sh                                                               17
  soffice                                                          39
  javaldx                                                         103
  soffice.bin                                                    3065</pre><p>The output shows that a process associated with the StarOffice software, <tt>soffice.bin</tt>, is responsible for most of the page-ins. To get a better picture of <tt>soffice.bin</tt> in terms of virtual memory behavior, you could enable all <tt>vminfo</tt> probes. The following example runs <tt>dtrace</tt>(1M) while launching the StarOffice software:</p>
<pre><tt><b>dtrace -P vminfo'/execname == "soffice.bin"/{@[probename] = count()}'</b></tt>
dtrace: description 'vminfo' matched 42 probes
<tt><b>^C</b></tt>

  kernel_asflt                                                      1
  fspgin                                                           10
  pgout                                                            16
  execfree                                                         16
  execpgout                                                        16
  fsfree                                                           16
  fspgout                                                          16
  anonfree                                                         16
  anonpgout                                                        16
  pgpgout                                                          16
  dfree                                                            16
  execpgin                                                         80
  prot_fault                                                       85
  maj_fault                                                        88
  pgin                                                             90
  pgpgin                                                           90
  cow_fault                                                       859
  zfod                                                           1619
  pgfrec                                                         8811
  pgrec                                                          8827
  as_fault                                                       9495</pre><p>The following example script provides more information about the virtual memory behavior of the StarOffice software during its startup:</p>
<pre>vminfo:::maj_fault,
vminfo:::zfod,
vminfo:::as_fault
/execname == "soffice.bin" &amp;&amp; start == 0/
{
	/*
	 * This is the first time that a vminfo probe has been hit; record
	 * our initial timestamp.
	 */
	start = timestamp;
}

vminfo:::maj_fault,
vminfo:::zfod,
vminfo:::as_fault
/execname == "soffice.bin"/
{
	/*
	 * Aggregate on the probename, and lquantize() the number of seconds
	 * since our initial timestamp.  (There are 1,000,000,000 nanoseconds
	 * in a second.)  We assume that the script will be terminated before
	 * 60 seconds elapses.
	 */
	@[probename] =
	    lquantize((timestamp - start) / 1000000000, 0, 60);
}</pre><p>Run the script while again starting the StarOffice software. Then, create a new drawing, create a new presentation, and then close all files and quit the application. Press Control-C in the shell running the D script. The results provide a view of some virtual memory behavior over time:</p>
<pre><tt><b># dtrace -s ./soffice.d</b></tt>
dtrace: script './soffice.d' matched 10 probes
<tt><b>^C</b></tt>

 maj_fault                                         
           value  ------------- Distribution ------------- count    
               7 |                                         0        
               8 |@@@@@@@@@                                88       
               9 |@@@@@@@@@@@@@@@@@@@@                     194      
              10 |@                                        18       
              11 |                                         0        
              12 |                                         0        
              13 |                                         2        
              14 |                                         0        
              15 |                                         1        
              16 |@@@@@@@@                                 82       
              17 |                                         0        
              18 |                                         0        
              19 |                                         2        
              20 |                                         0        

  zfod                                              
           value  ------------- Distribution ------------- count    
             &lt; 0 |                                         0        
               0 |@@@@@@@                                  525      
               1 |@@@@@@@@                                 605      
               2 |@@                                       208      
               3 |@@@                                      280      
               4 |                                         4        
               5 |                                         0        
               6 |                                         0        
               7 |                                         0        
               8 |                                         44       
               9 |@@                                       161      
              10 |                                         2        
              11 |                                         0        
              12 |                                         0        
              13 |                                         4        
              14 |                                         0        
              15 |                                         29       
              16 |@@@@@@@@@@@@@@                           1048     
              17 |                                         24       
              18 |                                         0        
              19 |                                         0        
              20 |                                         1        
              21 |                                         0        
              22 |                                         3        
              23 |                                         0        

  as_fault                                          
           value  ------------- Distribution ------------- count    
             &lt; 0 |                                         0        
               0 |@@@@@@@@@@@@@                            4139     
               1 |@@@@@@@                                  2249     
               2 |@@@@@@@                                  2402     
               3 |@                                        594      
               4 |                                         56       
               5 |                                         0        
               6 |                                         0        
               7 |                                         0        
               8 |                                         189      
               9 |@@                                       929      
              10 |                                         39       
              11 |                                         0        
              12 |                                         0        
              13 |                                         6        
              14 |                                         0        
              15 |                                         297      
              16 |@@@@                                     1349     
              17 |                                         24       
              18 |                                         0        
              19 |                                         21       
              20 |                                         1        
              21 |                                         0        
              22 |                                         92       
              23 |                                         0</pre><p>The output shows some StarOffice behavior with respect to the virtual memory system. For example, the <tt>maj_fault</tt> probe didn't fire until a new instance of the application was started. As you would hope, a &ldquo;warm start&rdquo; of StarOffice did not result in new major faults. The <tt>as_fault</tt> output shows an initial burst of activity, latency while the user located the menu to create a new drawing, another period of idleness, and a final burst of activity when the user clicked on a new presentation. The <tt>zfod</tt> output shows that creating the new presentation induced significant pressure for zero-filled pages, but only for a short period of time.</p>
<p>The next iteration of DTrace investigation in this example would depend on the direction you want to explore. If you want to understand the source of the demand for zero-filled pages, you could aggregate on <tt>ustack()</tt> in a <tt>zfod</tt> enabling. You might want to establish a threshold for zero-filled pages and use the <tt>stop()</tt> destructive action to stop the offending process when the threshold is exceeded. This approach would enable you to use more traditional debugging tools like <tt>truss</tt>(1) or <tt>mdb</tt>(1). The <tt>vminfo</tt> provider enables you to associate statistics seen in the output of conventional tools like <tt>vmstat</tt>(1M) with the applications that are inducing the systemic behavior.</p>
<a name="chp-vminfo-stability"></a><h3>Stability</h3>
<p><a name="indexterm-371"></a><a name="indexterm-372"></a>The <tt>vminfo</tt> provider uses DTrace's stability mechanism to describe its stabilities, as shown in the following table. For more information about the stability mechanism, see <a href="p64.html">Chapter&nbsp;39, Stability</a>.</p>
<table><tr><th><p>Element</p>
</th><th><p>Name stability</p>
</th><th><p>Data stability</p>
</th><th><p>Dependency class</p>
</th></tr>
<tr><td><p>Provider</p>
</td><td><p>Evolving</p>
</td><td><p>Evolving</p>
</td><td><p>ISA</p>
</td></tr>
<tr><td><p>Module</p>
</td><td><p>Private</p>
</td><td><p>Private</p>
</td><td><p>Unknown</p>
</td></tr>
<tr><td><p>Function</p>
</td><td><p>Private</p>
</td><td><p>Private</p>
</td><td><p>Unknown</p>
</td></tr>
<tr><td><p>Name</p>
</td><td><p>Evolving</p>
</td><td><p>Evolving</p>
</td><td><p>ISA</p>
</td></tr>
<tr><td><p>Arguments</p>
</td><td><p>Private</p>
</td><td><p>Private</p>
</td><td><p>ISA</p>
</td></tr>
</table>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p44.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p46.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

