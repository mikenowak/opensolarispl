<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Troubleshooting Miscellaneous Solaris Zones
Problems - System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-05-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Solaris Containers-Resource Management and Solaris Zones<?GenHTML /ReferencePage>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p112.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p114.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="gclkx"></a>Chapter&nbsp;28<h3>Troubleshooting Miscellaneous Solaris Zones
Problems</h3><p>This chapter contains zones troubleshooting information.</p>
<a name="geoin"></a><h3>Exclusive-IP Zone Is Using Device, so <tt>dladm</tt> <tt>reset-linkprop</tt> Fails</h3>
<p>If the following error message is displayed:</p>
<pre>dladm: warning: cannot reset link property 'zone' on 'bge0': operation failed</pre><p>Referring to <a href="p109.html#geofj">How to Use <tt>dladm</tt> <tt>reset-linkprop</tt></a>,
the attempt to use <tt>dladm</tt> <tt>reset-linkprop</tt> failed.
The running zone <tt>excl</tt> is using the device, which was assigned
by executing <tt>ifconfig</tt> <tt>bge0</tt> <tt>plumb</tt> inside
the zone.</p>
<p>To reset the value, use the procedure <tt>ifconfig</tt> <tt>bge0</tt> <tt>unplumb</tt> inside the zone and rerun the <tt>dladm</tt> command.</p>
<a name="gcokc"></a><h3>Incorrect Privilege Set Specified in Zone Configuration</h3>
<p>If the zone's privilege set contains a disallowed privilege, is missing
a required privilege, or includes an unknown privilege name, an attempt to
verify, ready, or boot the zone will fail with an error message such as the
following:</p>
<pre>zonecfg:zone5> <tt><b>set limitpriv="basic"</b></tt>
.
.
.
global# <tt><b>zoneadm -z zone5 boot</b></tt>
 	required privilege "sys_mount" is missing from the zone's privilege set
 	zoneadm: zone zone5 failed to verify</pre><h3>Zone Administrator Mounting Over File Systems Populated by the
Global Zone</h3>
<p>The presence of files within a file system hierarchy when a non-global
zone is first booted indicates that the file system data is managed by the
global zone. When the non-global zone was installed, a number of the packaging
files in the global zone were duplicated inside the zone. These files must
reside under the <tt>zonepath</tt> directly. If the files reside
under a file system created by a zone administrator on disk devices or ZFS
datasets added to the zone, packaging and patching problems could occur.</p>
<p>The issue with storing any of the file system data that is managed by
the global zone in a zone-local file system can be described by using ZFS
as an example. If a ZFS dataset has been delegated to a non-global zone, the
zone administrator should not use that dataset to store any of the file system
data that is managed by the global zone. The configuration could not be patched
or upgraded correctly.</p>
<p>For example, a ZFS delegated dataset should not be used as a <tt>/var</tt> file
system. The Solaris operating system delivers core packages that install components
into <tt>/var</tt>.  These packages have to access <tt>/var</tt> when
they are upgraded or patched, which is not possible if <tt>/var</tt> is
mounted on a delegated ZFS dataset.</p>
<p>File system mounts under parts of the hierarchy controlled by the global
zone are supported. For example, if an empty <tt>/usr/local</tt> directory
exists in the global zone, the zone administrator can mount other contents
under that directory.</p>
<p>You can use a delegated ZFS dataset for file systems that do not need
to be accessed during patching or upgrade, such as <tt>/export</tt> in
the non-global zone. </p>
<a name="gdepn"></a><h3><tt>netmasks</tt> Warning Displayed When
Booting Zone</h3>
<p>If you see the following message when you boot the zone as described
in <a href="p71.html#z.inst.task-13">How to Boot a Zone</a>:</p>
<pre># <tt><b>zoneadm -z my-zone boot</b></tt>
zoneadm: zone 'my-zone': WARNING: hme0:1: no matching subnet
	found in netmasks(4) for 192.168.0.1; using default of
	255.255.255.0.</pre><p>The message is only a warning, and the command has succeeded. The message
indicates that the system was unable to find the <tt>netmask</tt> to
be used for the IP address specified in the zone's configuration.</p>
<p>To stop the warning from displaying on subsequent reboots, ensure that
the correct <tt>netmasks</tt> databases are listed in the <tt>/etc/nsswitch.conf</tt> file in the global zone and that at least one of these databases
contains the subnet and <tt>netmasks</tt> to be used for the zone <tt>my-zone</tt>.</p>
<p>For example, if the <tt>/etc/inet/netmasks</tt> file and
the local NIS database are used for resolving <tt>netmasks</tt> in
the global zone, the appropriate entry in <tt>/etc/nsswitch.conf</tt> is
as follows:</p>
<p><tt>netmasks: files nis</tt></p>
<p>The subnet and corresponding netmask information for the zone <tt>my-zone</tt> can then be added to <tt>/etc/inet/netmasks</tt> for
subsequent use.</p>
<p>For more information about the <tt>netmasks</tt> command,
see the <tt>netmasks</tt>(4) man
page.</p>
<a name="gcrsr"></a><h3>Zone Does Not Halt</h3>
<p>In the event that the system state associated with the zone cannot be
destroyed, the halt operation will fail halfway. This leaves the zone in an
intermediate state, somewhere between running and installed. In this state
there are no active user processes or kernel threads, and none can be created.
When the halt operation fails, you must manually intervene to complete the
process.</p>
<p>The most common cause of a failure is the inability of the system to
unmount all file systems. Unlike a traditional Solaris system shutdown, which
destroys the system state, zones must ensure that no mounts performed while
booting the zone or during zone operation remain once the zone has been halted.
Even though <tt>zoneadm</tt> makes sure that there are no processes
executing in the zone, the unmount operation can fail if processes in the
global zone have open files in the zone. Use the tools described in the <tt>proc</tt>(1) (see <tt>pfiles</tt>) and <tt>fuser</tt>(1M) man pages to find these processes
and take appropriate action. After these processes have been dealt with, reinvoking <tt>zoneadm</tt> <tt>halt</tt> will completely halt the zone.</p>
<a name="gchbp"></a><h3>Resolving Problems With a <tt>zoneadm</tt> <tt>attach</tt> Operation</h3>
<a name="gcgme"></a><h4><img src="graphics/procedure.gif"> Patches and Packages Are Out of Sync</h4>
<p>The target system must be running the same versions of the following
required operating system packages and patches as those installed on the original
host.</p>
<ul><li><p>Packages that deliver files under an <tt>inherit-pkg-dir</tt> resource </p>
</li>
<li><p>Packages where <tt>SUNW_PKG_ALLZONES=true</tt></p>
</li>
</ul>
<ol><li><b>If packages and patches are different between the original host
and the new host, you might see a display similar to the following:</b><pre>host2# <tt><b>zoneadm -z my-zone attach</b></tt>
	These packages installed on the source system are inconsistent with this system:
            SUNWgnome-libs (2.6.0,REV=101.0.3.2005.12.06.20.27) version mismatch
                    (2.6.0,REV=101.0.3.2005.12.19.21.22)
            SUNWudaplr (11.11,REV=2005.12.13.01.06) version mismatch
                    (11.11,REV=2006.01.03.00.45)
            SUNWradpu320 (11.10.0,REV=2005.01.21.16.34) is not installed
            SUNWaudf (11.11,REV=2005.12.13.01.06) version mismatch
                    (11.11,REV=2006.01.03.00.45)
            NCRos86r (11.10.0,REV=2005.01.17.23.31) is not installed
	These packages installed on this system were not installed on the source system:
            SUNWukspfw (11.11,REV=2006.01.03.00.45) was not installed
            SUNWsmcmd (1.0,REV=2005.12.14.01.53) was not installed
	These patches installed on the source system are inconsistent with this system:
            120081 is not installed
            118844 is not installed
            118344 is not installed
	These patches installed on this system were not installed on the source system:
            118669 was not installed
            118668 was not installed
            116299 was not installed</pre></li><li><b>To migrate the zone successfully, update the new host with the
correct packages and patches so that this content is the same on both systems.
For more information, see <a href="p84.html">Chapter&nbsp;24, About Packages and Patches on a Solaris System With Zones Installed (Overview)</a> and <a href="p91.html">Chapter&nbsp;25, Adding and Removing Packages and Patches on a Solaris System With Zones Installed (Tasks)</a>.</b></li></ol><a name="gchcg"></a><h4><img src="graphics/procedure.gif"> Operating System Releases or Machine Architectures
Do Not Match</h4>
<p>To migrate the zone successfully, install the same Solaris release that
is running on the original host on a system with the same architecture.</p>
<ol><li><b>Verify the Solaris release running on the original system and
the system architecture.</b><pre>host1# <tt><b>uname -a</b></tt></pre></li><li><b>Install the same release on the new host with the same architecture. </b><p>Refer to the Solaris installation documentation on <tt>docs.sun.com</tt>.</p></li></ol><a name="gchhk"></a>Part&nbsp;IIIBranded Zones<p>BrandZ provides the framework to create non-global branded zones that
contain non-native operating environments. Branded zones are used on the Solaris
Operating System to run applications. The first brand available is the <tt>lx</tt> brand, Solaris Containers for Linux Applications. The <tt>lx</tt> brand
provides a Linux environment for your applications and runs on x86 and x64
 machines.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p112.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p114.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

