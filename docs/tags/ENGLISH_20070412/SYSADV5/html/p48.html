<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Configuring PAM to Use UNIX <tt>policy</tt> - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-09-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)<?GenHTML /ReferencePage> > <a href="p45.html">12.&nbsp;&nbsp;Setting Up LDAP Clients (Tasks)</a> > <a href="p46.html">Initializing an LDAP Client</a> > <a href="p47.html#clientsetup-89">Configuring PAM</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p47.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p49.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="clientsetup-91"></a><h5>Configuring PAM to Use UNIX <tt>policy</tt></h5>
<p>To configure PAM to use UNIX <tt>policy</tt>, follow the sample
in <a href="p52.html#schemas-111">Example <tt>pam.conf</tt> File for <tt>pam_ldap</tt></a>.
Add the lines that contain <tt>pam_ldap.so.1</tt> to the client's <tt>/etc/pam.conf</tt> file. For details, see the <tt>pam.conf</tt>(4) man page.</p>
<a name="clientsetup-92"></a><h5>Configuring PAM to Use LDAP <tt>server_policy</tt></h5>
<p>To configure PAM to use LDAP <tt>server_policy</tt>, follow
the sample in <a href="p52.html#schemas-250">Example <tt>pam_conf</tt> file for <tt>pam_ldap</tt> Configured for Account Management</a>. Add the lines that contain <tt>pam_ldap.so.1</tt> to the client's <tt>/etc/pam.conf</tt> file. In addition,
if any PAM module in the sample <tt>pam.conf</tt> file specifies
the <tt>binding</tt> flag and  the <tt>server_policy</tt> option,
use the same flag and option for the corresponding module in the client's
 <tt>/etc/pam.conf</tt> file.   Also, add the <tt>server_policy</tt> option
to the line that contains the service module <tt>pam_authtok_store.so.1</tt>.</p>
<hr>
<p><b>Note - </b>After you enable <tt>pam_ldap</tt> account management,
all users must provide a password any time they log in to the system. A login
password is required for authentication. Therefore, nonpassword-based logins
using tools such as <tt>rsh</tt>, <tt>rlogin</tt>, or <tt>ssh</tt> will fail.</p>
<hr>
<ul><li><p>The <tt>binding</tt> control flag</p>
<p>Using
the <tt>binding</tt> control flag allows a local password  override
of a remote (LDAP) password. For example, if a user account  is found on both
the local files and the LDAP namespace,  the password associated with the
local account takes precedence over the remote password. Thus, if the local
password expires, authentication fails even if the remote LDAP password is
still valid.</p>
</li>
<li><p>The <tt>server_policy</tt> option</p>
<p>The <tt>server_policy</tt> option instructs <tt>pam_unix_auth</tt>, <tt>pam_unix_account</tt>, and <tt>pam_passwd_auth</tt> to ignore
a user found in the LDAP namespace and to allow <tt>pam_ldap</tt> to
perform authentication or account validation. In the case of <tt>pam_authtok_store</tt>, a new password is passed to the LDAP server without encryption.
The password is thereby stored in the directory according to the password
encryption scheme configured on the server. For more information, see <tt>pam.conf</tt>(4) and   <tt>pam_ldap</tt>(5).</p>
</li>
</ul>
<a name="clientsetup-59"></a><h3>Retrieving LDAP Naming Services Information</h3>
<p>You can retrieve information about LDAP naming services by using the <tt>ldaplist</tt> utility. This LDAP utility lists the naming information
from the LDAP servers in LDIF format. It can be useful for troubleshooting.
 See <tt>ldaplist</tt>(1) for
further information.</p>
<a name="clientsetup-61"></a><h4>Listing All LDAP Containers</h4>
<p><tt>ldaplist</tt> displays its output with a blank line separating
records, which is helpful for big multiline records.</p>
<hr>
<p><b>Note - </b>The output of <tt>ldaplist</tt> depends upon the client
configuration. For example, if the value of <tt>ns_ldap_search</tt> is <tt>sub</tt> rather than <tt>one</tt>, <tt>ldaplist</tt> lists
all the entries under the current search <tt>baseDN</tt>.</p>
<hr>
<p>The following is an example of <tt>ldaplist</tt> output.</p>
<pre># <tt><b>ldaplist</b></tt>
dn: ou=people,dc=west,dc=example,dc=com

dn: ou=group,dc=west,dc=example,dc=com

dn: ou=rpc,dc=west,dc=example,dc=com

dn: ou=protocols,dc=west,dc=example,dc=com

dn: ou=networks,dc=west,dc=example,dc=com

dn: ou=netgroup,dc=west,dc=example,dc=com

dn: ou=aliases,dc=west,dc=example,dc=com

dn: ou=hosts,dc=west,dc=example,dc=com

dn: ou=services,dc=west,dc=example,dc=com

dn: ou=ethers,dc=west,dc=example,dc=com

dn: ou=profile,dc=west,dc=example,dc=com

dn: automountmap=auto_home,dc=west,dc=example,dc=com

dn: automountmap=auto_direct,dc=west,dc=example,dc=com

dn: automountmap=auto_master,dc=west,dc=example,dc=com

dn: automountmap=auto_shared,dc=west,dc=example,dc=com</pre><a name="clientsetup-62"></a><h4>Listing All User Entry Attributes</h4>
<p>To list specific information such as a user's <tt>passwd</tt> entry,
use <tt>getent</tt> as follows:</p>
<pre># <tt><b>getent passwd user1</b></tt>
user1::30641:10:Joe Q. User:/home/user1:/bin/csh</pre><p>If you want to list all attributes, use <tt>ldaplist</tt> with
the <tt>-l</tt> option.</p>
<pre># <tt><b>ldaplist</b></tt> <tt>-l</tt> <tt><b>passwd user1</b></tt>dn: uid=user1,ou=People,dc=west,dc=example,dc=com
        uid: user1
        cn: user1
        uidNumber: 30641
        gidNumber: 10
        gecos: Joe Q. User
        homeDirectory: /home/user1
        loginShell: /bin/csh
        objectClass: top
        objectClass: shadowAccount
        objectClass: account
        objectClass: posixAccount
        shadowLastChange: 6445</pre><a name="clientsetup-63"></a><h3>Customizing the LDAP Client Environment</h3>
<p>The following sections describe how you can customize the client environment.</p>
<p>You can change any of the services, but be careful, because if the data
is not populated on the server for the service specified, things will stop
working. Also, in some cases files may not be set up by default.</p>
<a name="clientsetup-65"></a><h4>Modifying the <tt>nsswitch.conf</tt> File
for LDAP</h4>
<p>You can modify your <tt>/etc/nsswitch.conf</tt> file to
customize where each service gets its information.  The default settings are
stored in <tt>/etc/nsswitch.ldap</tt> and <tt>ldapclient</tt> uses
this file to create your <tt>/etc/nsswitch.conf</tt> file when
the client is initialized.</p>
<a name="clientsetup-2"></a><h4>Enabling DNS With LDAP</h4>
<p>If you want to enable DNS by setting up a <tt>/etc/resolv.conf</tt> file,
add DNS to your hosts lines as shown below.</p>
<pre>hosts:      ldap dns [NOTFOUND=return] files</pre><p>The recommended configuration
is:</p>
<p><tt>hosts: files dns</tt></p>
<p><tt>ipnodes: files dns</tt></p>
<p>If per-user
authentication is used, the sasl/GSSAPI and Kerberos mechanisms expect the
dns naming service to be configured and enabled.  See the chapters on DNS
in this administration guide for further details.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p47.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p49.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2006 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

