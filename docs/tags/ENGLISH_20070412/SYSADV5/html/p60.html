<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>N2L Server Timeout Issue - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-09-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)<?GenHTML /ReferencePage> > <a href="p55.html">15.&nbsp;&nbsp;Transitioning From NIS to LDAP (Overview/Tasks)</a> > <a href="p59.html#nis2ldap-58">NIS-to-LDAP Troubleshooting</a> > <a href="p59.html#nis2ldap-59">NIS-to-LDAP Issues</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p59.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p61.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="nis2ldap-22"></a><h5>N2L Server Timeout Issue</h5>
<ul><li><p><b>Problem</b>: The server times out.</p>
</li>
<li><p><b>Cause</b>: When the N2L server refreshes a map, the result might be a large LDAP directory access. If the Sun Java System Directory Server is not correctly configured, this operation might time out before completion.</p>
</li>
<li><p><a name="indexterm-567"></a><b>Solution</b>: To avoid directory server timeouts, modify the Sun Java System Directory Server attributes manually or by running the <tt>idsconfig</tt> command. See <a href="p59.html#nis2ldap-10">Common LDAP Error Messages</a> and <a href="p58.html#nis2ldap-16">NIS-to-LDAP Best Practices With Sun Java System Directory Server</a> for details.</p>
</li>
</ul>
<a name="nis2ldap-11"></a><h5>N2L Lock File Issue</h5>
<ul><li><p><b>Problem</b>: The <tt>ypserv</tt> command starts but does not respond to NIS requests.</p>
</li>
<li><p><b>Cause</b>: The N2L server lock files are not correctly synchronizing access to the NIS maps. This should never happen.</p>
</li>
<li><p><a name="indexterm-568"></a><b>Solution</b>: Type the following commands on the N2L server.</p>
<pre># <tt><b>svcadm disable network/nis/server:default</b></tt>
# <tt><b>rm /var/run/yp_maplock /var/run/yp_mapupdate</b></tt>
# <tt><b>svcadm enable network/nis/server:default</b></tt></pre></li>
</ul>
<a name="nis2ldap-13"></a><h5>N2L Deadlock Issue</h5>
<ul><li><p><b>Problem</b>: The N2L server deadlocks.</p>
</li>
<li><p><b>Cause</b>: If the addresses of the N2L master server and the LDAP server are not listed properly in the <tt>hosts</tt>, <tt>ipnodes</tt>, or <tt>ypserv</tt> files, a deadlock might result. See <a href="p56.html#nis2ldap-15">Prerequisites for the NIS-to-LDAP Transition</a> for details about proper address configuration for N2L.</p>
<p>For an example of a deadlock scenario, consider the following sequence of events:</p>
<ol><li><p>An NIS client tries to look up an IP address.</p>
</li>
<li><p>The N2L server finds that the <tt>hosts</tt> entry is out-of-date.</p>
</li>
<li><p>The N2L server tries to update the <tt>hosts</tt> entry from LDAP.</p>
</li>
<li><p>The N2L server gets the name of its LDAP server from <tt>ypserv</tt>, then does a search by using <tt>libldap</tt>.</p>
</li>
<li><p><tt>libldap</tt> tries to convert the LDAP server's name to an IP address by making a call to the name service switch.</p>
</li>
<li><p>The name service switch might make an NIS call to the N2L server, which deadlocks.</p>
</li>
</ol>
</li>
<li><p><b>Solution</b>: List the addresses of the N2L master server and the LDAP server in the <tt>hosts</tt> or <tt>ipnodes</tt> files on the N2L master server. Whether the server addresses must be listed in <tt>hosts</tt>, <tt>ipnodes</tt>, or both files depends on how these files are configured to resolve local host names. Also, check that the <tt>hosts</tt> and <tt>ipnodes</tt> entries
in the <tt>nsswitch.conf</tt> file list <tt>files</tt> before <tt>nis</tt> in the lookup order.</p>
<p><a name="indexterm-569"></a>An alternative solution to this deadlock problem is to list the LDAP server address, not its host name, in the <tt>ypserv</tt> file. This means that the LDAP server address would be listed in another place. Therefore, changing the address of either the LDAP server or the N2L server would require slightly more effort.</p>
</li>
</ul>
<a name="nis2ldap-42"></a><h3>Reverting to NIS</h3>
<a name="indexterm-570"></a><a name="indexterm-571"></a><a name="indexterm-572"></a><p>A site that has transitioned from NIS to LDAP using the N2L service is expected to gradually replace all NIS clients with Solaris LDAP naming services clients. Support for NIS clients eventually becomes redundant. However, if required, the
N2L service provides two ways to return to traditional NIS, as explained in the next two procedures.</p>
<hr>
<p><b>Tip - </b>Traditional NIS ignores the N2L versions of the NIS maps if those maps are present. After reverting to NIS, if you leave the N2L versions of the maps on the server, the N2L maps do not cause problems. Therefore, it might be useful to keep the N2L maps in case you later decide to re-enable N2L. However, the maps do take up disk space.</p>
<hr>
<a name="nis2ldap-proc-43"></a><h4><img src="graphics/procedure.gif"> How to Revert to Maps Based on Old Source Files</h4>
<ol><li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see Chapter 8, Using Role-Based Access Control (Tasks), in <i>System Administration Guide: Security Services</i>.</p></li><li><a name="nis2ldap-step-44"></a><b>Stop the <tt>NIS</tt> daemons.</b><pre># <tt><b>svcadm disable network/nis/server:default</b></tt></pre></li><li><a name="nis2ldap-step-45"></a><b>Disable N2L.</b><p>This command backs up and moves the N2L mapping file.</p><pre># <tt><b>mv /var/yp/NISLDAPmapping </tt><i>backup_filename</i><tt></b></tt></pre></li><li><a name="nis2ldap-step-27"></a><b>Set the <tt>NOPUSH</tt> environment variable so the new maps are not pushed by <tt>ypmake</tt>.</b><pre># <tt><b>NOPUSH=1</b></tt></pre></li><li><a name="nis2ldap-step-46"></a><b>Make a new set of NIS maps that are based on the old sources.</b><pre># <tt><b>cd /var/yp</b></tt>
# <tt><b>make</b></tt></pre></li><li><a name="nis2ldap-step-47"></a><b>(<b>Optional</b>) Remove N2L versions of the NIS maps.</b><pre># <tt><b>rm /var/yp/</tt><i>domainname</i><tt>/LDAP_*</b></tt></pre></li><li><a name="nis2ldap-step-48"></a><b>Start the <tt>NIS</tt> daemons.</b><pre># <tt><b>svcadm enable network/nis/server:default</b></tt></pre></li></ol><a name="nis2ldap-proc-49"></a><h4><img src="graphics/procedure.gif"> How to Revert to Maps Based on Current DIT Contents</h4>
<p>Back up the old NIS source files before performing this procedure. </p>
<ol><li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see Chapter 8, Using Role-Based Access Control (Tasks), in <i>System Administration Guide: Security Services</i>.</p></li><li><a name="nis2ldap-step-50"></a><b>Stop the <tt>NIS</tt> daemons.</b><pre># <tt><b>svcadm disable network/nis/server:default</b></tt></pre></li><li><a name="nis2ldap-step-51"></a><b>Update the maps from the DIT.</b><pre># <tt><b>ypserv</b></tt> <tt>-r</tt><tt><b></b></tt></pre><p>Wait for <tt>ypserv</tt> to exit.</p></li><li><a name="nis2ldap-step-53"></a><b>Disable N2L.</b><p>This command backs up and moves the N2L mapping file.</p><pre># <tt><b>mv /var/yp/NISLDAPmapping </tt><i>backup_filename</i><tt></b></tt></pre></li><li><a name="nis2ldap-step-54"></a><b>Regenerate the NIS source files.</b><pre># <tt><b>ypmap2src</b></tt></pre></li><li><a name="nis2ldap-step-55"></a><b>Manually check that regenerated NIS source files have the correct content and structure.</b></li><li><a name="nis2ldap-step-49"></a><b>Move the regenerated NIS source files to the appropriate directories.</b></li><li><a name="nis2ldap-step-56"></a><b>(<b>Optional</b>) Remove the N2L versions of the mapping files.</b><pre># <tt><b>rm /var/yp/</tt><i>domainname</i><tt>/LDAP_*</b></tt></pre></li><li><a name="nis2ldap-step-57"></a><b>Start the <tt>NIS</tt> daemons.</b><pre># <tt><b>svcadm enable network/nis/server:default</b></tt></pre></li></ol>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p59.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p61.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2006 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

