<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>How to Modify the <tt>Makefile</tt> to
Delete Databases - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-09-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)<?GenHTML /ReferencePage> > <a href="p21.html">6.&nbsp;&nbsp;Administering NIS (Tasks)</a> > <a href="p22.html#anis2-11278">Working With NIS Maps</a> > <a href="p23.html#anis2-1014">Modifying <tt>Makefile</tt> Entries</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p23.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p25.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="anis2-proc-28"></a><h4><img src="graphics/procedure.gif"> How to Modify the <tt>Makefile</tt> to
Delete Databases</h4>
<p>If you do not want the <tt>Makefile</tt> to produce maps for
a specific database, edit the <tt>Makefile</tt> as follows.</p>
<ol><li><a name="anis2-step-29"></a><b>Delete the name of the database from the <tt>all</tt> rule.</b></li><li><a name="anis2-step-30"></a><b>Delete or comment out the database rule for
the database you want to delete.</b><p><a name="indexterm-372"></a>For example, to delete the <tt>hosts</tt> database,
the <tt>hosts.time</tt> entry should be removed.</p></li><li><a name="anis2-step-31"></a><b>Remove the time rule.</b><p>For example,
to delete the <tt>hosts</tt> database, the <tt>hosts: hosts.time</tt> entry should be removed.</p></li><li><a name="anis2-step-32"></a><b>Remove the map from the master and slave servers.</b></li></ol><a name="anis2-1010"></a><h3>Updating and Modifying Existing Maps</h3>
<p>After you have installed NIS, you might discover that some maps require
frequent updating while others never need to change. For example, the <tt>passwd.byname</tt> map can change frequently on a large company's network, while
the <tt>auto_master</tt> map changes little, if at all.</p>
<p>As mentioned in <a href="p14.html#anis1-6">Default NIS Maps</a>,
the default location of the default NIS maps is on the master server in <tt>/var/yp/</tt><i>domainname</i>, where <i>domainname</i> is the name of the NIS domain. When you need to update a map,
you can use one of two updating procedures, depending on whether or not it
is a default map.</p>
<ul><li><p><a name="indexterm-373"></a>A default map is a map in the default set created by <tt>ypinit</tt> from
the network databases.</p>
</li>
<li><p><a name="indexterm-374"></a>Nondefault maps can be any of the following.</p>
<ul><li><p>Maps included with an application purchased from a vendor</p>
</li>
<li><p>Maps created specifically for your site</p>
</li>
<li><p>Maps created from a nontext file</p>
</li>
</ul>
</li>
</ul>
<p>The following sections explain how to use various updating tools. In
practice, you might decide to only use them if you add nondefault maps or
change the set of NIS servers after the system is already up and running.</p>
<a name="anis2-20918"></a><h4><img src="graphics/procedure.gif"> How to Update Maps Supplied With the Default
Set</h4>
<p>Use the following procedure for updating maps supplied with the default
set.</p>
<ol><li><a name="anis2-step-36"></a><b>Become a superuser on the master server.</b><p>Always modify NIS maps only on the master server.</p></li><li><a name="anis2-step-37"></a><b>Edit the source file for the map you want to
change, whether that file resides in <tt>/etc</tt> or in some
other directory of your choice.</b></li><li><a name="anis2-step-38"></a><b>Type the following.</b><pre># <tt><b>cd /var/yp</b></tt>
# <tt><b>make </tt><i>mapname</i><tt></b></tt></pre><p><a name="indexterm-375"></a>The <tt>make</tt> command then updates your map according
to the changes you made in its corresponding file. It also propagates the
changes among the other servers.</p></li></ol><h4>Maintaining Updated Maps</h4>
<p>The following sections describe additional procedures after you have
completed updating maps that are supplied with the default set.</p>
<h5>Propagating an NIS Map</h5>
<p>After a map is changed, the <tt>Makefile</tt> uses <tt>yppush</tt> to propagate a new map to the slave servers (unless <tt>NOPUSH</tt> is set in the <tt>Makefile</tt>).
It does this by informing the <tt>ypserv</tt> daemon and sending
a map transfer request. The <tt>ypserv</tt> daemon on the slave
then starts a <tt>ypxfr</tt> process, which in turn contacts the <tt>ypxfrd</tt> daemon on the master server. Some basic checks are made (for
example did the map really change?) and then the map is transferred. <tt>ypxfr</tt> on the slave then sends a response to the <tt>yppush</tt> process
indicating whether the transfer succeeded.</p>
<hr>
<p><b>Note - </b><a name="indexterm-376"></a>The above procedure will <b>not</b> work for newly
created maps that do not yet exist on the slave servers. New maps must be
sent to the slave servers by running <tt>ypxfr</tt> on the slaves.</p>
<hr>
<p>Occasionally, maps fail to propagate and you must to use <tt>ypxfr</tt> manually
to send new map information. You can choose to use <tt>ypxfr</tt> in
two different ways: periodically through the root <tt>crontab</tt> file,
or interactively on the command line. These approaches are discussed in the
following sections. </p>
<h5>Using <tt>cron</tt> for Map Transfers</h5>
<p>Maps have different rates of change. For instance, some might not change
for months at a time, such as <tt>protocols.byname</tt> among
the default maps and <tt>auto_master</tt> among the nondefault
maps; but <tt>passwd.byname</tt> can change several times a day.
Scheduling map transfer using the <tt>crontab</tt> command allows
you to set specific propagation times for individual maps.</p>
<p>To periodically run <tt>ypxfr</tt> at a rate appropriate for
the map, the root <tt>crontab</tt> file on each slave server should
contain the appropriate <tt>ypxfr</tt> entries. <tt>ypxfr</tt> contacts
the master server and transfers the map only if the copy on the master server
is more recent than the local copy.</p>
<hr>
<p><b>Note - </b><a name="indexterm-377"></a><a name="indexterm-378"></a><a name="indexterm-379"></a>If your master server runs <tt>rpc.yppasswdd</tt> with
the default <tt>-m</tt> option, then each time someone changes their <tt>yp</tt> password, the <tt>passwd</tt> daemon runs <tt>make</tt>,
which rebuilds the <tt>passwd</tt> maps.</p>
<hr>
<h5>Using Shell Scripts With <tt>cron</tt> and <tt>ypxfr</tt></h5>
<p>As an alternative to creating separate <tt>crontab</tt> entries
for each map, you might prefer to have the root <tt>crontab</tt> command
run a shell script that periodically updates all maps. Sample map-updating
shell scripts are n the <tt>/usr/lib/netsvc/yp</tt> directory.
The script names are <tt>ypxfr_1perday</tt>, <tt>ypxfr_1perhour</tt>,
and <tt>ypxfr_2perday</tt>. You can modify or replace these shell
scripts to fit your site requirements. <a href="p24.html#anis2-28903">Example 6-1</a> shows the default <tt>ypxfr_1perday</tt> shell
script.</p>
<a name="anis2-28903"></a>Example 6-1 <tt>ypxfr_1perday</tt> Shell Script<pre>#! /bin/sh
#
# ypxfr_1perday.sh - Do daily yp map check/updates
PATH=/bin:/usr/bin:/usr/lib/netsvc/yp:$PATH
export PATH
# set -xv
ypxfr group.byname
ypxfr group.bygid
ypxfr protocols.byname
ypxfr protocols.bynumber
ypxfr networks.byname
ypxfr networks.byaddr
ypxfr services.byname
ypxfr ypservers</pre><p>This shell script updates the maps once per day, if the root <tt>crontab</tt> is executed daily. You can also have scripts that update maps once
a week, once a month, once every hour, and so forth, but be aware of the performance
degradation implied in frequently propagating the maps.</p>
<p>Run the same shell scripts as root on each slave server configured for
the NIS domain. Alter the exact time of execution from one server to another
to avoid bogging down the master.</p>
<p>If you want to transfer the map from a particular slave server, use
the <tt>-h</tt> <i>machine</i> option of <tt>ypxfr</tt> within the shell script. Here is the syntax of the commands you
put in the script.</p>
<pre># <tt><b>/usr/lib/netsvc/yp/ypxfr</b></tt> <tt>-h</tt> <tt><b></tt><i>machine</i><tt> [</b></tt> <tt>-c</tt> <tt><b>] </tt><i>mapname</i><tt></b></tt></pre><p>Where <i>machine</i> is the name of the server with
the maps you want to transfer, and <i>mapname</i> is the
name of the requested map. If you use the <tt>-h</tt> option without
specifying a machine, <tt>ypxfr</tt> tries to get the map from the
master server. If <tt>ypserv</tt> is not running locally at the
time <tt>ypxfr</tt> is executed, you must use the <tt>-c</tt> flag
so that <tt>ypxfr</tt> does not send a clear current map request
to the local <tt>ypserver</tt>.</p>
<p>You can use the <tt>-s</tt> <i>domain</i> option
to transfer maps from another domain to your local domain. These maps should
be the same across domains. For example, two domains might share the same <tt>services.byname</tt> and <tt>services.byaddr</tt> maps.
Alternatively, you can use <tt>rcp</tt>, or <tt>rdist</tt> for
more control, to transfer files across domains.</p>
<h5>Directly Invoking <tt>ypxfr</tt></h5>
<p>The second method of invoking <tt>ypxfr</tt> is to run it
as a command. Typically, you do this only in exceptional situations&mdash;for
example, when setting up a temporary NIS server to create a test environment
or when trying to quickly get an NIS server that has been out of service consistent
with the other servers.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p23.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p25.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2006 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

