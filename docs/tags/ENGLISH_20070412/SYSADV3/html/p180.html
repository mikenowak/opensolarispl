<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p178.html#ipqos-policy-planning-1">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p178.html#ipqos-policy-planning-2">Creating IPQoS Configuration Files for Web Servers</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p179.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p181.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipqos-policy-planning-102"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Define Traffic Forwarding in the
IPQoS Configuration File</h3>
<p>The next procedure shows how to define traffic forwarding by adding per-hop
behaviors for a class into the IPQoS configuration file. </p>
<h5>Before You Begin</h5><p>The procedure assumes that you have an existing IPQoS configuration file with
already defined classes and already defined filters. The steps continue building the <tt>/var/ipqos/Goldweb.qos</tt> file from <A HREF="p178.html#ipqos-policy-planning-ex-93">Example 34-1</A>.</p>
<p><hr size="1" noshade><p><b>Note - </b>The procedure shows how to configure traffic forwarding by using the <tt>dscpmk</tt> marker module. For information about traffic forwarding on VLAN systems
by using the <tt>dlclosmk</tt> marker, refer to <A HREF="p190.html#ipqos-reference-110">Using the <tt>dlcosmk</tt> Marker With VLAN Devices</A>.</p>
<hr size="1" noshade></p><ol><A NAME="ipqos-policy-planning-step-107"></A><li><p><b>Open the IPQoS configuration file,
and locate the end of the last filter you defined.</b></p><p>For example, on the
IPQoS-enabled server <tt>Goldweb,</tt> you would start after the following <tt>filter</tt> clause in <tt>/var/ipqos/Goldweb.qos</tt>:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>filter {
        name videoout
        sport videosrv
        direction LOCAL_OUT
        class video
    }
}</pre>
</td></table><br><p>Note that this <tt>filter</tt> clause is at the end of the <tt>ipgpc</tt> classifier <tt>action</tt> statement. Therefore, you need
a closing brace to terminate the filter and a second closing brace to terminate the <tt>action</tt> statement.</p>
</li>
<A NAME="ipqos-policy-planning-step-104"></A><li><p><b><A NAME="indexterm-3103"></A><A NAME="indexterm-3104"></A>Invoke the marker with the following <tt>action</tt> statement.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>action {
    module dscpmk
    name markAF11</b></tt></pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p>module dscpmk</p></td><td valign="top"><p>Calls the marker module <tt>dscpmk</tt>.</p>
</td></tr><tr><td valign="top"><p>name markAF11</p></td><td valign="top"><p>Gives the name <tt>markAF11</tt> to the <tt>action</tt> statement.</p>
</td></tr></table>
<p>The previously defined class <tt>goldweb</tt> includes a <tt>next_action markAF11</tt> statement. This statement sends traffic flows to the <tt>markAF11</tt> action statement after the classifier concludes processing.</p>
</li>
<A NAME="ipqos-policy-planning-step-105"></A><li><p><b><A NAME="indexterm-3105"></A><A NAME="indexterm-3106"></A>Define actions for the marker to take on the traffic flow.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>    params {
        global_stats FALSE
        dscp_map{0-63:10}
        next_action continue
    }
}</b></tt></pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p>global_stats FALSE</p></td><td valign="top"><p>Enables statistics collection for the <tt>markAF11</tt> marker <tt>action</tt> statement. However, because the value of <tt>enable_stats</tt> is <tt>FALSE</tt>, statistics are not collected.</p>
</td></tr><tr><td valign="top"><p>dscp_map{0-63:10}</p></td><td valign="top"><p>Assigns a DSCP of <tt>10</tt> to the packet headers of the
traffic class <tt>goldweb</tt>, which is currently being processed by the
marker.</p>
</td></tr><tr><td valign="top"><p>next_action continue</p></td><td valign="top"><p>Indicates that no further processing is required on packets of the
traffic class <tt>goldweb</tt>, and that these packets can return to the
network stream.</p>
</td></tr></table>
<p><A NAME="indexterm-3107"></A>The DSCP of <tt>10</tt> instructs the marker to set all entries
in the <tt>dscp</tt> map to the decimal value 10 (binary 001010). This codepoint
indicates that packets of the <tt>goldweb</tt> traffic class are subject
to the AF11 per-hop behavior. AF11 guarantees that all packets with the DSCP of <tt>10</tt> receive a low-drop, high-priority service. Thus, outgoing traffic for
premium customers on <tt>Goldweb</tt> is given the highest priority that
is available for the Assured Forwarding (AF) PHB. For a table of possible DSCPs for
AF, refer to <A HREF="p189.html#ipqos-reference-tbl-16">Table 37-2</A>.</p>
</li>
<A NAME="ipqos-policy-planning-step-108"></A><li><p><b>Start another marker <tt>action</tt> statement.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>action {
    module dscpmk
    name markEF</b></tt>    </pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p>module dscpmk</p></td><td valign="top"><p>Calls the marker module <tt>dscpmk</tt>.</p>
</td></tr><tr><td valign="top"><p><tt>name markEF</tt></p></td><td valign="top"><p>Gives the name <tt>markEF</tt> to the <tt>action</tt> statement.</p>
</td></tr></table>
</li>
<A NAME="ipqos-policy-planning-step-109"></A><li><p><b>Define actions for the marker to take
on the traffic flow.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>    params {
        global_stats TRUE
        dscp_map{0-63:46}
        next_action acct
    }
}</b></tt></pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p><tt>global_stats TRUE</tt></p></td><td valign="top"><p>Enables statistics collection on class <tt>video</tt>, which
selects streaming video packets.</p>
</td></tr><tr><td valign="top"><p><tt>dscp_map{0-63:46}</tt></p></td><td valign="top"><p>Assigns a DSCP of <tt>46</tt> to the packet headers of the
traffic class <tt>video</tt>, which is currently being processed by the
marker. </p>
</td></tr><tr><td valign="top"><p><tt>next_action acct</tt></p></td><td valign="top"><p>Instructs the <tt>dscpmk</tt> module to pass packets of
the class <tt>video</tt> to the <tt>acct</tt> <tt>action</tt> statement after <tt>dscpmk</tt> completes processing. The <tt>acct</tt> <tt>action</tt> statement invokes the <tt>flowacct</tt> module.</p>
</td></tr></table>
<p><A NAME="indexterm-3108"></A>The DSCP of <tt>46</tt> instructs the <tt>dscpmk</tt> module
to set all entries in the <tt>dscp</tt> map to the decimal value 46 (binary
101110) in the DS field. This codepoint indicates that packets of the <tt>video</tt> traffic class are subject to the Expedited Forwarding (EF) per-hop behavior. </p>
<p><hr size="1" noshade><p><b>Note - </b>The recommended codepoint for EF is 46 (binary 101110). Other DSCPs assign
AF PHBs to a packet.</p>
<hr size="1" noshade></p><p>The EF PHB guarantees that packets with the DSCP of <tt>46</tt> are
given the highest precedence by IPQoS and Diffserv-aware systems. Streaming applications
require highest-priority service, which is the rationale behind assigning to streaming
applications the EF PHBs in the QoS policy. For more details about the expedited forwarding
PHB, refer to <A HREF="p189.html#ipqos-reference-140">Expedited Forwarding (EF) PHB</A>.</p>
</li>
<A NAME="ipqos-policy-planning-step-113"></A><li><p><b>Add the DSCPs that you have just created
to the appropriate files on the Diffserv router. </b></p><p>For more information,
refer to <A HREF="p183.html#ipqos-policy-planning-136">How to Configure a Router on an IPQoS-Enabled Network</A>.</p>
</li>
</ol><h5>See Also</h5><ul><li><p>To start gathering flow-accounting statistics on traffic flows, refer
to <A HREF="p180.html#ipqos-policy-planning-110">How to Enable Accounting for a Class in the IPQoS Configuration File</A>.</p>
</li>
<li><p>To define forwarding behaviors for the marker modules, refer to <A HREF="p180.html#ipqos-policy-planning-102">How to Define Traffic Forwarding in the IPQoS Configuration File</A>.</p>
</li>
<li><p>To define flow-control parameters for the metering modules, refer
to <A HREF="p183.html#ipqos-policy-planning-144">How to Configure Flow Control in the IPQoS Configuration File</A>.</p>
</li>
<li><p>To activate the IPQoS configuration file, refer to <A HREF="p184.html#ipqos-maint-5">How to Apply a New Configuration to the IPQoS Kernel Modules</A>.</p>
</li>
<li><p>To define additional filters, refer to <A HREF="p179.html#ipqos-policy-planning-33">How to Define Filters in the IPQoS Configuration File</A>.</p>
</li>
<li><p>To create classes for traffic flows from applications, refer to <A HREF="p182.html#ipqos-policy-planning-67">How to Configure the IPQoS Configuration File for an Application Server</A>.</p>
</li>
</ul>
<A NAME="ipqos-policy-planning-110"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Enable Accounting for a Class in
the IPQoS Configuration File</h3>
<p>The next procedure shows how to enable accounting on a traffic class in the
IPQoS configuration file. The procedure shows how to define flow accounting for the <tt>video</tt> class, which is introduced in <A HREF="p179.html#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</A>. This
class selects streaming video traffic, which must be billed as part of a premium customer's
SLA. </p>
<h5>Before You Begin</h5><p>The procedure assumes that you have an existing IPQoS configuration file with
already defined classes, filters, metering actions, if appropriate, and marking actions,
if appropriate. The steps continue building the <tt>/var/ipqos/Goldweb.qos</tt> file
from <A HREF="p178.html#ipqos-policy-planning-ex-93">Example 34-1</A>.</p>
<ol><A NAME="ipqos-policy-planning-step-115"></A><li><p><b>Open the IPQoS configuration file,
and locate the end of the last <tt>action</tt> statement you defined.</b></p><p>For example, on the IPQoS-enabled server <tt>Goldweb,</tt> you would
start after the following <tt>markEF</tt> <tt>action</tt> statement
in <tt>/var/ipqos/Goldweb.qos</tt>.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>action {
    module dscpmk
    name markEF
    params {
        global_stats TRUE
        dscp_map{0-63:46}
        next_action acct
    }
}</pre>
</td></table><br></li>
<A NAME="ipqos-policy-planning-step-116"></A><li><p><b><A NAME="indexterm-3109"></A>Begin an <tt>action</tt> statement that calls flow accounting.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>action {
    module flowacct
    name acct</b></tt></pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p><tt>module flowacct</tt></p></td><td valign="top"><p>Invokes the flow-accounting module <tt>flowacct</tt>.</p>
</td></tr><tr><td valign="top"><p><tt>name acct</tt></p></td><td valign="top"><p>Gives the name <tt>acct</tt> to the <tt>action</tt> statement</p>
</td></tr></table>
</li>
<A NAME="ipqos-policy-planning-step-112"></A><li><p><b><A NAME="indexterm-3110"></A>Define a <tt>params</tt> clause to control accounting on the
traffic class.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>params {
        global_stats TRUE
        timer 10000
        timeout 10000
        max_limit 2048
        next_action continue
  </b></tt>  }
}</pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p><tt>global_stats TRUE</tt></p></td><td valign="top"><p>Enables statistics collection on the class <tt>video</tt>,
which selects streaming video packets.</p>
</td></tr><tr><td valign="top"><p><tt>timer 10000</tt></p></td><td valign="top"><p>Specifies the duration of the interval, in milliseconds, when the
flow table is scanned for timed-out flows. In this parameter, that interval is 10000
milliseconds. </p>
</td></tr><tr><td valign="top"><p><tt>timeout 10000</tt></p></td><td valign="top"><p>Specifies the minimum interval time out value. A flow "times
out" when packets for the flow are not seen during a time out interval. In this
parameter, packets time out after 10000 milliseconds.</p>
</td></tr><tr><td valign="top"><p><tt>max_limit 2048</tt></p></td><td valign="top"><p>Sets the maximum number of active flow records in the flow table for
this action instance.</p>
</td></tr><tr><td valign="top"><p><tt>next_action continue</tt></p></td><td valign="top"><p>Indicates that no further processing is required on packets of the
traffic class <tt>video</tt>, and that these packets can return to the network
stream.</p>
</td></tr></table>
<p><A NAME="indexterm-3111"></A>The <tt>flowacct</tt> module gathers statistical information
on packet flows of a particular class until a specified <tt>timeout</tt> value
is reached.</p>
</li>
</ol><h5>See Also</h5><ul><li><p>To configure per-hop behaviors on a router, refer to <A HREF="p183.html#ipqos-policy-planning-136">How to Configure a Router on an IPQoS-Enabled Network</A>.</p>
</li>
<li><p>To activate the IPQoS configuration file, refer to <A HREF="p184.html#ipqos-maint-5">How to Apply a New Configuration to the IPQoS Kernel Modules</A>.</p>
</li>
<li><p>To create classes for traffic flows from applications, refer to <A HREF="p182.html#ipqos-policy-planning-67">How to Configure the IPQoS Configuration File for an Application Server</A>.</p>
</li>
</ul>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p179.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p181.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

