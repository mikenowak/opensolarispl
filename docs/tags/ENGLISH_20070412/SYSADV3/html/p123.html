<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p119.html#ike-task-1">23.&nbsp;&nbsp;Configuring IKE (Tasks)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p121.html#ike-task-25">Configuring IKE With Public Key Certificates</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p122.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p124.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ike-task-14"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Generate and Store Public Key Certificates
on Hardware</h3>
<A NAME="indexterm-2119"></A><p>Generating and storing public key certificates on hardware is similar
to generating and storing public key certificates on your system. On hardware, the <tt>ikecert certlocal</tt> and <tt>ikecert certdb</tt> commands must identify the hardware. The <tt>-T</tt> option
with the token ID identifies the hardware to the commands.</p>
<h5>Before You Begin</h5><ul><li><p>The hardware must be configured.</p>
</li>
<li><p>The hardware
uses the <tt>/usr/lib/libpkcs11.so</tt> library unless the <tt>pkcs11_path</tt> keyword in the <tt>/etc/inet/ike/config</tt> file points
to a different library. The library must be implemented according
to the following standard: RSA Security Inc. PKCS&nbsp;#11 Cryptographic Token
Interface (Cryptoki), that is, a PKCS&nbsp;#11 library.</p>
<p><A NAME="indexterm-2120"></A><A NAME="indexterm-2121"></A>See <A HREF="p125.html#ike-task-11">How to Configure IKE to Find the Sun Crypto Accelerator 4000 Board</A> for setup instructions.</p>
</li>
</ul>
<ol><li><p><b>On the system console, assume the Primary Administrator role or
become superuser.</b></p><p>The Primary Administrator role includes the
Primary Administrator profile. To create the role and assign the role to a
user, see Chapter 2, "Working With the Solaris Management Console (Tasks)," in <i>System Administration Guide: Basic Administration</i>.</p>
<p><hr size="1" noshade><p><b>Note - </b><A NAME="indexterm-2122"></A>Logging in remotely exposes security-critical traffic to eavesdropping.
Even if you somehow protect the remote login, the security of the system is
reduced to the security of the remote login session.</p>
<hr size="1" noshade></p></li>
<li><p><b><A NAME="indexterm-2123"></A><A NAME="indexterm-2124"></A><A NAME="indexterm-2125"></A><A NAME="indexterm-2126"></A>Generate a self-signed certificate or a certificate request, and
specify the token ID.</b></p><p>Choose one of the following options:</p>
<p><hr size="1" noshade><p><b>Note - </b>The Sun Crypto Accelerator 4000 board supports keys up to 2048 bits for RSA. For DSA,
this board supports keys up to 1024 bits.</p>
<hr size="1" noshade></p><ul><li><p><b>For a self-signed certificate, use this syntax.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certlocal -ks -m 1024 -t rsa-md5 \</b></tt>
> <tt><b>-D "C=US, O=PartyCompany, OU=US-Partym, CN=Partym" \</b></tt>
> <tt><b>-a -T dca0-accel-stor IP=192.168.116.16</b></tt>
Creating hardware private keys.
Enter PIN for PKCS#11 token: <em>Type user:password</em></pre>
</td></table><br><p>The argument to the <tt>-T</tt> option is the token ID from the
attached Sun Crypto Accelerator 4000 board.</p>
</li>
<li><p><b><A NAME="indexterm-2127"></A><A NAME="indexterm-2128"></A>For a certificate request, use this syntax.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certlocal -kc -m 1024 -t rsa-md5 \</b></tt>
> <tt><b>-D "C=US, O=PartyCompany, OU=US-Partym, CN=Partym" \</b></tt>
> <tt><b>-a -T dca0-accel-stor IP=192.168.116.16</b></tt>
Creating hardware private keys.
Enter PIN for PKCS#11 token: <em>Type user:password</em></pre>
</td></table><br></li>
</ul>
<p>For a description of the arguments to the <tt>ikecert</tt> command,
see the <tt>ikecert</tt>(1M) man
page.</p>
</li>
<A NAME="ike-task-pin-1"></A><li><p><b>At the prompt for a PIN, type the Sun Crypto Accelerator 4000 user,
a colon, and the user's password. </b></p><p>If the Sun Crypto Accelerator 4000 board has a user <tt>ikemgr</tt> whose password is <tt>rgm4tigt</tt>, you would
type the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>Enter PIN for PKCS#11 token: <tt><b>ikemgr:rgm4tigt</b></tt></pre>
</td></table><br><p><hr size="1" noshade><p><b>Note - </b>The PIN response is stored on disk <b>as clear text</b>.</p>
<hr size="1" noshade></p><p>After you type the password, the certificate prints out:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>Enter PIN for PKCS#11 token: <tt><b>ikemgr:rgm4tigt</b></tt>
-----BEGIN X509 CERTIFICATE-----
MIIBuDCCASECAQAwSTELMAkGA1UEBhMCVVMxFTATBgNVBAoTDFBhcnR5Q29tcGFu
...
oKUDBbZ9O/pLWYGr
-----END X509 CERTIFICATE-----</pre>
</td></table><br></li>
<li><p><b>Send your certificate for use by the other party.</b></p><p>Choose
one of the following options:</p>
<ul><li><p><b>Send the self-signed certificate to the remote system.</b></p><p>You
can paste the certificate into an email.</p>
</li>
<li><p><b>Send the certificate request to an organization that handles PKI.</b></p><p>Follow the instructions of the PKI organization to submit the certificate
request. For a more detailed discussion, see <A HREF="p122.html#ike-task-pki-1">Step&nbsp;3</A> of <A HREF="p122.html#ike-task-41">How to Configure IKE With Certificates Signed by a CA</A>.</p>
</li>
</ul>
</li>
<li><p><b><A NAME="indexterm-2129"></A><A NAME="indexterm-2130"></A>On your system, edit the <tt>/etc/inet/ike/config</tt> file
to recognize the certificates.</b></p><p>Choose one of the following options.</p>
<ul><li><p><b><A NAME="indexterm-2131"></A><A NAME="indexterm-2132"></A>Self-signed certificate</b></p><p>Use the values that the administrator
of the remote system provides for the <tt>cert_trust</tt>, <tt>remote_id</tt>, and <tt>remote_addr</tt> parameters. For example, on
the <tt>enigma</tt> system, the <tt>ike/config</tt> file
would appear similar to the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># Explicitly trust the following self-signed certs
# Use the Subject Alternate Name to identify the cert

cert_trust "192.168.116.16"  <em>Local system's certificate Subject Alt Name</em>
cert_trust "192.168.13.213"  <em>Remote system's certificate Subject Alt name</em>


# Solaris 10 1/06 release: default path does not have to be typed in
#pkcs11_path "/usr/lib/libpkcs11.so" <em>Hardware connection</em>

# Solaris 10 release: use this path
#pkcs11_path "/opt/SUNWconn/cryptov2/lib/libvpkcs11.so"
...
{
 label "JA-enigmax to US-partym"
 local_id_type dn
 local_id "C=JA, O=EnigmaCo, OU=JA-Enigmax, CN=Enigmax"
 remote_id "C=US, O=PartyCompany, OU=US-Partym, CN=Partym"

 local_addr  192.168.116.16
 remote_addr 192.168.13.213

 p1_xform
  {auth_method rsa_sig oakley_group 2 auth_alg md5 encr_alg 3des}
}</pre>
</td></table><br></li>
<li><p><b>Certificate request</b></p><p><A NAME="indexterm-2133"></A><A NAME="indexterm-2134"></A><A NAME="indexterm-2135"></A>Type the name that the PKI organization provides as the value
for the <tt>cert_root</tt> keyword. For example, the <tt>ike/config</tt> file on the <tt>enigma</tt> system might appear
similar to the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># Trusted root cert
# This certificate is from Example PKI
# This is the X.509 distinguished name for the CA that it issues.

cert_root "C=US, O=ExamplePKI\, Inc., OU=PKI-Example, CN=Example PKI"

# Solaris 10 1/06 release: default path does not have to be typed in
#pkcs11_path "/usr/lib/libpkcs11.so" <em>Hardware connection</em>

# Solaris 10 release: use this path
#pkcs11_path "/opt/SUNWconn/cryptov2/lib/libvpkcs11.so"
...
{
 label "JA-enigmax to US-partym - Example PKI"
 local_id_type dn
 local_id "C=JA, O=EnigmaCo, OU=JA-Enigmax, CN=Enigmax"
 remote_id  "C=US, O=PartyCompany, OU=US-Partym, CN=Partym"

 local_addr  192.168.116.16
 remote_addr 192.168.13.213

 p1_xform
  {auth_method rsa_sig oakley_group 2 auth_alg md5 encr_alg 3des}
}</pre>
</td></table><br></li>
</ul>
</li>
<li><p><b>Place the certificates from the other party in the hardware.</b></p><p>Respond to the PIN request as you responded in <A HREF="p123.html#ike-task-pin-1">Step&nbsp;3</A>.</p>
<p><hr size="1" noshade><p><b>Note - </b>You <b>must</b> add the public key certificates
to the same attached hardware that generated your private key.</p>
<hr size="1" noshade></p><ul><li><p><b>Self-signed certificate.</b></p><p>Add the remote system's self-signed
certificate. In this
example, the certificate is stored in the file, <tt>DCA.ACCEL.STOR.CERT</tt>.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certdb -a -T dca0-accel-stor &lt; DCA.ACCEL.STOR.CERT</b></tt>
Enter PIN for PKCS#11 token: <em>Type user:password</em></pre>
</td></table><br><p>If the self-signed certificate used <tt>rsa_encrypt</tt> as
the value for the <tt>auth_method</tt> parameter, add the peer's
certificate to the hardware store.</p>
</li>
<li><p><b><A NAME="indexterm-2136"></A>Certificates from a PKI organization.</b></p><p>Add the certificate
that the organization generated from your certificate request, and add the
certificate authority (CA).</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certdb -a -T dca0-accel-stor &lt; DCA.ACCEL.STOR.CERT</b></tt>
Enter PIN for PKCS#11 token: <em>Type user:password</em></pre>
</td></table><br><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certdb -a -T dca0-accel-stor &lt; DCA.ACCEL.STOR.CA.CERT</b></tt>
Enter PIN for PKCS#11 token: <em>Type user:password</em></pre>
</td></table><br><p>To add a certificate revocation list (CRL) from the PKI organization,
see <A HREF="p124.html#ike-task-22">How to Handle a Certificate Revocation List</A>.</p>
</li>
</ul>
</li>
</ol>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p122.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p124.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

