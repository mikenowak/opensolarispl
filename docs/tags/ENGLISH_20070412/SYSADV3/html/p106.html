<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p103.html#ipsec-ov-1">19.&nbsp;&nbsp;IP Security Architecture (Overview)</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p105.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p107.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipsec-ov-15"></A><h2>Virtual Private Networks and IPsec</h2>
<p><A NAME="indexterm-1703"></A><A NAME="indexterm-1704"></A><A NAME="indexterm-1705"></A>A configured tunnel is a point-to-point interface. The tunnel
enables one IP packet to be encapsulated within another IP packet. A correctly
configured tunnel requires both a tunnel source and a tunnel destination.
For more information, see the <tt>tun</tt>(7M) man
page and <A HREF="p37.html#ipv6-config-tasks-16">Configuring Tunnels for IPv6 Support</A>. </p>
<p><A NAME="indexterm-1706"></A>A tunnel creates an apparent <A HREF="p193.html#glossary-68">physical interface</A> to IP. The physical link's integrity depends on the underlying
security protocols. If you set up the security associations (SAs) securely,
then you can trust the tunnel. Packets that exit the tunnel must have originated
from the peer that was specified in the tunnel destination. If this trust
exists, you can use per-interface IP forwarding to create a <A HREF="p193.html#glossary-57">virtual private network (VPN)</A>.</p>
<p><A NAME="indexterm-1707"></A><A NAME="indexterm-1708"></A>You can use IPsec to construct a VPN. IPsec secures the connection.
For example, an organization that uses VPN technology to connect offices with
separate networks can deploy IPsec to secure traffic between the two offices.</p>
<p>The following figure illustrates how two offices use the Internet to
form their VPN with IPsec deployed on their network systems.</p>
<A NAME="ipsec-ov-fig-4"></A><p><b>Figure 19-7 </b>Virtual Private Network</p>
<IMG src="figures/IPsecvpn.gif" class="figure" alt="Diagram shows that Offices 1 and 2 use the hme0 interface
to communicate with each other. Each office uses hme1 for internal communication." title="Diagram shows that Offices 1 and 2 use the hme0 interface
to communicate with each other. Each office uses hme1 for internal communication."><p>For a detailed example of the setup procedure, see <A HREF="p111.html#ipsec-mgtasks-23">How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv4</A>. For IPv6 networks, see <A HREF="p112.html#ipsec-mgtasks-15">How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv6</A>.</p>
<A NAME="ipsec-ov-24"></A><h2>IPsec and NAT Traversal</h2>
<A NAME="indexterm-1709"></A><A NAME="indexterm-1710"></A><p>IKE can negotiate IPsec SAs across a <A HREF="p193.html#glossary-140">NAT</A> box.
This ability enables systems to securely connect from a remote network, even
when the systems are behind a NAT device. For example, employees who work
from home, or who log on from a conference site can protect their traffic
with IPsec.</p>
<p>NAT stands for network address translation. A NAT box is used to translate
a private internal address into a unique Internet address. NATs are very common
at public access points to the Internet, such as hotels. For a fuller discussion,
see <A HREF="p130.html#euqfc">Using Solaris IP Filter's NAT Feature</A>.</p>
<p>The ability to use IKE when a NAT box is between communicating systems
is called NAT traversal, or NAT-T. In the Solaris 10 release, NAT-T has the
following limitations:</p>
<ul><li><p>NAT-T works on IPv4 networks only.</p>
</li>
<li><p>NAT-T cannot take advantage of the	IPsec ESP acceleration
provided by the Sun Crypto Accelerator 4000 board. However, IKE acceleration with the Sun Crypto Accelerator 4000 board
works.</p>
</li>
<li><p>The AH protocol depends on an unchanging IP header, therefore
AH cannot work with NAT-T. The ESP protocol is used with NAT-T.</p>
</li>
<li><p>The NAT box does not use special processing rules. A NAT box
with special IPsec processing rules might interfere with the implementation
of NAT-T.</p>
</li>
<li><p>NAT-T works only when the IKE initiator is the system behind
the NAT box. An IKE responder cannot be behind a NAT box unless the box has
been programmed to forward IKE packets to the appropriate individual system
behind the box.</p>
</li>
</ul>
<p>The following RFCs describe NAT functionality and the limits of NAT-T.
Copies of the RFCs can be retrieved from <A  HREF="http://www.rfc-editor.org">http://www.rfc-editor.org</A>.</p>
<ul><li><p>RFC 3022, "Traditional IP Network Address Translator
(Traditional NAT)," January 2001</p>
</li>
<li><p>RFC 3715, "IPsec-Network Address Translation (NAT) Compatibility
 Requirements," March 2004</p>
</li>
<li><p>RFC 3947, "Negotiation of NAT-Traversal in the IKE," January
2005</p>
</li>
<li><p>RFC 3948, "UDP Encapsulation of
IPsec Packets," January 2005</p>
</li>
</ul>
<p>To use IPsec across a NAT, see <A HREF="p124.html#ike-task-38">Configuring IKE for Mobile Systems (Task Map)</A>.</p>
<A NAME="ipsec-ov-22"></A><h2>IPsec and SCTP</h2>
<A NAME="indexterm-1711"></A><A NAME="indexterm-1712"></A><p>The Solaris 10 release supports the Streams Control Transmission Protocol
(SCTP). The use of the SCTP protocol and SCTP port number to specify IPsec
policy is supported, but is not robust. The IPsec extensions for SCTP as specified
in RFC 3554 are not yet implemented. These limitations can create complications
in creating IPsec policy for SCTP.</p>
<p>SCTP can make use of multiple source and destination addresses in the
context of a single SCTP association. When IPsec policy is applied to a single
source or a single destination address, communication can fail when SCTP switches
the source or the destination address of that association. IPsec policy only
recognizes the original address. For information about SCTP, read the RFCs
and <A HREF="p4.html#ermih">SCTP Protocol</A>.</p>
<A NAME="ipsec-ov-18"></A><h2>IPsec and Solaris Zones</h2>
<p><A NAME="indexterm-1713"></A><A NAME="indexterm-1714"></A>IPsec is configured from the global zone. The IPsec policy configuration file, <tt>ipsecinit.conf</tt>, exists in the global zone only. The file can have entries that
apply to non-global zones, as well as entries that apply to the global zone.
For information on how to use IPsec with zones, see <A HREF="p107.html#ipsec-mgtasks-4">Protecting Traffic With IPsec</A>. For information
about zones, see Chapter 16, "Introduction to Solaris Zones," in <i>System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</i>.</p>
<A NAME="ipsec-ov-21"></A><h2>IPsec Utilities and Files</h2>
<A NAME="indexterm-1715"></A><A NAME="indexterm-1716"></A><A NAME="indexterm-1717"></A><p><A HREF="p106.html#ipsecref-tbl-1">Table 19-3</A> describes the files and
commands that are used to configure and manage IPsec. For completeness, the
table includes key management files and commands. </p>
<ul><li><p>For instructions on implementing IPsec on your network, see <A HREF="p107.html#ipsec-mgtasks-2">Protecting Traffic With IPsec (Task Map)</A>.</p>
</li>
<li><p>For more details about IPsec utilities and files, see <A HREF="p115.html#ipsecref-1">Chapter&nbsp;21, IP Security Architecture (Reference)</A>.</p>
</li>
</ul>
<A NAME="ipsecref-tbl-1"></A><p><b>Table 19-3 </b>List of Selected
IPsec Files and Commands</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>IPsec Utility or File</p></th><th scope="col"><p>Description</p></th><th scope="col"><p>Man Page</p></th></tr>
<tr><td><p><tt>/etc/inet/ipsecinit.conf</tt> file</p></td><td><p><A NAME="indexterm-1718"></A><A NAME="indexterm-1719"></A><A NAME="indexterm-1720"></A><A NAME="indexterm-1721"></A>IPsec policy file. If this file exists, IPsec is activated at
boot time.</p></td><td><p><tt>ipsecconf</tt>(1M)</p></td></tr>
<tr><td><p><tt>ipsecconf</tt> command</p></td><td><p><A NAME="indexterm-1722"></A><A NAME="indexterm-1723"></A>IPsec policy command. The boot scripts use <tt>ipsecconf</tt> to
read the <tt>/etc/inet/ipsecinit.conf</tt> file and activate IPsec.
Useful for viewing and modifying the current IPsec policy, and for testing.</p></td><td><p><tt>ipsecconf</tt>(1M)</p></td></tr>
<tr><td><p><tt>PF_KEY</tt> socket interface</p></td><td><p><A NAME="indexterm-1724"></A>Interface for security associations database (SADB). Handles manual
key management and automatic key management.</p></td><td><p><tt>pf_key</tt>(7P)</p></td></tr>
<tr><td><p><tt>ipseckey</tt> command</p></td><td><p><A NAME="indexterm-1725"></A><A NAME="indexterm-1726"></A>IPsec security associations (SAs) keying command. <tt>ipseckey</tt> is
a command-line front end to the <tt>PF_KEY</tt> interface. <tt>ipseckey</tt> can create, destroy, or modify SAs.</p></td><td><p><tt>ipseckey</tt>(1M)</p></td></tr>
<tr><td><p><tt>/etc/inet/secret/ipseckeys</tt> file</p></td><td><p><A NAME="indexterm-1727"></A><A NAME="indexterm-1728"></A><A NAME="indexterm-1729"></A>Keys for IPsec SAs. If the <tt>ipsecinit.conf</tt> file
exists, the <tt>ipseckeys</tt> file is automatically read at boot
time.</p></td><td>&nbsp;</td></tr>
<tr><td><p><tt>ipsecalgs</tt> command</p></td><td><p>IPsec algorithms command. Useful for viewing and modifying the list
of IPsec algorithms and their properties.</p></td><td><p><tt>ipsecalgs</tt>(1M)</p></td></tr>
<tr><td><p><tt>/etc/inet/ipsecalgs</tt> file</p></td><td><p>Contains the configured IPsec protocols and algorithm definitions. This
file is managed by the <tt>ipsecalgs</tt> utility and must never
be edited manually.</p></td><td>&nbsp;</td></tr>
<tr><td><p><tt>/etc/inet/ike/config</tt> file</p></td><td><p><A NAME="indexterm-1730"></A><A NAME="indexterm-1731"></A><A NAME="indexterm-1732"></A>IKE configuration and policy file. If this file exists, the IKE
daemon, <tt>in.iked</tt>, provides automatic key management. The
management is based on rules and global parameters in the <tt>/etc/inet/ike/config</tt> file. See <A HREF="p118.html#ike-12">IKE Utilities and Files</A>.</p></td><td><p><tt>ike.config</tt>(4)</p></td></tr>
</table><A NAME="ipsec-ov-16"></A><h2>Changes to IPsec for the Solaris 10 Release</h2>
<A NAME="indexterm-1733"></A><p>For a complete listing of new Solaris features and a description
of Solaris releases, see <i>Solaris Express, Developer Edition What's New</i>. Since
the Solaris 9 release, IPsec includes the following functionality:</p>
<ul><li><p>When a Sun Crypto Accelerator 4000 board is attached, the board automatically caches
IPsec SAs for packets that use the board's Ethernet interface. The board also
accelerates the processing of the IPsec SAs.</p>
</li>
<li><p>IPsec can take advantage of automatic key management with
IKE over IPv6 networks. For more information, see <A HREF="p117.html#ike-1">Chapter&nbsp;22, Internet Key Exchange (Overview)</A>.</p>
<p>For new IKE features,
see <A HREF="p118.html#ike-10">Changes to IKE for the Solaris 10 Release</A>.</p>
</li>
<li><p>The parser for the<tt>ipseckey</tt> command provides
clearer help. The <tt>ipseckey monitor</tt> command timestamps each
event. For details, see the <tt>ipseckey</tt>(1M) man
page.</p>
</li>
<li><p>IPsec algorithms now come from a central storage location,
the Solaris cryptographic framework. The <tt>ipsecalgs</tt>(1M) man page describes the characteristics
of the algorithms that are available. The algorithms are optimized for the
architecture that they run on. For a description of the framework, see Chapter 12, "Solaris Cryptographic Framework (Overview)," in <i>System Administration Guide: Security Services</i>.</p>
</li>
<li><p>IPsec works in the global zone. IPsec policy is managed in
the global zone for a non-global zone. Keying material is created and is managed
manually in the global zone for a non-global zone. IKE cannot be used to generate
keys for a non-global zone. For more information on zones, see Chapter 16, "Introduction to Solaris Zones," in <i>System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</i>.</p>
</li>
<li><p>IPsec policy can work with the Streams Control Transmission
Protocol (SCTP) and SCTP port number. However, the implementation is not complete.
The IPsec extensions for SCTP that are specified in RFC 3554 are not yet implemented.
These limitations can cause complications when creating IPsec policy for SCTP.
For details, consult the RFCs. Also, read <A HREF="p106.html#ipsec-ov-22">IPsec and SCTP</A> and <A HREF="p4.html#ermih">SCTP Protocol</A>.</p>
</li>
<li><p>IPsec and IKE can protect traffic that originates behind a
NAT box. For details and limitations, see <A HREF="p106.html#ipsec-ov-24">IPsec and NAT Traversal</A>. For procedures, see <A HREF="p124.html#ike-task-38">Configuring IKE for Mobile Systems (Task Map)</A>.</p>
</li>
</ul>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p105.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p107.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

