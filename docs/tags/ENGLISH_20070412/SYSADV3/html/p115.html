<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p114.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p116.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipsecref-1"></A><b>Chapter&nbsp;21</b><h1>IP Security Architecture (Reference)</h1>
<p>This chapter contains the following reference information:</p>
<ul><li><p><A HREF="p115.html#ipsecref-22"><tt>ipsecconf</tt> Command</A></p>
</li>
<li><p><A HREF="p115.html#ipsecref-23"><tt>ipsecinit.conf</tt> File</A></p>
</li>
<li><p><A HREF="p115.html#ipsecref-17"><tt>ipsecalgs</tt> Command</A></p>
</li>
<li><p><A HREF="p116.html#ipsecref-24">Security Associations Database for IPsec</A></p>
</li>
<li><p><A HREF="p116.html#ipsecref-25">Utilities for Key Generation in IPsec</A></p>
</li>
<li><p><A HREF="p116.html#ipsecref-26"><tt>snoop</tt> Command and IPsec</A></p>
</li>
</ul>
<p>For instructions on how to implement IPsec on your network, see <A HREF="p107.html#ipsec-mgtasks-1">Chapter&nbsp;20, Configuring IPsec (Tasks)</A>.
For an overview of IPsec, see <A HREF="p103.html#ipsec-ov-1">Chapter&nbsp;19, IP Security Architecture (Overview)</A>.</p>
<A NAME="ipsecref-22"></A><h2><tt>ipsecconf</tt> Command</h2>
<A NAME="indexterm-1893"></A><A NAME="indexterm-1894"></A><A NAME="indexterm-1895"></A><A NAME="indexterm-1896"></A><A NAME="indexterm-1897"></A><A NAME="indexterm-1898"></A><A NAME="indexterm-1899"></A><p><A NAME="indexterm-1900"></A><A NAME="indexterm-1901"></A><A NAME="indexterm-1902"></A>You use the <tt>ipsecconf</tt> command to configure
the IPsec policy for a host. When you run the command to configure the policy,
the system creates  the IPsec policy entries in the kernel. The system uses these entries to check
the policy on all outbound and inbound IP datagrams. Forwarded datagrams are
not subjected to policy checks that are added by using this command. The <tt>ipsecconf</tt> command also configures the security policy database (SPD).</p>
<ul><li><p>For information on how to protect forwarded packets, see the <tt>ifconfig</tt>(1M) and <tt>tun</tt>(7M) man pages.</p>
</li>
<li><p>For IPsec policy options, see the <tt>ipsecconf</tt>(1M) man page.</p>
</li>
<li><p>For instructions on how to use the <tt>ipsecconf</tt> command
to protect traffic between systems, see <A HREF="p119.html#ike-task-7">Configuring IKE (Task Map)</A>.</p>
</li>
</ul>
<p>You must become superuser or assume an equivalent role to invoke the <tt>ipsecconf</tt> command. The command accepts entries that protect traffic
in both directions. The command also accepts entries that protect traffic
in only one direction.</p>
<p>Policy entries with a format of local address and remote address can
protect traffic in both directions with a single policy entry. For example,
entries that contain the patterns <tt>laddr host1</tt> and <tt>raddr
host2</tt> protect traffic in both directions, if no direction is specified
for the named host. Thus, you need only one policy entry for each host.</p>
<p>Policy entries with a format of source address to destination address
protect traffic in only one direction. For example, a policy entry of the
pattern <tt>saddr host1 daddr host2</tt> protects inbound traffic
or outbound traffic, not both directions. Thus, to protect traffic in both
directions, you need to pass the <tt>ipsecconf</tt> command another
entry, as in <tt>saddr host2 daddr host1</tt>.</p>
<p>The <tt>ipsecpolicy.conf</tt> file is deleted
when the system shuts down. To ensure that the IPsec policy is active when
the machine boots, you can create an IPsec policy file, <tt>/etc/inet/ipsecinit.conf</tt>. This file is read when the network services are started. For
instructions on how to create an IPsec policy file, see <A HREF="p107.html#ipsec-mgtasks-2">Protecting Traffic With IPsec (Task Map)</A>.</p>
<A NAME="ipsecref-23"></A><h2><tt>ipsecinit.conf</tt> File</h2>
<A NAME="indexterm-1903"></A><A NAME="indexterm-1904"></A><A NAME="indexterm-1905"></A><A NAME="indexterm-1906"></A><A NAME="indexterm-1907"></A><A NAME="indexterm-1908"></A><A NAME="indexterm-1909"></A><A NAME="indexterm-1910"></A><p>To invoke IPsec security policies when you start the Solaris Operating System,
you create a configuration file to initialize IPsec with your specific IPsec
policy entries. You should name the file <tt>/etc/inet/ipsecinit.conf</tt>.
See the <tt>ipsecconf</tt>(1M) man
page for details about policy entries and their format. After policies are
configured, you can use the <tt>ipsecconf</tt> command to view or
modify the existing configuration.</p>
<A NAME="ipsecref-44"></A><h3>Sample <tt>ipsecinit.conf</tt> File</h3>
<p><A NAME="indexterm-1911"></A>The Solaris software includes a sample IPsec policy file, <tt>ipsecinit.sample</tt>. You can use the file as a template to create your own <tt>ipsecinit.conf</tt> file. The <tt>ipsecinit.sample</tt> file contains
the following examples:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>#
# For example,
#
#	 {rport 23} ipsec {encr_algs des encr_auth_algs md5}
#
# will protect the telnet traffic originating from the host with ESP using
# DES and MD5. Also:
#
#	 {raddr 10.5.5.0/24} ipsec {auth_algs any}
#
# will protect traffic to or from the 10.5.5.0 subnet with AH 
# using any available algorithm.
#
#
# To do basic filtering, a drop rule may be used. For example:
#
#    {lport 23 dir both} drop {}
# will disallow any remote system from telnetting in.
#
# If you are using IPv6, it may be useful to bypass neighbor discovery
# to allow in.iked to work properly with on-link neighbors. To do that,
# add the following lines:
#
#        {ulp ipv6-icmp type 133-137 dir both } pass { }
#
# This will allow neighbor discovery to work normally.</pre>
</td></table><br><A NAME="ipsecref-42"></A><h3>Security Considerations for <tt>ipsecinit.conf</tt> and <tt>ipsecconf</tt></h3>
<A NAME="indexterm-1912"></A><A NAME="indexterm-1913"></A><A NAME="indexterm-1914"></A><A NAME="indexterm-1915"></A><A NAME="indexterm-1916"></A><p>Use extreme caution if transmitting a copy of the <tt>ipsecinit.conf</tt> file
over a network. An adversary can read a network-mounted file as the file is
being read. If, for example, the <tt>/etc/inet/ipsecinit.conf</tt> file
is accessed or is copied from an NFS-mounted file system, an adversary can
change the policy that is contained in the file.</p>
<p>Ensure that you set up IPsec policies before starting any communications,
because existing connections might be affected by the addition of new policy
entries. Similarly, do not change policies in the middle of a communication.</p>
<p><A NAME="indexterm-1917"></A><A NAME="indexterm-1918"></A>Specifically, IPsec policy cannot be changed for SCTP, TCP, or
UDP sockets on which a <tt>connect()</tt> or <tt>accept()</tt> function
call has been issued. A socket whose policy cannot be changed is called a <b>latched socket</b>. New policy entries do not protect sockets that
are already latched. For more information, see the <tt>connect</tt>(3SOCKET) and <tt>accept</tt>(3SOCKET) man
pages.</p>
<p>Protect your naming system. If the following two conditions are met,
then your host names are no longer trustworthy:</p>
<ul><li><p>Your source address is a host that can be looked up over the
network.</p>
</li>
<li><p>Your naming system is compromised.</p>
</li>
</ul>
<p>Security weaknesses often arise from the misapplication of tools, not
from the actual tools. You should be cautious when using the <tt>ipsecconf</tt> command.
Use a console or other hard-connected TTY for the safest mode of operation.</p>
<A NAME="ipsecref-17"></A><h2><tt>ipsecalgs</tt> Command</h2>
<p><A NAME="indexterm-1919"></A><A NAME="indexterm-1920"></A><A NAME="indexterm-1921"></A><A NAME="indexterm-1922"></A><A NAME="indexterm-1923"></A>The Solaris cryptographic framework provides authentication and
encryption algorithms to IPsec. You use the <tt>ipsecalgs</tt> command
to query and modify the list of protocols and the list of algorithms that
IPsec supports. The <tt>ipsecalgs</tt> command stores this information
in tabular format in the IPsec protocols and algorithms file, <tt>/etc/inet/ipsecalgs</tt>. This file must never be edited manually.</p>
<p>The valid IPsec protocols and algorithms are described by the ISAKMP <A HREF="p193.html#glossary-125">domain of interpretation (DOI)</A>, which is
covered by RFC 2407. In a general sense, a DOI defines data formats, network
traffic exchange types, and conventions for naming security-relevant information.
Security policies, cryptographic algorithms, and cryptographic modes are examples
of security-relevant information.</p>
<p>Specifically, the ISAKMP DOI defines the naming and numbering conventions
for the valid IPsec algorithms and for their protocols, <tt>PROTO_IPSEC_AH</tt> and <tt>PROTO_IPSEC_ESP</tt>. Each algorithm is  associated with exactly one
protocol. These ISAKMP DOI definitions are in the <tt>/etc/inet/ipsecalgs</tt> file.
The algorithm and protocol numbers are defined by the Internet Assigned Numbers
Authority (IANA). The <tt>ipsecalgs</tt> command makes the list
of algorithms for IPsec extensible.</p>
<p>For more information on the algorithms, refer to the <tt>ipsecalgs</tt>(1M) man page.
For more information on the Solaris cryptographic framework, see Chapter 12, "Solaris Cryptographic Framework (Overview)," in <i>System Administration Guide: Security Services</i>.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p114.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p116.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

