<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p25.html#fwawf">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p28.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p30.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="fpjvl"></A><h2>Administering Link Aggregations</h2>
<A NAME="indexterm-660"></A><A NAME="indexterm-661"></A><A NAME="indexterm-662"></A><p><A NAME="indexterm-663"></A>The Solaris OS supports the organization
of network interfaces into link aggregations. A <b>link aggregation</b> consists
of several interfaces on a system that are configured together as a single,
logical unit. Link aggregation, also referred to as <b>trunking</b>,
is defined in the <A  HREF="http://www.ieee802.org/3/index.html">IEEE 802.3ad Link Aggregation Standard</A>. </p>
<p>The IEEE 802.3ad Link Aggregation Standard provides a method to combine
the capacity of multiple full-duplex Ethernet links into a single logical
link. This link aggregation group is then treated as though it were, in fact,
a single link. </p>
<p>The following are features of link aggregations:<A NAME="indexterm-664"></A></p>
<ul><li><p><b>Increased bandwidth</b> -
The capacity of multiple links is combined into one logical link.</p>
</li>
<li><p><b>Automatic failover/failback</b> -
Traffic from a failed link is failed over to working links in the aggregation.</p>
</li>
<li><p><b>Load balancing</b> -
Both inbound and outbound traffic is distributed according to user selected
load balancing policies, such as source and destination MAC or IP addresses.</p>
</li>
<li><p><b>Support for redundancy</b> -
Two systems can be configured with parallel aggregations.</p>
</li>
<li><p><b>Improved administration</b> -
All interfaces are administered as a single unit.</p>
</li>
<li><p><b>Less drain on the network address
pool</b> - The entire aggregation is assigned one IP address.</p>
</li>
</ul>
<A NAME="gafjy"></A><h3>Link Aggregation Basics</h3>
<p>The basic link aggregation topology involves a single aggregation that
is composed of a set of physical interfaces. You might use the basic link
aggregation in the following situations:</p>
<ul><li><p>For systems that run an application with distributed heavy
traffic, you can dedicate an aggregation to that application's traffic.</p>
</li>
<li><p>For sites with limited IP address space that nevertheless
require large amounts of bandwidth, you need only one IP address for a large
aggregation of interfaces. </p>
</li>
<li><p>For sites that need to hide the existence of internal interfaces,
the IP address of the aggregation hides its interfaces from external applications.</p>
</li>
</ul>
<p><A HREF="p29.html#gatnz">Figure 6-3</A> shows an aggregation
for a server that hosts a popular web site. The site requires increased bandwidth
for query traffic between Internet customers and the site's database server.
For security purposes, the existence of the individual interfaces on the server
must be hidden from external applications. The solution is the aggregation <tt>aggr1</tt> with the IP address <tt>192.168.50.32</tt>. This
aggregation consists of three interfaces,<tt>bge0-2</tt>.
These interfaces are dedicated to sending out traffic in response to customer
queries. The outgoing address on packet traffic from all the interfaces is
the IP address of <tt>aggr1</tt>, <tt>192.168.50.32</tt>.<A NAME="indexterm-665"></A></p>
<A NAME="gatnz"></A><p><b>Figure 6-3 </b>Basic Link Aggregation Topology</p>
<IMG src="figures/virtualLinkAg.gif" class="figure" alt="The figure shows a block for the link aggr1. Three physical
interfaces, bge0&ndash;bge2, descend from the link block." title="The figure shows a block for the link aggr1. Three physical
interfaces, bge0&ndash;bge2, descend from the link block."><p><A NAME="indexterm-666"></A><A HREF="p29.html#gatog">Figure 6-4</A> depicts a local
network with two systems, each of which has an aggregation configured. The
two systems are connected by a switch. If you need to run an aggregation through
a switch, that switch must support aggregation technology. This type of configuration
is particularly useful for high availability and redundant systems.</p>
<p>In the figure, System A has an aggregation that consists of two interfaces, <tt>bge0</tt> and <tt>bge1</tt>. These interfaces are connected
to the switch through aggregated ports. System B has an aggregation of four
interfaces, <tt>e1000g0</tt> through<tt>e100g3</tt>. These
interfaces are also connected to aggregated ports on the switch.</p>
<A NAME="gatog"></A><p><b>Figure 6-4 </b>Aggregation Topology With Switch</p>
<A NAME="indexterm-667"></A><IMG src="figures/backToBackLinkAg.gif" class="figure" alt="The figure is explained in the preceding context." title="The figure is explained in the preceding context."><A NAME="gafjl"></A><h3>Back-to-Back Link Aggregations</h3>
<p>The back-to-back link aggregation topology involves two separate systems
that are cabled directly to each other, as shown in the following figure.
The systems run parallel aggregations. </p>
<A NAME="gazxe"></A><p><b>Figure 6-5 </b>Basic Back-to-Back Aggregation Topology</p>
<A NAME="indexterm-668"></A><IMG src="figures/BasicB2bAg.gif" class="figure" alt="The figure is explained in the following context." title="The figure is explained in the following context."><p>In this example, device <tt>bge0</tt> on System A is directly
linked to <tt>bge0</tt> on System B, and so on. In this way, Systems
A and B can support redundancy and high availability, as well as high-speed
communications between both servers. Each server also has interface <tt>ce0</tt> configured
for traffic flow with the local network.</p>
<p>The most common application for back-to-back aggregations is mirrored
database servers. Both servers need to be updated together and therefore require
significant bandwidth, high-speed traffic flow, and reliability. Data centers
are the most common users of back-to-back link aggregations.</p>
<A NAME="gafwr"></A><h3>Policies and Load Balancing</h3>
<A NAME="indexterm-669"></A><A NAME="indexterm-670"></A><A NAME="indexterm-671"></A><p>If you plan to use a link aggregation, consider defining a policy for
outgoing traffic. This policy specifies how you want packets to be distributed
across the available links of an aggregation, thus establishing load balancing.
The following are the possible layer specifiers and their significance for
the aggregation policy:</p>
<ul><li><p><b>L2</b> - Determines the outgoing
link by hashing the MAC (L2) header of each packet</p>
</li>
<li><p><b>L3</b> - Determines the outgoing
link by hashing the IP (L3) header of each packet</p>
</li>
<li><p><b>L4</b> - Determines the outgoing
link by hashing the TCP, UDP, or other ULP (L4) header of each packet</p>
</li>
</ul>
<p>Any combination of these policies is also valid. The default policy
is L4. For more information, refer to the <tt>dladm</tt>(1M) man
page.</p>
<A NAME="gaiam"></A><h3>Aggregation Mode and Switches</h3>
<A NAME="indexterm-672"></A><A NAME="indexterm-673"></A><p>If your aggregation topology involves connection through a switch, you
must note whether the switch supports <b>link aggregation control protocol
(LACP)</b>. If the switch supports LACP, you must configure LACP for
the switch and the aggregation. However, you can define one of the following <b>modes</b> in which LACP is to operate:</p>
<ul><li><p><b>Off mode</b> - The default
mode for aggregations. LACP packets, which are called <b>LACPDUs</b> are
not generated.</p>
</li>
<li><p><b>Active mode</b> - The
system generates <tt>LACPDU</tt>s at regular intervals, which you
can specify.</p>
</li>
<li><p><b>Passive mode</b> - The
system generates an <tt>LACPDU</tt> only when it receives an <tt>LACPDU</tt> from the switch. When both the aggregation and the switch are configured
in passive mode, they cannot exchange <tt>LACPDU</tt>s.</p>
</li>
</ul>
<p>See the <tt>dladm</tt>(1M) man page and the switch manufacturer's
documentation for syntax information.</p>
<A NAME="gafij"></A><h3>Requirements for Aggregations</h3>
<A NAME="indexterm-674"></A><p>Your aggregation configuration is bound by the following requirements:</p>
<ul><li><p>You must use the <tt>dladm</tt> command to configure
aggregations. </p>
</li>
<li><p>An interface that has been plumbed cannot become a member
of an aggregation.</p>
</li>
<li><p><A NAME="indexterm-675"></A>Interfaces must be of the GLDv3 type: <tt>xge</tt>, <tt>e1000g</tt>, and <tt>bge</tt>. </p>
</li>
<li><p>All interfaces in the aggregation must run at the same speed
and in full duplex mode.</p>
</li>
<li><p>You must set the value for MAC addresses to "true"
in the EEPROM parameter <tt>local-mac-address?</tt> For instructions,
refer to <A HREF="p27.html#eyprp">SPARC: How to Ensure That the MAC Address of an Interface Is Unique</A>.</p>
</li>
<li><p>"Legacy" <b>data link provider interfaces
(DLPI )</b>, such as the <tt>ce</tt> interface do not support
Solaris link aggregations. Instead, you must configure aggregations for legacy
devices by using Sun Trunking. You cannot configure aggregations for legacy
devices by using the <tt>dladm</tt> command. For more information
about Sun Trunking, refer to the <i>Sun Trunking 1.3 Installation
and User's Guide.</i></p>
</li>
</ul>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p28.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p30.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

