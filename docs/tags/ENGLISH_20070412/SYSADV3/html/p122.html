<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p119.html#ike-task-1">23.&nbsp;&nbsp;Configuring IKE (Tasks)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p121.html#ike-task-25">Configuring IKE With Public Key Certificates</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p121.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p123.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ike-task-41"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Configure IKE With Certificates
Signed by a CA</h3>
<A NAME="indexterm-2094"></A><A NAME="indexterm-2095"></A><A NAME="indexterm-2096"></A><A NAME="indexterm-2097"></A><p>Public certificates from a Certificate Authority (CA) require negotiation
with an outside organization. The certificates very easily scale to protect
a large number of communicating systems.</p>
<ol><li><p><b>On the system console, assume the Primary Administrator role or
become superuser.</b></p><p>The Primary Administrator role includes the
Primary Administrator profile. To create the role and assign the role to a
user, see Chapter 2, "Working With the Solaris Management Console (Tasks)," in <i>System Administration Guide: Basic Administration</i>.</p>
<p><hr size="1" noshade><p><b>Note - </b>Logging in remotely exposes security-critical traffic to eavesdropping.
Even if you somehow protect the remote login, the security of the system is
reduced to the security of the remote login session.</p>
<hr size="1" noshade></p></li>
<li><p><b><A NAME="indexterm-2098"></A><A NAME="indexterm-2099"></A><A NAME="indexterm-2100"></A><A NAME="indexterm-2101"></A><A NAME="indexterm-2102"></A><A NAME="indexterm-2103"></A>Use the <tt>ikecert certlocal -kc</tt> command to create
a certificate request.</b></p><p>For a description of the arguments to the
command, see <A HREF="p121.html#ike-task-step-ksgen-1">Step&nbsp;2</A> in <A HREF="p121.html#ike-task-42">How to Configure IKE With Self-Signed Public Key Certificates</A>.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ikecert certlocal -kc -m <i>keysize</i> -t <i>keytype</i> \
-D <i>dname</i> -A <i>altname</i></pre>
</td></table><br><ol Type="a"><li><p><b>For example, the following command creates a certificate request
on the <tt>partym</tt> system:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certlocal -kc -m 1024 -t rsa-md5 \</b></tt>
> <tt><b>-D "C=US, O=PartyCompany\, Inc., OU=US-Partym, CN=Partym" \</b></tt>
> <tt><b>-A "DN=C=US, O=PartyCompany\, Inc., OU=US-Partym"</b></tt>
Creating software private keys.
  Writing private key to file /etc/inet/secret/ike.privatekeys/2.
Enabling external key providers - done.
Certificate Request: 
  Proceeding with the signing operation.
  Certificate request generated successfully (.../publickeys/0)
Finished successfully.
-----BEGIN CERTIFICATE REQUEST-----
MIIByjCCATMCAQAwUzELMAkGA1UEBhMCVVMxHTAbBgNVBAoTFEV4YW1wbGVDb21w
...
lcM+tw0ThRrfuJX9t/Qa1R/KxRlMA3zckO80mO9X
-----END CERTIFICATE REQUEST-----</pre>
</td></table><br></li>
<li><p><b>The following command creates a certificate request on the <tt>enigma</tt> system:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certlocal -kc -m 1024 -t rsa-md5 \</b></tt>
> <tt><b>-D "C=JA, O=EnigmaCo\, Inc., OU=JA-Enigmax, CN=Enigmax" \</b></tt>
> <tt><b>-A "DN=C=JA, O=EnigmaCo\, Inc., OU=JA-Enigmax"</b></tt>
Creating software private keys.
...
Finished successfully.
-----BEGIN CERTIFICATE REQUEST-----
MIIBuDCCASECAQAwSTELMAkGA1UEBhMCVVMxFTATBgNVBAoTDFBhcnR5Q29tcGFu
...
8qlqdjaStLGfhDOO
-----END CERTIFICATE REQUEST-----</pre>
</td></table><br></li>
</ol>
</li>
<A NAME="ike-task-pki-1"></A><li><p><b>Submit the certificate request to a PKI organization.</b></p><p><A NAME="indexterm-2104"></A>The PKI organization can tell you how to submit the certificate
request. Most organizations have a web site with a submission form. The form
requires proof that the submission is legitimate. Typically, you paste your
certificate request into the form. When your request has been checked by the
organization, the organization issues you the following two certificate objects
and a list of revoked certificates:</p>
<ul><li><p>Your public key certificate - This certificate is based
on the request that you submitted to the organization. The request that you
submitted is part of this public key certificate. The certificate uniquely
identifies you.</p>
</li>
<li><p>A Certificate Authority - The organization's signature.
The CA verifies that your public key certificate is legitimate.</p>
</li>
<li><p>A Certificate Revocation List (CRL) - The latest list
of certificates that the organization has revoked. The CRL is not sent separately
as a certificate object if access to the CRL is embedded in the public key
certificate.</p>
<p>When a URI for the CRL is embedded in the public
key certificate, IKE can automatically retrieve the CRL for you. Similarly,
when a DN (directory name on an LDAP server) entry is embedded in the public
key certificate, IKE can retrieve and cache the CRL from an LDAP server that
you specify.</p>
<p>See <A HREF="p124.html#ike-task-22">How to Handle a Certificate Revocation List</A> for an example of an embedded URI and
an embedded DN entry in a public key certificate.</p>
</li>
</ul>
</li>
<li><p><b><A NAME="indexterm-2105"></A><A NAME="indexterm-2106"></A><A NAME="indexterm-2107"></A><A NAME="indexterm-2108"></A><A NAME="indexterm-2109"></A><A NAME="indexterm-2110"></A>Add each certificate to your system.</b></p><p>The <tt>-a</tt> option
to the <tt>ikecert certdb -a</tt> adds the pasted object to the
appropriate certificate database on your system. For more information, see <A HREF="p117.html#ike-29">IKE With Public Key Certificates</A>.</p>
<ol Type="a"><li><p><b>On the system console, assume the Primary Administrator role or
become superuser.</b></p></li>
<li><p><b>Add the public key certificate that you received from the PKI
organization.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certdb -a</b></tt>
<em>Press the Return key</em>
<em>Paste the certificate:</em>
<tt><b>-----BEGIN X509 CERTIFICATE-----
...
-----END X509 CERTIFICATE----</b></tt>
<em>Press the Return key</em>
<tt><b>&lt;Control>-D</b></tt></pre>
</td></table><br></li>
<li><p><b>Add the CA from the PKI organization.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certdb -a</b></tt>
<em>Press the Return key</em>
<em>Paste the CA:</em>
<tt><b>-----BEGIN X509 CERTIFICATE-----
...
-----END X509 CERTIFICATE----</b></tt>
<em>Press the Return key</em>
<tt><b>&lt;Control>-D</b></tt></pre>
</td></table><br></li>
<li><p><b>If the PKI organization has sent a list of revoked certificates,
add the CRL to the <tt>certrldb</tt> database:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certrldb -a</b></tt>
<em>Press the Return key</em>
<em>Paste the CRL:</em>
<tt><b>-----BEGIN CRL-----
...
-----END CRL----</b></tt>
<em>Press the Return key</em>
<tt><b>&lt;Control>-D</b></tt></pre>
</td></table><br></li>
</ol>
</li>
<li><p><b><A NAME="indexterm-2111"></A><A NAME="indexterm-2112"></A><A NAME="indexterm-2113"></A>Use the <tt>cert_root</tt> keyword to identify the PKI
organization in the <tt>/etc/inet/ike/config</tt> file.</b></p><p>Use
the name that the PKI organization provides.</p>
<ol Type="a"><li><p><b>For example, the <tt>ike/config</tt> file on the <tt>partym</tt> system
might appear similar to the following:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># Trusted root cert
# This certificate is from Example PKI
# This is the X.509 distinguished name for the CA that it issues.

<tt><b>cert_root "C=US, O=ExamplePKI\, Inc., OU=PKI-Example, CN=Example PKI"</b></tt>

## Parameters that may also show up in rules.

p1_xform 
 { auth_method rsa_sig oakley_group 1 auth_alg sha1 encr_alg des }
p2_pfs 2

{
 label "US-partym to JA-enigmax - Example PKI"
 local_id_type dn
 local_id  "C=US, O=PartyCompany, OU=US-Partym, CN=Partym"
 remote_id "C=JA, O=EnigmaCo, OU=JA-Enigmax, CN=Enigmax"

 local_addr  192.168.13.213
 remote_addr 192.168.116.16

 p1_xform
  {auth_method rsa_sig oakley_group 2 auth_alg md5 encr_alg 3des}
}</pre>
</td></table><br><p><hr size="1" noshade><p><b>Note - </b>All arguments to the <tt>auth_method</tt> parameter
must be on the same line. </p>
<hr size="1" noshade></p></li>
<li><p><b>On the <tt>enigma</tt> system, create a similar
file.</b></p><p>Specifically, the <tt>enigma</tt> <tt>ike/config</tt> file should do the following:</p>
<ul><li><p>Include the same <tt>cert_root</tt> value.</p>
</li>
<li><p>Use <tt>enigma</tt> values for local parameters.</p>
</li>
<li><p>Use <tt>partym</tt> values for remote parameters.</p>
</li>
<li><p>Create a unique value for the <tt>label</tt> keyword.
This value must be different from the remote system's <tt>label</tt> value.</p>
</li>
</ul>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>...
cert_root "C=US, O=ExamplePKI\, Inc., OU=PKI-Example, CN=Example PKI"
...
{
 label "JA-enigmax to US-partym - Example PKI"
 local_id_type dn
 local_id   "C=JA, O=EnigmaCo, OU=JA-Enigmax, CN=Enigmax"
 remote_id  "C=US, O=PartyCompany, OU=US-Partym, CN=Partym"
 
 local_addr  192.168.116.16
 remote_addr 192.168.13.213
...</pre>
</td></table><br></li>
</ol>
</li>
<A NAME="ike-task-trcert-1"></A><li><p><b><A NAME="indexterm-2114"></A><A NAME="indexterm-2115"></A><A NAME="indexterm-2116"></A><A NAME="indexterm-2117"></A>Tell IKE how to handle CRLs.</b></p><p>Choose the appropriate
option:</p>
<ul><li><p><b>No CRL available</b></p><p>If the PKI organization does not
provide a CRL, add the keyword <tt>ignore_crls</tt> to the <tt>ike/config</tt> file.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># Trusted root cert
...
cert_root "C=US, O=ExamplePKI\, Inc., OU=PKI-Example,...
<tt><b>ignore_crls</b></tt>
...</pre>
</td></table><br><p>The <tt>ignore_crls</tt> keyword tells IKE not to search for
CRLs.</p>
</li>
<li><p><b>CRL available</b></p><p>If the PKI organization provides a central
distribution point for CRLs, you can modify the <tt>ike/config</tt> file
to point to that location.</p>
<p>See <A HREF="p124.html#ike-task-22">How to Handle a Certificate Revocation List</A> for examples.</p>
</li>
</ul>
</li>
</ol><A NAME="ike-task-45"></A><h5>Example 23-3 &nbsp;&nbsp;Using <tt>rsa_encrypt</tt> When Configuring IKE</h5>
<p>When you use <tt>auth_method rsa_encrypt</tt> in the <tt>ike/config</tt> file, you must add the peer's certificate to the <tt>publickeys</tt> database.</p>
<ol Type="1"><li><p>Send the certificate to the remote system's administrator. </p>
<p>You can paste the certificate into an email.</p>
<p>For example,
the <tt>partym</tt> administrator would send the following email:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>To: admin@ja.enigmaexample.com
From: admin@us.partyexample.com
Message: -----BEGIN X509 CERTIFICATE-----
MII...
----END X509 CERTIFICATE-----</pre>
</td></table><br><p>The <tt>enigma</tt> administrator would send the following
email:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>To: admin@us.partyexample.com
From: admin@ja.enigmaexample.com
Message: -----BEGIN X509 CERTIFICATE-----
MII
...
-----END X509 CERTIFICATE-----</pre>
</td></table><br></li>
<li><p>On each system, add the emailed certificate to the local <tt>publickeys</tt> database. </p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certdb -a</b></tt>
<em>Press the Return key</em>
<tt><b>-----BEGIN X509 CERTIFICATE-----
MII...
-----END X509 CERTIFICATE-----</b></tt>
<em>Press the Return key</em>
<tt><b>&lt;Control>-D</b></tt></pre>
</td></table><br></li>
</ol>
<p>The authentication method for RSA encryption hides identities in IKE
from eavesdroppers. Because the <tt>rsa_encrypt</tt> method hides
the peer's identity, IKE cannot retrieve the peer's certificate. As a result,
the <tt>rsa_encrypt</tt> method requires that the IKE peers know
each other's public keys.</p>
<p>Therefore, when you use an <tt>auth_method</tt> of <tt>rsa_encrypt</tt> in the <tt>/etc/inet/ike/config</tt> file, you must
add the peer's certificate to the <tt>publickeys</tt> database.
The <tt>publickeys</tt> database then holds three certificates
for each communicating pair of systems:</p>
<ul><li><p>Your public key certificate</p>
</li>
<li><p>The CA certificate</p>
</li>
<li><p>The peer's public key certificate</p>
</li>
</ul>
<p><A NAME="indexterm-2118"></A><b>Troubleshooting -</b> The
IKE payload, which includes the three certificates, can become too large for <tt>rsa_encrypt</tt> to encrypt. Errors such as "authorization failed"
and "malformed payload" can indicate that the <tt>rsa_encrypt</tt> method
cannot encrypt the total payload. Reduce the size of the payload by using
a method, such as <tt>rsa_sig</tt>, that requires only two certificates.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p121.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p123.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

