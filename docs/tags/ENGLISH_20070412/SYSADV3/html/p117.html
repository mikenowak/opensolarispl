<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p116.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p118.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ike-1"></A><b>Chapter&nbsp;22</b><h1>Internet Key Exchange
(Overview)</h1>
<p>Internet Key Exchange (IKE) automates key management for IPsec. This
chapter contains the following information about IKE:</p>
<ul><li><p><A HREF="p117.html#ike-13">What's New in IKE?</A></p>
</li>
<li><p><A HREF="p117.html#ike-2">Key Management With IKE</A></p>
</li>
<li><p><A HREF="p117.html#ike-3">IKE Key Negotiation</A></p>
</li>
<li><p><A HREF="p117.html#ike-5">IKE Configuration Choices</A></p>
</li>
<li><p><A HREF="p118.html#ike-23">IKE and Hardware Acceleration</A></p>
</li>
<li><p><A HREF="p118.html#ike-24">IKE and Hardware Storage</A></p>
</li>
<li><p><A HREF="p118.html#ike-12">IKE Utilities and Files</A></p>
</li>
<li><p><A HREF="p118.html#ike-10">Changes to IKE for the Solaris 10 Release</A></p>
</li>
</ul>
<p><A NAME="indexterm-1942"></A><A NAME="indexterm-1943"></A><A NAME="indexterm-1944"></A><A NAME="indexterm-1945"></A><A NAME="indexterm-1946"></A>For instructions on implementing IKE, see <A HREF="p119.html#ike-task-1">Chapter&nbsp;23, Configuring IKE (Tasks)</A>. For
reference information, see <A HREF="p126.html#ikeref-1">Chapter&nbsp;24, Internet Key Exchange (Reference)</A>. For information about IPsec, see <A HREF="p103.html#ipsec-ov-1">Chapter&nbsp;19, IP Security Architecture (Overview)</A>.</p>
<A NAME="ike-13"></A><h2>What's New in IKE?</h2>
<A NAME="indexterm-1947"></A><A NAME="indexterm-1948"></A><A NAME="indexterm-1949"></A><A NAME="indexterm-1950"></A><p><b>Solaris Express, Developer Edition 2/07</b>:
In this release, IKE can use the AES algorithm, and can be configured in the
global zone to be used in non-global zones.</p>
<ul><li><p>The <tt>SO_ALLZONES</tt> socket option enables IKE
to handle traffic in non-global zones.</p>
</li>
<li><p>For a complete listing of new Solaris features and a description
of Solaris releases, see <i>Solaris Express, Developer Edition What's New</i>.</p>
</li>
</ul>
<A NAME="ike-2"></A><h2>Key Management With IKE</h2>
<A NAME="indexterm-1951"></A><A NAME="indexterm-1952"></A><p>The management of keying material for IPsec security associations (SAs)
is called <b>key management</b>. Automatic key management requires
a secure channel of communication for the creation, authentication, and exchange
of keys. The Solaris Operating System uses Internet Key Exchange (IKE) to automate key management.
IKE easily scales to provide a secure channel for a large volume of traffic.
IPsec SAs on IPv4 and IPv6 packets can take advantage of IKE.</p>
<p>When IKE is used on a system with a Sun&#153; Crypto
Accelerator 1000 board or a Sun Crypto Accelerator 4000 board, the public key operations can be
offloaded to the accelerator. Operating system resources are not used for
public key operations. When IKE is used on a system with a Sun Crypto Accelerator 4000 board, the
certificates, public keys, and private keys can be stored on the board. Key
storage that is off the system provides an additional layer of protection.</p>
<A NAME="ike-3"></A><h2>IKE Key Negotiation</h2>
<p><A NAME="indexterm-1953"></A><A NAME="indexterm-1954"></A><A NAME="indexterm-1955"></A><A NAME="indexterm-1956"></A><A NAME="indexterm-1957"></A><A NAME="indexterm-1958"></A><A NAME="indexterm-1959"></A><A NAME="indexterm-1960"></A><A NAME="indexterm-1961"></A><A NAME="indexterm-1962"></A>The IKE daemon, <tt>in.iked</tt>, negotiates and authenticates
keying material for SAs in a protected manner. The daemon uses random seeds
for keys from internal functions provided by the Solaris Operating System. IKE provides perfect
forward secrecy (PFS). In PFS, the keys that protect data transmission are
not used to derive additional keys. Also, seeds used to create data transmission
keys are not reused. See the <tt>in.iked</tt>(1M) man
page.</p>
<p>When the IKE daemon discovers a remote system's public encryption key,
the local system can then use that key. The system encrypts messages by using
the remote system's public key. The messages can be read only by that remote
system. The IKE daemon performs its job in two phases. The phases are called <b>exchanges</b>.</p>
<A NAME="ike-32"></A><h3>IKE Key Terminology</h3>
<p>The following table lists terms that are used in key negotiation, provides
their commonly used acronyms, and gives a definition and use for each term.</p>
<A NAME="ike-tbl-2"></A><p><b>Table 22-1 </b>Key Negotiation Terms, Acronyms,
and Uses</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Key Negotiation Term</p></th><th scope="col"><p>Acronym</p></th><th scope="col"><p>Definition and Use</p></th></tr>
<tr><td><p>Key exchange</p></td><td><p>&nbsp;</p></td><td><p>The process of generating keys for asymmetric cryptographic algorithms.
The two main methods are RSA protocols and the Diffie-Hellman protocol.</p></td></tr>
<tr><td><p>Diffie-Hellman protocol</p></td><td><p>DH</p></td><td><p>A key exchange protocol that involves key generation and key authentication.
Often called <b>authenticated key exchange</b>.</p></td></tr>
<tr><td><p>RSA protocol</p></td><td><p>RSA</p></td><td><p>A key exchange protocol that involves key generation and key transport.
The protocol is named for its three creators, Rivest, Shamir, and Adleman.</p></td></tr>
<tr><td><p><A NAME="indexterm-1963"></A>Perfect forward secrecy</p></td><td><p>PFS</p></td><td><p>Applies to authenticated key exchange only. PFS ensures that long-term
secret material for keys does not compromise the secrecy of the exchanged
keys from previous communications. </p><p>In PFS, the key that is used to protect transmission of data is not
used to derive additional keys. Also, the source of the key that is used to
protect data transmission is never used to derive additional keys.</p></td></tr>
<tr><td><p>Oakley method</p></td><td><p>&nbsp;</p></td><td><p>A method for establishing keys for Phase 2 in a secure manner. This
protocol is analogous to the Diffie-Hellman method of key exchange. Similar
to Diffie-Hellman, Oakley group key exchange involves key generation and key
authentication. The Oakley method is used to negotiate PFS.</p></td></tr>
</table><A NAME="ike-26"></A><h3>IKE Phase 1 Exchange</h3>
<p><A NAME="indexterm-1964"></A><A NAME="indexterm-1965"></A><A NAME="indexterm-1966"></A><A NAME="indexterm-1967"></A>The Phase 1 exchange is known as <b>Main Mode</b>.
In the Phase 1 exchange, IKE uses public key encryption methods to authenticate
itself with peer IKE entities. The result is an Internet Security Association
and Key Management Protocol (ISAKMP) security association (SA). An ISAKMP
SA is a secure channel for IKE to negotiate keying material for the IP datagrams.
Unlike IPsec SAs, the ISAKMP SAs are bidirectional, so only one security association
is needed.</p>
<p><A NAME="indexterm-1968"></A><A NAME="indexterm-1969"></A>How IKE negotiates keying material in the Phase 1 exchange is
configurable. IKE reads the configuration information from the <tt>/etc/inet/ike/config</tt> file. Configuration information includes the following:</p>
<ul><li><p>Global parameters, such as the names of public key certificates</p>
</li>
<li><p>Whether perfect forward secrecy (PFS) is used</p>
</li>
<li><p>The interfaces that are affected</p>
</li>
<li><p>The security protocols and their algorithms</p>
</li>
<li><p>The authentication method</p>
</li>
</ul>
<p>The two authentication methods are preshared keys and public key certificates.
The public key certificates can be self-signed. Or, the certificates can be
issued by a <A HREF="p193.html#glossary-41">certificate authority (CA)</A> from
a public key infrastructure (<A HREF="p193.html#glossary-29">PKI</A>) organization.
Organizations include beTrusted, Entrust, GeoTrust, RSA Security, and Verisign.</p>
<A NAME="ike-14"></A><h3>IKE Phase 2 Exchange</h3>
<p><A NAME="indexterm-1970"></A><A NAME="indexterm-1971"></A>The Phase 2 exchange is known as <b>Quick Mode</b>.
In the Phase 2 exchange, IKE creates and manages the IPsec SAs between systems
that are running the IKE daemon. IKE uses the secure channel that was created
in the Phase 1 exchange to protect the transmission of keying material. The
IKE daemon creates the keys from a random number generator by using the <tt>/dev/random</tt> device. The daemon refreshes the keys at a configurable
rate. The keying material is available to algorithms that are specified in
the configuration file for IPsec policy, <tt>ipsecinit.conf</tt>.</p>
<A NAME="ike-5"></A><h2>IKE Configuration Choices</h2>
<p><A NAME="indexterm-1972"></A><A NAME="indexterm-1973"></A>The <tt>/etc/inet/ike/config</tt> configuration file
contains IKE policy entries. For two IKE daemons to authenticate each other,
the entries must be valid. Also, keying material must be available. The entries
in the configuration file determine the method for using the keying material
to authenticate the Phase 1 exchange. The choices are preshared keys or public
key certificates.</p>
<p>The entry <tt>auth_method preshared</tt> indicates that preshared
keys are used. Values for <tt>auth_method</tt> other than <tt>preshared</tt> indicate that public key certificates are to be used. Public key
certificates can be self-signed, or the certificates can be installed from
a PKI organization. For more information, see the <tt>ike.config</tt>(4) man page.</p>
<A NAME="ike-28"></A><h3>IKE With Preshared Keys</h3>
<p><A NAME="indexterm-1974"></A><A NAME="indexterm-1975"></A><A NAME="indexterm-1976"></A>Preshared keys are created by an administrator on one system.
The keys are then shared out of band with administrators of remote systems.
You should take care to create large random keys and to protect the file and
the out-of-band transmission. The keys are placed in the <tt>/etc/inet/secret/ike.preshared</tt> file on each system.
The <tt>ike.preshared</tt> file is for IKE as the <tt>ipseckeys</tt> file is for IPsec. Any compromise of the keys in the <tt>ike.preshared</tt> file compromises all keys that are derived from the keys in the
file. </p>
<p><A NAME="indexterm-1977"></A>One system's preshared key must be identical to its remote system's
key. The keys are tied to a particular IP address. Keys are most secure when
one administrator controls the communicating systems. For more information,
see the <tt>ike.preshared</tt>(4) man page.</p>
<A NAME="ike-29"></A><h3>IKE With Public Key Certificates</h3>
<p><A NAME="indexterm-1978"></A><A NAME="indexterm-1979"></A>Public key certificates eliminate the need for communicating systems
to share secret keying material out of band. Public keys use the <A HREF="p193.html#glossary-54">Diffie-Hellman protocol</A> (DH) for authenticating
and negotiating keys. Public key certificates come in two flavors. The certificates
can be self-signed, or the certificates can be certified by a <A HREF="p193.html#glossary-41">certificate authority (CA)</A>.</p>
<p>Self-signed public key certificates are created by you, the administrator.
The <tt>ikecert certlocal -ks</tt> command creates the private part
of the public-private key pair for the system. You then get the self-signed
certificate output in X.509 format from the remote system. The remote system's
certificate is input to the <tt>ikecert certdb</tt> command for
the public part of the key pair. The self-signed certificates reside in the <tt>/etc/inet/ike/publickeys</tt> directory on the communicating
systems. When you use the <tt>-T</tt> option, the certificates reside
on attached hardware.</p>
<p>Self-signed certificates are a halfway point between preshared keys
and CAs. Unlike preshared keys, a self-signed certificate can be used on a
mobile machine or on a system that might be renumbered. To self-sign a certificate
for a system without a fixed number, use a <tt>DNS</tt> (<tt>www.example.org</tt>) or <tt>email</tt> (<tt>root@domain.org</tt>) alternative name.</p>
<p>Public keys can be delivered by a PKI or a CA organization. You install
the public keys and their accompanying CAs in the <tt>/etc/inet/ike/publickeys</tt> directory. When you use the <tt>-T</tt> option, the certificates
reside on attached hardware. Vendors also issue certificate revocation lists
(CRLs). Along with installing the keys and CAs, you are responsible for installing
the CRL in the <tt>/etc/inet/ike/crls</tt> directory.</p>
<p>CAs have the advantage of being certified by an outside organization,
rather than by the site administrator. In a sense, CAs are notarized certificates.
As with self-signed certificates, CAs can be used on a mobile machine or on
a system that might be renumbered. Unlike self-signed certificates, CAs can
very easily scale to protect a large number of communicating systems.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p116.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p118.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

