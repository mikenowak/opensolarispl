<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p173.html#ipqos-config-planning-1">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p173.html#ipqos-config-planning-7">Planning the Quality-of-Service Policy</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p174.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p176.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipqos-config-planning-42"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Define Filters in the QoS
Policy</h3>
<h5>Before You Begin</h5><p>Before you can perform the next steps, you should have completed the
procedure <A HREF="p174.html#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</A>.</p>
<ol><A NAME="ipqos-config-planning-step-48"></A><li><p><b>Create at least one filter
for each class in the QoS planning table that you created in <A HREF="p174.html#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</A>.</b></p><p>Consider creating separate filters for incoming
and outgoing traffic for each class, where applicable. For example, add an <tt>ftp-in</tt> filter and an <tt>ftp-out</tt> filter to the QoS
policy of an IPQoS-enabled FTP server.  You then can define an appropriate <tt>direction</tt> selector in addition to the basic selectors. </p>
</li>
<A NAME="ipqos-config-planning-step-44"></A><li><p><b>Define at least one selector
for each filter in a class.</b></p><p>Use the QoS planning table that was
introduced in <A HREF="p173.html#ipqos-config-planning-tbl-28">Table 33-1</A> to
fill in filters for the classes you defined.</p>
</li>
</ol><A NAME="eojbp"></A><h5>Example 33-1 &nbsp;&nbsp;Defining Filters for FTP Traffic</h5>
<p>The next table shows how you would define a filter for outgoing FTP
traffic.</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Class</p></th><th scope="col"><p>Priority</p></th><th scope="col"><p>Filters</p></th><th scope="col"><p>Selectors</p></th></tr>
<tr><td><p><tt>ftp-traffic</tt></p></td><td><p>4</p></td><td><p><tt>ftp-out</tt></p></td><td><p><tt>saddr 10.190.17.44</tt></p><p><tt>daddr 10.100.10.53</tt></p><p><tt>sport 21</tt></p><p><tt>direction LOCAL_OUT</tt></p></td></tr>
</table><h5>See Also</h5><ul><li><p>To define a flow-control scheme, refer to <A HREF="p175.html#ipqos-config-planning-16">How to Plan Flow Control</A>.</p>
</li>
<li><p>To define forwarding behaviors for flows as the flows return
to the network stream, refer to <A HREF="p176.html#ipqos-config-planning-45">How to Plan Forwarding Behavior</A>.</p>
</li>
<li><p>To plan for flow accounting of certain types of traffic, refer
to <A HREF="p176.html#ipqos-config-planning-18">How to Plan for Flow Accounting</A>.</p>
</li>
<li><p>To add more classes to the QoS policy, refer to <A HREF="p174.html#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</A>.</p>
</li>
<li><p>To add more filters to the QoS policy, refer to <A HREF="p175.html#ipqos-config-planning-42">How to Define Filters in the QoS Policy</A>.</p>
</li>
</ul>
<A NAME="ipqos-config-planning-16"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Plan Flow Control</h3>
<p>Flow control involves measuring traffic flow for a class and then releasing
packets onto the network at a defined rate. When you plan flow control, you
define parameters to be used by the IPQoS metering modules. The meters determine
the rate at which traffic is released onto the network. For an introduction
to the metering modules, see <A HREF="p170.html#ipqos-intro-19">Meter <tt>(tokenmt</tt> and <tt>tswtclmt)</tt> Overview</A>. </p>
<p>The next procedure assumes that you have defined filters and selectors,
as described in <A HREF="p175.html#ipqos-config-planning-42">How to Define Filters in the QoS Policy</A>.</p>
<ol><A NAME="ipqos-config-planning-step-36"></A><li><p><b>Determine the maximum bandwidth
for your network.</b></p></li>
<A NAME="ipqos-config-planning-step-32"></A><li><p><b>Review any SLAs that are supported
on your network. Identify customers and the type of service that is guaranteed
to each customer.</b></p><p>To guarantee a certain level of service, you
might need to meter certain traffic classes that are generated by the customer. </p>
</li>
<A NAME="ipqos-config-planning-step-34"></A><li><p><b>Review the list of classes
that you created in <A HREF="p174.html#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</A>.</b></p><p>Determine if any classes
other than those classes that are associated with SLAs need to be metered.</p>
<p>Suppose the IPQoS system runs an application that generates a high level
of traffic. After you classify the application's traffic, meter the flows
to control the rate at which the packets of the flow return to the network.</p>
<p><hr size="1" noshade><p><b>Note - </b>Not all classes need to be metered. Remember this guideline as
you review your list of classes.</p>
<hr size="1" noshade></p></li>
<A NAME="ipqos-config-planning-step-380"></A><li><p><b>Determine which filters in
each class select traffic that needs flow control. Then, refine your list
of classes that require metering.</b></p><p>Classes that have more than
one filter might require metering for only one filter. Suppose that you define
filters for incoming and outgoing traffic of a certain class. You might conclude
that only traffic in one direction requires flow control.</p>
</li>
<A NAME="ipqos-config-planning-step-35"></A><li><p><b>Choose a meter module for each
class to be flow controlled.</b></p><p>Add the module name to the meter
column in your QoS planning table. </p>
</li>
<A NAME="ipqos-config-planning-step-390"></A><li><p><b>Add the rates for each class
to be metered to the organizational table.</b></p><p><A NAME="indexterm-3077"></A>If you use the <tt>tokenmt</tt> module, you need to
define the following rates in bits per second:</p>
<ul><li><p>Committed rate</p>
</li>
<li><p>Peak rate</p>
</li>
</ul>
<p>If these rates are sufficient to meter a particular class, you can define
only the committed rate and the committed burst for <tt>tokenmt</tt>. </p>
<p>If needed, you can also define the following rates:</p>
<ul><li><p>Committed burst</p>
</li>
<li><p>Peak burst</p>
</li>
</ul>
<p>For a complete definition of <tt>tokenmt</tt> rates, refer
to <A HREF="p189.html#ipqos-reference-13">Configuring <tt>tokenmt</tt> as a Two-Rate Meter</A>. You can also find more detailed information in the <tt>tokenmt</tt>(7ipp) man page.</p>
<p>If you use the <tt>tswtclmt</tt> module,
you need to define the following rates in bits per second.</p>
<ul><li><p>Committed rate</p>
</li>
<li><p>Peak rate</p>
</li>
</ul>
<p>You can also define the window size in milliseconds. These rates are
defined in <A HREF="p189.html#ipqos-reference-20"><tt>tswtclmt</tt> Metering Module</A> and
in the <tt>twstclmt</tt>(7ipp) man page.</p>
</li>
<A NAME="ipqos-config-planning-step-370"></A><li><p><b>Add traffic conformance outcomes
for the metered traffic.</b></p><p><A NAME="indexterm-3078"></A>The outcomes for both metering modules are green, red, and yellow.
Add to your QoS organizational table the traffic conformance outcomes that
apply to the rates you define. Outcomes for the meters are fully explained
in <A HREF="p188.html#ipqos-reference-8">Meter Module</A>.</p>
<p>You
need to determine what action should be taken on traffic that conforms, or
does not conform, to the committed rate. Often,  but not always, this action
is to mark the packet header with a per-hop behavior. One acceptable action
for green-level traffic could be to continue processing while traffic flows
do not exceed the committed rate. Another action could be to drop packets
of the class if flows exceed peak rate.</p>
</li>
</ol><A NAME="eojbq"></A><h5>Example 33-2 &nbsp;&nbsp;Defining Meters</h5>
<p>The next table shows meter entries for a class of email traffic. The
network on which the IPQoS system is located has a total bandwidth of 100
Mbits/sec, or 10000000 bits per second. The QoS policy assigns a low priority
to the email class. This class also receives best-effort forwarding behavior.</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Class</p></th><th scope="col"><p>Priority</p></th><th scope="col"><p>Filter</p></th><th scope="col"><p>Selector</p></th><th scope="col"><p>Rate</p></th></tr>
<tr><td><p><tt>email</tt></p></td><td><p>8</p></td><td><p><tt>mail_in</tt></p></td><td><p><tt>daddr</tt><tt>10.50.50.5</tt></p><p><tt>dport imap</tt></p><p><tt>direction LOCAL_IN</tt></p></td><td><p>&nbsp;</p></td></tr>
<tr><td><p><tt>email</tt> </p></td><td><p>8</p></td><td><p><tt>mail_out</tt></p></td><td><p><tt>saddr</tt><tt>10.50.50.5</tt></p><p><tt>sport imap</tt></p><p><tt>direction LOCAL_OUT</tt></p></td><td><p>meter=<tt>tokenmt</tt></p><p>committed rate=5000000</p><p>committed burst =5000000</p><p>peak rate =10000000</p><p>peak burst=1000000</p><p>green precedence=continue processing</p><p>yellow precedence=mark yellow PHB</p><p>red precedence=drop</p></td></tr>
</table><h5>See Also</h5><ul><li><p>To define forwarding behaviors for flows as the packets return
to the network stream, refer to <A HREF="p176.html#ipqos-config-planning-45">How to Plan Forwarding Behavior</A>.</p>
</li>
<li><p>To plan for flow accounting of certain types of traffic, refer
to <A HREF="p176.html#ipqos-config-planning-18">How to Plan for Flow Accounting</A>.</p>
</li>
<li><p>To add more classes to the QoS policy, refer to <A HREF="p174.html#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</A>.</p>
</li>
<li><p>To add more filters to the QoS policy, refer to <A HREF="p175.html#ipqos-config-planning-42">How to Define Filters in the QoS Policy</A>.</p>
</li>
<li><p>To define another flow-control scheme, refer to <A HREF="p175.html#ipqos-config-planning-16">How to Plan Flow Control</A>.</p>
</li>
<li><p>To create an IPQoS configuration file, refer to <A HREF="p179.html#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</A>.</p>
</li>
</ul>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p174.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p176.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

