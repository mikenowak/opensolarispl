<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p128.html#eupsq">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p128.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p130.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ezltg"></A><h2>Guidelines for Using Solaris IP Filter</h2>
<A NAME="indexterm-2303"></A><A NAME="indexterm-2304"></A><A NAME="indexterm-2305"></A><ul><li><p>Solaris IP Filter is managed by the SMF services svc:/network/pfil
and svc:/network/ipfilter. For a complete overview of SMF, see Chapter 14, "Managing Services (Overview)," in <i>System Administration Guide: Basic Administration</i>.
For information on the step-by-step procedures that are associated with SMF,
see Chapter 15, "Managing Services (Tasks)," in <i>System Administration Guide: Basic Administration</i>.</p>
</li>
<li><p>Solaris IP Filter requires direct editing of configuration
files.</p>
</li>
<li><p>Solaris IP Filter is installed as part of the Solaris OS.
By default, Solaris IP Filter is not activated after a fresh install. To configure
filtering, you must edit configuration files and manually activate Solaris
IP Filter. You can activate filtering by either rebooting the system or by
plumbing the interfaces using the <tt>ifconfig</tt> command. For
more information, see the <tt>ifconfig</tt>(1M) man page. For the tasks associated with enabling Solaris
IP Filter, see <A HREF="p132.html#etmhi">Configuring Solaris IP Filter</A>.</p>
</li>
<li><p>To administer Solaris IP Filter, you must be able to assume
a role that includes the IP Filter Management rights profile, or become superuser.
You can assign the IP Filter Management rights profile to a role that you
create. To create the role and assign the role to a user, see "Configuring RBAC (Task Map)" in <i>System Administration Guide: Security Services</i>.</p>
</li>
<li><p>IP Network Multipathing (IPMP) supports stateless filtering
only.</p>
</li>
<li><p>Sun Cluster configurations do not support filtering with Solaris
IP Filter.</p>
</li>
<li><p>Filtering between zones is not currently supported with Solaris
IP Filter.</p>
</li>
</ul>
<A NAME="ezecz"></A><h2>Using Solaris IP Filter Configuration Files</h2>
<A NAME="indexterm-2306"></A><A NAME="indexterm-2307"></A><p>Solaris IP Filter can be used to provide firewall services or network
address translation (NAT). Solaris IP Filter can be implemented using loadable
configuration files. Solaris IP Filter includes a directory called <tt>/etc/ipf</tt>. You can create and store configuration files called <tt>ipf.conf</tt>, <tt>ipnat.conf</tt> and <tt>ippool.conf</tt> in
the <tt>/etc/ipf</tt> directory. These files are loaded automatically
during the boot process when they reside in the <tt>/etc/ipf</tt> directory.
You can also store the configuration files in another location and load the
files manually. For example configuration files, see <A HREF="p139.html#ipfilter-admin-2">Creating and Editing Solaris IP Filter Configuration Files</A>.</p>
<A NAME="ezecx"></A><h2>Working With Solaris IP Filter Rule Sets</h2>
<A NAME="indexterm-2308"></A><A NAME="indexterm-2309"></A><p>To manage your firewall, you use Solaris IP Filter to specify rule sets
that you use to filter your network traffic. You can create the following
types of rule sets:</p>
<ul><li><p>Packet filtering rule sets</p>
</li>
<li><p>Network Address Translation (NAT) rule sets</p>
</li>
</ul>
<p>Additionally, you can create address pools to reference groups of IP
addresses. You can then use these pools later in a rule set. The address pools
help to speed up rule processing. Address pools also make managing large groups
of addresses easier.</p>
<A NAME="euqfb"></A><h3>Using Solaris IP Filter's Packet Filtering Feature</h3>
<A NAME="indexterm-2310"></A><A NAME="indexterm-2311"></A><A NAME="indexterm-2312"></A><A NAME="indexterm-2313"></A><A NAME="indexterm-2314"></A><p>You set up packet filtering by using packet filtering rule sets. Use
the <tt>ipf</tt> command to work with packet filtering rule sets.
For more information on the <tt>ipf</tt> command, see the <tt>ipf</tt>(1M) command.</p>
<p>You can create packet filtering rules either at the command line, using
the <tt>ipf</tt> command, or in a packet filtering configuration
file. If you want the packet filtering rules to be loaded at boot time, create
a configuration file called <tt>/etc/ipf/ipf.conf</tt> in which
to put packet filtering rules. If you do not want the packet filtering rules
loaded at boot time, put the <tt>ipf.conf</tt> file in a location
of your choice, and manually activate packet filtering by using the <tt>ipf</tt> command.</p>
<p>You can maintain two sets of packet filtering rule sets with Solaris
IP Filter, the active rule set and the inactive rule set. In most cases, you
work with the active rule set. However, the <tt>ipf <tt>-I</tt></tt> command
enables you to apply the command action to the inactive rule list. The inactive
rule list is not used by Solaris IP Filter unless you select it. The inactive
rule list provides you with a place to store rules without affecting active
packet filtering.</p>
<p>Solaris IP Filter processes the rules in the rules list from the beginning
of the configured rules list to the end of the rules list before passing or
blocking a packet. Solaris IP Filter maintains a flag that determines whether
it will or will not pass a packet. It goes through the entire rule set and
determines whether to pass or block the packet based on the last matching
rule.</p>
<p>There are two exceptions to this process. The first exception is if
the packet matches a rule containing the <tt>quick</tt> keyword.
If a rule includes the <tt>quick</tt> keyword, the action for that
rule is taken, and no subsequent rules are checked. The second exception is
if the packet matches a rule containing the <tt>group</tt> keyword.
If a packet matches a group, only rules tagged with the group are checked.</p>
<A NAME="euqfk"></A><h4>Configuring Packet Filtering Rules</h4>
<p>Use the following syntax to create packet filtering rules:</p>
<p><i>action</i> <tt>[in|out]</tt> <i>option</i> <i>keyword, keyword...</i></p>
<ol Type="1"><li><p>Each rule begins with an action. Solaris IP Filter applies
the action to the packet if the packet matches the rule. The following list
includes the commonly used actions applied to a packet.</p>
<table border="0" cellspacing="5"><tr><td valign="top"><p><tt>block</tt></p></td><td valign="top"><p>Prevents the packet from passing through the filter.</p>
</td></tr><tr><td valign="top"><p><tt>pass</tt></p></td><td valign="top"><p>Allows the packet through the filter.</p>
</td></tr><tr><td valign="top"><p><tt>log</tt></p></td><td valign="top"><p>Logs the packet but does not determine if the packet is blocked
or passed. Use the <tt>ipmon</tt> command to view the log.</p>
</td></tr><tr><td valign="top"><p><tt>count</tt></p></td><td valign="top"><p>Includes the packet in the filter statistics. Use the <tt>ipfstat</tt> command to view the statistics.</p>
</td></tr><tr><td valign="top"><p><tt>skip</tt> <i>number</i></p></td><td valign="top"><p>Makes the filter skip over <i>number</i> filtering
rules.</p>
</td></tr><tr><td valign="top"><p><tt>auth</tt></p></td><td valign="top"><p>Requests that packet authentication be performed by a user
program that validates packet information. The program determines whether
the packet is passed or blocked.</p>
</td></tr><tr><td valign="top"><p><tt>preauth</tt></p></td><td valign="top"><p>Requests that the filter look at a pre-authenticated list
to determine what to do with the packet.</p>
</td></tr></table>
</li>
<li><p>Following the action, the next word must be either <tt>in</tt> or <tt>out</tt>. Your choice determines whether the packet filtering rule is
applied to an incoming packet or to an outgoing packet.</p>
</li>
<li><p>Next, you can choose from a list of options. If you use more
than one option, they must be in the order shown here.</p>
<table border="0" cellspacing="5"><tr><td valign="top"><p><tt>log</tt></p></td><td valign="top"><p>Logs the packet if the rule is the last matching rule. Use
the <tt>ipmon</tt> command to view the log.</p>
</td></tr><tr><td valign="top"><p><tt>quick</tt></p></td><td valign="top"><p>Executes the rule containing the <tt>quick</tt> option
if there is a packet match. All further rule checking stops.</p>
</td></tr><tr><td valign="top"><p><tt>on</tt> <i>interface-name</i></p></td><td valign="top"><p>Applies the rule only if the packet is moving in or out of
the specified interface.</p>
</td></tr><tr><td valign="top"><p><tt>dup-to</tt> <i>interface-name</i></p></td><td valign="top"><p>Copies the packet and sends the duplicate out on <i>interface-name</i> to an optionally specified IP address.</p>
</td></tr><tr><td valign="top"><p><tt>to</tt> <i>interface-name</i></p></td><td valign="top"><p>Moves the packet to an outbound queue on <i>interface-name</i>.</p>
</td></tr></table>
</li>
<li><p>After specifying the options, you can choose from a variety
of keywords that determine whether the packet matches the rule. The following
keywords must be used in the order shown here.</p>
<p><hr size="1" noshade><p><b>Note - </b>By default, any packet that does not match any rule in the configuration
file is passed through the filter.</p>
<hr size="1" noshade></p><table border="0" cellspacing="5"><tr><td valign="top"><p><tt>tos</tt></p></td><td valign="top"><p>Filters the packet based on the type-of-service value expressed
as either a hexadecimal or a decimal integer.</p>
</td></tr><tr><td valign="top"><p><tt>ttl</tt></p></td><td valign="top"><p>Matches the packet based on its time-to-live value. The time-to-live
value stored in a packet indicates the length of time a packet can be on the
network before being discarded.</p>
</td></tr><tr><td valign="top"><p><tt>proto</tt></p></td><td valign="top"><p>Matches a specific protocol. You can use any of the protocol
names specified in the <tt>/etc/protocols</tt> file, or use a
decimal number to represent the protocol. The keyword <tt>tcp/udp</tt> can
be used to match either a TCP or a UDP packet.</p>
</td></tr><tr><td valign="top"><p><tt>from</tt>/<tt>to</tt>/<tt>all</tt>/<tt>any</tt></p></td><td valign="top"><p>Matches any or all of the following: the source IP address,
the destination IP address, and the port number. The <tt>all</tt> keyword
is used to accept packets from all sources and to all destinations.</p>
</td></tr><tr><td valign="top"><p><tt>with</tt></p></td><td valign="top"><p>Matches specified attributes associated with the packet. Insert
either the word <tt>not</tt> or the word <tt>no</tt> in
front of the keyword in order to match the packet only if the option is not
present.</p>
</td></tr><tr><td valign="top"><p><tt>flags</tt></p></td><td valign="top"><p>Used for TCP to filter based on TCP flags that are set. For
more information on the TCP flags, see the <tt>ipf</tt>(4) man page.</p>
</td></tr><tr><td valign="top"><p><tt>icmp-type</tt></p></td><td valign="top"><p>Filters according to ICMP type. This keyword is used only
when the <tt>proto</tt> option is set to <tt>icmp</tt> and
is not used if the <tt>flags</tt> option is used.</p>
</td></tr><tr><td valign="top"><p><tt>keep</tt> <i>keep-options</i></p></td><td valign="top"><p>Determines the information that is kept for a packet. The <i>keep-options</i> available include the <tt>state</tt> option
and the <tt>frags</tt> option. The <tt>state</tt> option
keeps information about the session and can be kept on TCP, UDP, and ICMP
packets. The <tt>frags</tt> option keeps information on packet fragments
and applies the information to later fragments. The <i>keep-options</i> allow
matching packets to pass without going through the access control list.</p>
</td></tr><tr><td valign="top"><p><tt>head</tt> <i>number</i></p></td><td valign="top"><p>Creates a new group for filtering rules, which is denoted
by the number <i>number</i>.</p>
</td></tr><tr><td valign="top"><p><tt>group</tt> <i>number</i></p></td><td valign="top"><p>Adds the rule to group number <i>number</i> instead
of the default group. All filtering rules are placed in group 0 if no other
group is specified.</p>
</td></tr></table>
</li>
</ol>
<p>The following example illustrates how to put together the packet filtering
rule syntax to create a rule. To block incoming traffic from the IP address <tt>192.168.0.0/16</tt>, you would include the following rule in the rule
list:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>block in quick from 192.168.0.0/16 to any</pre>
</td></table><br><p>For the complete grammar and syntax used to write packet filtering rules,
see the <tt>ipf</tt>(4) man
page. For tasks associated with packet filtering, see <A HREF="p133.html#ettma">Managing Packet Filtering Rule Sets for Solaris IP Filter</A>. For an explanation
of the IP address scheme (<tt>192.168.0.0/16</tt>) shown in the
example, see <A HREF="p6.html#ipplan-1">Chapter&nbsp;2, Planning an IPv4 Addressing Scheme (Tasks</A>.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p128.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p130.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

