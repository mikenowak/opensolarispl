<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p90.html#eyatl">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p92.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p94.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="extkj"></A><h2>DHCP Client Event Scripts</h2>
<A NAME="indexterm-1542"></A><A NAME="indexterm-1543"></A><A NAME="indexterm-1544"></A><A NAME="indexterm-1545"></A><p>You can set up the Solaris DHCP client to run an executable program
or script that can perform any action that is appropriate for the client system.
The program or script, which is called an <b>event script</b>,
is automatically executed after certain DHCP lease events occur. The event
script can be used to run other commands, programs, or scripts in response
to specific lease events. You must provide your own event script to use this
feature.</p>
<p>The following event keywords are used by <tt>dhcpagent</tt> to
signify DHCP lease events:</p>
<table border="0" cellspacing="5"><tr><td valign="top"><p><b>Event Keyword</b></p></td><td valign="top"><p><b>Description</b></p>
</td></tr><tr><td valign="top"><p><tt>BOUND</tt></p></td><td valign="top"><p>The interface is configured for DHCP. The client receives
the acknowledgement message (<tt>ACK</tt>) from the DHCP server,
which grants the lease request for an IP address. The event script is invoked
immediately after the interface is configured successfully.</p>
</td></tr><tr><td valign="top"><p><tt>EXTEND</tt></p></td><td valign="top"><p>The client successfully extends a lease. The event script
is invoked immediately after the client receives the acknowledgement message
from the DHCP server for the renew request.</p>
</td></tr><tr><td valign="top"><p><tt>EXPIRE</tt></p></td><td valign="top"><p>The lease expires when the lease time is up. The event script
is invoked immediately before the leased address is removed from the interface
and the interface is marked as down.</p>
</td></tr><tr><td valign="top"><p><tt>DROP</tt></p></td><td valign="top"><p>The client drops the lease to remove the interface from DHCP
control. The event script is invoked immediately before the interface is removed
from DHCP control.</p>
</td></tr><tr><td valign="top"><p><tt>RELEASE</tt></p></td><td valign="top"><p>The client relinquishes the IP address. The event script is
invoked immediately before the client releases the address on the interface
and sends the <tt>RELEASE</tt> packet to the DHCP server.</p>
</td></tr></table>
<p><A NAME="indexterm-1546"></A><A NAME="indexterm-1547"></A>With each of these events, <tt>dhcpagent</tt> invokes
the following command:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>/etc/dhcp/eventhook <i>interface event</i></pre>
</td></table><br><p>where <i>interface</i> is the interface that is
using DHCP and <i>event</i> is one of the event keywords
described previously. For example, when the <tt>ce0</tt> interface
is first configured for DHCP, the <tt>dhcpagent</tt> invokes the
event script as follows:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>/etc/dhcp/eventhook ce0 BOUND</pre>
</td></table><br><p>To use the event script feature, you must do the following:</p>
<ul><li><p>Name the executable file <tt>/etc/dhcp/eventhook</tt>.</p>
</li>
<li><p>Set the owner of the file to be <tt>root</tt>.</p>
</li>
<li><p>Set permissions to <tt>755</tt> (<tt>rwxr-xr-x</tt>).</p>
</li>
<li><p>Write the script or program to perform a sequence of actions
in response to any of the documented events. Because Sun might add new events,
the program must silently ignore any events that are not recognized or do
not require action. For example, the program or script might write to a log
file when the event is <tt>RELEASE</tt>, and ignore all other events.</p>
</li>
<li><p>Make the script or program noninteractive. Before the event
script is invoked, <tt>stdin</tt>, <tt>stdout</tt>, and <tt>stderr</tt> are connected to <tt>/dev/null</tt>. To see the
output or errors, you must redirect to a file.</p>
</li>
<li><p>Enable the script or program to be run with the following
command:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>/etc/dhcp/eventhook <i>interface event</i></pre>
</td></table><br></li>
</ul>
<p>The event script inherits its program environment from <tt>dhcpagent</tt>,
and runs with <tt>root</tt> privileges. The script can use the <tt>dhcpinfo</tt> utility to obtain more information about the interface,
if necessary. See the <tt>dhcpinfo</tt>(1) man
page for more information.</p>
<p>The <tt>dhcpagent</tt> daemon waits for the event script to
exit on all events. If the event script does not exit after 55 seconds, <tt>dhcpagent</tt> sends a <tt>SIGTERM</tt> signal to the script
process. If the process still does not exit after three additional seconds,
the daemon sends a <tt>SIGKILL</tt> signal to kill the process.</p>
<p>The <tt>dhcpagent</tt>(1M) man
page includes one example of an event script.</p>
<p><A HREF="p93.html#fapgt">Example 16-3</A> shows how to use
a DHCP event script to keep the content of the <tt>/etc/resolv.conf</tt> file
up to date. When the <tt>BOUND</tt> and <tt>EXTEND</tt> events
occur, the script replaces the names of the domain server and name server.
When the <tt>EXPIRE</tt>, <tt>DROP</tt> and <tt>RELEASE</tt> events
occur, the script removes the names of the domain server and name server from
the file.</p>
<p><hr size="1" noshade><p><b>Note - </b>The example script assumes that DHCP is the authoritative source
for the names of the domain server and the name server. The script also assumes
that all interfaces under DHCP control return consistent and current information.
These assumptions might not reflect conditions on your system.</p>
<hr size="1" noshade></p><A NAME="fapgt"></A><p><b>Example 16-3 </b>Event Script for Updating the <tt>/etc/resolv.conf</tt> File</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>#!/bin/ksh -p

PATH=/bin:/sbin export PATH
umask 0222

# Refresh the domain and name servers on /etc/resolv.conf

insert ()
{
	dnsservers=`dhcpinfo -i $1 DNSserv`
	if [ -n "$dnsservers" ]; then
		# remove the old domain and name servers
		if [ -f /etc/resolv.conf ]; then
			rm -f /tmp/resolv.conf.$$
			sed -e '/^domain/d' -e '/^nameserver/d' \
			    /etc/resolv.conf > /tmp/resolv.conf.$$
		fi

		# add the new domain
		dnsdomain=`dhcpinfo -i $1 DNSdmain`
		if [ -n "$dnsdomain" ]; then
			echo "domain $dnsdomain" >> /tmp/resolv.conf.$$
		fi

		# add new name servers
		for name in $dnsservers; do
			echo nameserver $name >> /tmp/resolv.conf.$$
		done
		mv -f /tmp/resolv.conf.$$ /etc/resolv.conf
	fi
}

# Remove the domain and name servers from /etc/resolv.conf

remove ()
{
	if [ -f /etc/resolv.conf ]; then
		rm -f /tmp/resolv.conf.$$
		sed -e '/^domain/d' -e '/^nameserver/d' \
		    /etc/resolv.conf > /tmp/resolv.conf.$$
		mv -f /tmp/resolv.conf.$$ /etc/resolv.conf
	fi
}

case $2 in
BOUND | EXTEND)
	insert $1
	exit 0
	;;
EXPIRE | DROP | RELEASE)
	remove
	exit 0
	;;
*)
	exit 0
	;;
esac</pre>
</td></table><br>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p92.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p94.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

