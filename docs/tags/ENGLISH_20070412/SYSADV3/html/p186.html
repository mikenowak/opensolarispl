<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p185.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p187.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipqos-accounting-1"></A><b>Chapter&nbsp;36</b><h1>Using Flow Accounting
and Statistics Gathering (Tasks)</h1>
<p>This chapter explains how to obtain accounting and statistical information on
traffic that is handled by an IPQoS system. The following topics are discussed:</p>
<ul><li><p><A HREF="p186.html#ipqos-accounting-3">Setting Up Flow Accounting (Task Map)</A></p>
</li>
<li><p><A HREF="p186.html#ipqos-accounting-2">Recording Information About Traffic Flows</A></p>
</li>
<li><p><A HREF="p186.html#ipqos-accounting-5">Gathering Statistical Information</A></p>
</li>
</ul>
<A NAME="ipqos-accounting-3"></A><h2>Setting Up Flow Accounting (Task Map)</h2>
<p><A NAME="indexterm-3135"></A>The following task map lists the generic
tasks for obtaining information about traffic flows by using the <tt>flowacct</tt> module.</p>
<A NAME="ipqos-accounting-tbl-6"></A>
<table cellspacing="5" border="1">
<tr><th scope="col"><p>Task</p></th><th scope="col"><p>Description</p></th><th scope="col"><p>For Instructions</p></th></tr>
<tr><td><p>1. Create a file to contain accounting information for traffic flows.</p></td><td><p>Use the <tt>acctadm</tt> command to create a file that holds the results
of processing by <tt>flowacct</tt>.</p></td><td><p><A HREF="p186.html#ipqos-accounting-7">How to Create a File for Flow-Accounting Data</A>&nbsp;</p></td></tr>
<tr><td><p>2. Define <tt>flowacct</tt> parameters in the IPQoS configuration
file.</p></td><td><p>Define values for the <tt>timer</tt>, <tt>timeout</tt>,
and <tt>max_limit</tt> parameters.</p></td><td><p><A HREF="p180.html#ipqos-policy-planning-110">How to Enable Accounting for a Class in the IPQoS Configuration File</A>&nbsp;</p></td></tr>
</table><A NAME="ipqos-accounting-2"></A><h2>Recording Information About Traffic Flows</h2>
<p><A NAME="indexterm-3136"></A>You use the IPQoS <tt>flowacct</tt> module to collect information about traffic flows. For example,
you can collect  source and destination addresses, number of packets in a flow, and
similar data. The process of accumulating and recording information about flows is
called <b>flow accounting</b>. </p>
<p><A NAME="indexterm-3137"></A>The results of flow accounting on traffic of a
particular class are recorded in a table of <b>flow records</b>. Each
flow record consists of a series of attributes. These attributes contain data about
traffic flows of a particular class over an interval of time. For a list of the <tt>flowacct</tt> attributes, refer to <A HREF="p191.html#ipqos-reference-tbl-6">Table 37-4</A>.</p>
<p><A NAME="indexterm-3138"></A>Flow accounting is particularly
useful for billing clients as is defined in their service-level agreements (SLAs).
You can also use flow accounting to obtain flow statistics for critical applications.
This section contains tasks for using <tt>flowacct</tt> with the Solaris
extended accounting facility to obtain data on traffic flows. </p>
<p>The following information is contained in sources outside this chapter:</p>
<ul><li><p>For instructions on creating an action statement for <tt>flowacct</tt> in the IPQoS configuration file, refer to <A HREF="p183.html#ipqos-policy-planning-144">How to Configure Flow Control in the IPQoS Configuration File</A>. </p>
</li>
<li><p>To learn how <tt>flowacct</tt> works, refer to <A HREF="p188.html#ipqos-reference-3">Classifier Module</A>.</p>
</li>
<li><p>For technical information, refer to the <tt>flowacct</tt>(7ipp)
man page. </p>
</li>
</ul>
<A NAME="ipqos-accounting-7"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Create a File for Flow-Accounting Data</h3>
<p>Before you add a <tt>flowacct</tt> action to the IPQoS configuration
file, you must create a file for flow records from the <tt>flowacct</tt> module.
You use the <tt>acctadm</tt> command for this purpose. <tt>acctadm</tt> can record either basic attributes or extended attributes in the file.
All <tt>flowacct</tt> attributes are listed in <A HREF="p191.html#ipqos-reference-tbl-6">Table 37-4</A>. For detailed information about <tt>acctadm</tt>,
refer to the <tt>acctadm</tt>(1M) man page. </p>
<ol><li><p><b>Assume the Primary Administrator role, or become superuser, on the IPQoS-enabled
system.</b></p><p>The Primary Administrator role includes the Primary Administrator
profile. To create the role and assign the role to a user, see Chapter 2, "Working With the Solaris Management Console (Tasks)," in <i>System Administration Guide: Basic Administration</i>.</p>
</li>
<A NAME="ipqos-accounting-step-10"></A><li><p><b>Create a basic flow-accounting file.</b></p><p>The following example shows how to create a basic flow-accounting file for the
premium web server that is configured in <A HREF="p178.html#ipqos-policy-planning-ex-93">Example 34-1</A>.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>/usr/sbin/acctadm -e basic -f /var/ipqos/goldweb/account.info flow</b></tt></pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p><tt>acctadm -e</tt></p></td><td valign="top"><p>Invokes <tt>acctadm</tt> with the <tt>-e</tt> option.
The <tt>-e</tt> option enables the arguments that follow.</p>
</td></tr><tr><td valign="top"><p><tt>basic</tt></p></td><td valign="top"><p>States that only data for the eight basic <tt>flowacct</tt> attributes
is to be recorded in the file.</p>
</td></tr><tr><td valign="top"><p><tt>/var/ipqos/goldweb/account.info</tt></p></td><td valign="top"><p>Specifies the fully qualified path name of the file to hold the flow
records from <tt>flowacct</tt>.</p>
</td></tr><tr><td valign="top"><p><tt>flow</tt></p></td><td valign="top"><p>Instructs <tt>acctadm</tt> to enable flow accounting.</p>
</td></tr></table>
</li>
<A NAME="ipqos-accounting-step-11"></A><li><p><b>View information about flow accounting on
the IPQoS system by typing <tt>acctadm</tt> without arguments.</b></p><p><tt>acctadm</tt> generates the following output:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>Task accounting: inactive
       Task accounting file: none
     Tracked task resources: none
   Untracked task resources: extended
         Process accounting: inactive
    Process accounting file: none
  Tracked process resources: none
Untracked process resources: extended,host,mstate
            Flow accounting: active
       Flow accounting file: /var/ipqos/goldweb/account.info
     Tracked flow resources: basic
   Untracked flow resources: dsfield,ctime,lseen,projid,uid</pre>
</td></table><br><p>All entries but the last four are for use with the Solaris Resource Manager
feature. The next table explains the entries that are specific to IPQoS.</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Entry</p></th><th scope="col"><p>Description</p></th></tr>
<tr><td><p><tt>Flow accounting: active</tt></p></td><td><p>Indicates that flow accounting is turned on.</p></td></tr>
<tr><td><p><tt>Flow accounting file: /var/ipqos/goldweb/account.info</tt></p></td><td><p>Gives the name of the current flow-accounting file.</p></td></tr>
<tr><td><p><tt>Tracked flow resources: basic</tt></p></td><td><p>Indicates that only the basic flow attributes are tracked.</p></td></tr>
<tr><td><p><tt>Untracked flow resources: dsfield,ctime,lseen,projid,uid</tt></p></td><td><p>Lists the <tt>flowacct</tt> attributes that are not tracked in the
file.</p></td></tr>
</table></li>
<A NAME="ipqos-accounting-step-15"></A><li><p><b><A NAME="indexterm-3139"></A>(Optional) Add the extended attributes to
the accounting file.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># acctadm -e extended -f /var/ipqos/goldweb/account.info flow</pre>
</td></table><br></li>
<A NAME="ipqos-accounting-step-18"></A><li><p><b>(Optional) Return to recording only the
basic attributes in the accounting file.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># acctadm -d extended -e basic -f /var/ipqos/goldweb/account.info</pre>
</td></table><br><p>The <tt>-d</tt> option disables extended accounting.</p>
</li>
<li><p><b>View the contents of a flow-accounting file.</b></p><p>Instructions
for viewing the contents of a flow-accounting file are in "Perl Interface to libexacct" in <i>System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</i>.</p>
</li>
</ol><h5>See Also</h5><ul><li><p>For detailed information on the extended accounting feature, refer
to Chapter 4, "Extended Accounting (Overview)," in <i>System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</i>.</p>
</li>
<li><p>To define <tt>flowacct</tt> parameters in the IPQoS configuration
file, refer to <A HREF="p180.html#ipqos-policy-planning-110">How to Enable Accounting for a Class in the IPQoS Configuration File</A>.</p>
</li>
<li><p>To print the data in the file that was created with <tt>acctadm</tt>, refer to "Perl Interface to libexacct" in <i>System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</i>.</p>
</li>
</ul>
<A NAME="ipqos-accounting-5"></A><h2>Gathering Statistical Information</h2>
<p><A NAME="indexterm-3140"></A><A NAME="indexterm-3141"></A><A NAME="indexterm-3142"></A>You can use
the <tt>kstat</tt> command to generate statistical information from the
IPQoS modules. Use the following syntax:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>/bin/kstat -m</b></tt> <i>ipqos-module-name</i></pre>
</td></table><br><p>You can specify any valid IPQoS module name, as shown in <A HREF="p192.html#ipqos-reference-tbl-2">Table 37-5</A>. For example, to view statistics that are generated by the <tt>dscpmk</tt> marker, you use the following form of <tt>kstat</tt>:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>/bin/kstat -m dscpmk</b></tt></pre>
</td></table><br><p>For technical details, refer to the <tt>kstat</tt>(1M) man page.</p>
<A NAME="eupug"></A><p><b>Example 36-1 </b><tt>kstat</tt> Statistics for IPQoS</p>
<p>Here is an example of possible results from running <tt>kstat</tt> to
obtain statistics about the <tt>flowacct</tt> module.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>kstat -m flowacct</b></tt>
module: flowacct                        instance: 3     
name:   Flowacct statistics             class:    flacct 
        bytes_in_tbl                    84
        crtime                          345728.504106363
        epackets                        0
        flows_in_tbl                    1
        nbytes                          84
        npackets                        1
        snaptime                        345774.031843301
        usedmem                         256</pre>
</td></table><br>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p185.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p187.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

