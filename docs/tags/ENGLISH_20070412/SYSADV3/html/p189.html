<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p188.html#ipqos-reference-1">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p188.html#ipqos-reference-2">IPQoS Architecture and the Diffserv Model</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p188.html#ipqos-reference-8">Meter Module</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p188.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p190.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipqos-reference-130"></A><h4><tt>tokenmt</tt> Metering
Module</h4>
<p><A NAME="indexterm-3152"></A>The <tt>tokenmt</tt> module uses <b>token buckets</b> to
measure the transmission rate of a flow. You can configure <tt>tokenmt</tt> to
operate as a single-rate or two-rate meter. A <tt>tokenmt</tt> action
instance maintains two token buckets that determine whether the traffic flow
conforms to configured parameters. </p>
<p>The <tt>tokenmt</tt>(7ipp) man
page explains how IPQoS implements the token meter paradigm. You can find
more general information about token buckets in Kalevi Kilkki's <b>Differentiated
Services for the Internet</b> and on a number of web sites.</p>
<p><A NAME="indexterm-3153"></A><A NAME="indexterm-3154"></A>Configuration parameters for <tt>tokenmt</tt> are as
follows:</p>
<ul><li><p><tt>committed_rate</tt> - Specifies the committed
rate of the flow in bits per second.</p>
</li>
<li><p><tt>committed_burst</tt> - Specifies the committed
burst size in bits. The <tt>committed_burst</tt> parameter defines
how many outgoing packets of a particular class can pass onto the network
at the committed rate.</p>
</li>
<li><p><tt>peak_rate</tt> - Specifies the peak rate
in bits per second. </p>
</li>
<li><p><tt>peak_burst</tt> - Specifies the peak or
excess burst size in bits. The <tt>peak_burst</tt> parameter grants
to a traffic class a peak-burst size that exceeds the committed rate.</p>
</li>
<li><p><tt>color_aware</tt> - Turns on awareness
mode for <tt>tokenmt</tt>. </p>
</li>
<li><p><tt>color_map</tt> - Defines an integer array
that maps DSCP values to green, yellow, or red.</p>
</li>
</ul>
<A NAME="ipqos-reference-12"></A><h5>Configuring <tt>tokenmt</tt> as
a Single-Rate Meter</h5>
<p><A NAME="indexterm-3155"></A>To configure <tt>tokenmt</tt> as a single-rate meter,
do not specify a <tt>peak_rate</tt> parameter for <tt>tokenmt</tt> in
the IPQoS configuration file. To configure a single-rate <tt>tokenmt</tt> instance
to have a red, green, or a yellow outcome, you must specify the <tt>peak_burst</tt> parameter. If you do not use the <tt>peak_burst</tt> parameter,
you can configure <tt>tokenmt</tt> to have only a red outcome or
green outcome. For an example of a single-rate <tt>tokenmt</tt> with
two outcomes, see <A HREF="p181.html#ipqos-policy-planning-ex-96">Example 34-3</A>.</p>
<p>When <tt>tokenmt</tt> operates as a single-rate meter, the <tt>peak_burst</tt> parameter is actually the excess burst size. <tt>committed_rate</tt>, and either <tt>committed_burst</tt> or <tt>peak_burst</tt>,
must be nonzero positive integers.</p>
<A NAME="ipqos-reference-13"></A><h5>Configuring <tt>tokenmt</tt> as
a Two-Rate Meter</h5>
<p><A NAME="indexterm-3156"></A>To configure <tt>tokenmt</tt> as a two-rate meter, specify
a <tt>peak_rate</tt> parameter for the <tt>tokenmt</tt> action
in the IPQoS configuration file. A two-rate <tt>tokenmt</tt> always
has the three outcomes, red, yellow, and green. The <tt>committed_rate</tt>, <tt>committed_burst</tt>, and <tt>peak_burst</tt> parameters must
be nonzero positive integers.</p>
<A NAME="ipqos-reference-14"></A><h5>Configuring <tt>tokenmt</tt> to
Be Color Aware</h5>
<p><A NAME="indexterm-3157"></A><A NAME="indexterm-3158"></A><A NAME="indexterm-3159"></A>To configure a two-rate <tt>tokenmt</tt> to be color
aware, you must add parameters to specifically add "color awareness."
The following is an example action statement that configures <tt>tokenmt</tt> to
be color aware.</p>
<A NAME="ipqos-reference-ex-20"></A><p><b>Example 37-1 </b>Color-Aware <tt>tokenmt</tt> Action
for the IPQoS Configuration File</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>action {
    module tokenmt
    name meter1
    params {
	      committed_rate 4000000
	      peak_rate 8000000
	      committed_burst 4000000
	      peak_burst 8000000
	      global_stats true
	      red_action_name continue
	      yellow_action_name continue
	      green_action_name continue
	      color_aware true
	      color_map {0-20,22:GREEN;21,23-42:RED;43-63:YELLOW}
    }
}</pre>
</td></table><br><p>You turn on color awareness by setting the <tt>color_aware</tt> parameter
to <tt>true</tt>. As a color-aware meter, <tt>tokenmt</tt> assumes
that the packet has already been marked as red, yellow, or green by a previous <tt>tokenmt</tt> action. Color-aware <tt>tokenmt</tt> evaluates
a packet by using the DSCP in the packet header in addition to the parameters
for a two-rate meter. </p>
<p><A NAME="indexterm-3160"></A>The <tt>color_map</tt> parameter contains an array into
which the DSCP in the packet header is mapped. Consider the following <tt>color_map</tt> array:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>color_map {0-20,22:GREEN;21,23-42:RED;43-63:YELLOW}</pre>
</td></table><br><p>Packets with a DSCP of 0-20 and 22 are mapped to green. Packets
with a DSCP of 21 and 23-42 are mapped to red. Packets with a DSCP of
43-63 are mapped to yellow. <tt>tokenmt</tt> maintains a default
color map. However, you can change the default as needed by using the <tt>color_map</tt> parameters.</p>
<p>In the <i>color</i><tt>_action_name</tt> parameters,
you can specify <tt>continue</tt> to complete processing of the
packet. Or, you can add an argument to send the packet to a marker action,
for example, <tt>yellow_action_name mark22</tt>.</p>
<A NAME="ipqos-reference-20"></A><h4><tt>tswtclmt</tt> Metering
Module</h4>
<p><A NAME="indexterm-3161"></A>The <tt>tswtclmt</tt> metering module estimates average
bandwidth for a traffic class by using a time-based <b>rate estimator</b>. <tt>tswtclmt</tt> always operates as a three-outcome meter. The rate estimator
provides an estimate of the flow's arrival rate. This rate should approximate
the running average bandwidth of the traffic stream over a specific period
or time, its <b>time window</b>. The rate estimation algorithm
is taken from RFC 2859, <b>A Time Sliding Window Three Colour Marker</b>.</p>
<p><A NAME="indexterm-3162"></A>You use the following parameters to configure <tt>tswtclmt</tt>:</p>
<ul><li><p><tt>committed_rate</tt> - Specifies the committed
rate in bits per second</p>
</li>
<li><p><tt>peak_rate</tt> - Specifies the peak rate
in bits per second</p>
</li>
<li><p><tt>window</tt> - Defines the time window,
in milliseconds over which history of average bandwidth is kept</p>
</li>
</ul>
<p>For technical details on <tt>tswtclmt</tt>, refer to the<tt>tswtclmt</tt>(7ipp) man page.
For general information on rate shapers that are similar to <tt>tswtclmt</tt>,
see <A  HREF="http://www.ietf.org/rfc/rfc2963.txt?number=2963">RFC 2963, A Rate Adaptive Shaper for Differentiated Services</A>.</p>
<A NAME="ipqos-reference-11"></A><h3>Marker Module</h3>
<p><A NAME="indexterm-3163"></A><A NAME="indexterm-3164"></A>IPQoS includes
two marker modules, <tt>dscpmk</tt> and <tt>dlcosmk</tt>.
This section contains information for using both markers. Normally, you should
use <tt>dscpmk</tt> because <tt>dlcosmk</tt> is only available
for IPQoS systems with VLAN devices.</p>
<p>For technical information about <tt>dscpmk</tt>, refer to
the <tt>dscpmk</tt>(7ipp) man page. For technical information about <tt>dlcosmk</tt>, refer to the <tt>dlcosmk</tt>(7ipp) man page.</p>
<A NAME="ipqos-reference-330"></A><h4>Using the <tt>dscpmk</tt> Marker
for Forwarding Packets</h4>
<p><A NAME="indexterm-3165"></A><A NAME="indexterm-3166"></A><A NAME="indexterm-3167"></A>The marker receives traffic flows after the flows are processed
by the classifier or by the metering modules. The marker marks the traffic
with a forwarding behavior. This forwarding behavior is the action to be taken
on the flows after the flows leaving the IPQoS system. Forwarding behavior
to be taken on a traffic class is defined in the <b>per-hop behavior
(PHB)</b>. The PHB assigns a priority to a traffic class, which indicates
the precedence flows of that class in relation to other traffic classes. PHBs
only govern forwarding behaviors on the IPQoS system's contiguous network.
For more information on PHBs, refer to <A HREF="p171.html#ipqos-intro-10">Per-Hop Behaviors</A>.</p>
<p><b>Packet forwarding</b> is the process of sending traffic
of a particular class to its next destination on a network. For a host such
as an IPQoS system, a packet is forwarded from the host to the local network
stream. For a Diffserv router, a packet is forwarded from the local network
to the router's next hop.  </p>
<p>The marker marks the DS field in the packet header with a well-known
forwarding behavior that is defined in the IPQoS configuration file. Thereafter,
the IPQoS system and subsequent Diffserv-aware systems forward the traffic
as indicated in the DS field until the mark changes. To assign a PHB, the
IPQoS system marks a value in the DS field of the packet header. This value
is called the differentiated services codepoint (DSCP). The Diffserv architecture
defines two types of forwarding behaviors, EF and AF, which use different
DSCPs. For overview information about DSCPs, refer to <A HREF="p171.html#ipqos-intro-99">DS Codepoint</A>.</p>
<p><A NAME="indexterm-3168"></A>The IPQoS system reads the DSCP for the traffic flow and evaluates
the flow's precedence in relation to other outgoing traffic flows. The IPQoS
system then prioritizes  all concurrent traffic flows and releases each flow
onto the network by its priority. </p>
<p>The Diffserv router receives the outgoing traffic flows and reads the
DS field in the packet headers. The DSCP enables the router to prioritize
and schedule the concurrent traffic flows. The router  forwards each flow
by the priority that is indicated by the PHB. Note that the PHB cannot apply
beyond the boundary router of the network unless Diffserv-aware systems on
subsequent hops also recognize the same PHB. </p>
<A NAME="ipqos-reference-140"></A><h5>Expedited Forwarding (EF) PHB</h5>
<p><A NAME="indexterm-3169"></A><A NAME="indexterm-3170"></A><b>Expedited forwarding</b> (EF) guarantees that
packets with the recommended EF codepoint 46 (101110) receive the best treatment
that is available on release to the network. Expedited forwarding is often
compared to a leased line. Packets with the 46 (101110) codepoint are guaranteed
preferential treatment by all Diffserv routers en route to the packets' destination.
For technical information about EF, refer to RFC 2598, <b>An Expedited
Forwarding PHB</b>.</p>
<A NAME="ipqos-reference-150"></A><h5>Assured Forwarding (AF) PHB</h5>
<p><A NAME="indexterm-3171"></A><A NAME="indexterm-3172"></A><A NAME="indexterm-3173"></A><b>Assured forwarding</b> (AF) provides four different
classes of forwarding behaviors that you can specify to the marker. The next
table shows the classes, the three drop precedences that are provided with
each class, and the recommended DSCPs that are associated with each precedence.
Each DSCP is represented by its AF value, its value in decimal, and its value
in binary.</p>
<A NAME="ipqos-reference-tbl-16"></A><p><b>Table 37-2 </b>Assured
Forwarding Codepoints</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>&nbsp;</p></th><th scope="col"><p>Class 1</p></th><th scope="col"><p>Class 2</p></th><th scope="col"><p>Class 3</p></th><th scope="col"><p>Class 4</p></th></tr>
<tr><td><p><b>Low-Drop Precedence</b></p></td><td><p>AF11 =</p><p>10 (001010)</p></td><td><p>AF21 =</p><p>18 (010010)</p></td><td><p>AF31 =</p><p>26 (011010)</p></td><td><p>AF41 =</p><p>34 (100010)</p></td></tr>
<tr><td><p><b>Medium-Drop Precedence</b></p></td><td><p>AF12 =</p><p>12 (001100)</p></td><td><p>AF22 =</p><p>20 (010100)</p></td><td><p>AF32 =</p><p>28 (011100)</p></td><td><p>AF42 = </p><p>36 (100100)</p></td></tr>
<tr><td><p><b>High-Drop Precedence</b></p></td><td><p>AF13 =</p><p>14 (001110)</p></td><td><p>AF23 =</p><p>22 (010110)</p></td><td><p>AF33 =</p><p>30 (011110)</p></td><td><p>AF43 =</p><p>38 (100110)</p></td></tr>
</table><p>Any Diffserv-aware system can use the AF codepoint as a guide for providing
differentiated forwarding behaviors to different classes of traffic. </p>
<p><A NAME="indexterm-3174"></A>When these packets reach a Diffserv router, the router evaluates
the packets' codepoints along with DSCPs of other traffic in the queue. The
router then forwards or drops packets, depending on the available bandwidth
and the priorities that are assigned by the packets' DSCPs. Note that packets
that are marked with the EF PHB are guaranteed bandwidth over packets that
are marked with the various AF PHBs.</p>
<p>Coordinate packet marking between any IPQoS systems on your network
and the Diffserv router to ensure that packets are forwarded as expected.
For example, suppose IPQoS systems on your network mark packets with AF21
(010010), AF13 (001110), AF43 (100110), and EF (101110) codepoints. You then
need to add the AF21, AF13, AF43, and EF DSCPs to the appropriate file on
the Diffserv router.</p>
<p>For a technical explanation of the AF codepoint table, refer to RFC
2597. Router manufacturers Cisco Systems and Juniper Networks have detailed
information about setting the AF PHB on their web sites. You can use this
information to define AF PHBs for IPQoS systems as well as routers. Additionally,
router manufacturers' documentation contains instructions for setting DS codepoints
on their equipment.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p188.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p190.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

