<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title><tt>io</tt> Provider - Solaris Dynamic Tracing Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2005-09-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >Solaris Dynamic Tracing Guide<?GenHTML /ReferencePage>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p49.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p51.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="chp-io"></a>Chapter&nbsp;27<h3><tt>io</tt> Provider</h3><p>The <tt>io</tt> provider makes available probes related to disk input and output. The <tt>io</tt> provider enables quick exploration of behavior observed through I/O monitoring tools such as <tt>iostat</tt>(1M). For example, using the <tt>io</tt> provider, you can understand I/O by device, by I/O type, by I/O size, by process, by application name, by file name, or by file offset.</p>
<a name="gelrk"></a><h3>Probes</h3>
<p><a name="indexterm-397"></a><a name="indexterm-398"></a><a name="indexterm-399"></a><a name="indexterm-400"></a><a name="indexterm-401"></a><a name="indexterm-402"></a>The <tt>io</tt> probes are described in <a href="p50.html#tbl-io">Table 27-1</a>.</p>
<a name="tbl-io"></a>Table 27-1 <tt>io</tt> Probes<table><tr><th valign="top"><p>Probe</p>
</th><th valign="top"><p>Description</p>
</th></tr>
<tr><td><p><tt>start</tt></p>
</td><td><p>Probe that fires when an I/O request is about to be made either to a peripheral device or to an NFS server. The <tt>bufinfo_t</tt> corresponding to the I/O request is pointed to by <tt>args[0]</tt>. The <tt>devinfo_t</tt> of the device to which the I/O is being issued is pointed to by <tt>args[1]</tt>. The <tt>fileinfo_t</tt> of the file that corresponds to the I/O request is pointed to by <tt>args[2]</tt>. Note that file information availability depends on the filesystem making the I/O request. See <a href="p50.html#chp-io-fileinfo"><tt>fileinfo_t</tt></a> for more information.</p>
</td></tr>
<tr><td><p><tt>done</tt></p>
</td><td><p>Probe that fires after an I/O request has been fulfilled. The <tt>bufinfo_t</tt> corresponding to the I/O request is pointed to by <tt>args[0]</tt>. The <tt>done</tt> probe fires after the I/O completes, but before completion processing has been performed on the buffer. As a result <tt>B_DONE</tt> is <b>not</b> set in <tt>b_flags</tt> at the time the <tt>done</tt> probe fires. The <tt>devinfo_t</tt> of the device to which the I/O was issued is pointed to by <tt>args[1]</tt>. The <tt>fileinfo_t</tt> of the file that corresponds to the I/O request is pointed to by <tt>args[2]</tt>.</p>
</td></tr>
<tr><td><p><tt>wait-start</tt></p>
</td><td><p>Probe that fires immediately before a thread begins to wait pending completion of a given I/O request. The <tt>buf</tt>(9S) structure corresponding to the I/O request for which the thread will wait is pointed to by <tt>args[0]</tt>. The <tt>devinfo_t</tt> of the device to which the I/O was issued is pointed to by <tt>args[1]</tt>. The <tt>fileinfo_t</tt> of the file that corresponds to the I/O request is pointed to by <tt>args[2]</tt>. Some time after the <tt>wait-start</tt> probe fires, the <tt>wait-done</tt> probe will fire in the same thread.</p>
</td></tr>
<tr><td><p><tt>wait-done</tt></p>
</td><td><p>Probe that fires when a thread is done waiting for the completion of a given I/O request. The <tt>bufinfo_t</tt> corresponding to the I/O request for which the thread will wait is pointed to by <tt>args[0]</tt>. The <tt>devinfo_t</tt> of the device to which the I/O was issued is pointed to by <tt>args[1]</tt>. The <tt>fileinfo_t</tt> of the file that corresponds to the I/O request is pointed to by <tt>args[2]</tt>. The <tt>wait-done</tt> probe fires only after the <tt>wait-start</tt> probe has fired in the same thread.</p>
</td></tr>
</table><p>Note that the <tt>io</tt> probes fire for all I/O requests to peripheral devices, and for all file read and file write requests to an NFS server. Requests for metadata from an NFS server, for example, do <b>not</b> trigger <tt>io</tt> probes due to a <tt>readdir</tt>(3C) request.</p>
<a name="chp-io-args"></a><h3>Arguments</h3>
<p><a name="indexterm-403"></a>The argument types for the <tt>io</tt> probes are listed in <a href="p50.html#tbl-io-args">Table 27-2</a>. The arguments are described in <a href="p50.html#tbl-io">Table 27-1</a>.</p>
<a name="tbl-io-args"></a>Table 27-2 <tt>io</tt> Probe Arguments<table><tr><th valign="top"><p>Probe</p>
</th><th valign="top"><p><tt>args[0]</tt></p>
</th><th valign="top"><p><tt>args[1]</tt></p>
</th><th valign="top"><p><tt>args[2]</tt></p>
</th></tr>
<tr><td><p><tt>start</tt></p>
</td><td><p><tt>struct buf *</tt></p>
</td><td><p><tt>devinfo_t *</tt></p>
</td><td><p><tt>fileinfo_t *</tt></p>
</td></tr>
<tr><td><p><tt>done</tt></p>
</td><td><p><tt>struct buf *</tt></p>
</td><td><p><tt>devinfo_t *</tt></p>
</td><td><p><tt>fileinfo_t *</tt></p>
</td></tr>
<tr><td><p><tt>wait-start</tt></p>
</td><td><p><tt>struct buf *</tt></p>
</td><td><p><tt>devinfo_t *</tt></p>
</td><td><p><tt>fileinfo_t *</tt></p>
</td></tr>
<tr><td><p><tt>wait-done</tt></p>
</td><td><p><tt>struct buf *</tt></p>
</td><td><p><tt>devinfo_t *</tt></p>
</td><td><p><tt>fileinfo_t *</tt></p>
</td></tr>
</table><p>Each <tt>io</tt> probe has arguments consisting of a pointer to a <tt>buf</tt>(9S) structure, a pointer to a <tt>devinfo_t</tt>, and a pointer to a <tt>fileinfo_t</tt>. These structures are described in greater detail in this section.</p>
<a name="chp-io-buf"></a><h4><tt>bufinfo_t</tt> structure</h4>
<p><a name="indexterm-404"></a><a name="indexterm-405"></a>The <tt>bufinfo_t</tt> structure is the abstraction that describes an I/O request. The buffer corresponding to an I/O request is pointed to by <tt>args[0]</tt> in the <tt>start</tt>, <tt>done</tt>, <tt>wait-start</tt>, and <tt>wait-done</tt> probes. The <tt>bufinfo_t</tt> structure definition is as follows:</p>
<pre>typedef struct bufinfo {
	int b_flags;                    /* flags */
	size_t b_bcount;                /* number of bytes */
	caddr_t b_addr;                 /* buffer address */
	uint64_t b_blkno;               /* expanded block # on device */
	uint64_t b_lblkno;              /* block # on device */
	size_t b_resid;                 /* # of bytes not transferred */
	size_t b_bufsize;               /* size of allocated buffer */ 
	caddr_t b_iodone;               /* I/O completion routine */
	dev_t b_edev;                   /* extended device */
 } bufinfo_t;</pre><p><a name="indexterm-406"></a>The <tt>b_flags</tt> member indicates the state of the I/O buffer, and consists of a bitwise-or of different state values. The valid state values are in <a href="p50.html#tbl-io-flags">Table 27-3</a>.</p>
<a name="tbl-io-flags"></a>Table 27-3 <tt>b_flags</tt> Values<table><tr><td><p><tt>B_DONE</tt></p>
</td><td><p>Indicates that the data transfer has completed.</p>
</td></tr>
<tr><td><p><tt>B_ERROR</tt></p>
</td><td><p>Indicates an I/O transfer error. It is set in conjunction with the <tt>b_error</tt> field.</p>
</td></tr>
<tr><td><p><tt>B_PAGEIO</tt></p>
</td><td><p>Indicates that the buffer is being used in a paged I/O request. See the description of the <tt>b_addr</tt> field for more information.</p>
</td></tr>
<tr><td><p><tt>B_PHYS</tt></p>
</td><td><p>Indicates that the buffer is being used for
physical  (direct) I/O to a user data area.</p>
</td></tr>
<tr><td><p><tt>B_READ</tt></p>
</td><td><p>Indicates that data is to be read from the peripheral device into main memory.</p>
</td></tr>
<tr><td><p><tt>B_WRITE</tt></p>
</td><td><p>Indicates that the data is to be transferred from main memory to the peripheral device.</p>
</td></tr>
<tr><td><p><tt>B_ASYNC</tt></p>
</td><td><p>The I/O request is asynchronous, and will not be waited upon. The <tt>wait-start</tt> and <tt>wait-done</tt> probes don't fire for asynchronous I/O requests. Note that some I/Os directed to be asynchronous might not have <tt>B_ASYNC</tt> set: the asynchronous I/O subsystem might implement the asynchronous request by having a separate worker thread perform a synchronous I/O operation.</p>
</td></tr>
</table><p>The <tt>b_bcount</tt> field is the number of bytes to be transferred as part of the I/O request.</p>
<p>The <tt>b_addr</tt> field is the virtual address of the I/O request, unless <tt>B_PAGEIO</tt> is set. The address is a kernel virtual address unless <tt>B_PHYS</tt> is set, in which case it is a user virtual address. If <tt>B_PAGEIO</tt> is set, the <tt>b_addr</tt> field contains kernel private data. Exactly one of <tt>B_PHYS</tt> and <tt>B_PAGEIO</tt> can be set, or neither flag will be set.</p>
<p>The <tt>b_lblkno</tt> field identifies which logical block on the device is to be accessed. The mapping from a logical block to a physical block (such as the cylinder, track, and so on) is defined by the device.</p>
<p>The <tt>b_resid</tt> field is set to the number of bytes not transferred because of an error.</p>
<p>The <tt>b_bufsize</tt> field contains the size of the allocated buffer.</p>
<p>The <tt>b_iodone</tt> field identifies a specific routine in the kernel that is called when the I/O is complete.</p>
<p>The <tt>b_error</tt> field may hold an error code returned from the driver in the event of an I/O error. <tt>b_error</tt> is set in conjunction with the <tt>B_ERROR</tt> bit set in the <tt>b_flags</tt> member.</p>
<p>The <tt>b_edev</tt> field contains the major and minor device numbers of the device accessed. Consumers may use the D subroutines <tt>getmajor()</tt> and <tt>getminor()</tt> to extract the major and minor device numbers from the <tt>b_edev</tt> field.</p>
<a name="chp-io-devinfo"></a><h4><tt>devinfo_t</tt></h4>
<p><a name="indexterm-407"></a><a name="indexterm-408"></a>The <tt>devinfo_t</tt> structure provides information about a device. The <tt>devinfo_t</tt> structure corresponding to the destination device of an I/O is pointed to by <tt>args[1]</tt> in the <tt>start</tt>, <tt>done</tt>, <tt>wait-start</tt>, and <tt>wait-done</tt> probes. The members of <tt>devinfo_t</tt> are as follows:</p>
<pre>typedef struct devinfo {
	int dev_major;                  /* major number */
	int dev_minor;                  /* minor number */
	int dev_instance;               /* instance number */
	string dev_name;                /* name of device */
	string dev_statname;            /* name of device + instance/minor */
	string dev_pathname;            /* pathname of device */
} devinfo_t;</pre><p>The <tt>dev_major</tt> field is the major number of the device. See <tt>getmajor</tt>(9F) for more information.</p>
<p>The <tt>dev_minor</tt> field is the minor number of the device. See <tt>getminor</tt>(9F) for more information.</p>
<p>The <tt>dev_instance</tt> field is the instance number of the device. The instance of a device is different from the minor number. The minor number is an abstraction managed by the device driver. The instance number is a property of the device node. You can display device node instance numbers with <tt>prtconf</tt>(1M).</p>
<p>The <tt>dev_name</tt> field is the name of the device driver that manages the device. You can display device driver names with the <tt>-D</tt> option to <tt>prtconf</tt>(1M).</p>
<p>The <tt>dev_statname</tt> field is the name of the device as reported by <tt>iostat</tt>(1M). This name also corresponds to the name of a kernel statistic as reported by <tt>kstat</tt>(1M). This field is provided so that aberrant <tt>iostat</tt> or <tt>kstat</tt> output can be quickly correlated to actual I/O activity.</p>
<p>The <tt>dev_pathname</tt> field is the full path of the device. This path may be specified as an argument to <tt>prtconf</tt>(1M) to obtain detailed device information. The path specified by <tt>dev_pathname</tt> includes components expressing the device node, the instance number, and the minor node. However, all three of these elements aren't necessarily expressed in the statistics name. For some devices, the statistics name consists of the device name and the instance number. For other devices, the name consists of the device name and the number of the minor node. As a result, two devices that have the same <tt>dev_statname</tt> may differ in <tt>dev_pathname</tt>.</p>
<a name="chp-io-fileinfo"></a><h4><tt>fileinfo_t</tt></h4>
<p><a name="indexterm-409"></a><a name="indexterm-410"></a>The <tt>fileinfo_t</tt> structure provides information about a file. The file to which an I/O corresponds is pointed to by <tt>args[2]</tt> in the <tt>start</tt>, <tt>done</tt>, <tt>wait-start</tt>, and <tt>wait-done</tt> probes. The presence of file information is contingent upon the filesystem providing this information when dispatching I/O requests. Some filesystems, especially third-party filesystems, might not provide this information. Also, I/O requests might emanate from a filesystem for which no file information exists. For example, any I/O to filesystem metadata will not be associated with any one file. Finally, some highly optimized filesystems might aggregate I/O from disjoint files into a single I/O request. In this case, the filesystem might provide the file information either for the file that represents the majority of the I/O or for the file that represents <b>some</b> of the I/O. Alternately, the filesystem might provide no file information at all in this case.</p>
<p>The definition of the <tt>fileinfo_t</tt> structure is as follows:</p>
<pre>typedef struct fileinfo {
	string fi_name;                 /* name (basename of fi_pathname) */
	string fi_dirname;              /* directory (dirname of fi_pathname) */
	string fi_pathname;             /* full pathname */
	offset_t fi_offset;             /* offset within file */
	string fi_fs;                   /* filesystem */
	string fi_mount;                /* mount point of file system */
} fileinfo_t;</pre><p>The <tt>fi_name</tt> field contains the name of the file but does not include any directory components. If no file information is associated with an I/O, the <tt>fi_name</tt> field will be set to the string <tt>&lt;none></tt>. In some rare cases, the pathname associated with a file might be unknown. In this case, the <tt>fi_name</tt> field will be set to the string <tt>&lt;unknown></tt>.</p>
<p>The <tt>fi_dirname</tt> field contains <b>only</b> the directory component of the file name. As with <tt>fi_name</tt>, this string may be set to <tt>&lt;none></tt> if no file information is present, or <tt>&lt;unknown></tt> if the pathname associated with the file is not known.</p>
<p>The <tt>fi_pathname</tt> field contains the full pathname to the file. As with <tt>fi_name</tt>, this string may be set to <tt>&lt;none></tt> if no file information is present, or <tt>&lt;unknown></tt> if the pathname associated with the file is not known.</p>
<p>The <tt>fi_offset</tt> field contains the offset within the file , or -1 if either file information is not present or if the offset is otherwise unspecified by the filesystem.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p49.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p51.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

