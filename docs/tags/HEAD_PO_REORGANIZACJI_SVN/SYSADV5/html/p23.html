<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Modifying Configuration Files - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-09-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)<?GenHTML /ReferencePage> > <a href="p21.html">6.&nbsp;&nbsp;Administering NIS (Tasks)</a> > <a href="p22.html#anis2-11278">Working With NIS Maps</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p22.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p24.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="anis2-40083"></a><h4>Modifying Configuration Files</h4>
<a name="indexterm-347"></a><a name="indexterm-348"></a><p>NIS intelligently parses the setup files. Although this makes NIS administration
easier, it does make the behavior of NIS more sensitive to changes in the
setup and configuration files.</p>
<p>Use the procedures in this section when modifying any of the following.</p>
<ul><li><p><a name="indexterm-349"></a><a name="indexterm-350"></a><tt>/var/yp/Makefile</tt> to add or delete supported
maps</p>
</li>
<li><p>Adding or deleting <tt>/etc/resolv.conf</tt> to
allow or deny DNS forwarding</p>
</li>
<li><p><a name="indexterm-351"></a><a name="indexterm-352"></a>Adding or deleting <tt>$PWDIR/security/passwd.adjunct</tt> to
allow or deny C2 security (<tt>$PWDIR</tt> is defined in <tt>/var/yp/Makefile</tt>)</p>
</li>
</ul>
<a name="anis2-proc-18"></a><h4><img src="graphics/procedure.gif"> How to Modify Configuration Files</h4>
<p>You do not have to stop and start NIS when changing NIS maps or the
map source files.</p>
<p>Keep the following in mind.</p>
<ul><li><p>Deleting a map or source file from an NIS master server does
not automatically result in corresponding deletions from slave servers. You
must delete maps and source files from slave servers by hand.</p>
</li>
<li><p>New maps do not automatically get pushed to existing slave
servers. You must run <tt>ypxfr</tt> from the slaves.</p>
</li>
</ul>
<ol><li><a name="anis2-step-1002"></a><b>Become superuser or assume an equivalent
role.</b><p>Roles contain authorizations and privileged commands. For
more information about roles, see Chapter 8, Using Role-Based Access Control (Tasks), in <i>System Administration Guide: Security Services</i>.</p></li><li><a name="anis2-step-19"></a><b>Stop the NIS server.</b><pre># <tt><b>svcadm disable network/nis/server</b></tt></pre></li><li><a name="anis2-step-20"></a><b>Make the necessary changes to your files.</b></li><li><a name="anis2-step-21"></a><b>Start the NIS server.</b><pre># <tt><b>svcadm enable network/nis/server</b></tt></pre></li></ol><a name="anis2-20638"></a><h4>Modifying and Using the <tt>Makefile</tt></h4>
<a name="indexterm-353"></a><p>You can modify the <tt>Makefile</tt> provided by default
in <tt>/var/yp</tt> to suit your needs. You can add or delete
maps, and you can change the names of some of the directories.</p>
<hr>
<p><b>Tip - </b>Keep an unmodified copy of the original <tt>Makefile</tt> for
future reference.</p>
<hr>
<a name="anis2-1013"></a><h5>Working With the <tt>Makefile</tt></h5>
<p>To add a new NIS map, you must get copies of the <tt>ndbm</tt> files
for the map into the <tt>/var/yp/</tt><i>domainname</i> directory
on each of the NIS servers in the domain. This is normally done for you by
the <tt>Makefile</tt>. After deciding which NIS server is the master
of the map, modify the <tt>Makefile</tt> on the master server
so that you can conveniently rebuild the map. Different servers can be masters
of different maps, but in most cases this leads to administrative confusion.
Try to set only one server as the master of all maps.</p>
<p><a name="indexterm-354"></a><a name="indexterm-355"></a>Typically a human-readable text file is filtered through <tt>awk</tt>, <tt>sed</tt>, or <tt>grep</tt> to make it
suitable for input to <tt>makedbm</tt>. Refer to the default <tt>Makefile</tt> for examples. See the <tt>make</tt>(1S) for general information about the <tt>make</tt> command.</p>
<p><a name="indexterm-356"></a>Use the mechanisms already in place in the <tt>Makefile</tt> when
deciding how to create dependencies that <tt>make</tt> will recognize.
Be aware that <tt>make</tt> is very sensitive to the presence or
absence of tabs at the beginning of lines within the dependency rules. A missing
tab can invalidate an entry that is otherwise well formed.</p>
<p>Adding an entry to the <tt>Makefile</tt> involves the following.</p>
<ul><li><p>Adding the name of the database to the <tt>all</tt> rule</p>
</li>
<li><p>Writing the <tt>time</tt> rule</p>
</li>
<li><p>Adding the rule for the database</p>
</li>
</ul>
<p><a name="indexterm-357"></a><a name="indexterm-358"></a><a name="indexterm-359"></a>For example, in order for the <tt>Makefile</tt> to
work on automounter input files, you would have to add the <tt>auto_direct.time</tt> and <tt>auto_home.time</tt> maps to the NIS database.</p>
<p>To add these maps to the NIS database you need to modify the <tt>Makefile</tt>.</p>
<a name="anis2-33"></a><h5>Changing <tt>Makefile</tt> Macros/Variables</h5>
<a name="indexterm-360"></a><a name="indexterm-361"></a><p>You can change the settings of the variables defined at the top of the <tt>Makefile</tt> by changing the value to the right of the equal sign (=).
For instance, if you do not want to use the files located in <tt>/etc</tt> as
input for the maps, but you would rather use files located in another directory,
such as <tt>/var/etc/domainname</tt>, you should change <tt>DIR</tt> from <tt>DIR=/etc</tt> to <tt>DIR=/var/etc/</tt><i>domainname</i>.
You should also change <tt>PWDIR</tt> from <tt>PWDIR=/etc</tt> to <tt>PWDIR=/var/etc/</tt><i>domainname</i>.</p>
<p>The variables are the following.</p>
<ul><li><p><a name="indexterm-362"></a><i>DIR</i>= The directory containing all of
the NIS input files except <tt>passwd</tt> and <tt>shadow</tt>.
The default value is <tt>/etc</tt>. Since it is not good practice
to use the files in the master server's <tt>/etc</tt> directory
as NIS input files, you should change this value.</p>
</li>
<li><p><a name="indexterm-363"></a><i>PWDIR</i>= The directory containing the <tt>passwd</tt> and <tt>shadow</tt> NIS input files. Since it
is not good practice to use the files in the master server's <tt>/etc</tt> directory
as NIS input files, you should change this value.</p>
</li>
<li><p><a name="indexterm-364"></a><i>DOM</i>= The NIS domain name. The default
value of <tt>DOM</tt> is set using the <tt>domainname</tt> command.
However, most NIS commands use the current machine's domain which is set in
the machine's <tt>/etc/defaultdomain</tt> file.</p>
</li>
</ul>
<a name="anis2-1014"></a><h4>Modifying <tt>Makefile</tt> Entries</h4>
<p>The following procedure describes how to add and delete databases from
the <tt>Makefile</tt>.</p>
<a name="anis2-proc-22"></a><h4><img src="graphics/procedure.gif"> How to Modify the <tt>Makefile</tt> to
Use Specific Databases</h4>
<ol><li><a name="anis2-step-9"></a><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information
about roles, see Chapter 8, Using Role-Based Access Control (Tasks), in <i>System Administration Guide: Security Services</i>.</p></li><li><a name="anis2-step-23"></a><b>Modify the line that starts with the word <tt>all</tt> by adding the name(s) of the database you want to add:</b><pre>all: passwd group hosts ethers networks rpc services protocols \
	netgroup bootparams aliases netid netmasks \
	auto_direct auto_home auto_direct.time auto_home.time</pre><p>The order of the entries is not relevant, but the blank space at the
beginning of the continuation lines must be a Tab, not spaces.</p></li><li><a name="anis2-step-24"></a><b>Add the following lines at the end of the <tt>Makefile</tt>:</b><pre>auto_direct: auto_direct.time
auto_home: auto_home.time</pre></li><li><a name="anis2-step-25"></a><b>Add an entry for <tt>auto_direct.time</tt> in
the middle of the file.</b><pre>auto_direct.time: $(DIR)/auto_direct
 @(while read L; do echo $$L; done &lt; $(DIR)/auto_direct
 $(CHKPIPE)) | \ (sed -e "/^#/d" -e "s/#.*$$//" -e "/^ *$$/d"
 $(CHKPIPE)) | \ $(MAKEDBM) - $(YPDBDIR)/$(DOM)/auto_direct;
 @touch auto_direct.time;
 @echo "updated auto_direct";
 @if [ ! $(NOPUSH) ]; then $(YPPUSH) auto_direct; fi
 @if [ ! $(NOPUSH) ]; then echo "pushed auto_direct"; fi</pre><p>where</p><ul><li><p><a name="indexterm-365"></a><a name="indexterm-366"></a><tt>CHKPIPE</tt> makes certain that the operations to
the left of the pipe (<tt>|</tt>) are successfully completed before
piping the results to next commands. If the operations to the left of the
pipe do not successfully complete, the process is terminated with a <tt>NIS
make terminated</tt>  message.</p>
</li>
<li><p><a name="indexterm-367"></a><a name="indexterm-368"></a><a name="indexterm-369"></a><a name="indexterm-370"></a> <tt>NOPUSH</tt> prevents the <tt>makefile</tt> from
calling <tt>yppush</tt> to transfer the new map to the slave servers.
If <tt>NOPUSH</tt> is not set, the push is done automatically.</p>
</li>
</ul>
<p><a name="indexterm-371"></a>The <tt>while</tt> loop at the beginning is designed
to eliminate any backslash-extended lines in the input file. The <tt>sed</tt> script
eliminates comment and empty lines.</p><p>The same procedure should
be followed for all other automounter maps, such as <tt>auto_home</tt>,
or any other nondefault maps.</p></li><li><a name="anis2-step-26"></a><b>Run <tt>make</tt>.</b><pre># <tt><b>make </tt><i>mapname</i><tt></b></tt></pre><p>Where <b>mapname</b> is the name of the map you want to
make.</p></li></ol>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p22.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p24.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2006 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

