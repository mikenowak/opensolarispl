<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Running DTrace in a Non-Global Zone - System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-05-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Solaris Containers-Resource Management and Solaris Zones<?GenHTML /ReferencePage> > <a href="p95.html">26.&nbsp;&nbsp;Solaris Zones Administration (Overview)</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p101.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p103.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="gcogk"></a><h3>Running DTrace in a Non-Global Zone</h3>
<p><a name="indexterm-321"></a><a name="indexterm-322"></a><a name="indexterm-323"></a><a name="indexterm-324"></a>DTrace programs
that only require the <tt>dtrace_proc</tt> and <tt>dtrace_user</tt> privileges
can be run in a non-global zone. To add these privileges to the set of privileges
available in the non-global zone, use the <tt>zonecfg</tt> <tt>limitpriv</tt> property. For instructions, see <a href="p105.html#gelxd">How to Use DTrace</a>.</p>
<p>The providers supported through <tt>dtrace_proc</tt> are <tt>fasttrap</tt> and <tt>pid</tt>. The providers supported through <tt>dtrace_user</tt> are <tt>profile</tt> and <tt>syscall</tt>.
DTrace providers and actions are limited in scope to the zone.</p>
<p>Also see <a href="p100.html#z.admin.ov-18">Privileges in a Non-Global Zone</a> for more information.</p>
<a name="gbrho"></a><h3>About Backing Up a Solaris System With Zones Installed</h3>
<p>You can perform backups in individual non-global zones, or back up the
entire system from the global zone.</p>
<a name="gbrgy"></a><h4>Backing Up Loopback File System Directories</h4>
<p>Because many non-global zones share files with the global zone through
the use of loopback file system read-only mounts (usually <tt>/usr</tt>, <tt>/lib</tt>, <tt>/sbin</tt>, and <tt>/platform</tt>),
you must use a global zone backup method to back up <tt>lofs</tt> directories.</p>
<hr>
<p><b>Caution - </b>Do not back up the <tt>lofs</tt> file systems in
non-global zones. An attempt by the non-global administrator to restore <tt>lofs</tt> file systems from a non-global zone could cause a serious problem.</p>
<hr>
<a name="gbrhl"></a><h4>Backing Up Your System From the Global Zone</h4>
<p>You might choose to perform your backups from the global zone in the
following cases:</p>
<ul><li><p>You want to back up the configurations of your non-global
zones as well as the application data.</p>
</li>
<li><p>Your primary concern is the ability to recover from a disaster.
If you need to restore everything or almost everything on your system, including
the root file systems of your zones and their configuration data as well as
the data in your global zone, backups should take place in the global zone.</p>
</li>
<li><p>You want to use the <tt>ufsdump</tt> command to
perform a data backup. Because importing a physical disk device into a non-global
zone would change the security profile of the zone, <tt>ufsdump</tt> should
only be used from the global zone.</p>
</li>
<li><p>You have commercial network backup software.</p>
<hr>
<p><b>Note - </b>Your network backup software should be configured to skip all
inherited <tt>lofs</tt> file systems if possible. The backup should
be performed when the zone and its applications have quiesced the data to
be backed up.</p>
<hr>
</li>
</ul>
<a name="gbrhn"></a><h4>Backing Up Individual Non-Global Zones on Your System</h4>
<p>You might decide to perform backups within the non-global zones in the
following cases.</p>
<ul><li><p>The non-global zone administrator needs the ability to recover
from less serious failures or to restore application or user data specific
to a zone.</p>
</li>
<li><p>You want to use programs that back up on a file-by-file basis,
such as <tt>tar</tt> or <tt>cpio</tt>. See the <tt>tar</tt>(1) and <tt>cpio</tt>(1) man pages.</p>
</li>
<li><p>You use the backup software of a particular application or
service running in a zone. It might be difficult to execute the backup software
from the global zone because application environments, such as directory path
and installed software, would be different between the global zone and the
non-global zone.</p>
<p>If the application can perform a snapshot on
its own backup schedule in each non-global zone and store those backups in
a writable directory exported from the global zone, the global zone administrator
can pick up those individual backups as part of the backup strategy from the
global zone.</p>
</li>
</ul>
<a name="gbrhi"></a><h3>Determining What to Back Up in Non-Global Zones</h3>
<p>You can back up everything in the non-global zone, or, because a zone's
configuration changes less frequently, you can perform backups of the application
data only.</p>
<a name="gbrid"></a><h4>Backing Up Application Data Only</h4>
<p>If application data is kept in a particular part of the file system,
you might decide to perform regular backups of this data only. The zone's
root file system might not have to be backed up as often because it changes
less frequently.</p>
<p>You will have to determine where the application places its files. Locations
where files can be stored include the following:</p>
<ul><li><p>Users' home directories</p>
</li>
<li><p><tt>/etc</tt> for configuration data files</p>
</li>
<li><p><tt>/var</tt></p>
</li>
</ul>
<p>Assuming the application administrator knows where the data is stored,
it might be possible to create a system in which a per-zone writable directory
is made available to each zone. Each zone can then store its own backups,
and the global administrator can make this location one of the places on the
system to back up.</p>
<a name="gbrhh"></a><h4>General Database Backup Operations</h4>
<p>If the database application data is not under its own directory, the
following rules apply:</p>
<ul><li><p>Ensure that the databases are in a consistent state first.</p>
<p>Databases must be quiesced because they have internal buffers to flush
to disk. Make sure that the databases in non-global zones have come down before
starting the backup from the global zone.</p>
</li>
<li><p>Within each zone, use file system features to make a snapshot
of the data, then back up the snapshots directly from the global zone.</p>
<p>This process will minimize elapsed time for the backup window and remove
the need for backup clients/modules in all of the zones.</p>
</li>
</ul>
<a name="gbrja"></a><h4>Tape Backups</h4>
<p>Each non-global zone can take a snapshot of its private file systems
when it is convenient for that zone and the application has been briefly quiesced.
Later, the global zone can back up each of the snapshots and put them on tape
after the application is back in service.</p>
<p>This method has the following advantages:</p>
<ul><li><p>Fewer tape devices are needed.</p>
</li>
<li><p>There is no need for coordination between the non-global zones.</p>
</li>
<li><p>There is no need to assign devices directly to zones, which
improves security.</p>
</li>
<li><p>Generally, this method keeps system management in the global
zone, which is preferred.</p>
</li>
</ul>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p101.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p103.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

