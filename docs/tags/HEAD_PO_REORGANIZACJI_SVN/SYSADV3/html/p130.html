<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p128.html#eupsq">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p129.html#ezecx">Working With Solaris IP Filter Rule Sets</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p129.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p131.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="euqfc"></A><h3>Using Solaris IP Filter's NAT Feature</h3>
<A NAME="indexterm-2315"></A><A NAME="indexterm-2316"></A><A NAME="indexterm-2317"></A><A NAME="indexterm-2318"></A><A NAME="indexterm-2319"></A><A NAME="indexterm-2320"></A><A NAME="indexterm-2321"></A><A NAME="indexterm-2322"></A><p>NAT sets up mapping rules that translate source and destination IP addresses
into other Internet or intranet addresses. These rules modify the source and
destination addresses of incoming or outgoing IP packets and send the packets
on. You can also use NAT to redirect traffic from one port to another port.
NAT maintains the integrity of the packet during any modification or redirection
done on the packet.</p>
<p>Use the <tt>ipnat</tt> command to work with NAT rule lists.
For more information on the <tt>ipnat</tt> command, see the <tt>ipnat</tt>(1M) command.</p>
<p>You can create NAT rules either at the command line, using the <tt>ipnat</tt> command, or in a NAT configuration file. NAT configuration rules
reside in the <tt>ipnat.conf</tt> file. If you want the NAT rules
to be loaded at boot time, create a file called <tt>/etc/ipf/ipnat.conf</tt> in
which to put NAT rules. If you do not want the NAT rules loaded at boot time,
put the <tt>ipnat.conf</tt> file in a location of your choice,
and manually activate packet filtering with the <tt>ipnat</tt> command.</p>
<A NAME="euxbd"></A><h4>Configuring NAT Rules</h4>
<p>Use the following syntax to create NAT rules:</p>
<p><i>command</i> <i>interface-name</i> <i>parameters</i></p>
<ol Type="1"><li><p>Each rule begins with one of the following commands:</p>
<table border="0" cellspacing="5"><tr><td valign="top"><p><tt>map</tt></p></td><td valign="top"><p>Maps one IP address or network to another IP address or network
in an unregulated round-robin process.</p>
</td></tr><tr><td valign="top"><p><tt>rdr</tt></p></td><td valign="top"><p>Redirects packets from one IP address and port pair to another
IP address and port pair.</p>
</td></tr><tr><td valign="top"><p><tt>bimap</tt></p></td><td valign="top"><p>Establishes a bidirectional NAT between an external IP address
and an internal IP address.</p>
</td></tr><tr><td valign="top"><p><tt>map-block</tt></p></td><td valign="top"><p>Establishes static IP address-based translation. This command
is based on an algorithm that forces addresses to be translated into a destination
range.</p>
</td></tr></table>
</li>
<li><p>Following the command, the next word is the interface name,
such as <tt>hme0</tt>.</p>
</li>
<li><p>Next, you can choose from a variety of parameters, which determine
the NAT configuration. Some of the parameters include:</p>
<table border="0" cellspacing="5"><tr><td valign="top"><p><tt>ipmask</tt></p></td><td valign="top"><p>Designates the network mask.</p>
</td></tr><tr><td valign="top"><p><tt>dstipmask</tt></p></td><td valign="top"><p>Designates the address that <tt>ipmask</tt> is translated
to.</p>
</td></tr><tr><td valign="top"><p><tt>mapport</tt></p></td><td valign="top"><p>Designates <tt>tcp</tt>, <tt>udp</tt>,
or <tt>tcp/udp</tt> protocols, along with a range of port numbers.</p>
</td></tr></table>
</li>
</ol>
<p>The following example illustrates how to put together the NAT rule syntax
together to create a NAT rule. To rewrite a packet that goes out on the <tt>de0</tt> device with a source address of <tt>192.168.1.0/24</tt> and
to externally show its source address as <tt>10.1.0.0/16</tt>, you
would include the following rule in the NAT rule set:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>map de0 192.168.1.0/24 -> 10.1.0.0/16</pre>
</td></table><br><p>For the complete grammar and syntax used to write NAT rules, see the <tt>ipnat</tt>(4) man
page.</p>
<A NAME="euqfe"></A><h3>Using Solaris IP Filter's Address Pools Feature</h3>
<A NAME="indexterm-2323"></A><A NAME="indexterm-2324"></A><A NAME="indexterm-2325"></A><A NAME="indexterm-2326"></A><A NAME="indexterm-2327"></A><A NAME="indexterm-2328"></A><p>Address pools establish a single reference that is used to name a group
of address/netmask pairs. Address pools provide processes to reduce the time
needed to match IP addresses with rules.  Address pools also make managing
large groups of addresses easier.</p>
<p>Address pool configuration rules reside in the <tt>ippool.conf</tt> file.
If you want the address pool rules to be loaded at boot time, create a file
called <tt>/etc/ipf/ippool.conf</tt> in which to put address pool
rules. If you do not want the address pool rules loaded at boot time, put
the <tt>ippool.conf</tt> file in a location of your choice, and
manually activate packet filtering with the <tt>ippool</tt> command.</p>
<A NAME="euxby"></A><h4>Configuring Address Pools</h4>
<p>Use the following syntax to create an address pool:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>table role = <i>role-name</i> type = <i>storage-format</i> number = <i>reference-number</i></pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p><tt>table</tt></p></td><td valign="top"><p>Defines the reference for the multiple addresses.</p>
</td></tr><tr><td valign="top"><p><tt>role</tt></p></td><td valign="top"><p>Specifies the role of the pool in Solaris IP Filter. At this
time, the only role you can reference is <tt>ipf</tt>.</p>
</td></tr><tr><td valign="top"><p><tt>type</tt></p></td><td valign="top"><p>Specifies the storage format for the pool.</p>
</td></tr><tr><td valign="top"><p><tt>number</tt></p></td><td valign="top"><p>Specifies the reference number that is used by the filtering
rule.</p>
</td></tr></table>
<p>For example, to reference the group of addresses <tt>10.1.1.1 and
10.1.1.2</tt>, and the network <tt>192.16.1.0</tt> as pool
number <tt>13</tt>, you would include the following rule in the
address pool configuration file:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>table role = ipf type = tree number = 13 
{ 10.1.1.1/32, 10.1.1.2/32, 192.168.1.0/24 };</pre>
</td></table><br><p>Then, to reference pool number <tt>13</tt> in a filtering
rule, you would construct the rule similar to the following example:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>pass in from pool/13 to any</pre>
</td></table><br><p>Note that you must load the pool file before loading the rules file
that contains a reference to the pool. If you do not, the pool is undefined,
as shown in the following output:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ipfstat -io
empty list for ipfilter(out)
block in from pool/13(!) to any</pre>
</td></table><br><p>Even if you add the pool later, the addition of the pool does not update
the kernel rule set. You also need to reload the rules file that references
the pool.</p>
<p>For the complete grammar and syntax used to write packet filtering rules,
see the <tt>ippool</tt>(4) man
page.</p>
<A NAME="gdwan"></A><h2>Packet Filter Hooks</h2>
<A NAME="indexterm-2329"></A><A NAME="indexterm-2330"></A><p>Beginning with the Solaris Express, Developer Edition 2/07 release,
packet filter hooks replace the <tt>pfil</tt> module to enable Solaris
IP filter. In previous Solaris releases, configuration of the <tt>pfil</tt> module
was required as an additional step to set up Solaris IP Filter. This extra
configuration requirement increased the risk of errors that would cause Solaris
IP Filter to work improperly. The insertion of the <tt>pfil</tt> STREAMS
module between IP and the device driver also caused performance degradation.
Lastly, the <tt>pfil</tt> module could not perform packet interception
between zones.</p>
<p>The use of packet filter hooks streamlines the procedure to enable Solaris
IP Filter. Through these hooks, Solaris IP Filter uses pre-routing (input)
and post-routing (output) filter taps to control packet flow into and out
of the Solaris system.</p>
<p>Packet filter hooks eliminate the need for the <tt>pfil</tt> module.
Thus the following components that are associated with the module are also
removed.</p>
<ul><li><p><tt>pfil</tt> driver</p>
</li>
<li><p><tt>pfil</tt> daemon</p>
</li>
<li><p><tt>svc:/network/pfil</tt> SMF service</p>
</li>
</ul>
<p>For tasks associated with enabling Solaris IP Filter, see <A HREF="p132.html#ipfilter-admin-1">Chapter&nbsp;26, Solaris IP Filter (Tasks)</A>.</p>
<A NAME="fxxrb"></A><h2>IPv6 for Solaris IP Filter</h2>
<A NAME="indexterm-2331"></A><A NAME="indexterm-2332"></A><A NAME="indexterm-2333"></A><A NAME="indexterm-2334"></A><A NAME="indexterm-2335"></A><A NAME="indexterm-2336"></A><A NAME="indexterm-2337"></A><A NAME="indexterm-2338"></A><A NAME="indexterm-2339"></A><A NAME="indexterm-2340"></A><A NAME="indexterm-2341"></A><A NAME="indexterm-2342"></A><p>Beginning with the Solaris 10 6/06 release, support for IPv6 is available
with Solaris IP Filter. IPv6 packet filtering can filter based on the source/destination
IPv6 address, pools containing IPv6 addresses, and IPv6 extension headers.</p>
<p>IPv6 is similar to IPv4 in many ways. However, header and packet size
differ between the two versions of IP, which is an important consideration
for IP Filter. IPv6 packets known as <b>jumbograms</b> contain
a datagram longer than 65,535 bytes. Solaris IP Filter does not support IPv6
jumbograms. To learn more about other IPv6 features, see <A HREF="p10.html#ipv6-overview-8">Major Features of IPv6</A>.</p>
<p><hr size="1" noshade><p><b>Note - </b>For more information on jumbograms, refer to the document IPv6
Jumbograms, RFC 2675 from the Internet Engineering Task Force (IETF). [<A  HREF="http://www.ietf.org/rfc/rfc2675.txt">http://www.ietf.org/rfc/rfc2675.txt</A>]</p>
<hr size="1" noshade></p><p>IP Filter tasks associated with IPv6 do not differ substantially from
IPv4. The most notable difference is the use of the <tt>-6</tt> option
with certain commands. Both the <tt>ipf</tt> command and the <tt>ipfstat</tt> command include the <tt>-6</tt> option for use with IPv6
packet filtering. Use the <tt>-6</tt> option with the <tt>ipf</tt> command
to load and flush IPv6 packet filtering rules. To display IPv6 statistics,
use the <tt>-6</tt> option with the <tt>ipfstat</tt> command.
The <tt>ipmon</tt> and <tt>ippool</tt> commands also support
IPv6, although there is no associated option for IPv6 support. The <tt>ipmon</tt> command has been enhanced to accommodate the logging of IPv6 packets.
The <tt>ippool</tt> command supports the pools with IPv6 addresses.
You can create pools of only IPv4 or IPv6 addresses, or a pool containing
both IPv4 and IPv6 addresses within the same pool.</p>
<p>You can use the <tt>ipf6.conf</tt> file to create packet
filtering rule sets for IPv6. By default, the <tt>ipf6.conf</tt> configuration
file is included in the <tt>/etc/ipf</tt> directory. As with the
other filtering configuration files, the <tt>ipf6.conf</tt> file
loads automatically during the boot process when it is stored in the <tt>/etc/ipf</tt> directory. You can also create and store an IPv6 configuration
file in another location and load the file manually.</p>
<p><hr size="1" noshade><p><b>Note - </b>Network Address Translation (NAT) does not support IPv6.</p>
<hr size="1" noshade></p><p>Once packet filtering rules for IPv6 have been set up, activate IPv6
packet filtering capabilities by plumbing the <tt>inet6</tt> version
of the interface.</p>
<p>For more information on IPv6, see <A HREF="p10.html#ipv6-overview-7">Chapter&nbsp;3, Planning an IPv6 Addressing Scheme (Overview)</A>. For tasks associated
with Solaris IP Filter, see <A HREF="p132.html#ipfilter-admin-1">Chapter&nbsp;26, Solaris IP Filter (Tasks)</A>.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p129.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p131.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

