<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p132.html#ipfilter-admin-1">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p138.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p140.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipfilter-admin-2"></A><h2>Creating and Editing Solaris IP Filter
Configuration Files</h2>
<p>You must directly edit the configuration files to create and modify
rule sets and address pools. Configuration files follow standard UNIX syntax
rules:</p>
<ul><li><p>The pound sign (<tt>#</tt>) indicates a line containing
comments.</p>
</li>
<li><p>Rules and comments can coexist on the same line.</p>
</li>
<li><p>Extraneous white space is allowed to keep rules easy to read.</p>
</li>
<li><p>Rules can be more than one line long. Use the backslash (\)
at the end of a line to indicate that the rule continues on the next line.</p>
</li>
</ul>
<A NAME="fahpp"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Create a Configuration File for Solaris IP
Filter</h3>
<A NAME="indexterm-2449"></A><A NAME="indexterm-2450"></A><A NAME="indexterm-2451"></A><A NAME="indexterm-2452"></A><A NAME="indexterm-2453"></A><A NAME="indexterm-2454"></A><A NAME="indexterm-2455"></A><A NAME="indexterm-2456"></A><A NAME="indexterm-2457"></A><A NAME="indexterm-2458"></A><A NAME="indexterm-2459"></A><p>The following procedure describes how to set up the following:</p>
<ul><li><p>Packet filtering configuration files</p>
</li>
<li><p>NAT rules configuration files</p>
</li>
<li><p>Address pool configuration files</p>
</li>
</ul>
<ol><li><p><b>Assume a role that includes the IP Filter Management rights profile,
or become superuser.</b></p><p>You can assign the IP Filter Management rights
profile to a role that you create. To create the role and assign the role
to a user, see "Configuring RBAC (Task Map)" in <i>System Administration Guide: Security Services</i>.</p>
</li>
<li><p><b>Start the file editor of your choice. Create or edit the configuration
file for the feature you want to configure.</b></p><ul><li><p>To create a configuration file for packet filtering rules,
edit the <tt>ipf.conf</tt> file.</p>
<p>Solaris IP Filter
uses the packet filtering rules that you put in to the <tt>ipf.conf</tt> file.
If you locate the rules file for packet filtering in the <tt>/etc/ipf/ipf.conf</tt> file, this file is loaded when the system is booted. If you do
not want the filtering rules to be loaded at boot time, put the in a file
of your choice. You can then activate the rules with the <tt>ipf</tt> command,
as described in <A HREF="p134.html#ettmd">How to Activate a Different or Updated Packet Filtering Rule Set</A>.</p>
<p>See <A HREF="p129.html#euqfb">Using Solaris IP Filter's Packet Filtering Feature</A> for information about
creating packet filtering rules.</p>
<p><hr size="1" noshade><p><b>Note - </b>If the <tt>ipf.conf</tt> file is empty, there is no
filtering. An empty <tt>ipf.conf</tt> file is the same as having
a rule set that reads:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>pass in all
pass out all</pre>
</td></table><br><hr size="1" noshade></p></li>
<li><p>To create a configuration file for NAT rules, edit the <tt>ipnat.conf</tt> file.</p>
<p>Solaris IP Filter uses the NAT rules
that you put in to the <tt>ipnat.conf</tt> file. If you locate
the rules file for NAT in the <tt>/etc/ipf/ipnat.conf</tt> file,
this file is loaded when the system is booted. If you do not want the NAT
rules loaded at boot time, put the <tt>ipnat.conf</tt> file in
a location of your choice. You can then activate the NAT rules with the <tt>ipnat</tt> command.</p>
<p>See <A HREF="p130.html#euqfc">Using Solaris IP Filter's NAT Feature</A> for information about creating rules for NAT.</p>
</li>
<li><p>To create a configuration file for address pools, edit the <tt>ippool.conf</tt> file.</p>
<p>Solaris IP Filter uses the pool of
addresses that you put in to the <tt>ippool.conf</tt> file. If
you locate the rules file for the pool of addresses in the <tt>/etc/ipf/ippool.conf</tt> file, this file is loaded when the system is booted. If you do
not want the pool of addresses loaded at boot time, put the <tt>ippool.conf</tt> file in a location of your choice. You can then activate the pool
of addresses with the <tt>ippool</tt> command.</p>
<p>See <A HREF="p130.html#euqfe">Using Solaris IP Filter's Address Pools Feature</A> for
information about creating address pools.</p>
</li>
</ul>
</li>
</ol><A NAME="ezecy"></A><h3>Solaris IP Filter Configuration File Examples</h3>
<p>The following examples provide an illustration of packet filtering rules
used in filtering configurations.</p>
<A NAME="eywvr"></A><p><b>Example 26-24 </b>Solaris IP Filter Host Configuration</p>
<p>This example shows a configuration on a host machine with an <tt>elxl</tt> network
interface.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># pass and log everything by default
pass in log on elxl0 all
pass out log on elxl0 all

# block, but don't log, incoming packets from other reserved addresses
block in quick on elxl0 from 10.0.0.0/8 to any
block in quick on elxl0 from 172.16.0.0/12 to any

# block and log untrusted internal IPs. 0/32 is notation that replaces 
# address of the machine running Solaris IP Filter.
block in log quick from 192.168.1.15 to &lt;thishost>
block in log quick from 192.168.1.43 to &lt;thishost>

# block and log X11 (port 6000) and remote procedure call 
# and portmapper (port 111) attempts
block in log quick on elxl0 proto tcp from any to elxl0/32 port = 6000 keep state
block in log quick on elxl0 proto tcp/udp from any to elxl0/32 port = 111 keep state</pre>
</td></table><br><p>This rule set begins with two unrestricted rules that allow everything
to pass into and out of the <tt>elxl</tt> interface. The second
set of rules blocks any incoming packets from the private address spaces <tt>10.0.0.0</tt> and <tt>172.16.0.0</tt> from entering the firewall.
The next set of rules blocks specific internal addresses from the host machine.
Finally, the last set of rules blocks packets coming in on port 6000 and port
111.</p>
<A NAME="eywvs"></A><p><b>Example 26-25 </b>Solaris IP Filter Server Configuration</p>
<p>This example shows a configuration for a host machine acting as a web
server. This machine has an <tt>eri</tt> network interface.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># web server with an eri interface
# block and log everything by default; then allow specific services
# group 100 - inbound rules
# group 200 - outbound rules
# (0/32) resolves to our IP address)
*** FTP proxy ***


# block short packets which are packets fragmented too short to be real.
block in log quick all with short


# block and log inbound and outbound by default, group by destination
block in log on eri0 from any to any head 100
block out log on eri0 from any to any head 200


# web rules that get hit most often
pass in quick on eri0 proto tcp from any \
to eri0/32 port = http flags S keep state group 100
pass in quick on eri0 proto tcp from any \
to eri0/32 port = https flags S keep state group 100


# inbound traffic - ssh, auth
pass in quick on eri0 proto tcp from any \
to eri0/32 port = 22 flags S keep state group 100
pass in log quick on eri0 proto tcp from any \
to eri0/32 port = 113 flags S keep state group 100
pass in log quick on eri0 proto tcp from any port = 113 \
to eri0/32 flags S keep state group 100


# outbound traffic - DNS, auth, NTP, ssh, WWW, smtp
pass out quick on eri0 proto tcp/udp from eri0/32 \
to any port = domain flags S keep state group 200
pass in quick on eri0 proto udp from any port = domain to eri0/32 group 100

pass out quick on eri0 proto tcp from eri0/32 \
to any port = 113 flags S keep state group 200
pass out quick on eri0 proto tcp from eri0/32 port = 113 \
to any flags S keep state group 200

pass out quick on eri0 proto udp from eri0/32 to any port = ntp group 200
pass in quick on eri0 proto udp from any port = ntp to eri0/32 port = ntp group 100

pass out quick on eri0 proto tcp from eri0/32 \
to any port = ssh flags S keep state group 200

pass out quick on eri0 proto tcp from eri0/32 \
to any port = http flags S keep state group 200
pass out quick on eri0 proto tcp from eri0/32 \
to any port = https flags S keep state group 200

pass out quick on eri0 proto tcp from eri0/32 \
to any port = smtp flags S keep state group 200


# pass icmp packets in and out
pass in quick on eri0 proto icmp from any to eri0/32  keep state group 100
pass out quick on eri0 proto icmp from eri0/32 to any keep state group 200


# block and ignore NETBIOS packets
block in quick on eri0 proto tcp from any \
to any port = 135 flags S keep state group 100

block in quick on eri0 proto tcp from any port = 137 \
to any flags S keep state group 100
block in quick on eri0 proto udp from any to any port = 137 group 100
block in quick on eri0 proto udp from any port = 137 to any group 100

block in quick on eri0 proto tcp from any port = 138 \
to any flags S keep state group 100
block in quick on eri0 proto udp from any port = 138 to any group 100

block in quick on eri0 proto tcp from any port = 139 to any flags S keep state
group 100
block in quick on eri0 proto udp from any port = 139 to any group 100</pre>
</td></table><br>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p138.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p140.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

