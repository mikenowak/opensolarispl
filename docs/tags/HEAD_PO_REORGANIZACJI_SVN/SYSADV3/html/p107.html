<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p106.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p108.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipsec-mgtasks-1"></A><b>Chapter&nbsp;20</b><h1>Configuring IPsec (Tasks)</h1>
<p>This chapter provides procedures for implementing IPsec on your network.
The procedures are described in the following task maps:</p>
<ul><li><p><A HREF="p107.html#ipsec-mgtasks-2">Protecting Traffic With IPsec (Task Map)</A></p>
</li>
<li><p><A HREF="p110.html#ipsec-mgtasks-vpn-2">Protecting a VPN With IPsec (Task Map)</A></p>
</li>
</ul>
<p>For overview information about IPsec, see <A HREF="p103.html#ipsec-ov-1">Chapter&nbsp;19, IP Security Architecture (Overview)</A>. For reference information about
IPsec, see <A HREF="p115.html#ipsecref-1">Chapter&nbsp;21, IP Security Architecture (Reference)</A>.</p>
<A NAME="ipsec-mgtasks-2"></A><h2>Protecting Traffic With IPsec (Task Map)</h2>
<p><A NAME="indexterm-1734"></A><A NAME="indexterm-1735"></A><A NAME="indexterm-1736"></A><A NAME="indexterm-1737"></A>The following table points to procedures that set up IPsec between
one or more systems. The <tt>ipsecconf</tt>(1M), <tt>ipseckey</tt>(1M), and <tt>ifconfig</tt>(1M) man pages
also describe useful procedures in their respective Examples sections.</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Task</p></th><th scope="col"><p>Description</p></th><th scope="col"><p>For Instructions</p></th></tr>
<tr><td><p>Secure traffic between two systems</p></td><td><p>Protects packets from one system to another system.</p></td><td><p><A HREF="p107.html#ipsec-mgtasks-3">How to Secure Traffic Between Two Systems With IPsec</A>&nbsp;</p></td></tr>
<tr><td><p>Secure a web server by using IPsec policy</p></td><td><p>Requires non-web traffic to use IPsec. Web clients are identified by
particular ports, which bypass IPsec checks.</p></td><td><p><A HREF="p108.html#ipsec-mgtasks-16">How to Secure a Web Server With IPsec</A>&nbsp;</p></td></tr>
<tr><td><p>Display
IPsec policies</p></td><td><p>Displays
the IPsec policies that are currently being enforced, in the order in which
the policies are enforced.</p></td><td><p><A HREF="p108.html#ipsec-mgtasks-14">How to Display IPsec Policies</A>&nbsp;</p></td></tr>
<tr><td><p>Generate random numbers</p></td><td><p>Generates random numbers for keying material for manually created security
associations.</p></td><td><p><A HREF="p108.html#ipsec-mgtasks-12">How to Generate Random Numbers on a Solaris System</A>&nbsp;</p></td></tr>
<tr><td><p>Create or replace security associations manually</p></td><td><p>Provides the raw data for security associations:</p><ul><li><p>IPsec algorithm name and keying material</p></li>
<li><p>Key for the security parameter index</p></li>
<li><p>IP source and destination addresses</p></li>
</ul>
</td><td><p><A HREF="p109.html#ipsec-mgtasks-13">How to Manually Create IPsec Security Associations</A>&nbsp;</p></td></tr>
<tr><td><p>Check that IPsec is protecting the packets</p></td><td><p>Examines <tt>snoop</tt> output for specific headers that indicate
how the IP datagrams are protected.</p></td><td><p><A HREF="p110.html#ipsec-mgtasks-11">How to Verify That Packets Are Protected With IPsec</A>&nbsp;</p></td></tr>
<tr><td><p>(Optional) Create a Network Security role</p></td><td><p>Creates a role that can set up a secure network, but has fewer powers
than superuser.</p></td><td><p><A HREF="p110.html#ipsec-mgtasks-18">How to Create a Role for Configuring Network Security</A>&nbsp;</p></td></tr>
<tr><td><p>Set up a secure virtual private network (VPN)</p></td><td><p>Sets up IPsec between two systems that are separated by the Internet.</p></td><td><p><A HREF="p110.html#ipsec-mgtasks-vpn-2">Protecting a VPN With IPsec (Task Map)</A>&nbsp;</p></td></tr>
</table><A NAME="ipsec-mgtasks-4"></A><h2>Protecting Traffic With IPsec</h2>
<p>This section provides procedures that enable you to secure traffic between
two systems, and to secure a web server. To protect a VPN, see <A HREF="p110.html#ipsec-mgtasks-vpn-2">Protecting a VPN With IPsec (Task Map)</A>. Additional procedures provide keying material, provide security
associations, and verify that IPsec is working as configured.</p>
<p>The following information applies to all IPsec configuration tasks:</p><ul><li><p><A NAME="indexterm-1738"></A><A NAME="indexterm-1739"></A><A NAME="indexterm-1740"></A><A NAME="indexterm-1741"></A><b>IPsec and zones -</b> To
manage IPsec policy and keys for a non-global zone, create the IPsec policy file in the global
zone, and run the IPsec configuration commands from the global zone. Use the source address which corresponds
to the non-global zone that is being configured. You can also configure IPsec
policy and keys in the global zone for the global zone. In the  Solaris Express, Developer Edition 2/07 release,
you can use IKE to manage keys in a non-global zone.</p>
</li>
<li><p><A NAME="indexterm-1742"></A><A NAME="indexterm-1743"></A><b>IPsec and RBAC -</b> To use
roles to administer IPsec, see Chapter 8, "Using Role-Based Access Control (Tasks)," in <i>System Administration Guide: Security Services</i>. For an example, see <A HREF="p110.html#ipsec-mgtasks-18">How to Create a Role for Configuring Network Security</A>.</p>
</li>
<li><p><A NAME="indexterm-1744"></A><A NAME="indexterm-1745"></A><b>IPsec and SCTP -</b> IPsec
can be used to protect Streams Control Transmission Protocol (SCTP) associations,
but caution must be used. For more information, see <A HREF="p106.html#ipsec-ov-22">IPsec and SCTP</A>.</p>
</li>
</ul>
<A NAME="ipsec-mgtasks-3"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Secure Traffic Between Two Systems
With IPsec</h3>
<p><hr size="1" noshade><p><b>Note - </b><A NAME="indexterm-1746"></A><A NAME="indexterm-1747"></A><A NAME="indexterm-1748"></A><A NAME="indexterm-1749"></A>You configure IPsec policy in the global zone. </p>
<hr size="1" noshade></p><p>This procedure assumes the following setup:</p><ul><li><p>The two systems are named <tt>enigma</tt> and <tt>partym</tt>.</p>
</li>
<li><p>Each system has two addresses, an IPv4 address and an IPv6
address.</p>
</li>
<li><p>Each system invokes AH protection with the MD5 algorithm,
which requires a key of 128 bits.</p>
</li>
<li><p>Each system invokes ESP protections with the 3DES algorithm,
which requires a key of 192 bits.</p>
</li>
<li><p>Each system uses shared security associations.</p>
<p>With
shared SAs, only one pair of SAs is needed to protect the two systems.</p>
</li>
</ul>
<ol><li><p><b>On the system console, assume the Primary Administrator role or
become superuser.</b></p><p>The Primary Administrator role includes the
Primary Administrator profile. To create the role and assign the role to a
user, see Chapter 2, "Working With the Solaris Management Console (Tasks)," in <i>System Administration Guide: Basic Administration</i>.</p>
<p><hr size="1" noshade><p><b>Note - </b><A NAME="indexterm-1750"></A>Logging in remotely exposes security-critical traffic to eavesdropping.
Even if you somehow protect the remote login, the security of the system is
reduced to the security of the remote login session.</p>
<hr size="1" noshade></p></li>
<A NAME="ipsec-mgtasks-ipnode-1"></A><li><p><b><A NAME="indexterm-1751"></A><A NAME="indexterm-1752"></A><A NAME="indexterm-1753"></A><A NAME="indexterm-1754"></A>On each system, add host entries to the <tt>/etc/inet/hosts</tt> file.</b></p><ol Type="a"><li><p><b>On a system that is named <tt>partym</tt>, type
the following in the <tt>hosts</tt> file:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># Secure communication with enigma
192.168.116.16 enigma
2001::aaaa:6666:6666 enigma</pre>
</td></table><br></li>
<li><p><b>On a system that is named <tt>enigma</tt>, type
the following in the <tt>hosts</tt> file:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># Secure communication with partym
192.168.13.213 partym
2001::eeee:3333:3333 partym</pre>
</td></table><br></li>
</ol>
</li>
<li><p><b><A NAME="indexterm-1755"></A>On each system, create the IPsec policy file.</b></p><p>The
file name is <tt>/etc/inet/ipsecinit.conf</tt>. For
an example, see the <tt>/etc/inet/ipsecinit.sample</tt> file.</p>
</li>
<A NAME="ipsec-mgtasks-policy-1"></A><li><p><b><A NAME="indexterm-1756"></A>Add an IPsec policy entry to the <tt>ipsecinit.conf</tt> file.</b></p><ol Type="a"><li><p><b>On the <tt>enigma</tt> system, add the following
policy:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>{laddr enigma raddr partym} ipsec {auth_algs any encr_algs any sa shared}</pre>
</td></table><br></li>
<li><p><b>On the <tt>partym</tt> system, add the identical policy:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>{laddr partym raddr enigma} ipsec {auth_algs any encr_algs any sa shared}</pre>
</td></table><br><p>For the syntax of IPsec policy entries, see the <tt>ipsecconf</tt>(1M) man page.</p>
</li>
</ol>
</li>
<A NAME="ipsec-mgtasks-sa-3"></A><li><p><b><A NAME="indexterm-1757"></A><A NAME="indexterm-1758"></A><A NAME="indexterm-1759"></A><A NAME="indexterm-1760"></A><A NAME="indexterm-1761"></A>On each system, add a pair of IPsec SAs between the two systems.</b></p><p>You can configure Internet Key Exchange (IKE) to create the SAs automatically.
You can also add the SAs manually.</p>
<p><hr size="1" noshade><p><b>Note - </b>You should use IKE unless you have good reason to generate and
maintain your keys manually. IKE key management is more secure than manual
key management.</p>
<hr size="1" noshade></p><ul><li><p>Configure IKE by following one of the configuration procedures
in <A HREF="p119.html#ike-task-7">Configuring IKE (Task Map)</A>. For the
syntax of the IKE configuration file, see the <tt>ike.config</tt>(4) man page.</p>
</li>
<li><p>To add the SAs manually, see <A HREF="p109.html#ipsec-mgtasks-13">How to Manually Create IPsec Security Associations</A>. </p>
</li>
</ul>
</li>
<A NAME="ipsec-mgtasks-reboot-1"></A><li><p><b>Reboot each system.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>init 6</b></tt></pre>
</td></table><br></li>
<li><p><b>Verify that packets are being protected.</b></p><p>For the procedure,
see <A HREF="p110.html#ipsec-mgtasks-11">How to Verify That Packets Are Protected With IPsec</A>.</p>
</li>
</ol><A NAME="ipsec-mgtasks-19"></A><h5>Example 20-1 &nbsp;&nbsp;Securing Traffic With IPsec Without Rebooting</h5>
<p>The following example describes how to implement IPsec in a test environment.
In a production environment, it is more secure to reboot than to run the <tt>ipsecconf</tt> command.
For the security considerations, see the end of this example.</p>
<p>Instead of rebooting at <A HREF="p107.html#ipsec-mgtasks-reboot-1">Step&nbsp;6</A>, choose one of the following options.</p>
<ul><li><p><A NAME="indexterm-1762"></A>If you used IKE to create keying material, stop and then restart
the <tt>in.iked</tt> daemon.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>pkill in.iked</b></tt>
# <tt><b>/usr/lib/inet/in.iked</b></tt></pre>
</td></table><br></li>
<li><p><A NAME="indexterm-1763"></A><A NAME="indexterm-1764"></A><A NAME="indexterm-1765"></A><A NAME="indexterm-1766"></A><A NAME="indexterm-1767"></A>If you added keys manually, use the <tt>ipseckey</tt> command
to add the SAs to the database.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ipseckey -f /etc/inet/secret/ipseckeys</b></tt></pre>
</td></table><br><p>Then activate the IPsec policy
with the <tt>ipsecconf</tt> command.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ipsecconf -a /etc/inet/ipsecinit.conf</b></tt></pre>
</td></table><br></li>
</ul>
<p><A NAME="indexterm-1768"></A><A NAME="indexterm-1769"></A><b>Security Considerations -</b> Read
the warning when you execute the <tt>ipsecconf</tt> command. A socket
that is already latched, that is, a socket that is already in use, provides
an unsecured back door into the system. For more extensive discussion, see <A HREF="p115.html#ipsecref-42">Security Considerations for <tt>ipsecinit.conf</tt> and <tt>ipsecconf</tt></A>.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p106.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p108.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

