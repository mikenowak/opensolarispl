<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p188.html#ipqos-reference-1">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p188.html#ipqos-reference-2">IPQoS Architecture and the Diffserv Model</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p189.html#ipqos-reference-11">Marker Module</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p189.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p191.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipqos-reference-500"></A><h5>Supplying a DSCP to the Marker</h5>
<p><A NAME="indexterm-3175"></A>The DSCP is 6 bits in length. The DS field is 1 byte long. When
you define a DSCP, the marker marks the first 6 significant bits of the packet
header with the DS codepoint. The remaining 2 least-significant bits are unused. </p>
<p><A NAME="indexterm-3176"></A>To define a DSCP, you use the following parameter within a marker
action statement:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre> dscp_map{0-63:<i>DS_codepoint</i>}</pre>
</td></table><br><p>The <tt>dscp_map</tt> parameter is a 64-element array, which
you populate with the (DSCP) value. <tt>dscp_map</tt> is used to
map incoming DSCPs to outgoing DSCPs that are applied by the <tt>dscpmk</tt> marker.</p>
<p>You must specify the DSCP value to <tt>dscp_map</tt> in decimal
notation. For example, you must translate the EF codepoint of 101110 into
the decimal value 46, which results in <tt>dscp_map{0-63:46}</tt>.
For AF codepoints, you must translate the various codepoints that are shown
in <A HREF="p189.html#ipqos-reference-tbl-16">Table 37-2</A> to decimal
notation for use with <tt>dscp_map.</tt></p>
<A NAME="ipqos-reference-110"></A><h4>Using the <tt>dlcosmk</tt> Marker
With VLAN Devices</h4>
<p><A NAME="indexterm-3177"></A><A NAME="indexterm-3178"></A><A NAME="indexterm-3179"></A><A NAME="indexterm-3180"></A>The <tt>dlcosmk</tt> marker module marks a forwarding
behavior in the MAC header of a datagram. You can use <tt>dlcosmk</tt> only
on an IPQoS system with a VLAN interface.</p>
<p><A NAME="indexterm-3181"></A><tt>dlcosmk</tt> adds four bytes, which are known as
the <b>VLAN tag</b>, to the MAC header. The VLAN tag includes
a 3-bit user-priority value, which is defined by the IEEE 801.D standard.
Diffserv-aware switches that understand VLAN can read the user-priority field
in a datagram. The 801.D user priority values implement the class-of-service
(CoS) marks, which are well known and understood by commercial switches.</p>
<p><A NAME="indexterm-3182"></A>You can use the user-priority values in the <tt>dlcosmk</tt> marker
action by defining the class of service marks that are listed in the next
table.</p>
<A NAME="ipqos-reference-tbl-18"></A><p><b>Table 37-3 </b>801.D User-Priority
Values</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Class of Service</p></th><th scope="col"><p>Definition</p></th></tr>
<tr><td><p>0</p></td><td><p>Best effort</p></td></tr>
<tr><td><p>1</p></td><td><p>Background</p></td></tr>
<tr><td><p>2</p></td><td><p>Spare</p></td></tr>
<tr><td><p>3</p></td><td><p>Excellent effort</p></td></tr>
<tr><td><p>4</p></td><td><p>Controlled load</p></td></tr>
<tr><td><p>5</p></td><td><p>Video less than 100ms latency</p></td></tr>
<tr><td><p>6</p></td><td><p>Video less than 10ms latency</p></td></tr>
<tr><td><p>7</p></td><td><p>Network control</p></td></tr>
</table><p>For more information on <tt>dlcosmk</tt>, refer to the <tt>dlcosmk</tt>(7ipp) man page.</p>
<A NAME="ipqos-reference-17"></A><h5>IPQoS Configuration for Systems With
VLAN Devices</h5>
<p>This section introduces a simple network scenario that shows how to
implement IPQoS on systems with VLAN devices. The scenario includes two IPQoS
systems, <tt>machine1</tt> and <tt>machine2</tt>, that
are connected by a switch. The VLAN device on <tt>machine1</tt> has
the IP address <tt>10.10.8.1</tt>. The VLAN device on <tt>machine2</tt> has the IP address <tt>10.10.8.3</tt>. </p>
<p><A NAME="indexterm-3183"></A>The following IPQoS configuration file for <tt>machine1</tt> shows
a simple solution for marking traffic through the switch to <tt>machine2</tt>.</p>
<A NAME="ipqos-reference-ex-19"></A><p><b>Example 37-2 </b>IPQoS Configuration File for a
System With a VLAN Device</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>fmt_version 1.0
action {
        module ipgpc
	      name ipgpc.classify

        filter {
                name myfilter2
                daddr 10.10.8.3
                class myclass
        }

        class {
                name myclass
                next_action mark4
        }
}

action {
        name mark4
        module dlcosmk
        params {
                cos 4
                next_action continue
		global_stats true
        }
}</pre>
</td></table><br><p>In this configuration, all traffic from <tt>machine1</tt> that
is destined for the VLAN device on <tt>machine2</tt> is passed to
the <tt>dlcosmk</tt> marker. The <tt>mark4</tt> marker
action instructs <tt>dlcosmk</tt> to add a VLAN mark to datagrams
of class <tt>myclass</tt> with a CoS of 4. The user-priority value
of 4 indicates that the switch between the two machines should give controlled
load forwarding to <tt>myclass</tt> traffic flows from <tt>machine1</tt>.</p>
<A NAME="ipqos-reference-300"></A><h3><tt>flowacct</tt> Module</h3>
<p><A NAME="indexterm-3184"></A><A NAME="indexterm-3185"></A>The IPQoS <tt>flowacct</tt> module records information
about traffic flows, a process that is referred to as <b>flow accounting</b>.
Flow accounting produces data that can be used for billing customers or for
evaluating the amount of traffic to a particular class.</p>
<p>Flow accounting is optional. <tt>flowacct</tt> is typically
the final module that metered or marked traffic flows might encounter before
release onto the network stream. For an illustration of <tt>flowacct</tt>'s
position in the Diffserv model, see <A HREF="p171.html#ipqos-intro-fig-2">Figure 32-1</A>. For detailed technical information about <tt>flowacct</tt>,
refer to the <tt>flowacct</tt>(7ipp) man page.</p>
<p>To enable flow accounting, you need to use the Solaris <tt>exacct</tt> accounting
facility and the <tt>acctadm</tt> command, as well as <tt>flowacct</tt>. For the overall steps in setting up flow accounting, refer to <A HREF="p186.html#ipqos-accounting-3">Setting Up Flow Accounting (Task Map)</A>.</p>
<A NAME="ipqos-reference-5"></A><h4><tt>flowacct</tt> Parameters</h4>
<p><A NAME="indexterm-3186"></A>The <tt>flowacct</tt> module gathers information about
flows in a <b>flow table</b> that is composed of <b>flow
records</b>. Each entry in the table contains one flow record. You
cannot display a flow table.</p>
<p>In the IPQoS configuration file, you define the following <tt>flowacct</tt> parameters to measure flow records and to write the records to
the flow table:</p>
<ul><li><p><tt>timer</tt> - Defines an interval, in milliseconds,
when timed-out flows are removed from the flow table and written to the file
that is created by <tt>acctadm</tt></p>
</li>
<li><p><tt>timeout</tt> - Defines an interval, in
milliseconds, which specifies how long a packet flow must be inactive before
the flow times out</p>
<p><hr size="1" noshade><p><b>Note - </b>You can configure <tt>timer</tt> and <tt>timeout</tt> to
have different values.</p>
<hr size="1" noshade></p></li>
<li><p><tt>max_limit</tt> - Places an upper limit
on the number of flow records that can be stored in the flow table</p>
</li>
</ul>
<p>For an example of how <tt>flowacct</tt> parameters are used
in the IPQoS configuration file, refer to <A HREF="p183.html#ipqos-policy-planning-144">How to Configure Flow Control in the IPQoS Configuration File</A>.</p>
<A NAME="ipqos-reference-16"></A><h4>Flow Table</h4>
<p><A NAME="indexterm-3187"></A><A NAME="indexterm-3188"></A>The <tt>flowacct</tt> module maintains a flow table
that records all packet flows that are seen by a <tt>flowacct</tt> instance.
A flow is identified by the following parameters, which include the <tt>flowacct</tt> 8-tuple:</p>
<ul><li><p>Source address</p>
</li>
<li><p>Destination address</p>
</li>
<li><p>Source port</p>
</li>
<li><p>Destination port</p>
</li>
<li><p>DSCP</p>
</li>
<li><p>User ID</p>
</li>
<li><p>Project ID</p>
</li>
<li><p>Protocol Number</p>
</li>
</ul>
<p>If all the parameters of the 8-tuple for a flow remain the same,
the flow table contains only one entry. The <tt>max_limit</tt> parameter
determines the number of entries that a flow table can contain.</p>
<p>The flow table is scanned at the interval that is specified in the IPQoS
configuration file for the <tt>timer</tt> parameter. The default
is 15 seconds. A flow "times out" when its packets are not seen
by the IPQoS system for at least the <tt>timeout</tt> interval in
the IPQoS configuration file. The default time out interval is 60 seconds.
Entries that have timed out are then written to the accounting file that is
created with the <tt>acctadm</tt> command.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p189.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p191.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

