<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p160.html#deploynetmult-56">31.&nbsp;&nbsp;Administering IPMP (Tasks)</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p164.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p166.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="deploynetmult-116"></A><h2>Recovering a Physical Interface That
Was Not Present at System Boot</h2>
<A NAME="indexterm-2973"></A><A NAME="indexterm-2974"></A><p><hr size="1" noshade><p><b>Note - </b>The following procedure pertains only to IP layers that are configured
by using the <tt>ifconfig</tt> command. Layers before or after the
IP layer, such as ATM or other services, require specific manual steps if
the layers are not automated. The specific steps in the next procedure are
used to unconfigure interfaces during predetachment and to configure interfaces
after postattachment. </p>
<hr size="1" noshade></p><p>Recovery after dynamic reconfiguration is automatic for an interface
that is part of the I/O board on a Sun Fire&trade; platform. If the NIC is
a Sun Crypto Accelerator I - cPCI board, the recovery is also  automatic.
Consequently, the following steps are not required for an interface that is
coming back as part of a DR operation. For more information on the Sun Fire
x800 and Sun Fire 15000 systems, see the <tt>cfgadm_sbd</tt>(1M) man page. The physical interface
fails back to the configuration that is specified in the <tt>/etc/hostname.</tt><i>interface</i> file. See <A HREF="p160.html#deploynetmult-57">Configuring IPMP Groups</A> for details on
how to configure interfaces to preserve the configuration across reboots.</p>
<p><hr size="1" noshade><p><b>Note - </b>On Sun Fire legacy (Exx00) systems, DR detachments are still subject
to manual procedures. However, DR attachments are automated.</p>
<hr size="1" noshade></p><A NAME="deploynetmult-107"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Recover a Physical Interface That
Was Not Present at System Boot</h3>
<p>You must complete the following procedure before you recover a physical
interface that was not present at system boot. The  example in this procedure
has the following configuration:</p>
<ul><li><p>Physical interfaces <tt>hme0</tt> and <tt>hme1</tt> are
the interfaces. </p>
</li>
<li><p>Both interfaces are in the same IPMP group. </p>
</li>
<li><p><tt>hme0</tt> was not installed at system boot.</p>
</li>
</ul>
<p><hr size="1" noshade><p><b>Note - </b>The failback of IP addresses during the recovery of a failed physical
interface takes up to three minutes. This time might vary, depending on network
traffic. The time also depends on the stability of the incoming interface
to fail back the failed-over interfaces by the <tt>in.mpathd</tt> daemon.</p>
<hr size="1" noshade></p><ol><li><p><b>On the system with the IPMP group configuration, assume the Primary
Administrator role or become superuser.</b></p><p>The Primary Administrator
role includes the Primary Administrator profile. To create the role and assign
the role to a user, see Chapter 2, "Working With the Solaris Management Console (Tasks)," in <i>System Administration Guide: Basic Administration</i>.</p>
</li>
<A NAME="deploynetmult-step-109"></A><li><p><b>Retrieve the failed network information
from the failure error message of the console log.</b></p><p>See the <tt>syslog</tt>(3C)man page. The error message
might be similar to the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>moving addresses from failed IPv4 interfaces:
hme1 (moved to hme0)</pre>
</td></table><br><p>This message indicates that the IPv4 addresses on the failed interface <tt>hme1</tt> have failed over to the <tt>hme0</tt> interface.</p>
<p>Alternatively, you might receive the following similar message:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>moving addresses from failed IPv4 interfaces:
hme1 (couldn't move, no alternative interface)</pre>
</td></table><br><p>This message indicates that no active interface could be found in the
same group as failed interface <tt>hme1</tt>. Therefore, the IPv4
addresses on <tt>hme1</tt> could not fail over.</p>
</li>
<A NAME="deploynetmult-step-110"></A><li><p><b>Attach the physical interface to the
system. </b></p><p>Refer to the following for instructions on how to replace
the physical interface:</p>
<ul><li><p><tt>cfgadm</tt>(1M) man
page</p>
</li>
<li><p><i>Sun Enterprise 10000 DR Configuration Guide</i></p>
</li>
<li><p><i>Sun Enterprise 6x00, 5x00, 4x00, and 3x00 Systems
Dynamic Reconfiguration User's Guide</i></p>
</li>
</ul>
</li>
<A NAME="deploynetmult-step-111"></A><li><p><b>Refer to the message content from
Step 2. If the addresses could not be moved, go to Step 6. If the addresses
were moved, continue to Step 5.</b></p></li>
<A NAME="deploynetmult-step-112"></A><li><p><b>Unplumb the logical interfaces that
were configured as part of the failover process.</b></p><ol Type="a"><A NAME="deploynetmult-step-113"></A><li><p><b>Review the contents of the <tt>/etc/hostname.</tt><i>moved-from-interface<tt></i></tt> file to determine what logical
interfaces were configured as part of the failover process.</b></p></li>
<A NAME="deploynetmult-step-114"></A><li><p><b>Unplumb each failover IP address.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ifconfig <i>moved-to-interface</i> removeif <i>moved-ip-address</i></pre>
</td></table><br><p><hr size="1" noshade><p><b>Note - </b>Failover addresses are marked with the <tt>failover</tt> parameter,
or are not marked with the <tt>-failover</tt> parameter. You do
not need to unplumb IP addresses that are marked <tt>-failover</tt>.</p>
<hr size="1" noshade></p><p>For example, assume that the contents of the <tt>/etc/hostname.hme0</tt> file
contains the following lines:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>inet 10.0.0.4 -failover up group one
addif 10.0.0.5 failover up
addif 10.0.0.6 failover up</pre>
</td></table><br><p>To unplumb each failover IP address, you would type the following commands:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ifconfig hme0 removeif 10.0.0.5
# ifconfig hme0 removeif 10.0.0.6</pre>
</td></table><br></li>
</ol>
</li>
<A NAME="deploynetmult-step-115"></A><li><p><b>Reconfigure the IPv4 information for
the replaced physical interface by typing the following command for each interface
that was removed:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ifconfig <i>removed-from-NIC</i> &lt;parameters></pre>
</td></table><br><p>For example, you would type the following commands:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ifconfig hme1 inet plumb
# ifconfig hme1 inet 10.0.0.4 -failover up group one
# ifconfig hme1 addif 10.0.0.5 failover up
# ifconfig hme1 addif 10.0.0.6 failover up</pre>
</td></table><br></li>
</ol><A NAME="gbdbr"></A><h2>Modifying the <tt>/etc/default/mpathd</tt> IPMP Configuration File</h2>
<A NAME="indexterm-2975"></A><A NAME="indexterm-2976"></A><p><A NAME="indexterm-2977"></A>Use the IPMP configuration file <tt>/etc/default/mpathd</tt> to
configure the following system-wide parameters for IPMP groups.</p>
<ul><li><p><tt>FAILURE_DETECTION_TIME</tt></p>
</li>
<li><p><tt>FAILBACK</tt></p>
</li>
<li><p><tt>TRACK_INTERFACES_ONLY_WITH_GROUPS</tt></p>
</li>
</ul>
<p>These parameters apply to all IPMP groups that are created on an individual
system.</p>
<A NAME="gbdbf"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Configure the <tt>/etc/default/mpathd</tt> File</h3>
<ol><li><p><b>On the system with the IPMP group configuration, assume the Primary
Administrator role or become superuser.</b></p><p>The Primary Administrator
role includes the Primary Administrator profile. To create the role and assign
the role to a user, see Chapter 2, "Working With the Solaris Management Console (Tasks)," in <i>System Administration Guide: Basic Administration</i>.</p>
</li>
<A NAME="deploynetmult-step-51"></A><li><p><b>Edit the <tt>/etc/default/mpathd</tt> file.</b></p></li>
<li><p><b>(Optional) Type the new value for the <i>FAILURE_DETECTION_TIME</i> parameter.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>FAILURE_DETECTION_TIME=<i>n</i></pre>
</td></table><br><p>where <i>n</i> is the amount of time in seconds
for ICMP probes to detect whether an interface failure has occurred. The default
is 10 seconds.</p>
</li>
<li><p><b>(Optional) Type the new value for the <i>TRACK_INTERFACES_ONLY_WITH_GROUPS</i> parameter.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>TRACK_INTERFACES_ONLY_WITH_GROUPS=[yes | no]</pre>
</td></table><br><ul><li><p><i>yes</i>- The <i>yes</i> value
is the default behavior of IPMP. This parameter causes IPMP to ignore network
interfaces that are not configured into an IPMP group.</p>
</li>
<li><p><i>no</i> - The <i>no</i> value
sets failure and repair detection for <b>all</b> network interfaces,
regardless of whether they are configured into an IPMP group. However, when
a failure or repair is detected on an interface that is not configured 	into
an IPMP group, no failover or failback occurs. 	 Therefore, the<i>no</i> value
is only useful for reporting failures and does not directly improve network
availability.</p>
</li>
</ul>
</li>
<li><p><b>(Optional) Type the new value for the <i>FAILBACK</i> parameter.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>FAILBACK=[yes | no]</pre>
</td></table><br><ul><li><p><i>yes</i>- The <i>yes</i> value
is the default failback behavior of IPMP. When the repair of a failed interface
is detected, network access fails back to the repaired interface, as described
in <A HREF="p157.html#emqqq">IPMP Failure Detection and Recovery Features</A>.</p>
</li>
<li><p><i>no</i> - The <i>no</i> indicates
that data traffic does not move back to a repaired interface. When a failed
interfaces is detected as repaired, the <i>INACTIVE</i> flag
of <tt>ifconfig</tt> is set. This flag indicates that the interface
is currently not to be used for data traffic. The interface can still be used
for probe traffic.</p>
<p>For example, suppose an IPMP group consists
of two interfaces, <!-- was interface. No mapping rule. -->ce0 and <!-- was interface. No mapping rule. -->ce1.
Then assume that the value <i>FAILBACK=no</i> is set in the <tt>mpathd</tt> file. If <!-- was interface. No mapping rule. -->ce0 fails, its traffic fails
over to <!-- was interface. No mapping rule. -->ce1, as is the expected behavior of IPMP. However,
when IPMP detects that <!-- was interface. No mapping rule. -->ce0 is repaired, traffic does
not fail back from <!-- was interface. No mapping rule. -->ce1, due to the <i>FAILBACK=no</i> parameter
in the <tt>mpathd</tt> file. <!-- was interface. No mapping rule. -->ce0 retains
its <tt>INACTIVE</tt> status and is not used for traffic unless
the <!-- was interface. No mapping rule. -->ce1 interface fails. </p>
</li>
</ul>
</li>
<A NAME="gbdby"></A><li><p><b>Restart the <tt>in.mpathd</tt> daemon.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>pkill -HUP in.mpathd</b></tt></pre>
</td></table><br></li>
</ol>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p164.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p166.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

