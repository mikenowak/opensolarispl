<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p178.html#ipqos-policy-planning-1">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p178.html#ipqos-policy-planning-2">Creating IPQoS Configuration Files for Web Servers</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p180.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p182.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipqos-policy-planning-114"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Create an IPQoS Configuration File
for a Best-Effort Web Server</h3>
<p>The IPQoS configuration file for a best-effort web server differs slightly from
an IPQoS configuration file for a premium web server. As an example, the procedure
uses the configuration file from <A HREF="p179.html#ipqos-policy-planning-ex-95">Example 34-2</A>.</p>
<ol><A NAME="ipqos-policy-planning-step-131"></A><li><p><b>Log in to the best-effort web server.</b></p></li>
<A NAME="ipqos-policy-planning-step-126"></A><li><p><b>Create a new IPQoS configuration file
with a <tt>.qos</tt> extension.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>fmt_vesion 1.0
action {
    module ipgpc
    name ipgpc.classify
    params {
        global_stats TRUE
   }</b></tt></pre>
</td></table><br><p>The <tt>/var/ipqos/userweb.qos</tt> file must begin with the partial <tt>action</tt> statement to invoke the <tt>ipgpc</tt> classifier. In addition,
the <tt>action</tt> statement also has a params clause to turn on statistics
collection. For an explanation of this <tt>action</tt> statement, see <A HREF="p179.html#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</A>.</p>
</li>
<A NAME="ipqos-policy-planning-step-127"></A><li><p><b><A NAME="indexterm-3112"></A>Define a class that identifies traffic that is bound for the best-effort
web server.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>class {
        name userweb
        next_action markAF12
        enable_stats FALSE
    }</b></tt></pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p><tt>name userweb</tt></p></td><td valign="top"><p>Creates a class that is called <tt>userweb</tt> for forwarding
web traffic from users.</p>
</td></tr><tr><td valign="top"><p><tt>next_action markAF1</tt></p></td><td valign="top"><p>Instructs the <tt>ipgpc</tt> module to pass packets of the <tt>userweb</tt> class to the <tt>markAF12</tt> <tt>action</tt> statement
after <tt>ipgpc</tt> completes processing. The <tt>markAF12</tt> <tt>action</tt> statement invokes the <tt>dscpmk</tt> marker.</p>
</td></tr><tr><td valign="top"><p><tt>enable_stats FALSE</tt></p></td><td valign="top"><p>Enables statistics collection for the <tt>userweb</tt> class.
However, because the value of <tt>enable_stats</tt> is <tt>FALSE</tt>,
statistics collection for this class does not occur.</p>
</td></tr></table>
<p>For an explanation of the <tt>class</tt> clause task, see <A HREF="p179.html#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</A>.</p>
</li>
<A NAME="ipqos-policy-planning-step-128"></A><li><p><b><A NAME="indexterm-3113"></A>Define a <tt>filter</tt> clause to select traffic flows for
the <tt>userweb</tt> class.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>   filter {
       name webout
       sport 80
       direction LOCAL_OUT
       class userweb
   }
}</b></tt></pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p><tt>name webout</tt></p></td><td valign="top"><p>Gives the name <tt>webout</tt> to the filter.</p>
</td></tr><tr><td valign="top"><p><tt>sport 80</tt></p></td><td valign="top"><p>Selects traffic with a source port of 80, the well-known port for
HTTP (web) traffic.</p>
</td></tr><tr><td valign="top"><p><tt>direction LOCAL_OUT</tt></p></td><td valign="top"><p>Further selects traffic that is outgoing from the local system.</p>
</td></tr><tr><td valign="top"><p>class userweb</p></td><td valign="top"><p>Identifies the class to which the filter belongs, in this instance,
class <tt>userweb</tt>.</p>
</td></tr></table>
<p><A NAME="indexterm-3114"></A>For an explanation of the <tt>filter</tt> clause task, see <A HREF="p179.html#ipqos-policy-planning-33">How to Define Filters in the IPQoS Configuration File</A>.</p>
</li>
<A NAME="ipqos-policy-planning-step-132"></A><li><p><b>Begin the <tt>action</tt> statement
to invoke the <tt>dscpmk</tt> marker.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>action {
    module dscpmk
    name markAF12</b></tt></pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p><tt>module dscpmk</tt></p></td><td valign="top"><p>Invokes the marker module <tt>dscpmk</tt>.</p>
</td></tr><tr><td valign="top"><p><tt>name markAF12</tt></p></td><td valign="top"><p>Gives the name <tt>markAF12</tt> to the <tt>action</tt> statement.</p>
</td></tr></table>
<p>The previously defined class <tt>userweb</tt> includes a <tt>next_action markAF12</tt> statement. This statement sends traffic flows to the <tt>markAF12</tt> <tt>action</tt> statement after the classifier concludes
processing.</p>
</li>
<A NAME="ipqos-policy-planning-step-129"></A><li><p><b><A NAME="indexterm-3115"></A>Define parameters for the marker to use for processing the traffic flow.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre><tt><b>    params {
        global_stats FALSE
        dscp_map{0-63:12}
        next_action continue
    }
}</b></tt></pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p><tt>global_stats FALSE</tt></p></td><td valign="top"><p>Enables statistics collection for the <tt>markAF12</tt> marker <tt>action</tt> statement. However, because the value of <tt>enable_stats</tt> is <tt>FALSE</tt>, statistics collection does not occur.</p>
</td></tr><tr><td valign="top"><p><tt>dscp_map{0-63:12}</tt></p></td><td valign="top"><p>Assigns a DSCP of <tt>12</tt> to the packet headers of the
traffic class <tt>userweb</tt>, which is currently being processed by the
marker. </p>
</td></tr><tr><td valign="top"><p><tt></tt>next_action continue</p></td><td valign="top"><p>Indicates that no further processing is required on packets of the
traffic class <tt>userweb</tt>, and that these packets can return to the
network stream.</p>
</td></tr></table>
<p>The DSCP of <tt>12</tt> instructs the marker to set all entries in
the <tt>dscp</tt> map to the decimal value 12 (binary 001100). This codepoint
indicates that packets of the <tt>userweb</tt> traffic class are subject
to the AF12 per-hop behavior. AF12 guarantees that all packets with the DSCP of <tt>12</tt> in the DS field receive a medium-drop, high-priority service.</p>
</li>
<A NAME="ipqos-policy-planning-step-791"></A><li><p><b>When you complete the IPQoS configuration
file, apply the configuration.</b></p></li>
</ol><h5>See Also</h5><ul><li><p>To add classes and other configuration for traffic flows from applications,
refer to <A HREF="p182.html#ipqos-policy-planning-67">How to Configure the IPQoS Configuration File for an Application Server</A>.</p>
</li>
<li><p>To configure per-hop behaviors on a router, refer to <A HREF="p183.html#ipqos-policy-planning-136">How to Configure a Router on an IPQoS-Enabled Network</A>.</p>
</li>
<li><p>To activate your IPQoS configuration file, refer to <A HREF="p184.html#ipqos-maint-5">How to Apply a New Configuration to the IPQoS Kernel Modules</A>.</p>
</li>
</ul>
<A NAME="ipqos-policy-planning-5"></A><h2>Creating an IPQoS Configuration File for
an Application Server</h2>
<p><A NAME="indexterm-3116"></A>This section explains how to create a configuration file for an application
server that provides major applications to customers. The procedure uses as its example
the <tt>BigAPPS</tt> server from <A HREF="p177.html#ipqos-config-planning-fig-44">Figure 33-4</A>.</p>
<p><A NAME="indexterm-3117"></A>The following configuration file defines IPQoS activities for the <tt>BigAPPS</tt> server. This server hosts FTP, electronic mail (SMTP), and network
news (NNTP) for customers.</p>
<A NAME="ipqos-policy-planning-ex-96"></A><p><b>Example 34-3 </b>Sample IPQoS Configuration File for
an Application Server</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>fmt_version 1.0

action {
    module ipgpc
    name ipgpc.classify
    params {
        global_stats TRUE
    }
    class {
        name smtp
        enable_stats FALSE
        next_action markAF13
    }
    class {
        name news
        next_action markAF21
    }
    class {
        name ftp
        next_action meterftp
    }
    filter {
        name smtpout
        sport smtp
        class smtp
    }
    filter {
        name newsout
        sport nntp
        class news
    }
    filter {
        name ftpout
        sport ftp
        class ftp
    }
   filter {
        name ftpdata
        sport ftp-data
        class ftp
    }
}
action {
    module dscpmk
    name markAF13
    params {
        global_stats FALSE
        dscp_map{0-63:14}
        next_action continue
    }
}
action {
    module dscpmk
    name markAF21
    params {
        global_stats FALSE
        dscp_map{0-63:18}
        next_action continue
    }
}
action {
    module tokenmt
    name meterftp
    params {
        committed_rate 50000000
        committed_burst 50000000
        red_action_name AF31
        green_action_name markAF22
        global_stats TRUE
    }
}
action {
    module dscpmk
    name markAF31
    params {
        global_stats TRUE
        dscp_map{0-63:26}
        next_action continue
    }
}
action {
    module dscpmk
    name markAF22
    params {
        global_stats TRUE
        dscp_map{0-63:20}
        next_action continue
    }
}</pre>
</td></table><br>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p180.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p182.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

