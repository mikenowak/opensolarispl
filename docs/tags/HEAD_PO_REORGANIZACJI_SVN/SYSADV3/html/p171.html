<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p168.html#ipqos-intro-1">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p170.html#ipqos-intro-11">Differentiated Services Model</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p170.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p172.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipqos-intro-20"></A><h3>Marker (<tt>dscpmk</tt> and <tt>dlcosmk</tt>) Overview</h3>
<p><A NAME="indexterm-3023"></A><A NAME="indexterm-3024"></A>In the Diffserv model, the <b>marker</b> marks a
packet with a value that reflects a forwarding behavior. <b>Marking</b> is
the process of placing a value in the packet's header to indicate how to forward
the packet to the network. IPQoS contains two marker modules:</p>
<ul><li><p><A NAME="indexterm-3025"></A><A NAME="indexterm-3026"></A><A NAME="indexterm-3027"></A><tt>dscpmk</tt> -
Marks the DS field in an IP packet header with a numeric value that is called
the <b>Differentiated Services codepoint</b>, or <b>DSCP</b>.
A Diffserv-aware router can then use the DS codepoint to apply the appropriate
forwarding behavior to the packet.</p>
</li>
<li><p><A NAME="indexterm-3028"></A><A NAME="indexterm-3029"></A><A NAME="indexterm-3030"></A><A NAME="indexterm-3031"></A><tt>dlcosmk</tt> - Marks the virtual local area
network (VLAN) tag of an Ethernet frame header with a numeric value that is
called the <b>user priority</b>. The user priority indicates
the <b>class of service (CoS)</b>, which defines the appropriate
forwarding behavior to be applied to the datagram.</p>
<p><tt>dlcosmk</tt> is
an IPQoS addition that is not part of the Diffserv model, as designed by the
IETF.</p>
</li>
</ul>
<p>For information on implementing a marker strategy for the QoS policy,
see <A HREF="p176.html#ipqos-config-planning-45">How to Plan Forwarding Behavior</A>.</p>
<A NAME="ipqos-intro-505"></A><h3>Flow Accounting (<tt>flowacct</tt>)
Overview</h3>
<p><A NAME="indexterm-3032"></A><A NAME="indexterm-3033"></A>IPQoS adds the <tt>flowacct</tt> accounting module to
the Diffserv model. You can use <tt>flowacct</tt> to gather statistics
on traffic flows, and bill customers in agreement with their SLAs. Flow accounting
is also useful for capacity planning and system monitoring.</p>
<p><A NAME="indexterm-3034"></A>The <tt>flowacct</tt> module works with the <tt>acctadm</tt> command to create an accounting log file. A basic log includes
the IPQoS 5-tuple and two additional attributes, as shown in the following
list:</p>
<ul><li><p>Source address</p>
</li>
<li><p>Source port</p>
</li>
<li><p>Destination address</p>
</li>
<li><p>Destination port</p>
</li>
<li><p>Protocol number</p>
</li>
<li><p>Number of packets</p>
</li>
<li><p>Number of bytes</p>
</li>
</ul>
<p>You can also gather statistics on other attributes, as described in <A HREF="p186.html#ipqos-accounting-2">Recording Information About Traffic Flows</A>,
and in the <tt>flowacct</tt>(7ipp) and <tt>acctadm</tt>(1M)
man pages.</p>
<p>For information on planning a flow-accounting strategy, see <A HREF="p176.html#ipqos-config-planning-18">How to Plan for Flow Accounting</A>.</p>
<A NAME="ipqos-intro-120"></A><h3>How Traffic Flows Through the IPQoS Modules</h3>
<p><A NAME="indexterm-3035"></A><A NAME="indexterm-3036"></A>The next figure shows a path that incoming traffic might take
through some of the IPQoS modules.</p>
<A NAME="ipqos-intro-fig-2"></A><p><b>Figure 32-1 </b>Traffic Flow Through the IPQoS Implementation
of the Diffserv Model</p>
<IMG src="figures/diffserv-mod.gif" class="figure" alt="The context follows the graphic, which is a flow diagram." title="The context follows the graphic, which is a flow diagram."><p>This figure illustrates a common traffic flow sequence on an IPQoS-enabled
machine:</p>
<ol Type="1"><li><p>The classifier selects from the packet stream all packets
that match the filtering criteria in the system's QoS policy.</p>
</li>
<li><p>The selected packets are then evaluated for the next action
to be taken.</p>
</li>
<li><p>The classifier sends to the marker any traffic that does not
require flow control.</p>
</li>
<li><p>Traffic to be flow-controlled is sent to the meter.</p>
</li>
<li><p>The meter enforces the configured rate. Then, the meter assigns
a traffic conformance value to the flow-controlled packets.</p>
</li>
<li><p>The flow-controlled packets are then evaluated to determine
if any packets require accounting.</p>
</li>
<li><p>The meter sends  to the marker any traffic that does not require
flow accounting.</p>
</li>
<li><p>The flow-accounting module gathers statistics on received
packets. The module then sends the packets to the marker.</p>
</li>
<li><p>The marker assigns a DS codepoint to the packet header. This
DSCP indicates the per-hop behavior that a Diffserv-aware system must apply
to the packet.</p>
</li>
</ol>
<A NAME="ipqos-intro-54"></A><h2>Traffic Forwarding on an IPQoS-Enabled Network</h2>
<p><A NAME="indexterm-3037"></A>This section introduces the elements that are involved in forwarding
packets on an IPQoS-enabled network. An IPQoS-enabled system handles any packets
on the network stream with the system's IP address as the destination. The
IPQoS system then applies its QoS policy to the packet to establish differentiated
services.</p>
<A NAME="ipqos-intro-99"></A><h3>DS Codepoint</h3>
<p><A NAME="indexterm-3038"></A><A NAME="indexterm-3039"></A>The DS codepoint (DSCP) defines in the packet header the action
that any Diffserv-aware system should take on a marked packet. The diffserv
architecture defines a set of DS codepoints for the IPQoS-enabled system and
diffserv router to use. The Diffserv architecture also defines a set of  actions
that are called <b>forwarding behaviors</b>, which correspond
to the DSCPs. The IPQoS-enabled system marks the precedence bits of the DS
field in the packet header with the DSCP. When a router receives a packet
with a DSCP value, the router applies the forwarding behavior that is associated
with that DSCP. The packet is then released onto the network. </p>
<p><hr size="1" noshade><p><b>Note - </b>The <tt>dlcosmk</tt> marker does not use the DSCP. Rather, <tt>dlcosmk</tt> marks Ethernet frame headers with a CoS value. If you plan
to configure IPQoS on a network that uses VLAN devices, refer to <A HREF="p189.html#ipqos-reference-11">Marker Module</A>.</p>
<hr size="1" noshade></p><A NAME="ipqos-intro-10"></A><h3>Per-Hop Behaviors</h3>
<p><A NAME="indexterm-3040"></A><A NAME="indexterm-3041"></A><A NAME="indexterm-3042"></A>In Diffserv terminology, the forwarding behavior that is assigned
to a DSCP is called the <b>per-hop behavior (PHB)</b>. The PHB
defines the forwarding precedence that a marked packet receives in relation
to other traffic on the Diffserv-aware system. This precedence ultimately
determines whether the IPQoS-enabled system or Diffserv router forwards or
drops the marked packet. For a forwarded packet, each Diffserv router that
the packet encounters en route to its destination applies the same PHB. The
exception is if another Diffserv system changes the DSCP. For more information
on PHBs, refer to <A HREF="p189.html#ipqos-reference-330">Using the <tt>dscpmk</tt> Marker for Forwarding Packets</A>.</p>
<p>The goal of a PHB is to provide a specified amount of network resources
to a class of traffic on the contiguous network. You can achieve this goal
in the QoS policy. Define DSCPs that indicate the precedence levels for traffic
classes when the traffic flows leave the IPQoS-enabled system. Precedences
can  range from high-precedence/low-drop probability to low-precedence/high-drop
probability. </p>
<p>For example, your QoS policy can assign to one class of traffic a DSCP
that guarantees a low-drop PHB. This traffic class then receives a low-drop
precedence PHB from any Diffserv-aware router, which guarantees bandwidth
to packets of this class. You can add to the QoS policy other DSCPs that assign
varying levels of precedence to other traffic classes. The lower-precedence
packets are given bandwidth by Diffserv systems in agreement with the priorities
that are indicated in the packets' DSCPs.</p>
<p>IPQoS supports two types of forwarding behaviors, which are defined
in the Diffserv architecture, expedited forwarding and assured forwarding. </p>
<A NAME="ipqos-intro-100"></A><h4>Expedited Forwarding</h4>
<p><A NAME="indexterm-3043"></A><A NAME="indexterm-3044"></A><A NAME="indexterm-3045"></A><A NAME="indexterm-3046"></A>The <b>expedited forwarding (EF)</b> per-hop behavior
assures that any traffic class with EFs related DSCP is given highest priority.
 Traffic with an EF DSCP is not queued. EF provides low loss, latency, and
jitter. The recommended DSCP for EF is 101110. A packet that is marked with
101110 receives guaranteed low-drop precedence as the packet traverses Diffserv-aware
networks en route to its destination. Use the EF DSCP when assigning priority
to customers or applications with a premium SLA.</p>
<A NAME="ipqos-intro-110"></A><h4>Assured Forwarding</h4>
<p><A NAME="indexterm-3047"></A><A NAME="indexterm-3048"></A><A NAME="indexterm-3049"></A>The <b>assured forwarding (AF)</b> per-hop behavior
provides four different forwarding classes that you can assign to a packet.
Every forwarding class provides three drop precedences, as shown in <A HREF="p189.html#ipqos-reference-tbl-16">Table 37-2</A>. </p>
<p>The various AF codepoints provide the ability to assign different levels
of service to customers and applications. In the QoS policy,  you can prioritize
traffic and services  on your network when you plan the QoS policy. You can
then assign different AF levels to the prioritized traffic.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p170.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p172.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

