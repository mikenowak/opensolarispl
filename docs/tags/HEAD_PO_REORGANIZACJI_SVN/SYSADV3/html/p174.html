<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p173.html#ipqos-config-planning-1">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p173.html#ipqos-config-planning-7">Planning the Quality-of-Service Policy</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p173.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p175.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipqos-config-planning-32"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Prepare a Network for IPQoS</h3>
<p>The following procedure lists general planning tasks to do before you
create the QoS policy.</p>
<ol><A NAME="ipqos-config-planning-step-37"></A><li><p><b>Review your network topology.
Then, plan a strategy that uses IPQoS systems and Diffserv routers.</b></p><p>For
topology examples, see <A HREF="p173.html#ipqos-config-planning-5">Planning the Diffserv Network Topology</A>.</p>
</li>
<A NAME="ipqos-config-planning-step-350"></A><li><p><b>Identify the hosts in the
topology that require IPQoS or that might become good candidates for IPQoS
service.</b></p></li>
<A NAME="ipqos-config-planning-step-360"></A><li><p><b>Determine which IPQoS-enabled
systems could use the same QoS policy.</b></p><p>For example, if you plan
to enable IPQoS on all hosts on the network, identify any hosts that could
use the same QoS policy. Each IPQoS-enabled system must have a local QoS policy,
which is implemented in its IPQoS configuration file. However, you can create
one IPQoS configuration file to be used by a range of systems. You can then
copy the configuration file to every system with the same QoS policy requirements.</p>
</li>
<A NAME="ipqos-config-planning-step-340"></A><li><p><b>Review and perform any planning
tasks that are required by the Diffserv router on your network.</b></p><p>Refer
to the router documentation and the router manufacturer's web site for details.</p>
</li>
</ol><A NAME="ipqos-config-planning-14"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Define the Classes for Your
QoS Policy</h3>
<p>The first step in defining the QoS policy is organizing traffic flows
into classes. You do not need to create classes for every type of traffic
on a Diffserv network. Moreover, depending on your network topology, you might
have to create a different QoS policy for each IPQoS-enabled system.</p>
<p><hr size="1" noshade><p><b>Note - </b>For an overview of classes, see <A HREF="p170.html#ipqos-intro-26">IPQoS Classes</A>.</p>
<hr size="1" noshade></p><p>The next procedure assumes that you have determined which systems on
your network are to be IPQoS-enabled, as identified in <A HREF="p174.html#ipqos-config-planning-32">How to Prepare a Network for IPQoS</A>.</p>
<ol><A NAME="ipqos-config-planning-step-39"></A><li><p><b>Create a QoS planning table
for organizing the QoS policy information.</b></p><p>For suggestions, refer
to <A HREF="p173.html#ipqos-config-planning-tbl-28">Table 33-1</A>. </p>
</li>
<A NAME="ipqos-config-planning-step-40"></A><li><p><b>Perform the remaining steps
for every QoS policy that is on your network.</b></p></li>
<A NAME="ipqos-config-planning-step-38"></A><li><p><b>Define the classes to be used
in the QoS policy.</b></p><p>The following questions are a guideline for
analyzing network traffic for possible class definitions.</p>
<ul><li><p><b>Does your company offer service-level
agreements to customers?</b></p>
<p>If yes, then evaluate the
relative priority levels of the SLAs that your company offers to customers.
The same applications might be offered to customers who are guaranteed different
priority levels.</p>
<p>For example, your company might offer web site
hosting to each customer, which indicates that you need to define a class
for each customer web site. One SLA might provide a premium web site as one
service level.  Another SLA might offer a "best-effort" personal
web site to discount customers. This factor indicates not only different web
site classes but also potentially different per-hop behaviors that are assigned
to the web site classes.</p>
</li>
<li><p><b>Does the IPQoS system offer popular
applications that might need flow control?</b></p>
<p>You can
improve network performance by enabling IPQoS on servers offering popular
applications that generate excessive traffic. Common examples are electronic
mail, network news, and FTP. Consider creating separate classes for incoming
and outgoing traffic for each service type, where applicable. For example,
you might create a <tt>mail-in</tt> class and a <tt>mail-out</tt> class
for the QoS policy for a mail server.</p>
</li>
<li><p><b>Does your network run certain applications
that require highest-priority forwarding behaviors?</b></p>
<p><A NAME="indexterm-3072"></A>Any critical applications that require highest-priority forwarding
behaviors must receive highest priority in the router's queue. Typical examples
are streaming video and streaming audio. </p>
<p>Define incoming classes
and outgoing classes for these high-priority applications. Then, add the classes
to the QoS policies of both the IPQoS-enabled system that serves the applications
and the Diffserv router. </p>
</li>
<li><p><b>Does your network experience traffic
flows that must be controlled because the flows consume large amounts of bandwidth?</b></p>
<p><A NAME="indexterm-3073"></A>Use <tt>netstat</tt>, <tt>snoop</tt>, and
other network monitoring utilities to discover the types of traffic that are
causing problems on the network. Review the classes that you have created
thus far, and then create new classes for any undefined problem traffic category.
If you have already defined classes for a category of problem traffic, then
define rates for the meter to control the problem traffic.</p>
<p>Create
classes for the problem traffic on every IPQoS-enabled system on the network.
Each IPQoS system can then handle any problem traffic  by limiting the rate
at which the traffic flow is released onto the network. Be sure also to define
these problem classes in the QoS policy on the Diffserv router. The router
can then queue and schedule the problem flows as configured in its QoS policy.</p>
</li>
<li><p><b>Do you need to obtain statistics on
certain types of traffic?</b></p>
<p>A quick review of an SLA
can indicate which types of customer traffic require accounting. If your site
does offer SLAs, you probably have already created classes for traffic that
requires accounting. You might also define classes to enable statistics gathering
on traffic flows that you are monitoring. You could also create classes for
traffic to which you  restrict access for security reasons.</p>
</li>
</ul>
</li>
<A NAME="ipqos-config-planning-step-41"></A><li><p><b>List the classes that you have
defined in the QoS planning table you created in Step 1.</b></p></li>
<A NAME="ipqos-config-planning-step-33"></A><li><p><b>Assign a priority level to
each class.</b></p><p>For example, have priority level 1 represent the 
highest-priority class, and assign descending-level priorities to the remaining
classes. The priority level that you assign is for organizational purposes
only. Priority levels that you set in the QoS policy template are not actually
used by IPQoS. Moreover, you can assign the same priority to more than one
class, if appropriate for your QoS policy. </p>
</li>
<A NAME="ipqos-config-planning-step-52"></A><li><p><b>When you finish defining classes,
you next define filters for each class, as explained in <A HREF="p175.html#ipqos-config-planning-42">How to Define Filters in the QoS Policy</A>.</b></p></li>
</ol><h5>More Information<br>Prioritizing the Classes</h5>
<p>As you create classes, you quickly realize which classes have highest
priority, medium priority, and best-effort priority. A good scheme for prioritizing
classes becomes particularly important when you assign per-hop behaviors to
outgoing traffic, as explained in <A HREF="p176.html#ipqos-config-planning-45">How to Plan Forwarding Behavior</A>. </p>
<p>In addition to assigning a PHB to a class, you can also define a priority
selector in a filter for the class. The priority selector is active on the
IPQoS-enabled host only. Suppose several classes with equal rates and identical
DSCPs sometimes compete for bandwidth as they leave the IPQoS system. The
priority selector in each class can further order the level of service that
is given to the otherwise identically valued classes.</p>
<A NAME="ipqos-config-planning-483"></A><h3>Defining Filters</h3>
<p><A NAME="indexterm-3074"></A><A NAME="indexterm-3075"></A>You create filters to identify packet flows as members of a particular
class. Each filter contains selectors, which define the criteria for evaluating
a packet flow. The IPQoS-enabled system then uses the criteria in the selectors
to extract packets from a traffic flow. The IPQoS system then associates the
packets with a class.  For an introduction to filters, see <A HREF="p170.html#ipqos-intro-27">IPQoS Filters</A>.</p>
<p><A NAME="indexterm-3076"></A>The following table lists the most commonly used selectors. The
first five selectors represent the IPQoS 5-tuple, which the IPQoS system uses
to identify packets as members of a flow. For a complete list of selectors,
see <A HREF="p188.html#ipqos-reference-tbl-32">Table 37-1</A>.</p>
<A NAME="ipqos-config-planning-tbl-47"></A><p><b>Table 33-2 </b>Common
IPQoS Selectors</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Name</p></th><th scope="col"><p>Definition</p></th></tr>
<tr><td><p><tt>saddr</tt></p></td><td><p>Source address.</p></td></tr>
<tr><td><p><tt>daddr</tt></p></td><td><p>Destination address.</p></td></tr>
<tr><td><p><tt>sport</tt></p></td><td><p>Source port number. You can use a well-known port number, as defined
in <tt>/etc/services</tt>, or a user-defined port number.</p></td></tr>
<tr><td><p><tt>dport</tt></p></td><td><p>Destination port number.</p></td></tr>
<tr><td><p><tt>protocol</tt></p></td><td><p>IP protocol number or protocol name that is assigned to the traffic
flow type in <tt>/etc/protocols</tt>.</p></td></tr>
<tr><td><p><tt>ip_version</tt></p></td><td><p>Addressing style to use. Use either IPv4 or IPv6. IPv4 is the default.</p></td></tr>
<tr><td><p><tt>dsfield</tt></p></td><td><p>Contents of the DS field, that is, the DSCP. Use this selector for extracting
incoming packets that are already marked with a particular DSCP.</p></td></tr>
<tr><td><p><tt>priority</tt></p></td><td><p>Priority level that is assigned to the class. For more information,
see <A HREF="p174.html#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</A>.</p></td></tr>
<tr><td><p><tt>user</tt></p></td><td><p>Either the UNIX user ID or user name that is used when the upper-level
application is executed.</p></td></tr>
<tr><td><p><tt>projid</tt></p></td><td><p>Project ID that is used when the upper-level application is executed.</p></td></tr>
<tr><td><p><tt>direction</tt></p></td><td><p>Direction of traffic flow. Value is either <tt>LOCAL_IN</tt>, <tt>LOCAL_OUT</tt>, <tt>FWD_IN</tt>, or <tt>FWD_OUT</tt>.</p></td></tr>
</table><p><hr size="1" noshade><p><b>Note - </b>Be judicious in your choice of selectors. Use only as many selectors
as you need to extract packets for a class. The more selectors that you define,
the greater the impact on IPQoS performance.</p>
<hr size="1" noshade></p>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p173.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p175.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

