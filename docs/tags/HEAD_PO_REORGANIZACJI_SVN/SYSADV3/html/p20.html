<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p17.html#ipconfig-1">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p19.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p21.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="gcvjj"></A><h2>Packet Forwarding and Routing on IPv4 Networks</h2>
<p>This section contains
procedures and examples that show how to configure forwarding and routing
for routers and hosts on IPv4 networks.</p>
<p><A NAME="indexterm-509"></A><b>Packet forwarding</b> is the basic method for
sharing information across systems on a network. Packets are transferred between
a source interface and a destination interface, usually on two different systems.
When you issue a command or send a message to a nonlocal interface, your system
forwards those packets onto the local network. The interface with the destination
IP address that is specified in the packet headers then retrieves the packets
from the local network. If the destination address is not on the local network,
the packets are then forwarded to the next adjacent network, or <b>hop</b>.
By default, packet forwarding is automatically configured when you install
the Solaris OS.<A NAME="indexterm-510"></A><A NAME="indexterm-511"></A><A NAME="indexterm-512"></A></p>
<p><A NAME="indexterm-513"></A><A NAME="indexterm-514"></A><A NAME="indexterm-515"></A><b>Routing</b> is the process by which systems decide
where to send a packet. Routing protocols on a system "discover"
the other systems on the local network. When the source system and the destination system are
on the same local network, the path that packets travel between them is called
a <b>direct route</b>. If a packet must travel at least one
hop beyond its source system, the path between the source system and destination system is called
an <b>indirect route</b>. The routing protocols learn the path
to a destination interface and retain data about known routes in the system's <b>routing table</b>. <A NAME="indexterm-516"></A></p>
<p><A NAME="indexterm-517"></A><b>Routers</b> are specially configured systems
with multiple physical interfaces that connect the router to more than one
local network. Therefore, the router can forward packets beyond the home LAN,
regardless of whether the router runs a routing protocol. For more information
about how routers forward packets, refer to <A HREF="p8.html#ipplan-37">Planning for Routers on Your Network</A>. </p>
<p><A NAME="indexterm-518"></A><b>Routing protocols</b> handle routing activity on a system and, by exchanging routing information with other hosts, maintain
known routes to remote networks. Both routers
and hosts can run routing protocols. The routing protocols
on the host communicate with routing daemons on other routers and hosts. These protocols assist
the host in determining where to forward packets. When network interfaces  are
enabled, the system
automatically communicates with the routing daemons. These daemons monitor
routers on the network and advertise the routers' addresses to the hosts
on the local network. Some routing protocols, though not all, also maintain
statistics that you can use to measure routing performance.  Unlike packet forwarding, you must explicitly configure routing
on a Solaris system.  </p>
<p>This section contains tasks for administering packet forwarding and
routing on IPv4 routers and hosts. For information about routing on an IPv6-enabled
network, refer to <A HREF="p34.html#ipv6-config-tasks-5">Configuring an IPv6 Router</A>.</p>
<A NAME="gcxjj"></A><h3>Routing Protocols Supported by the Solaris OS</h3>
<p><A NAME="indexterm-519"></A><A NAME="indexterm-520"></A><A NAME="indexterm-521"></A><A NAME="indexterm-522"></A><A NAME="indexterm-523"></A>Routing protocols are classified as
interior gateway protocols (IGPs), exterior gateway protocols (EGPs), or a combination
of both. <b>Interior gateway protocols</b>  exchange routing information between
routers on networks under common administrative control. In the network topology shown in <A HREF="p20.html#gdcvl">Figure 5-2</A>, the routers run an IGP for exchanging
routing information. <b>Exterior gateway protocols</b> enable
the router that connects the local internetwork to an external network to
exchange information with another router on the external network. For example,
the router that connects a corporate network to an ISP runs an EGP to exchange
routing information with its router counterpart at the ISP. Border Gateway
Protocol (BGP) is a popular EGP that is used for carrying  routing information
between different organizations and IGPs.</p>
<p>The following table provides information about the Solaris routing protocols
and the location of each protocol's associated documentation. </p>
<A NAME="gcxiw"></A><p><b>Table 5-1 </b>Solaris Routing Protocols</p>
<A NAME="indexterm-524"></A>
<table cellspacing="5" border="1">
<tr><th scope="col"><p>Protocol</p></th><th scope="col"><p>Associated Daemon</p></th><th scope="col"><p>Description</p></th><th scope="col"><p>For Instructions</p></th></tr>
<tr><td><p>Routing Information Protocol (RIP)</p></td><td><p><tt>in.routed</tt></p></td><td><p>IGP that routes IPv4 packets and maintains a routing table</p></td><td><p><A HREF="p20.html#ipconfig-118">How to Configure an IPv4 Router</A>&nbsp;</p></td></tr>
<tr><td><p>Internet Control Message Protocol (ICMP) Router Discovery</p></td><td><p><tt>in.routed</tt></p></td><td><p>Used by hosts to discover the presence of a router on the network</p></td><td><p><A HREF="p22.html#ipconfig-125">How to Enable Static Routing on a Single-Interface Host</A> and <A HREF="p22.html#ipconfig-15">How to Enable Dynamic Routing on a Single-Interface Host</A></p></td></tr>
<tr><td><p>Routing Information Protocol, next generation (RIPng) Protocol</p></td><td><p><tt>in.ripngd</tt></p></td><td><p>IGP that routes IPv6 packets and maintains a routing table</p></td><td><p><A HREF="p34.html#ipv6-config-tasks-21">How to Configure an IPv6-Enabled Router</A>&nbsp;</p></td></tr>
<tr><td><p>Neighbor Discovery (ND) Protocol</p></td><td><p><tt>in.ndpd</tt></p></td><td><p>Advertises the presence of an IPv6 router and discovers the presence
of IPv6 hosts on a network</p></td><td><p><A HREF="p33.html#ipv6-config-tasks-64">Configuring an IPv6 Interface</A>&nbsp;</p></td></tr>
</table><A NAME="gcxjg"></A><h3>IPv4 Autonomous System Topology</h3>
<p><A NAME="indexterm-525"></A>Sites with multiple routers and networks
typically administer their network topology as a single routing domain, or  <b>autonomous
system (AS)</b> . The following figure shows a typical
network topology that would
be considered a small AS. This topology is referenced in
the examples throughout this section.</p>
<A NAME="gdcvl"></A><p><b>Figure 5-2 </b>Autonomous System With Multiple IPv4 Routers</p>
<A NAME="indexterm-526"></A><IMG src="figures/nwt_multpl_routers.gif" class="figure" alt="This topology diagram of an autonomous system is explained
in the following context." title="This topology diagram of an autonomous system is explained
in the following context."><p>The figure shows an AS that is divided into three local networks, <tt>10.0.5.0</tt>, <tt>172.20.1.0</tt>, and <tt>192.168.5</tt>. Four routers share
packet-forwarding and routing responsibilities. The AS  includes the following types of systems:</p>
<ul><li><p><A NAME="indexterm-527"></A><A NAME="indexterm-528"></A><A NAME="indexterm-529"></A><A NAME="indexterm-530"></A><b>Border routers</b> connect
an AS
to an external network, such as the Internet. Border routers interconnect
with networks external to the IGP running on the local AS. A border router can run an EGP, such as Border
Gateway Protocol (BGP), to exchange information with external routers, for
example, the routers at the ISP. In <A HREF="p20.html#gdcvl">Figure 5-2</A>,
the border router's interfaces connect to internal network <tt>10.0.5.0</tt> and
to a high-speed router to a service provider.</p>
<p>For information on configuring a border router,
refer to the <A  HREF="http://quagga.net/docs/docs-info.php#SEC72">Open Source Quagga documentation</A> for BGP.</p>
<p><A NAME="indexterm-531"></A> If you plan to use BGP to connect your AS to the Internet, you
should obtain an autonomous system number (ASN) from the Internet Registry
for your locale. Regional registries, such as the American Registry for Internet
Numbers (ARIN), offer guidelines on how to obtain an ASN. For example, the<A  HREF="http://www.arin.net/policy/nrpm.html#five"> ARIN Number
Resource Policy Manual</A> contains instructions for getting an ASN for
autonomous systems in the United States and Canada. Alternatively, your ISP
might be able to obtain an ASN for you.</p>
</li>
<li><p><A NAME="indexterm-532"></A><A NAME="indexterm-533"></A><b>Default routers</b> maintain routing information
about all the systems on the local network. These routers typically run IGPs
such as RIP. In <A HREF="p20.html#gdcvl">Figure 5-2</A>, Router
1s interfaces
are connected to internal network <tt>10.0.5.0</tt> and internal
network <tt>192.168.5</tt>. Router 1 also serves as the default
router for <tt>192.168.5</tt>. Router 1 maintains routing information
for all systems on <tt>192.168.5</tt> and routes to other routers,
such as the border router. Router 2s interfaces connect to internal network <tt>10.0.5.0</tt> and internal network <tt>172.20.1</tt>. </p>
<p>For an example of configuring a default router, refer to <A HREF="p20.html#gcvjm">Example 5-4</A>.</p>
</li>
<li><p><A NAME="indexterm-534"></A><A NAME="indexterm-535"></A><b>Packet-forwarding routers</b> forward packets
but do not run routing protocols. This type of router receives packets from
one of its interfaces that is connected to a single  network. These packets
are then forwarded through another interface on the router to another local network.
In <A HREF="p20.html#gdcvl">Figure 5-2</A>, Router 3 is a packet-forwarding router with connections
to networks <tt>172.20.1</tt> and <tt>192.168.5</tt>. </p>
</li>
<li><p><A NAME="indexterm-536"></A><A NAME="indexterm-537"></A><b>Multihomed hosts</b> have two or more interfaces
that are connected to the same network segment. A multihomed host can forward
packets, which is the default for all systems that run the Solaris OS. <A HREF="p20.html#gdcvl">Figure 5-2</A> shows a multihomed host with both
interfaces connected to network <tt>192.168.5</tt>. For an example
of configuring a multihomed host, refer to <A HREF="p21.html#geegh">Example 5-6</A>.</p>
</li>
<li><p><A NAME="indexterm-538"></A><b>Single interface hosts</b> rely on the local
routers, not only for packet forwarding but also for receiving valuable configuration
information. <A HREF="p20.html#gdcvl">Figure 5-2</A> includes Host
A on the <tt>192.168.5</tt> network, which implements dynamic routing,
and Host B on the <tt>172.20.1</tt> network, which implements static
routing.  To configure
a host to run dynamic routing, refer to <A HREF="p22.html#ipconfig-15">How to Enable Dynamic Routing on a Single-Interface Host</A>. To
configure a host to run static routing, refer to <A HREF="p22.html#ipconfig-125">How to Enable Static Routing on a Single-Interface Host</A>.</p>
</li>
</ul>
<A NAME="ipconfig-116"></A><h3>Configuring an IPv4 Router</h3>
<p><A NAME="indexterm-539"></A><A NAME="indexterm-540"></A><A NAME="indexterm-541"></A><A NAME="indexterm-542"></A>This section contains a procedure and example for configuring an IPv4
router. To configure an IPv6-enabled router, refer to <A HREF="p34.html#ipv6-config-tasks-21">How to Configure an IPv6-Enabled Router</A>.</p>
<p>Because a router provides the interface between two or more networks,
you must assign a unique name and IP address to each of the router's physical
network interfaces. Thus, each router has a host name and an IP address that
are associated with its primary network interface, in addition to a minimum of one
more unique name and IP address for each additional network interface. </p>
<p>You can also use the following procedure to configure a system with only one
physical interface (by default, a host) to be a router. You might configure
a single interface system as a router if the system serves as one endpoint
on a PPP link, as explained in "Planning a Dial-up PPP Link" in <i>System Administration Guide: Network Services</i>. </p>
<p><hr size="1" noshade><p><b>Note - </b>You can configure all interfaces of a router during Solaris system
installation. For instructions, see <i>Solaris Express Installation Guide: Basic Installations</i>.</p>
<hr size="1" noshade></p><A NAME="ipconfig-118"></A><h4><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Configure an IPv4 Router</h4>
<p>The following instructions assume that you are configuring interfaces
for the router after installation.</p>
<h5>Before You Begin</h5><p><A NAME="indexterm-543"></A><A NAME="indexterm-544"></A><A NAME="indexterm-545"></A><A NAME="indexterm-546"></A>After the router is physically installed on the network, configure
the router to operate in local files mode, as described in <A HREF="p18.html#ipconfig-64">How to Configure a Host for Local Files Mode</A>.
This configuration ensures that routers boot if the network configuration
server is down.  </p>
<ol><li><p><b>On the system to be configured as a router, assume the Primary
Administrator role or become superuser.</b></p><p>The Primary Administrator
role includes the Primary Administrator profile. To create the role and assign
the role to a user, see Chapter 2, "Working With the Solaris Management Console (Tasks)," in <i>System Administration Guide: Basic Administration</i>.</p>
</li>
<li><p><b>Use the <tt>dladm show-link</tt> command
to determine which interfaces are physically installed on the router.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>dladm show-link</b></tt></pre>
</td></table><br><p>The following example output from <tt>dladm show-link</tt> indicates
that a <tt>qfe</tt> NIC with four interfaces and two <tt>bge</tt> interfaces
are physically available on the system.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>qfe0             type: legacy    mtu: 1500       device: qfe0
qfe1             type: legacy    mtu: 1500       device: qfe1
qfe2             type: legacy    mtu: 1500       device: qfe0
qfe3             type: legacy    mtu: 1500       device: qfe1
bge0             type: non-vlan  mtu: 1500       device: bge0
bge1             type: non-vlan  mtu: 1500       device: bge1</pre>
</td></table><br></li>
<A NAME="eypqa"></A><li><p><b>Review which interfaces on the router were configured
and plumbed during installation.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig -a</b></tt></pre>
</td></table><br><p>The following example output from <tt>ifconfig -a</tt> shows
that the interface <tt>qfe0</tt> was configured during installation.
This interface is on the <tt>172.16.0.0</tt> network. The remaining
interfaces on the <tt>qfe</tt> NIC, <tt>qfe1</tt> - <tt>qfe3</tt>, and the <tt>bge</tt> interfaces have not been configured.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>lo0: flags=1000849 &lt;UP,LOOPBACK,RUNNING,MULTICAST,IPv4> mtu 8232 index 1
        inet 127.0.0.1 netmask ff000000 
qfe0: flags=1000843 &lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
        inet 172.16.26.232 netmask ffff0000 broadcast 172.16.26.255
        ether 0:3:ba:11:b1:15 
         </pre>
</td></table><br></li>
<li><p><b>Configure and
plumb another interface.<A NAME="indexterm-547"></A><A NAME="indexterm-548"></A></b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig</b></tt> <i>interface</i> <tt><b>plumb up</b></tt></pre>
</td></table><br><p>For example, for <tt>qfe1</tt>, you would type:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig qfe1 plumb up</b></tt></pre>
</td></table><br><p><hr size="1" noshade><p><b>Note - </b>Interfaces that are explicitly configured with the <tt>ifconfig</tt> command
do not persist across reboots.</p>
<hr size="1" noshade></p></li>
<li><p><b>Assign an IPv4 address and a netmask to the interface.</b></p><hr size="1" noshade><p><IMG ALT="Caution" src="graphics/caution.gif">  <b>Caution - </b>You can configure an IPv4 routers to receive its IP address
through DHCP, but this is recommended only for very experienced DHCP system
administrators.</p><hr size="1" noshade><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig</b></tt> <i>interface IPv4-address</i> <tt><b>netmask+</b></tt><i>netmask</i></pre>
</td></table><br><p>For example, to assign the IP address <tt>192.168.84.3</tt> to <tt>qfe1</tt>, do either of the following:</p>
<ul><li><p>Using traditional IPv4 notation, type the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig qfe1 192.168.84.3 netmask + 255.255.255.0</b></tt></pre>
</td></table><br></li>
<li><p>Using CIDR notation, type the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig qfe1 192.168.84.3/24</b></tt></pre>
</td></table><br><p>The prefix <tt>/24</tt> automatically assigns the <tt>255.255.255.0</tt> netmask to <tt>qfe1</tt>. For a table of CIDR prefixes
and their dotted-decimal netmask equivalents, refer to <A HREF="p7.html#eypku">Figure 2-2</A>.</p>
</li>
</ul>
</li>
<A NAME="ipconfig-step-120"></A><li><p><b><A NAME="indexterm-549"></A><A NAME="indexterm-550"></A>(Optional)
To ensure that the interface configuration persists across reboots, create an <tt>/etc/hostname.</tt><i>interface</i> file for each additional physical
interface .</b></p><p>For example, you would
create the <tt>/etc/hostname.qfe1</tt> and <tt>/etc/hostname.qfe2</tt> files. Then you would type the host name <tt>timbuktu</tt> in <tt>/etc/hostname.qfe1</tt> file and host name <tt>timbuktu-201</tt> in <tt>/etc/hostname.qfe1</tt> . For more information
about configuring single interfaces, refer to <A HREF="p26.html#fpdcn">How to Configure a Physical Interface After System Installation</A>.</p>
<p>Be sure to
do a configuration reboot after creating this file:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>reboot -- -r</b></tt></pre>
</td></table><br></li>
<A NAME="ipconfig-step-122"></A><li><p><b><A NAME="indexterm-551"></A>Add the host name and IP address of each interface to the <tt>/etc/inet/hosts</tt> file. </b></p><p>For example:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>172.16.26.232      deadsea        #interface for network 172.16.0.0
192.168.200.20     timbuktu       #interface for network 192.168.200
192.168.201.20     timbuktu-201   #interface for network 192.168.201
192.168.200.9      gobi
192.168.200.10     mojave
192.168.200.110    saltlake
192.168.200.12     chilean</pre>
</td></table><br><p>The interfaces <tt>timbuktu</tt> and <tt>timbuktu-201</tt> are
on the same system. Notice that the network address for <tt>timbuktu-201</tt> is
different from the network interface for <tt>timbuktu</tt>. The difference
exists because the physical network media for network <tt>192.168.201</tt> is
connected to the <tt>timbuktu-201</tt> network interface while the
media for network <tt>192.168.200</tt> is connected to the <tt>timbuktu</tt> interface.</p>
</li>
<A NAME="ipconfig-step-123"></A><li><p><b><A NAME="indexterm-552"></A><A NAME="indexterm-553"></A><A NAME="indexterm-554"></A><A NAME="indexterm-555"></A><A NAME="indexterm-556"></A><A NAME="indexterm-557"></A>If the router is connected to any subnetted network, add the network
number and the netmask to the <tt>/etc/inet/netmasks</tt> file.<A NAME="indexterm-558"></A><A NAME="indexterm-559"></A><A NAME="indexterm-560"></A></b></p><ul><li><p>For traditional IPv4 address notation, such as <tt>192.168.83.0</tt>, you would type:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>192.168.83.0    255.255.255.0</pre>
</td></table><br></li>
<li><p>For CIDR addresses, use the dotted-decimal version of the prefix in the entry
in the <tt>/etc/inet/netmask</tt> file. Network prefixes and their
dotted-decimal equivalents can be found in <A HREF="p7.html#eypku">Figure 2-2</A>. For example, you would use the following entry in <tt>/etc/netmasks</tt> to express the CIDR network prefix <tt>192.168.3.0/22</tt>:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>192.168.3.0 255.255.252.0</pre>
</td></table><br></li>
</ul>
</li>
<li><p><b>Enable IPv4 packet forwarding on the router.</b></p><p>Use either of the following commands to enable packet forwarding:</p>
<ul><li><p>Use the <tt>routeadm</tt> command, as follows:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>routeadm -e ipv4-forwarding -u</b></tt></pre>
</td></table><br></li>
<li><p>Use the following service management facility (SMF) command:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>svcadm enable ipv4-forwarding</b></tt></pre>
</td></table><br></li>
</ul>
<p>At this point, the router can forward packets beyond the local network.
The router also supports <b>static routing</b>, a process where
you can manually add routes to the routing table. If you plan to use static
routing on this system, then router configuration is complete. However, you
need to maintain routes in the system routing table. For information on adding
routes, see <A HREF="p21.html#gdwbq">Configuring Routes</A> and the <tt>route</tt>(1M) man page.</p>
</li>
<li><p><b>(Optional) Start arouting protocol.</b></p><p>The routing daemon <tt>/usr/sbin/in.routed</tt> automatically updates the routing table, a process that is known
as <b>dynamic routing</b>. Turn on the default IPv4 routing protocols in either of the following ways:<A NAME="indexterm-561"></A></p>
<ul><li><p>Use the <tt>routeadm</tt> command, as follows:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>routeadm -e ipv4-routing -u</b></tt></pre>
</td></table><br></li>
<li><p>Use the following SMF command to start a routing protocol
such as RIP.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>#<tt><b> svcadm enable route:default</b></tt> </pre>
</td></table><br><p>The SMF FMRI associated with the <tt>in.routed</tt> daemon
is <tt>svc:/network/routing/route.</tt></p>
</li>
</ul>
<p>For  information about the <tt>routeadm</tt> command, see
the <tt>routeadm</tt>(1M) man
page. </p>
</li>
</ol><A NAME="gcvjm"></A><h5>Example 5-4 &nbsp;&nbsp;Configuring the Default Router for a Network</h5>
<p><A NAME="indexterm-562"></A><A NAME="indexterm-563"></A>This example shows
how to upgrade a system
with more than one interface to
become a default router.   The goal is to make Router 2, which
is shown in <A HREF="p20.html#gdcvl">Figure 5-2</A>,  the default router for network <tt>172.20.1.0</tt>. Router 2 contains two wired network connections, one connection
to network <tt>172.20.1.0</tt> and one to network <tt>10.0.5.0</tt>. The example assumes that the router operates in local files mode,
as described in <A HREF="p18.html#ipconfig-64">How to Configure a Host for Local Files Mode</A>. </p>
<p>After becoming superuser or assuming an equivalent
role, you would determine out the status of the system's interfaces.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>dladm show-link</b></tt>
ce0              type: legacy    mtu: 1500       device: ce0
bge0             type: non-vlan  mtu: 1500       device: bge0
bge1             type: non-vlan  mtu: 1500       device: bge1

# <tt><b>ifconfig -a</b></tt>
lo0: flags=1000849 &lt;UP,LOOPBACK,RUNNING,MULTICAST,IPv4> mtu 8232 index 1
        inet 127.0.0.1 netmask ff000000 
ce0: flags=1000843 &lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
        inet 172.20.1.10 netmask ffff0000 broadcast 172.20.10.100
        ether 8:0:20:c1:1b:c6 </pre>
</td></table><br><p>The output of <tt>dladm show-link</tt> indicates
that three links are available on the system. Only the <tt>ce0</tt> interface
has been plumbed. You would
begin default router configuration by physically connecting the <tt>bge0</tt> interface
to the <tt>10.0.5.0</tt> network. Then, you would plumb the interface and make
it persist across reboots.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig bge0 plumb up</b></tt>
# <tt><b>ifconfig bge0 10.0.5.10</b></tt>
# <tt><b>ifconfig -a</b></tt>
lo0: flags=1000849 &lt;UP,LOOPBACK,RUNNING,MULTICAST,IPv4> mtu 8232 index 1
        inet 127.0.0.1 netmask ff000000 
ce0: flags=1000843 &lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
        inet 172.20.1.10 netmask ffff0000 broadcast 172.255.255.255
        ether 8:0:20:c1:1b:c6 
bge0: flags=1000843 &lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
        inet 10.0.5.10 netmask ff000000 broadcast 10.255.255.255
        ether 8:0:20:e5:95:c4
 # <tt><b>vi /etc/hostname.bge0</b></tt>
<tt><b>10.0.5.10
255.0.0.0</b></tt></pre>
</td></table><br><p>Reboot the system, using the reconfiguration boot command:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>reboot -- -r</b></tt></pre>
</td></table><br><p>Continue
by configuring the following network databases
with information about the newly plumbed interface and the
network to which it is connected:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>vi /etc/inet/hosts</b></tt>
127.0.0.1       localhost
172.20.1.10        router2        #interface for network 172.20.1
<tt><b>10.0.5.10          router2-out    #interface for network 10.0.5</b></tt>
# <tt><b>vi /etc/inet/netmasks</b></tt>
172.20.1.0    255.255.0.0
<tt><b>10.0.5.0      255.0.0.0</b></tt></pre>
</td></table><br><p>Finally, use SMF
to enable packet forwarding and then enable the <tt>in.routed</tt> routing
daemon.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>svcadm enable ipv4-forwarding</b></tt>
#<tt><b> svcadm enable route:default</b></tt></pre>
</td></table><br><p>Now IPv4 packet forwarding and dynamic routing through RIP  are enabled on Router
2. However, the default
router configuration for network <tt>172.20.1.0</tt> is not yet
complete. You would need to do the following:</p>
<ul><li><p>Modify each host on <tt>172.10.1.10</tt> so that
the host gets its routing information from the new default router. For more
information, refer to <A HREF="p22.html#ipconfig-125">How to Enable Static Routing on a Single-Interface Host</A>.</p>
</li>
<li><p>Define a static route to the border router in the routing
table of Router 2. For more details, refer to <A HREF="p21.html#gdyen"> Routing Tables and Routing Types</A>.</p>
</li>
</ul>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p19.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p21.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

