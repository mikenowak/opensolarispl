<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p156.html#mpoverview">30.&nbsp;&nbsp;Introducing IPMP (Overview)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p157.html#emqqq">IPMP Failure Detection and Recovery Features</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p157.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p159.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="mpoverview-23"></A><h3>Link-Based Failure Detection</h3>
<A NAME="indexterm-2881"></A><A NAME="indexterm-2882"></A><A NAME="indexterm-2883"></A><p>Link-based failure detection is always enabled, provided that the interface
supports this type of failure detection. The following Sun network drivers
are supported in the current release of the Solaris OS:<A NAME="indexterm-2884"></A><A NAME="indexterm-2885"></A></p>
<ul><li><p><tt>hme</tt></p>
</li>
<li><p><tt>eri</tt></p>
</li>
<li><p><tt>ce</tt></p>
</li>
<li><p><tt>ge</tt></p>
</li>
<li><p><tt>bge</tt></p>
</li>
<li><p><tt>qfe</tt></p>
</li>
<li><p><tt>dmfe</tt></p>
</li>
</ul>
<p>To determine whether a third-party interface supports link-based failure
detection, refer to the manufacturer's documentation.</p>
<p>These network interface drivers monitor the interface's link state and
notify the networking subsystem when that link state changes. When  notified
of a change, the networking subsystem either sets or clears the  <tt>RUNNING</tt> flag for that interface, as appropriate. When the daemon detects
that the interface's <tt>RUNNING</tt> flag has been cleared, the
 daemon immediately fails the interface. </p>
<A NAME="emqra"></A><h3>Probe-Based Failure Detection</h3>
<A NAME="indexterm-2886"></A><A NAME="indexterm-2887"></A><p>The <tt>in.mpathd</tt> daemon performs probe-based failure
detection on each interface in the IPMP group that has a test address. Probe-based
failure detection involves the sending and receiving of ICMP probe messages
that use test addresses. These messages go out over the interface to one or
more target systems on the same IP link. For an introduction to test addresses,
refer to <A HREF="p157.html#emqvv">Test Addresses</A>. For information
on configuring test addresses, refer to <A HREF="p161.html#emqul">How to Configure an IPMP Group With Multiple Interfaces</A>.</p>
<p><A NAME="indexterm-2888"></A><A NAME="indexterm-2889"></A>The <tt>in.mpathd</tt> daemon determines which target
systems to probe dynamically. Routers that are connected to the IP link are
automatically selected as targets for probing. If no routers exist on the
link, <tt>in.mpathd</tt> sends probes to neighbor hosts on the link.
A multicast packet that is sent to the all hosts multicast address, <tt>224.0.0.1</tt> in IPv4 and <tt>ff02::1</tt> in IPv6, determines which
hosts to use as target systems. The first few hosts that respond to the echo
packets are chosen as targets for probing. If <tt>in.mpathd</tt> cannot
find routers or hosts that responded to the ICMP echo packets, <tt>in.mpathd</tt> cannot detect probe-based failures. </p>
<p>You can use host routes to explicitly configure a list of target systems
to be used by <tt>in.mpathd</tt>. For instructions, refer to <A HREF="p162.html#etmkd">Configuring Target Systems</A>.</p>
<p>To ensure that each interface in the IPMP group functions properly, <tt>in.mpathd</tt> probes all the targets separately through all the interfaces
in the IPMP group. If no replies are made in response to five consecutive
probes, <tt>in.mpathd</tt> considers the interface to have failed.
The probing rate depends on the <b>failure detection time</b> (FDT).
The default value for failure detection time is 10 seconds. However, you can
tune the failure detection time in the <tt>/etc/default/mpathd</tt> file.
For instructions, go to <A HREF="p166.html#deploynetmult-48">How to Configure the <tt>/etc/default/mpathd</tt> File</A>.<A NAME="indexterm-2890"></A><A NAME="indexterm-2891"></A><A NAME="indexterm-2892"></A></p>
<p>For a repair detection time of 10 seconds, the probing rate is  approximately
one probe every two seconds. The minimum repair detection time is twice the
failure detection time , 20 seconds by default, because replies to 10 consecutive
probes must be received. The failure  and repair detection times apply only
to probe-based failure detection.</p>
<A NAME="mpoverview-29"></A><h3>Group Failures</h3>
<A NAME="indexterm-2893"></A><A NAME="indexterm-2894"></A><p>A <b>group failure</b> occurs when all interfaces in an
IPMP group appear to fail at the same time. The <tt>in.mpathd</tt> daemon
does not perform failovers for a group failure. Also, no failover occurs when
all the target systems fail at the same time. In this instance, <tt>in.mpathd</tt> flushes all of its current target systems and discovers new target
systems.</p>
<A NAME="mpoverview-24"></A><h3>Detecting Physical Interface Repairs</h3>
<p><A NAME="indexterm-2895"></A><A NAME="indexterm-2896"></A>For the <tt>in.mpathd</tt> daemon to consider an interface
to be repaired, the <tt>RUNNING</tt> flag must be set for the interface.
If probe-based failure detection is used, the <tt>in.mpathd</tt> daemon
must receive responses to 10 consecutive probe packets from the interface
before that interface is considered repaired. When an interface is considered
repaired, any addresses that failed over to another interface then fail back
to the repaired interface. If the interface was configured as "active"
before it failed, after repair that interface can resume sending and receiving
traffic.</p>
<A NAME="eoqse"></A><h3>What Happens During Interface Failover</h3>
<p><A NAME="indexterm-2897"></A><A NAME="indexterm-2898"></A>The following two examples show a typical configuration and how
that configuration automatically changes when an interface fails. When the <tt>hme0</tt> interface fails, notice that all data addresses move from <tt>hme0</tt> to <tt>hme1</tt>.</p>
<A NAME="mpoverview-ex-12"></A><p><b>Example 30-1 </b>Interface Configuration Before an Interface
Failure</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>hme0: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
     inet 192.168.85.19 netmask ffffff00 broadcast 192.168.85.255
     groupname test
hme0:1: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,DEPRECATED,IPv4,NOFAILOVER> mtu 1500 
     index 2 inet 192.168.85.21 netmask ffffff00 broadcast 192.168.85.255
hme1: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
8     inet 192.168.85.20 netmask ffffff00 broadcast 192.168.85.255
     groupname test
hme1:1: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,DEPRECATED,IPv4,NOFAILOVER> mtu 1500 
     index 2 inet 192.168.85.22 netmask ffffff00 broadcast 192.168.85.255
hme0: flags=a000841&lt;UP,RUNNING,MULTICAST,IPv6,NOFAILOVER> mtu 1500 index 2
     inet6 fe80::a00:20ff:feb9:19fa/10
     groupname test
hme1: flags=a000841&lt;UP,RUNNING,MULTICAST,IPv6,NOFAILOVER> mtu 1500 index 2
     inet6 fe80::a00:20ff:feb9:1bfc/10
     groupname test</pre>
</td></table><br><A NAME="mpoverview-ex-13"></A><p><b>Example 30-2 </b>Interface Configuration After an Interface
Failure</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>hme0: flags=19000842&lt;BROADCAST,RUNNING,MULTICAST,IPv4,NOFAILOVER,FAILED> mtu 0 index 2
        inet 0.0.0.0 netmask 0 
        groupname test
hme0:1: flags=19040843&lt;UP,BROADCAST,RUNNING,MULTICAST,DEPRECATED,IPv4,NOFAILOVER,FAILED> 
        mtu 1500 index 2 inet 192.168.85.21 netmask ffffff00 broadcast 10.0.0.255
hme1: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
        inet 192.168.85.20 netmask ffffff00 broadcast 192.168.85.255
        groupname test
hme1:1: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,DEPRECATED,IPv4,NOFAILOVER> mtu 1500 
        index 2 inet 192.168.85.22 netmask ffffff00 broadcast 10.0.0.255
hme1:2: flags=1000843&lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 6
        inet 192.168.85.19 netmask ffffff00 broadcast 192.168.18.255
hme0: flags=a000841&lt;UP,RUNNING,MULTICAST,IPv6,NOFAILOVER,FAILED> mtu 1500 index 2
        inet6 fe80::a00:20ff:feb9:19fa/10 
        groupname test
hme1: flags=a000841&lt;UP,RUNNING,MULTICAST,IPv6,NOFAILOVER> mtu 1500 index 2
        inet6 fe80::a00:20ff:feb9:1bfc/10 
        groupname test</pre>
</td></table><br><p>You can see that the <tt>FAILED</tt> flag is set on <tt>hme0</tt> to indicate that this interface has failed. You can also see that <tt>hme1:2</tt> has been created. <tt>hme1:2</tt> was originally <tt>hme0</tt>. The address <tt>192.168.85.19</tt> then becomes
accessible through <tt>hme1</tt>. </p>
<p>Multicast memberships that are associated with <tt>192.168.85.19</tt> can
still receive packets, but they now receive packets through <tt>hme1</tt>.
When the failover of address <tt>192.168.85.19</tt> from <tt>hme0</tt> to <tt>hme1</tt> occurred, a dummy address <tt>0.0.0.0</tt> was created
on <tt>hme0</tt>. The dummy address was created so that <tt>hme0</tt> can
still be accessed. <tt>hme0:1</tt> cannot exist without <tt>hme0</tt>.
The dummy address is removed when a subsequent failback takes place.</p>
<p>Similarly, failover of the IPv6 address from <tt>hme0</tt> to <tt>hme1</tt> occurred. In IPv6, multicast memberships are associated with
interface indexes. Multicast memberships also fail over from <tt>hme0</tt> to <tt>hme1</tt>. All the addresses that <tt>in.ndpd</tt> configured
also moved. This action is not shown in the examples.</p>
<p>The <tt>in.mpathd</tt> daemon continues to probe through
the failed interface <tt>hme0</tt>. After the daemon receives 10
consecutive replies for a default repair detection time of 20 seconds, the
daemon determines that the interface is repaired. Because the <tt>RUNNING</tt> flag
is also set on <tt>hme0</tt>, the daemon invokes the failback. After
failback, the original configuration is restored.</p>
<p>For a description of all error messages that are logged on the console
during failures and repairs, see the <tt>in.mpathd</tt>(1M) man
page. </p>
<A NAME="esqdy"></A><h2>IPMP and Dynamic Reconfiguration</h2>
<A NAME="indexterm-2899"></A><A NAME="indexterm-2900"></A><p>The dynamic reconfiguration (DR) feature enables you to reconfigure
system hardware, such as interfaces, while the system is running. This section
explains how DR interoperates with IPMP. </p>
<p>On a system that supports DR of NICs, IPMP can be used to preserve connectivity
and prevent disruption of existing connections. You can safely attach, detach,
or reattach NIC's on a system that supports DR and uses IPMP. This is possible
because IPMP is integrated into the Reconfiguration Coordination Manager (RCM)
framework. <b>RCM</b> manages the dynamic reconfiguration of
system components. </p>
<p>You typically use the <tt>cfgadm</tt> command to perform DR
operations. However, some platforms provide other methods. Consult your platform's
documentation for details. You can find specific documentation about DR from
the following resources.</p>
<A NAME="eterj"></A><p><b>Table 30-1 </b>Documentation Resources for Dynamic
Reconfiguration</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Description</p></th><th scope="col"><p>For Information</p></th></tr>
<tr><td><p>Detailed information on the <tt>cfgadm</tt> command </p></td><td><p><tt>cfgadm</tt>(1M) man
page</p></td></tr>
<tr><td><p>Specific information about DR in the Sun Cluster environment</p></td><td><p><i>Sun Cluster 3.1 System Administration Guide</i></p></td></tr>
<tr><td><p>Specific information about DR in the Sun Fire environment</p></td><td><p><i>Sun Fire 880 Dynamic Reconfiguration Guide</i></p></td></tr>
<tr><td><p>Introductory information about DR and the <tt>cfgadm</tt> command</p></td><td><p>Chapter 6, "Dynamically Configuring Devices (Tasks)," in <i>System Administration Guide: Devices and File Systems</i></p></td></tr>
<tr><td><p>Tasks for administering IPMP groups on a system that supports DR</p></td><td><p><A HREF="p164.html#deploynetmult-92">Replacing a Failed Physical Interface on Systems That Support Dynamic Reconfiguration</A>&nbsp;</p></td></tr>
</table>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p157.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p159.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

