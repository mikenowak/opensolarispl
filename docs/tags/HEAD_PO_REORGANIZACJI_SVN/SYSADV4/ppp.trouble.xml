<chapter id="pppsvrconfig.troubleshoot-1"><title>Fixing Common PPP Problems
(Tasks)</title><highlights><itemizedlist><para>This chapter contains information
for troubleshooting common problems
that occur with Solaris PPP 4.0. The
following topics are covered:</para><listitem><para><olink targetptr="ppp.trouble-16" remap="internal">Tools for
Troubleshooting PPP</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-6" remap="internal">Solving
PPP-Related and PPPoE-Related Problems</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-25" remap="internal">Fixing
Leased-Line Problems</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-92" remap="internal">Diagnosing
and Fixing Authentication Problems</olink></para>
</listitem>
</itemizedlist><para>The sources <emphasis>PPP Design,
Implementation, and Debugging</emphasis> by
James Carlson and the Australian National
University's web site also have detailed
advice for PPP troubleshooting. For
more information, see <olink targetptr="pppsvrconfig.intro-3" remap="internal">Professional
Reference Books About PPP</olink> and <olink targetptr="pppsvrconfig.intro-35" remap="internal">Web
Sites About PPP</olink>.</para>
</highlights><sect1 id="pppsvrconfig.troubleshoot-2"><title>Solving PPP Problems (Task
Map)</title><para>Use the following task
map to quickly access advice and solutions
for common PPP problems.</para><table frame="all" pgwide="100" id="ppp.trouble-tbl-15"><title>Task
Map for Troubleshooting PPP</title><tgroup cols="3" colsep="1" rowsep="1"><colspec colname="colspec3" colwidth="27.11*"/><colspec colname="colspec4" colwidth="27.11*"/><colspec colname="colspec5" colwidth="44.78*"/><thead><row rowsep="1"><entry><para>Task</para>
</entry><entry><para>Definition </para>
</entry><entry><para>For Instructions</para>
</entry>
</row>
</thead><tbody><row><entry><para>Obtain diagnostic information
about the PPP link</para>
</entry><entry><para>Use PPP diagnostic tools to
obtain output for troubleshooting.</para>
</entry><entry><para><olink targetptr="ppp.trouble-10" remap="internal">How
to Obtain Diagnostic Information From
pppd</olink></para>
</entry>
</row><row><entry><para>Obtain debugging information
for the PPP link</para>
</entry><entry><para>Use the <command>pppd debug</command> command
to generate output for troubleshooting.</para>
</entry><entry><para><olink targetptr="ppp.trouble-21" remap="internal">How
to Turn on PPP Debugging</olink></para>
</entry>
</row><row><entry><para>Troubleshoot general problems
with the network layer</para>
</entry><entry><para>Identify and fix PPP problems
that are network-related by using
a series of checks.</para>
</entry><entry><para><olink targetptr="ppp.trouble-75" remap="internal">How
to Diagnose Network Problems</olink></para>
</entry>
</row><row><entry><para>Troubleshoot general communications
problems</para>
</entry><entry><para>Identify and fix communications
problems that affect the PPP link.</para>
</entry><entry><para><olink targetptr="ppp.trouble-93" remap="internal">How
to Diagnose and Fix Communications
Problems</olink></para>
</entry>
</row><row><entry><para>Troubleshoot configuration problems</para>
</entry><entry><para>Identify and fix problems in
the PPP configuration files.</para>
</entry><entry><para><olink targetptr="ppp.trouble-100" remap="internal">How to Diagnose Problems With the
PPP Configuration</olink></para>
</entry>
</row><row><entry><para>Troubleshoot modem-related problems</para>
</entry><entry><para>Identify and fix modem problems.</para>
</entry><entry><para><olink targetptr="ppp.trouble-27" remap="internal">How
to Diagnose Modem Problems</olink></para>
</entry>
</row><row><entry><para>Troubleshoot chat script-related
problems</para>
</entry><entry><para>Identify and fix chat script
problems on a dial-out machine.</para>
</entry><entry><para><olink targetptr="ppp.trouble-44" remap="internal">How
to Obtain Debugging Information for
Chat Scripts</olink></para>
</entry>
</row><row><entry><para>Troubleshoot serial-line speed
problems</para>
</entry><entry><para>Identify and fix line&#8211;speed
problems on a dial-in server.</para>
</entry><entry><para><olink targetptr="ppp.trouble-35" remap="internal">How
to Diagnose and Fix Serial-Line Speed
Problems</olink></para>
</entry>
</row><row><entry><para>Troubleshoot common problems
for leased lines</para>
</entry><entry><para>Identify and fix performance
problems on a leased line.</para>
</entry><entry><para><olink targetptr="ppp.trouble-25" remap="internal">Fixing
Leased-Line Problems</olink></para>
</entry>
</row><row><entry><para>Troubleshoot problems related
to authentication</para>
</entry><entry><para>Identify and fix problems related
to the authentication databases.</para>
</entry><entry><para><olink targetptr="ppp.trouble-92" remap="internal">Diagnosing
and Fixing Authentication Problems</olink></para>
</entry>
</row><row><entry><para>Troubleshoot problem areas for
PPPoE</para>
</entry><entry><para>Use PPP diagnostic tools to
obtain output for identifying and
fixing PPPoE problems.</para>
</entry><entry><para><olink targetptr="ppp.trouble-56" remap="internal">How
to Obtain Diagnostic Information for
PPPoE</olink></para>
</entry>
</row>
</tbody>
</tgroup>
</table>
</sect1><sect1 id="ppp.trouble-16"><title>Tools
for Troubleshooting PPP</title><itemizedlist><para>PPP links generally have
three major areas of failure:</para><listitem><para>Failure of the link
to be established</para>
</listitem><listitem><para>Poor performance of
the link during regular usage</para>
</listitem><listitem><para>Problems that can
be traced to the networks on either
side of the link</para>
</listitem>
</itemizedlist><para>The easiest way to find out
if PPP works is to run a command over
the link. Run a command  such as <literal>ping</literal> or <literal>traceroute</literal> to
a host on the peer's network. Then
observe the results. However, you
should use PPP and UNIX debugging
tools to monitor performance of an
established link  or to troubleshoot
a problematic link.</para><para>This section explains how to
obtain diagnostic information from <command>pppd</command> and its associated
log files. The remaining sections
in this chapter describe common problems
with PPP that you can discover and
fix with the aid of the PPP troubleshooting
tools.</para><task id="ppp.trouble-10"><title>How
to Obtain Diagnostic Information From <command>pppd</command></title><tasksummary><para>The next procedure shows how
to view the current operation of a
link on the local machine.</para>
</tasksummary><procedure><step id="ppp.trouble-step-67"><para>Become
superuser on the local machine or
assume an equivalent role.</para><para>Roles
contain authorizations and privileged
commands. For more information about
roles, see <olink targetdoc="sysadv6" targetptr="rbactask-15" remap="external"><citetitle remap="section">Configuring RBAC (Task Map)</citetitle> in <citetitle remap="book">System Administration Guide: Security Services</citetitle></olink>.
To configure a role with the Primary
Administrator profile, see <olink targetdoc="sysadv1" targetptr="smcover-1" remap="external">Chapter 2, <citetitle remap="chapter">Working With the Solaris Management Console (Tasks),</citetitle> in <citetitle remap="book">System Administration Guide: Basic Administration</citetitle></olink>.</para>
</step><step id="ppp.trouble-step-12"><para>Run <command>pppd</command> with
the serial device configured for PPP
as the argument:</para><screen># <userinput>pppd</userinput> <userinput>cua/b</userinput> <userinput>debug updetach</userinput></screen><para>The next examples show the resulting
displays for a dial-up link and a
leased-line link when <command>pppd</command> runs
in the foreground. If you run <command>pppd
debug</command> in the background,
the output that is produced is sent
to the <filename>/etc/ppp/connect-errors</filename> file. </para>
</step>
</procedure><example id="ppp.trouble-ex-17"><title>Output From a Properly Operating
Dial-up Link</title><screen># <userinput>pppd /dev/cua/b debug updetach</userinput>
have route to 0.0.0.0/0.0.0.0 via 172.21.0.4
serial speed set to 230400 bps
Using interface sppp0
Connect: sppp0 &#60;--> /dev/cua/b
sent [LCP ConfReq id=0x7b &#60;asyncmap 0x0> &#60;magic 0x73e981c8> &#60;pcomp> &#60;accomp>]
rcvd [LCP Ident id=0x79 magic=0x0 "ppp-2.4.0b1 (Sun Microsystems, Inc., Oct  6 
	2004 09:36:22)"]
Peer Identification: ppp-2.4.0b1 (Sun Microsystems, Inc., Oct  6 2004 09:36:22)
	rcvd [LCP ConfRej id=0x7b &#60;asyncmap 0x0>]
sent [LCP Ident id=0x7c magic=0x0 "ppp-2.4.0b1 (Sun Microsystems, Inc., Sep 15 
	2004 09:38:33)"
sent [LCP ConfReq id=0x7d &#60;magic 0x73e981c8> &#60;pcomp> &#60;accomp>]
rcvd [LCP ConfAck id=0x7d &#60;magic 0x73e981c8> &#60;pcomp> &#60;accomp>]
rcvd [LCP ConfAck id=0x78 &#60;magic 0xdd4ad820> &#60;pcomp> &#60;accomp>]
sent [LCP ConfAck id=0x78 &#60;magic 0xdd4ad820> &#60;pcomp> &#60;accomp>]
sent [LCP Ident id=0x7e magic=0x73e981c8 "ppp-2.4.0b1 (Sun Microsystems, Inc., 
	Sep 15 2004 09:38:33)"]
sent [IPCP ConfReq id=0x3d &#60;addr 0.0.0.0> &#60;compress VJ 0f 01>]
rcvd [LCP Ident id=0x7a magic=0xdd4ad820 "ppp-2.4.0b1 (Sun Microsystems, Inc., 
	Oct  6 2004 09:36:22)"]
Peer Identification: ppp-2.4.0b1 (Sun Microsystems, Inc., Oct  6 2004 09:36:22)
rcvd [IPCP ConfReq id=0x92 &#60;addr 10.0.0.1> &#60;compress VJ 0f 01>
sent [IPCP ConfAck id=0x92 &#60;addr 10.0.0.1> &#60;compress VJ 0f 01>
rcvd [IPCP ConfNak id=0x3d &#60;addr 10.0.0.2>]]
sent [IPCP ConfReq id=0x3e &#60;addr 10.0.0.2> &#60;compress VJ 0f 01>]
rcvd [IPCP ConfAck id=0x3e &#60;addr 10.0.0.2> &#60;compress VJ 0f 01>]
local  IP address 10.0.0.2
remote IP address 10.0.0.1</screen>
</example><example id="ppp.trouble-ex-18"><title>Output From a Properly Operating
Leased-Line Link</title><screen># <userinput>pppd /dev/se_hdlc1 default-asyncmap debug updetach</userinput>
pppd 2.4.0b1 (Sun Microsystems, Inc., Oct 24 2004 07:13:18) started by root, uid 0
synchronous speed appears to be 0 bps
init option: '/etc/ppp/peers/syncinit.sh' started (pid 105122)
Serial port initialized.
synchronous speed appears to be 64000 bps
Using interface sppp0
Connect: sppp0 &#60;--> /dev/se_hdlc1
sent [LCP ConfReq id=0xe9 &#60;magic 0x474283c6>&#60;pcomp> &#60;accomp>]
rcvd [LCP ConfAck id=0xe9 &#60;magic 0x474283c6>&#60;pcomp> &#60;accomp>]
rcvd [LCP ConfReq id=0x22 &#60;magic 0x8e3a53ff>&#60;pcomp> &#60;accomp>]
sent [LCP ConfReq id=0x22 &#60;magic 0x8e3a53ff>&#60;pcomp> &#60;accomp>]
sent [LCP Ident id=0xea magic=0x474283c6 "ppp-2.4.0b1 (Sun Microsystems, Inc., Oct 
	22 2004 14:31:44)"]
sent [IPCP ConfReq id=0xf7 &#60;addr 0.0.0.0> &#60;compress VJ Of o1>]]
sent [CCP ConfReq id=0x3f &#60;deflate 15> &#60;deflate(old#) 15> &#60;bsd v1 15>]
rcvd [LCP Ident id=0x23 magic=0x8e3a53ff "ppp-2.4.0b1 (Sun Microsystems, Inc., Oct 
	22 2004 14:31:44)"]
Peer Identification: ppp-2.4.0b1 (Sun Microsystems, Inc., Oct 22 2004 14:31:44)
rcvd [IPCP ConfReq id=0x25 &#60;addr 10.0.0.1> &#60;compress VJ Of 01>]
sent [IPCP ConfAck id=0x25 &#60;addr 10.0.0.1> &#60;compress VJ Of 01>]
rcvd [CCP ConfReq id=0x3 &#60;deflate 15> &#60;deflate(old#) 15 &#60;bsd v1 15>]
sent [CCP ConfAck id=0x3 &#60;deflate 15> &#60;deflate(old#) 15 &#60;bsd v1 15>]
rcvd [IPCP ConfNak id=0xf8 &#60;addr 10.0.0.2>]
rcvd [IPCP ConfReq id=0xf7 &#60;addr 10.0.0.2> &#60;compress VJ Of 01>]
rcvd [CCP ConfAck id=0x3f &#60;deflate 15> &#60;deflate(old#) 15 &#60;bsd v1 15>]
Deflate (15) compression enabled
rcvd [IPCP ConfAck id=0xf8 &#60;addr 10.0.0.2> &#60;compress VJ Of 01>]
local  IP address 10.0.0.2
remote IP address 10.0.0.1</screen>
</example>
</task><task id="ppp.trouble-21"><title>How
to Turn on PPP Debugging</title><tasksummary><para>The next task shows how
to use the <command>pppd</command> command
to obtain debugging information.</para><note><para>You only need to perform
step 1 through step 3 once for each
host. Thereafter, you can proceed
to step 4 to turn on debugging for
the host.</para>
</note>
</tasksummary><procedure>&rolestepA;<step id="ppp.trouble-step-68"><para>Create
a log file to hold output from <command>pppd</command>.</para><screen># <userinput>touch</userinput> <filename>/var/log/pppdebug</filename></screen>
</step><step id="ppp.trouble-step-30"><para>Add
the following <command>syslog</command> facilities
for <command>pppd</command> in <filename>/etc/syslog.conf</filename>.</para><screen><userinput>daemon.debug;local2.debug       /var/log/pppdebug</userinput></screen>
</step><step id="ppp.trouble-step-31"><para>Restart <command>syslogd</command>.</para><screen># <userinput>pkill -HUP -x syslogd</userinput></screen>
</step><step id="ppp.trouble-step-24"><para>Turn
on debugging for calls to a particular
peer by using the following syntax
of <command>pppd</command>.</para><screen># <userinput>pppd debug call</userinput> <replaceable>peer-name</replaceable> </screen><para><replaceable>peer-name</replaceable> must
be the name of a file in the <filename>/etc/ppp/peers</filename> directory.</para>
</step><step id="ppp.trouble-step-23"><para>View
the contents of the log file.</para><screen># <userinput>tail -f</userinput> <filename>/var/log/pppdebug</filename></screen><para>For an example of a log file,
see <olink targetptr="ppp.trouble-step-59" remap="internal">Step&#160;3</olink>.</para>
</step>
</procedure>
</task>
</sect1><sect1 id="ppp.trouble-6"><title>Solving
PPP-Related and PPPoE-Related Problems</title><para>Refer to the following sections
for information about how to resolve
PPP-related and PPPoE-related problems.</para><itemizedlist><listitem><para><olink targetptr="ppp.trouble-75" remap="internal">How to
Diagnose Network Problems</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-108" remap="internal">Common
Network Problems That Affect PPP</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-93" remap="internal">How to
Diagnose and Fix Communications Problems</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-109" remap="internal">General
Communications Problems That Affect
PPP</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-100" remap="internal">How to
Diagnose Problems With the PPP Configuration</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-110" remap="internal">Common
PPP Configuration Problems</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-27" remap="internal">How to
Diagnose Modem Problems</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-44" remap="internal">How to
Obtain Debugging Information for Chat
Scripts</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-111" remap="internal">Common
Chat Script Problems</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-35" remap="internal">How to
Diagnose and Fix Serial-Line Speed
Problems</olink></para>
</listitem><listitem><para><olink targetptr="ppp.trouble-56" remap="internal">How to
Obtain Diagnostic Information for
PPPoE</olink></para>
</listitem>
</itemizedlist><task id="ppp.trouble-75"><title>How
to Diagnose Network Problems</title><tasksummary><para>If the PPP link becomes
active but few hosts on the remote
network are reachable, a network problem
could be indicated. The following
procedure shows you how to isolate
and fix network problems that affect
a PPP link. </para>
</tasksummary><procedure><step id="ppp.trouble-step-89"><para>Become
superuser on the local machine or
assume an equivalent role.</para><para>Roles
contain authorizations and privileged
commands. For more information about
roles, see <olink targetdoc="sysadv6" targetptr="rbactask-15" remap="external"><citetitle remap="section">Configuring RBAC (Task Map)</citetitle> in <citetitle remap="book">System Administration Guide: Security Services</citetitle></olink>.
To configure a role with the Primary
Administrator profile, see <olink targetdoc="sysadv1" targetptr="smcover-1" remap="external">Chapter 2, <citetitle remap="chapter">Working With the Solaris Management Console (Tasks),</citetitle> in <citetitle remap="book">System Administration Guide: Basic Administration</citetitle></olink>.</para>
</step><step><para>Shut down the problematic
link.</para>
</step><step id="ppp.trouble-step-77"><para>Disable
any optional protocols in the configuration
files by adding the following options
to your PPP configuration:</para><screen>noccp novj nopcomp noaccomp default-asyncmap</screen><para>These options provide the simplest
uncompressed PPP that is available.
Try to invoke these options as arguments
to <command>pppd</command> on the
command line. If you can reach the
previously unreachable hosts, add
the options in either of the following
places.</para><itemizedlist><listitem><para><filename>/etc/ppp/peers/</filename><replaceable>peer-name</replaceable>,
after the <command>call</command> option</para>
</listitem><listitem><para><filename>/etc/ppp/options</filename>, ensuring that the options
apply globally</para>
</listitem>
</itemizedlist>
</step><step id="ppp.trouble-step-78"><para>Call
the remote peer. Then enable debugging
features.</para><screen>% <userinput>pppd debug call</userinput> <replaceable>peer-name</replaceable></screen>
</step><step><para>Obtain verbose logs from
the chat program by using the <option>v</option> option
of <command>chat</command>.</para><para>For
example, use the following format
in any PPP configuration file:</para><screen>connect 'chat -v -f <replaceable>/etc/ppp/chatfile</replaceable>'</screen><para><replaceable>/etc/ppp/chatfile</replaceable> represents
the name of your chat file.</para>
</step><step id="ppp.trouble-step-79"><para>Try
to re-create the problem by using
Telnet or other applications to reach
the remote hosts.</para><para>Observe
the debugging logs. If you still cannot
reach remote hosts, the PPP problem
might be network-related.</para>
</step><step id="ppp.trouble-step-80"><para>Verify
that the IP addresses of the remote
hosts are registered Internet addresses.</para><para>Some organizations assign internal
IP addresses that are known within
the local network but cannot be routed
to the Internet. If the remote hosts
are within your company, you  must
set up a name-to-address translation
(NAT) server or proxy server to reach
the Internet. If the remote hosts
are not within your company, you should
report the problem to the remote organization.</para>
</step><step id="ppp.trouble-step-81"><para>Examine
the routing tables.</para><substeps><step id="ppp.trouble-step-82"><para>Check
the routing tables on both the local
machine and the peer.</para>
</step><step id="ppp.trouble-step-90"><para>Check
the routing tables for any routers
that are in the path from the peer
to the remote system.  Also check
the routing tables for any routers
on the path back to the peer.</para><para>Ensure that the intermediate
routers have not been misconfigured.
Often the problem can be found in
the path back to the peer.</para>
</step>
</substeps>
</step><step performance="optional" id="ppp.trouble-step-84"><para>If
the machine is a router, check the
optional features.</para><screen># <userinput>ndd -set /dev/ip ip_forwarding 1</userinput></screen><para>For more information about <command>ndd</command>, refer to the <olink targetdoc="refman1m" targetptr="ndd-1m" remap="external"><citerefentry><refentrytitle>ndd</refentrytitle><manvolnum>1M</manvolnum></citerefentry></olink> man
page.</para><para>In the Solaris 10
release, you can use <olink targetdoc="refman1m" targetptr="routeadm-1m" remap="external"><citerefentry><refentrytitle>routeadm</refentrytitle><manvolnum>1M</manvolnum></citerefentry></olink>,
instead of <command>ndd</command>(1M).</para><screen># <userinput>routeadm -e ipv4-forwarding -u</userinput></screen><note><para>The <command>ndd</command> command
is not persistent. The values set
with this command are lost when the
system is rebooted. The <command>routeadm</command> command is persistent.
The values set with this command are
maintained after the system is rebooted.</para>
</note>
</step><step id="ppp.trouble-step-85"><para>Check
the statistics that are obtained from <command>netstat -s</command> and similar tools.</para><para>For complete details about <command>netstat</command>, refer to the <olink targetdoc="refman1m" targetptr="netstat-1m" remap="external"><citerefentry><refentrytitle>netstat</refentrytitle><manvolnum>1M</manvolnum></citerefentry></olink> man
page.</para><substeps><step id="ppp.trouble-step-91"><para>Run
statistics on the local machine.</para>
</step><step id="ppp.trouble-step-86"><para>Call
the peer.</para>
</step><step id="ppp.trouble-step-87"><para>Observe
the new statistics that are generated
by <command>netstat</command> <option>s</option>.
For more information, refer to <olink targetptr="ppp.trouble-108" remap="internal">Common
Network Problems That Affect PPP</olink>.</para>
</step>
</substeps>
</step><step id="ppp.trouble-step-88"><para>Check
the DNS configuration.</para><para>A
faulty name service configuration
causes applications to fail because
IP addresses cannot be resolved.</para>
</step>
</procedure>
</task><sect2 id="ppp.trouble-108"><title>Common
Network Problems That Affect PPP</title><para>You can use the messages
that are generated by <command>netstat</command>  <option>s</option> to fix the network problems
that are shown in the following table.
For related procedural information,
refer to <olink targetptr="ppp.trouble-75" remap="internal">How to
Diagnose Network Problems</olink>.</para><table frame="topbot" pgwide="100" id="ppp.trouble-tbl-105"><title>Common
Network Problems That Affect PPP</title><tgroup cols="3" colsep="0" rowsep="0"><colspec colname="colspec0" colwidth="33*"/><colspec colname="colspec1" colwidth="33*"/><colspec colname="colspec2" colwidth="33*"/><thead><row rowsep="1"><entry><para>Message</para>
</entry><entry><para>Problem</para>
</entry><entry><para>Solution</para>
</entry>
</row>
</thead><tbody><row><entry><para><computeroutput>IP packets not
forwardable</computeroutput></para>
</entry><entry><para>The local host is missing a
route.</para>
</entry><entry><para>Add the missing route to the
local host's routing tables.</para>
</entry>
</row><row><entry><para><computeroutput>ICMP input destination
unreachable</computeroutput></para>
</entry><entry><para>The local host is missing a
route.</para>
</entry><entry><para>Add the missing route to the
local host's routing tables.</para>
</entry>
</row><row><entry><para><computeroutput>ICMP time exceeded</computeroutput></para>
</entry><entry><para>Two routers are forwarding the
same destination address to each other,
causing the packet to bounce back
and forth until the time-to-live (TTL)
value is exceeded.</para>
</entry><entry><para>Use <command>traceroute</command> to
find the source of the routing loop,
and then contact the administrator
of the router in error. For information
about <command>traceroute</command>,
refer to the <olink targetdoc="refman1m" targetptr="traceroute-1m" remap="external"><citerefentry><refentrytitle>traceroute</refentrytitle><manvolnum>1M</manvolnum></citerefentry></olink> man
page.</para>
</entry>
</row><row><entry><para><computeroutput>IP packets not
forwardable</computeroutput></para>
</entry><entry><para>The local host is missing a
route.</para>
</entry><entry><para>Add the missing route to the
local host's routing table.</para>
</entry>
</row><row><entry><para><computeroutput>ICMP input destination
unreachable</computeroutput></para>
</entry><entry><para>The local host is missing a
route.</para>
</entry><entry><para>Add the missing route to the
local host's routing tables.</para>
</entry>
</row>
</tbody>
</tgroup>
</table>
</sect2><task id="ppp.trouble-93"><title>How
to Diagnose and Fix Communications
Problems</title><tasksummary><para>Communications problems
occur when the two peers cannot successfully
establish a link. Sometimes these
problems are actually negotiation
problems that are caused by incorrectly
configured chat scripts. The following
procedure shows you how to clear communication
problems. For clearing negotiation
problems that are caused by a faulty
chat script, see <olink targetptr="ppp.trouble-tbl-49" remap="internal">Table
21&#8211;5</olink>.</para>
</tasksummary><procedure><step id="ppp.trouble-step-98"><para>Become
superuser on the local machine or
assume an equivalent role.</para><para>Roles
contain authorizations and privileged
commands. For more information about
roles, see <olink targetdoc="sysadv6" targetptr="rbactask-15" remap="external"><citetitle remap="section">Configuring RBAC (Task Map)</citetitle> in <citetitle remap="book">System Administration Guide: Security Services</citetitle></olink>.
To configure a role with the Primary
Administrator profile, see <olink targetdoc="sysadv1" targetptr="smcover-1" remap="external">Chapter 2, <citetitle remap="chapter">Working With the Solaris Management Console (Tasks),</citetitle> in <citetitle remap="book">System Administration Guide: Basic Administration</citetitle></olink></para>
</step><step><para>Call the peer.</para>
</step><step id="ppp.trouble-step-95"><para>Call
the remote peer. Then enable debugging
features.</para><screen>% <userinput>pppd debug call</userinput> <replaceable>peer-name</replaceable></screen><para>You might need to obtain debugging
information from the peer in order
to fix certain communications problems.</para>
</step><step id="ppp.trouble-step-96"><para>Check
the resulting logs for communication
problems. For more information, refer
to <olink targetptr="ppp.trouble-109" remap="internal">General
Communications Problems That Affect
PPP</olink>.</para>
</step>
</procedure>
</task><sect2 id="ppp.trouble-109"><title>General
Communications Problems That Affect
PPP</title><para>The following table describes
symptoms that are related to log output
from the procedure, <olink targetptr="ppp.trouble-93" remap="internal">How to
Diagnose and Fix Communications Problems</olink>.</para><table frame="topbot" pgwide="100" id="ppp.trouble-tbl-97"><title>General
Communications Problems That Affect
PPP</title><tgroup cols="3" colsep="0" rowsep="0"><colspec colname="colspec3" colwidth="24.07*"/><colspec colname="colspec4" colwidth="23.84*"/><colspec colname="colspec5" colwidth="51.10*"/><thead><row rowsep="1"><entry><para>Symptom</para>
</entry><entry><para>Problem</para>
</entry><entry><para>Solution</para>
</entry>
</row>
</thead><tbody><row><entry><para><computeroutput>too many Configure-Requests</computeroutput></para>
</entry><entry><para>One peer cannot hear the other
peer.</para>
</entry><entry><para>Check for the following problems:</para><itemizedlist><listitem><para>The machine or modem
might have faulty cabling.</para>
</listitem><listitem><para>The modem configuration
might have  incorrect bit settings.
Or, the configuration might  have
broken flow control.</para>
</listitem><listitem><para>The chat script might
have failed.  In this situation, see <olink targetptr="ppp.trouble-tbl-49" remap="internal">Table
21&#8211;5</olink>.</para>
</listitem>
</itemizedlist>
</entry>
</row><row><entry><para>The <command>pppd debug</command> output
shows that LCP starts, but higher-level
protocols fail or show CRC errors.</para>
</entry><entry><para>The asynchronous control character
map (ACCM) is incorrectly set.</para>
</entry><entry><para>Use the <command>default-async</command> option
to set the ACCM to the standard default
of FFFFFFFF. First, try to use <command>default-async</command> as an option to <command>pppd</command> on
the command line. If the problem clears,
then add <command>default-async</command> to <filename>/etc/ppp/options</filename> or to <filename>/etc/ppp/peers/</filename><replaceable>peer-name</replaceable> after the call option.</para>
</entry>
</row><row><entry><para>The <command>pppd debug</command> output
shows that IPCP starts but terminates
immediately.</para>
</entry><entry><para>IP addresses might be incorrectly
configured.</para>
</entry><entry><orderedlist><listitem><para>Check the chat script
to verify whether the script has incorrect
IP addresses.</para>
</listitem><listitem><para>If  the chat script
is correct,  request debug logs for
the peer, and check IP addresses in
the peer logs. </para>
</listitem>
</orderedlist>
</entry>
</row><row><entry><para>The link exhibits very poor
performance.</para>
</entry><entry><para>The modem might be incorrectly
configured, with flow-control configuration
errors, modem setup errors, and incorrectly
configured DTE rates.</para>
</entry><entry><para>Check the modem configuration.
 Adjust the configuration if necessary.</para>
</entry>
</row>
</tbody>
</tgroup>
</table>
</sect2><task id="ppp.trouble-100"><title>How
to Diagnose Problems With the PPP
Configuration</title><tasksummary><para>Some PPP problems can
be traced to problems in the PPP configuration
files. The following procedure shows
you how to isolate and fix general
configuration problems.</para>
</tasksummary><procedure><step id="ppp.trouble-step-106"><para>Become
superuser on the local machine or
assume an equivalent role.</para><para>Roles
contain authorizations and privileged
commands. For more information about
roles, see <olink targetdoc="sysadv6" targetptr="rbactask-15" remap="external"><citetitle remap="section">Configuring RBAC (Task Map)</citetitle> in <citetitle remap="book">System Administration Guide: Security Services</citetitle></olink>.
To configure a role with the Primary
Administrator profile, see <olink targetdoc="sysadv1" targetptr="smcover-1" remap="external">Chapter 2, <citetitle remap="chapter">Working With the Solaris Management Console (Tasks),</citetitle> in <citetitle remap="book">System Administration Guide: Basic Administration</citetitle></olink>.</para>
</step><step id="ppp.trouble-step-102"><para>Call
the remote peer. Then enable debugging
features.</para><screen>% <userinput>pppd debug call</userinput> <replaceable>peer-name</replaceable></screen>
</step><step id="ppp.trouble-step-103"><para>Check
the resulting log for the configuration
problems. For more information, refer
to <olink targetptr="ppp.trouble-110" remap="internal">Common
PPP Configuration Problems</olink>.</para>
</step>
</procedure>
</task><sect2 id="ppp.trouble-110"><title>Common
PPP Configuration Problems</title><para>The following table describes
symptoms that are related to log output
from the procedure, <olink targetptr="ppp.trouble-100" remap="internal">How to
Diagnose Problems With the PPP Configuration</olink>.</para><table frame="topbot" pgwide="100" id="ppp.trouble-tbl-104"><title>Common
PPP Configuration Problems</title><tgroup cols="3" colsep="0" rowsep="0"><colspec colwidth="27.45*"/><colspec colwidth="27.45*"/><colspec colwidth="44.09*"/><thead><row rowsep="1"><entry><para>Symptom</para>
</entry><entry><para>Problem</para>
</entry><entry><para>Solution</para>
</entry>
</row>
</thead><tbody><row><entry><para><command>pppd debug</command> output
contains the error message, <literal>Could
not determine remote IP address</literal>.</para>
</entry><entry><para>The <filename>/etc/ppp/peers/</filename><replaceable>peer-name</replaceable> file does
not have an IP address for the peer.
The peer does not provide an IP address
during link negotiation.</para>
</entry><entry><para>Supply an IP address for the
peer on the pppd command line or in <filename>/etc/ppp/peers/</filename><replaceable>peer-name</replaceable> by using the following
format:</para><para>:10.0.0.10</para>
</entry>
</row><row><entry><para><command>pppd debug</command> output
shows that CCP data compression has
failed. The output also indictes that
the link is dropped.</para>
</entry><entry><para>The peers' PPP compression configurations
might be in conflict.  </para>
</entry><entry><para>Disable CCP compression by adding
the <command>noccp</command> option
to <filename>/etc/ppp/options</filename> on
one of the peers.</para>
</entry>
</row>
</tbody>
</tgroup>
</table>
</sect2><task id="ppp.trouble-27"><title>How
to Diagnose Modem Problems</title><tasksummary><para>Modems can be major problem
areas for a dial-up link. The most
common indicator of problems with
the modem configuration is no response
from the peer. However, you might
have difficulties when determining
if a link problem is indeed the result
of modem configuration problems. </para><para>For basic modem troubleshooting
suggestions, refer to <olink targetdoc="sysadv2" targetptr="modsetup-58" remap="external"><citetitle remap="section">Troubleshooting Terminal and Modem Problems</citetitle> in <citetitle remap="book">System Administration Guide: Advanced Administration</citetitle></olink>.
Modem manufacturers' documentation
and web sites also contain solutions
for problems with their particular
equipment. The following procedure
helps determine whether a faulty modem
configuration causes link problems.</para>
</tasksummary><procedure><step id="ppp.trouble-step-69"><para>Call
the peer with debugging turned on,
as explained in <olink targetptr="ppp.trouble-21" remap="internal">How to
Turn on PPP Debugging</olink>.</para>
</step><step id="ppp.trouble-step-29"><para>Display
the resulting <filename>/var/log/pppdebug</filename> log to check for faulty
modem configuration.</para>
</step><step id="ppp.trouble-step-32"><para>Use <command>ping</command> to send packets of
various sizes over the link.</para><para>For complete details about <command>ping</command>, refer to the <olink targetdoc="refman1m" targetptr="ping-1m" remap="external"><citerefentry><refentrytitle>ping</refentrytitle><manvolnum>1M</manvolnum></citerefentry></olink> man
page.</para><para>If small packets
are received but larger packets are
dropped, modem problems are indicated.</para>
</step><step id="ppp.trouble-step-33"><para>Check
for errors on interface <literal>sppp0</literal>:</para><screen>% <userinput>netstat -ni</userinput>
Name  Mtu  Net/Dest   Address      Ipkts    Ierrs Opkts    Oerrs Collis Queue 
lo0   8232 127.0.0.0  127.0.0.1    826808   0     826808   0     0      0     
hme0  1500 172.21.0.0 172.21.3.228 13800032 0     1648464  0     0      0     
<userinput>sppp0 1500 10.0.0.2   10.0.0.1     210      0     128      0     0      0</userinput></screen><para>If interface errors increase
over time, the modem configuration
might have problems.</para>
</step>
</procedure><taskrelated role="troubleshooting"><para>When you display the resulting <filename>/var/log/pppdebug</filename> log,
the following symptoms in the output
can indicate a faulty modem configuration.
The local machine can hear the peer,
but the peer cannot hear the local
machine.</para><itemizedlist><listitem><para>No &#8220;<literal>recvd</literal>&#8221;
messages have come from the peer.</para>
</listitem><listitem><para>The output contains
LCP messages from the peer, but the
link fails with <literal>too many
LCP Configure Requests</literal> messages
that are sent by the local machine.</para>
</listitem><listitem><para>The link terminates
with a SIGHUP signal.</para>
</listitem>
</itemizedlist>
</taskrelated>
</task><task id="ppp.trouble-44"><title>How
to Obtain Debugging Information for
Chat Scripts</title><tasksummary><para>Use the following procedure
for obtaining debugging information
from <command>chat</command> and suggestions
for clearing common problems. For
more information, refer to <olink targetptr="ppp.trouble-111" remap="internal">Common
Chat Script Problems</olink>.</para>
</tasksummary><procedure><step id="ppp.trouble-step-70"><para>Become
superuser on the dial-out machine
or assume an equivalent role.</para><para>Roles contain authorizations
and privileged commands. For more
information about roles, see <olink targetdoc="sysadv6" targetptr="rbactask-15" remap="external"><citetitle remap="section">Configuring RBAC (Task Map)</citetitle> in <citetitle remap="book">System Administration Guide: Security Services</citetitle></olink>.
To configure a role with the Primary
Administrator profile, see <olink targetdoc="sysadv1" targetptr="smcover-1" remap="external">Chapter 2, <citetitle remap="chapter">Working With the Solaris Management Console (Tasks),</citetitle> in <citetitle remap="book">System Administration Guide: Basic Administration</citetitle></olink>.</para>
</step><step id="ppp.trouble-step-46"><para>Edit
the <filename>/etc/ppp/peers/</filename><replaceable>peer-name</replaceable> file for the
peer to be called.</para>
</step><step id="ppp.trouble-step-47"><para>Add <option>v</option> as an argument to the <command>chat</command> command that is specified
in <literal>connect</literal> option.</para><screen>connect "/usr/bin/chat <userinput>-v</userinput> -f /etc/ppp/<replaceable>chat-script-name</replaceable>"</screen>
</step><step id="ppp.trouble-step-48"><para>View
chat script errors in the file <filename>/etc/ppp/connect-errors</filename>.</para><para>The following is the main error
that occurs with <command>chat</command>.</para><screen>Oct 31 08:57:13 deino chat[107294]: [ID 702911 local2.info] expect (CONNECT)
Oct 31 08:57:58 deino chat[107294]: [ID 702911 local2.info] alarm
Oct 31 08:57:58 deino chat[107294]: [ID 702911 local2.info] Failed</screen><para>The example shows timeout while
waiting for a <computeroutput>(CONNECT)</computeroutput>string.
When <command>chat</command> fails,
you get the following message from <command>pppd</command>:</para><screen>Connect script failed</screen>
</step>
</procedure>
</task><sect2 id="ppp.trouble-111"><title>Common
Chat Script Problems</title><para>Chat scripts are trouble-prone
areas for dial-up links. The following
table lists common chat script errors
and gives suggestions for fixing the
errors. For procedural information,
refer to <olink targetptr="ppp.trouble-44" remap="internal">How to
Obtain Debugging Information for Chat
Scripts</olink>.</para><table frame="topbot" pgwide="100" id="ppp.trouble-tbl-49"><title>Common
Chat Script Problems</title><tgroup cols="3" colsep="0" rowsep="0"><colspec colname="colspec0" colwidth="29.36*"/><colspec colname="colspec1" colwidth="31.75*"/><colspec colname="colspec2" colwidth="37.90*"/><thead><row rowsep="1"><entry><para>Symptom</para>
</entry><entry><para>Problem</para>
</entry><entry><para>Solution</para>
</entry>
</row>
</thead><tbody><row><entry><para><command>pppd debug</command> output
contains <literal>Connect script failed</literal> </para>
</entry><entry><para>Your chat script supplies a
user name and ssword.</para><screen>ogin: <replaceable>user-name</replaceable>
ssword: <replaceable>password</replaceable></screen><para>However, the peer that you intended
to connect to does not prompt for
this information.</para>
</entry><entry><orderedlist><listitem><para>Delete the login and
password from the chat script.</para>
</listitem><listitem><para>Try to call the peer
again.</para>
</listitem><listitem><para>If you still get the
message, call the ISP.  Ask the ISP
for the correct login sequence.</para>
</listitem>
</orderedlist>
</entry>
</row><row><entry><para>The <filename>/usr/bin/chat
-v</filename> log contains <literal>"expect
(login:)" alarm read timed out</literal></para>
</entry><entry><para>Your chat script supplies a
user name and ssword.</para><screen>ogin: pppuser
ssword: \q\U</screen><para>However, the peer that you intend
to connect to does not prompt for
this information.</para>
</entry><entry><orderedlist><listitem><para>Delete the login and
password from the chat script.</para>
</listitem><listitem><para>Try to call the peer
again.</para>
</listitem><listitem><para>If you still get the
message, call the ISP. Ask the ISP
for the correct login sequence.</para>
</listitem>
</orderedlist>
</entry>
</row><row><entry><para><command>pppd debug</command> output
contains <literal>possibly looped-back</literal> </para>
</entry><entry><para>The local machine or its peer
is hanging at the command line and
not running PPP. An incorrectly configured
login name and password are in the
chat script.</para>
</entry><entry><para></para><orderedlist><listitem><para>Delete the login and
password from the chat script.</para>
</listitem><listitem><para>Try to call the peer
again.</para>
</listitem><listitem><para>If you still get the
message, call the ISP.  Ask for the
correct login sequence.</para>
</listitem>
</orderedlist>
</entry>
</row><row><entry><para><command>pppd debug</command> output
shows that LCP activates, but the
link terminates soon afterward.</para>
</entry><entry><para>The password in the chat script
might be incorrect.</para>
</entry><entry><para></para><orderedlist><listitem><para>Ensure that you have
the correct password for the local
machine.</para>
</listitem><listitem><para>Check the password
in the chat script.  Fix the password
 if  incorrect.</para>
</listitem><listitem><para>Try to call the peer
again.</para>
</listitem><listitem><para>If you still get the
message, call the ISP. Ask the ISP
for the correct login sequence.</para>
</listitem>
</orderedlist>
</entry>
</row><row><entry><para>Text from the peer begins with
a tilde (~).</para>
</entry><entry><para>Your chat script supplies a
user name and ssword.</para><screen>ogin: pppuser
ssword: \q\U</screen><para>However, the peer that  you
intend to connect to does not prompt
for this information.</para>
</entry><entry><para></para><orderedlist><listitem><para>Delete the login and
password  from the chat script.</para>
</listitem><listitem><para>Try to call the peer
again.</para>
</listitem><listitem><para>If you still get the
message, call the ISP. Request the
correct login sequence.</para>
</listitem>
</orderedlist>
</entry>
</row><row><entry><para>The modem hangs.</para>
</entry><entry><para>Your chat script contains the
following line to force the local
machine to wait for the <literal>CONNECT</literal> message
from the peer:</para><screen>CONNECT &#8221;</screen>
</entry><entry><para>Use the following line when
you want the chat script to wait for
CONNECT from the peer:</para><screen>CONNECT \c</screen><para>End the chat script with <literal>~
\c</literal>. </para>
</entry>
</row><row><entry><para><command>pppd debug</command> output
contains <computeroutput>LCP: timeout
sending Config-Requests</computeroutput></para>
</entry><entry><para>Your chat script contains the
following line to force the local
machine to wait for the <literal>CONNECT</literal> message
from the peer:</para><screen>CONNECT &#8221;</screen>
</entry><entry><para>Use the following line when
you want the chat script to wait for
CONNECT from the peer:</para><screen>CONNECT \c</screen><para>End the chat script with <literal>~
\c</literal>.</para>
</entry>
</row><row><entry><para><command>pppd debug</command> output
contains <computeroutput>Serial link
is not 8-bit clean</computeroutput></para>
</entry><entry><para>Your chat script contains the
following line to force the local
machine to wait for the <literal>CONNECT</literal> message
from the peer:</para><screen>CONNECT &#8221;</screen>
</entry><entry><para>Use the following line when
you want the chat script to wait for
CONNECT from the peer:</para><screen>CONNECT \c</screen><para>End the chat script with <literal>~
\c</literal>. </para>
</entry>
</row><row><entry><para><command>pppd debug</command> output
contains <computeroutput> Loopback
detected</computeroutput></para>
</entry><entry><para>Your chat script contains the
following line to force the local
machine to wait for the <literal>CONNECT</literal> message
from the peer:</para><screen>CONNECT &#8221;</screen>
</entry><entry><para>Use the following line when
you want the chat script to wait for
CONNECT from the peer:</para><screen>CONNECT \c</screen><para>End the chat script with <literal>~
\c</literal>. </para>
</entry>
</row><row><entry><para><command>pppd debug</command> output
contains <computeroutput>SIGHUP</computeroutput></para>
</entry><entry><para>Your chat script contains the
following line to force the local
machine to wait for the <literal>CONNECT</literal> message
from the peer:</para><screen>CONNECT &#8221;</screen>
</entry><entry><para>Use the following line when
you want the chat script to wait for
CONNECT from the peer:</para><screen>CONNECT \c</screen><para>End the chat script with <literal>~
\c</literal>. </para>
</entry>
</row>
</tbody>
</tgroup>
</table>
</sect2><task id="ppp.trouble-35"><title>How
to Diagnose and Fix Serial-Line Speed
Problems</title><tasksummary><para>Dial-in servers can experience
problems because of conflicting speed
settings. The following procedure
helps you to isolate the cause of
the link problem to conflicting serial-line
speeds.</para><itemizedlist><para>The following behaviors cause
speed problems:</para><listitem><para>You invoked PPP through
a program such as <command>/bin/login</command> and
specified the speed of the line.</para>
</listitem><listitem><para>You started PPP from <literal>mgetty</literal> and accidentally
supplied the bit rate.</para>
</listitem>
</itemizedlist><para>pppd changes the speed that
was originally set for the line to
the speed that was set by <command>/bin/login</command> or <command>mgetty</command>.
 As a result, the line fails.</para>
</tasksummary><procedure><step id="ppp.trouble-step-71"><para>Log
in to the dial-in server. Call the
peer with debugging enabled.</para><para>If you need instructions, see <olink targetptr="ppp.trouble-21" remap="internal">How to
Turn on PPP Debugging</olink>.</para>
</step><step id="ppp.trouble-step-37"><para>Display
the resulting <filename>/var/log/pppdebug</filename> log.</para><para>Check
the output for the following message:</para><screen>LCP too many configure requests</screen><para>This message indicates that
the speeds of serial lines that were
configured for PPP might potentially
be in conflict.</para>
</step><step id="ppp.trouble-step-39"><para>Check
if PPP is invoked through a program
such as <command>/bin/login</command> and
the line speed that was set.</para><para>In such a situation, <command>pppd</command> changes
the originally configured line speed
to the speed that is specified in <command>/bin/login</command>.</para>
</step><step id="ppp.trouble-step-40"><para>Check
if a user started PPP from the <command>mgetty</command> command and accidentally
specified a bit rate.</para><para>This
action also causes serial-line speeds
to conflict.</para>
</step><step id="ppp.trouble-step-41"><para>Fix
the conflicting serial-line speed
problem as follows:</para><substeps><step id="ppp.trouble-step-72"><para>Lock
the DTE rate on the modem.</para>
</step><step id="ppp.trouble-step-42"><para>Do
not use autobaud.</para>
</step><step id="ppp.trouble-step-43"><para>Do
not change the line speed after configuration.</para>
</step>
</substeps>
</step>
</procedure>
</task><task id="ppp.trouble-56"><title>How
to Obtain Diagnostic Information for
PPPoE</title><tasksummary><para>You can use PPP and standard
UNIX utilities to identify problems
with PPPoE. When you suspect that
PPPoE is the cause of problems on
a link, use the following diagnostic
tools to obtain troubleshooting information.</para>
</tasksummary><procedure><step id="ppp.trouble-step-73"><para>Become
superuser on the machine that runs
the PPPoE tunnel, either PPPoE client
or PPPoE access server.</para>
</step><step id="ppp.trouble-step-58"><para>Turn
on debugging, as explained in the
procedure <olink targetptr="ppp.trouble-21" remap="internal">How to
Turn on PPP Debugging</olink>.</para>
</step><step id="ppp.trouble-step-59"><para>View
the contents of the log file <filename>/var/log/pppdebug</filename>.</para><para>The following example
shows part of a log file that was
generated for a link with a PPPoE
tunnel.</para><screen>Sep  6 16:28:45 enyo pppd[100563]: [ID 702911 daemon.info] Plugin 
  pppoe.so loaded.
Sep  6 16:28:45 enyo pppd[100563]: [ID 860527 daemon.notice] pppd 
  2.4.0b1 (Sun Microsystems, Inc.,
Sep  5 2001 10:42:05) started by troot, uid 0
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.debug] connect option:
   '/usr/lib/inet/pppoec 
-v hme0' started (pid 100564)
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.info] Serial connection established.
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.info] Using interface sppp0
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.notice] Connect: sppp0
   &#60;--> /dev/sppptun
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.debug] /etc/ppp/pap-secrets
  is apparently empty
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.debug] /etc/ppp/chap-secrets
  is apparently empty
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.debug] sent 
  [LCP ConfReq id=0xef &#60;mru 1492> 
asyncmap 0x0 &#60;magic 0x77d3e953>&#60;pcomp>&#60;acomp>
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.debug] rcvd 
  [LCP ConfReq id=0x2a &#60;mru 1402>
asyncmap 0x0 &#60;magic 0x9985f048>&#60;pcomp>&#60;acomp </screen><para>If the debugging output
does not help you isolate the problem,
continue with this procedure.</para>
</step><step id="ppp.trouble-step-61"><para>Get diagnostic messages
from PPPoE.</para><screen># pppd connect "/usr/lib/inet/pppoec -v <replaceable>interface-name</replaceable><userinput>"</userinput></screen><para><command>pppoec</command> sends
diagnostic information to the <filename>stderr</filename>. If you run <command>pppd</command> in
the foreground, the output appears
on the screen. If <command>pppd</command> runs
in the background, the output is sent
to <filename>/etc/ppp/connect-errors</filename>. </para><para>The next example shows
the messages that are generated as
the PPPoE tunnel is negotiated.</para><screen>Connect option: '/usr/lib/inet/pppoec -v hme0' started (pid 100564)
/usr/lib/inet/pppoec: PPPoE Event Open (1) in state Dead (0): action SendPADI (2)
/usr/lib/inet/pppoec: Sending PADI to ff:ff:ff:ff:ff:ff: 18 bytes
/usr/lib/inet/pppoec: PPPoE State change Dead (0) -> InitSent (1)
/usr/lib/inet/pppoec: Received Active Discovery Offer from 8:0:20:cd:c1:2/hme0:pppoed
/usr/lib/inet/pppoec: PPPoE Event rPADO+ (5) in state InitSent (1): action SendPADR+ (5)
/usr/lib/inet/pppoec: Sending PADR to 8:0:20:cd:c1:2: 22 bytes
/usr/lib/inet/pppoec: PPPoE State change InitSent (1) -> ReqSent (3)
/usr/lib/inet/pppoec: Received Active Discovery Session-confirmation from
   8:0:20:cd:c1:2/hme0:pppoed
/usr/lib/inet/pppoec: PPPoE Event rPADS (7) in state ReqSent (3): action Open (7)
/usr/lib/inet/pppoec: Connection open; session 0002 on hme0:pppoe
/usr/lib/inet/pppoec: PPPoE State change ReqSent (3) -> Convers (4)
/usr/lib/inet/pppoec: connected</screen><para>If the diagnostic messages do
not help you isolate the problem,
continue with this procedure.</para>
</step><step id="ppp.trouble-step-63"><para>Run <command>snoop</command>.
 Then save the trace to a file.</para><para>For information about <command>snoop</command>, refer to the <olink targetdoc="refman1m" targetptr="snoop-1m" remap="external"><citerefentry><refentrytitle>snoop</refentrytitle><manvolnum>1M</manvolnum></citerefentry></olink> man
page.</para><screen># snoop -o <replaceable>pppoe-trace-file</replaceable></screen>
</step><step id="ppp.trouble-step-64"><para>View the <command>snoop</command> trace
file.</para><screen># snoop -i <replaceable>pppoe-trace-file</replaceable> -v pppoe</screen><screen>ETHER: ----- Ether Header -----
ETHER:
ETHER: Packet 1 arrived at 6:35:2.77
ETHER: Packet size = 32 bytes
ETHER: Destination = ff:ff:ff:ff:ff:ff, (broadcast)
ETHER: Source      = 8:0:20:78:f3:7c, Sun
ETHER: Ethertype = 8863 (PPPoE Discovery)
ETHER:
PPPoE: ----- PPP Over Ethernet -----
PPPoE:
PPPoE: Version = 1
PPPoE: Type = 1
PPPoE: Code = 9 (Active Discovery Initiation)
PPPoE: Session Id = 0
PPPoE: Length = 12 bytes
PPPoE:
PPPoE: ----- Service-Name -----
PPPoE: Tag Type = 257
PPPoE: Tag Length = 0 bytes
PPPoE:
PPPoE: ----- Host-Uniq -----
PPPoE: Tag Type = 259
PPPoE: Tag Length = 4 bytes
PPPoE: Data = Ox00000002
PPPoE:
.
.
.
ETHER: ----- Ether Header -----
ETHER:
ETHER: Packet 5 arrived at 6:35:2.87
ETHER: Packet size = 60 bytes
ETHER: Destination = 8:0:20:78:f3:7c, Sun)
ETHER: Source      = 0:2:fd:39:7f:7, 
ETHER: Ethertype = 8864 (PPPoE Session)
ETHER:
PPPoE: ----- PPP Over Ethernet -----
PPPoE:
PPPoE: Version = 1
PPPoE: Type = 1
PPPoE: Code = 0 (PPPoE Session)
PPPoE: Session Id = 24383
PPPoE: Length = 20 bytes
PPPoE:
PPP: ----- Point-to-Point Protocol -----
PPP:
PPP-LCP: ----- Link Control Protocol -----
PPP-LCP:
PPP-LCP: Code = 1 (Configure Request)
PPP-LCP: Identifier = 80
PPP-LCP: Length = 18</screen>
</step>
</procedure>
</task>
</sect1><sect1 id="ppp.trouble-25"><title>Fixing
Leased-Line Problems</title><para>The most common problem
with leased lines is poor performance.
In most situations, you need to work
with the telephone company to fix
the problem. </para><table frame="topbot" pgwide="100" id="ppp.trouble-tbl-54"><title>Common
Leased-Line Problems</title><tgroup cols="3" colsep="0" rowsep="0"><colspec colname="colspec3" colwidth="34.90*"/><colspec colname="colspec4" colwidth="28.83*"/><colspec colname="colspec5" colwidth="35.26*"/><thead><row rowsep="1"><entry><para>Symptom</para>
</entry><entry><para>Problem</para>
</entry><entry><para>Solution</para>
</entry>
</row>
</thead><tbody><row><entry><para>The link does not start.</para>
</entry><entry><para>CSU biopolar violations (CSU
BPVs) can be the cause. One end of
the link is set up for AMI lines.
The other end is set up for ESF bit&#8211;8
zero substitute (B8Zs).</para>
</entry><entry><para>If you are in the United
States or Canada, you can directly
fix this problem from the menu of
the CSU/DSU. Check the CSU/DSU manufacturer's
documentation for details. </para><para>In other locales, the provider
might be responsible for fixing CSU
BPVs.</para>
</entry>
</row><row><entry><para>The link has poor performance.</para>
</entry><entry><para>The <command>pppd debug</command> output
shows CRC errors when sustained traffic
is on the link. Your line might have
a clocking problem, caused by misconfigurations
between the telephone company and
your network. </para>
</entry><entry><para>Contact the telephone company
to ensure that  &#8220;loop clocking&#8221;
is in use.</para><para>On some unstructured leased
lines, you might have to supply clocking.
North American users should use loop
clocking.</para><para></para>
</entry>
</row>
</tbody>
</tgroup>
</table>
</sect1><sect1 id="ppp.trouble-92"><title>Diagnosing
and Fixing Authentication Problems</title><para>The following table describes
solutions for general authentication
problems.</para><table frame="topbot" pgwide="100" id="ppp.trouble-tbl-99"><title>General
Authentication Problems</title><tgroup cols="3" colsep="0" rowsep="0"><colspec colwidth="29.63*"/><colspec colwidth="29.63*"/><colspec colwidth="39.73*"/><thead><row rowsep="1"><entry><para>Symptom</para>
</entry><entry><para>Problem</para>
</entry><entry><para>Solution</para>
</entry>
</row>
</thead><tbody><row><entry><para><command>pppd debug</command> output
shows the message <computeroutput>Peer
is not authorized to use remote address</computeroutput> <replaceable>address</replaceable>.</para>
</entry><entry><para>You are using PAP authentication,
and the IP address for the remote
peer is not in the <filename>/etc/ppp/pap-secrets</filename> file.</para>
</entry><entry><para>Add an asterisk (*) after the
entry for the peer in the <filename>/etc/ppp/pap-secrets</filename> file.</para>
</entry>
</row><row><entry><para><command>pppd debug</command> output
shows that LCP starts but terminates
shortly afterward.</para>
</entry><entry><para>The password might be incorrect
in the database for the particular
security protocol.</para>
</entry><entry><para>Check the password for the peer
in the <filename>/etc/ppp/pap-secrets</filename> or <filename>/etc/ppp/chap-secrets</filename> file.</para>
</entry>
</row>
</tbody>
</tgroup>
</table>
</sect1>
</chapter>