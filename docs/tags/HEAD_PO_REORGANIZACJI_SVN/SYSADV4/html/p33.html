<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>NFS Daemons - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Network Services<?GenHTML /ReferencePage> > <a href="p31.html">6.&nbsp;&nbsp;Accessing Network File Systems (Reference)</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p32.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p34.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="rfsrefer-8"></a><h3>NFS Daemons</h3>
<a name="indexterm-512"></a><p>To support NFS activities, several daemons are started when a system
goes into run level <tt>3</tt> or multiuser mode. The <tt>mountd</tt> and <tt>nfsd</tt> daemons are run on systems that are servers. The automatic
startup of the server daemons depends on the existence of entries that are
labeled with the NFS file-system type in <tt>/etc/dfs/sharetab</tt>.
To support NFS file locking, the <tt>lockd</tt> and <tt>statd</tt> daemons
are run on NFS clients and servers. However, unlike previous versions of NFS,
in NFS version 4, the daemons <tt>lockd</tt>, <tt>statd</tt>, <tt>mountd</tt>, and <tt>nfslogd</tt> are not used.</p>
<p>This section describes the following daemons.</p>
<ul><li><p><a href="p33.html#rfsrefer-65"><tt>automountd</tt> Daemon</a></p>
</li>
<li><p><a href="p33.html#rfsrefer-9"><tt>lockd</tt> Daemon</a></p>
</li>
<li><p><a href="p33.html#rfsrefer-10"><tt>mountd</tt> Daemon</a></p>
</li>
<li><p><a href="p33.html#rfsrefer-144"><tt>nfs4cbd</tt> Daemon</a></p>
</li>
<li><p><a href="p33.html#rfsrefer-11"><tt>nfsd</tt> Daemon</a></p>
</li>
<li><p><a href="p33.html#rfsrefer-7"><tt>nfslogd</tt> Daemon</a></p>
</li>
<li><p><a href="p33.html#rfsrefer-118"><tt>nfsmapid</tt> Daemon</a></p>
</li>
<li><p><a href="p35.html#rfsrefer-12"><tt>statd</tt> Daemon</a></p>
</li>
</ul>
<a name="rfsrefer-65"></a><h4><tt>automountd</tt> Daemon</h4>
<a name="indexterm-513"></a><a name="indexterm-514"></a><p>This daemon handles the mounting and unmounting requests from the autofs
service. The syntax of the command is as follows:</p>
<p><tt>automountd</tt> <tt>[</tt> <tt>-Tnv</tt> <tt>]</tt> <tt>[</tt> <tt>-D</tt> <i>name</i>=<i>value</i> <tt>]</tt></p>
<p>The command behaves in the following ways:</p>
<ul><li><p><tt>-T</tt> enables tracing.</p>
</li>
<li><p><tt>-n</tt> disables browsing on all autofs nodes.</p>
</li>
<li><p><tt>-v</tt> selects to log all status messages to the
console.</p>
</li>
<li><p><tt>-D</tt> <i>name</i>=<i>value</i> substitutes <i>value</i> for the automount
map variable that is indicated by <i>name</i>.</p>
</li>
</ul>
<p>The default value for the automount map is <tt>/etc/auto_master</tt>.
Use the <tt>-T</tt> option for troubleshooting.</p>
<a name="rfsrefer-9"></a><h4><tt>lockd</tt> Daemon</h4>
<a name="indexterm-515"></a><a name="indexterm-516"></a><p>This daemon supports record-locking operations on NFS files. The <tt>lockd</tt> daemon manages RPC connections between the client and the server
for the Network Lock Manager (NLM) protocol. The daemon is normally started
without any options. You can use three options with this command. See the <tt>lockd</tt>(1M) man page. These options can
either be used from the command line or by editing the appropriate string
in <tt>/etc/default/nfs</tt>. The following are descriptions of
keywords that can be set in the <tt>/etc/default/nfs</tt> file.</p>
<hr>
<p><b>Note - </b><a name="indexterm-517"></a><a name="indexterm-518"></a>Starting in the Solaris 10 release, the <tt>LOCKD_GRACE_PERIOD</tt> keyword
and the <tt>-g</tt> option have been deprecated. The deprecated keyword
is replaced with the new keyword <tt>GRACE_PERIOD</tt>.  If both
keywords are set, the value for <tt>GRACE_PERIOD</tt> overrides
the value for <tt>LOCKD_GRACE_PERIOD</tt>.  See the description
of <tt>GRACE_PERIOD</tt> that follows.</p>
<hr>
<p><a name="indexterm-519"></a>Like <tt>LOCKD_GRACE_PERIOD</tt>, <tt>GRACE_PERIOD</tt>=<i>graceperiod</i> in <tt>/etc/default/nfs</tt> sets the
number of seconds after a server reboot that the clients have to reclaim both
NFS version 3 locks, provided by NLM, and version 4 locks.  Thus, the value
for <tt>GRACE_PERIOD</tt> controls the length of the grace period
for lock recovery, for both NFS version 3 and NFS version 4.</p>
<p><a name="indexterm-520"></a><a name="indexterm-521"></a>The <tt>LOCKD_RETRANSMIT_TIMEOUT</tt>=<i>timeout</i> parameter
in <tt>/etc/default/nfs</tt> selects the number of seconds to
wait before retransmitting a lock request to the remote server. This option
affects the NFS client-side service. The default value for <i>timeout</i> is
15 seconds. Decreasing the <i>timeout</i> value can improve
response time for NFS clients on a &ldquo;noisy&rdquo; network. However, this
change can cause additional server load by increasing the frequency of lock
requests. The same parameter can be used from the command line by starting
the daemon with the <tt>-t</tt> <i>timeout</i> option.</p>
<p><a name="indexterm-522"></a><a name="indexterm-523"></a>The <tt>LOCKD_SERVERS</tt>=<i>nthreads</i> parameter
in <tt>/etc/default/nfs</tt> specifies the maximum number of concurrent
threads that the server handles per connection. Base the value for <i>nthreads</i> on the load that is expected on the NFS server. The default
value is 20. Each NFS client that uses TCP uses a single connection with the
NFS server. Therefore, each client can use a maximum of 20 concurrent threads
on the server.</p>
<p>All NFS clients that use UDP share a single connection with the NFS
server. Under these conditions, you might have to increase the number of threads
that are available for the UDP connection. A minimum calculation would be
to allow two threads for each UDP client. However, this number is specific
to the workload on the client, so two threads per client might not be sufficient.
The disadvantage to using more threads is that when the threads are used,
more memory is used on the NFS server. If the threads are never used, however,
increasing <i>nthreads</i> has no effect. The same parameter
can be used from the command line by starting the daemon with the <tt>nthreads</tt> option.</p>
<a name="rfsrefer-10"></a><h4><tt>mountd</tt> Daemon</h4>
<a name="indexterm-524"></a><a name="indexterm-525"></a><p>This daemon handles file-system mount requests from remote systems and
provides access control. The <tt>mountd</tt> daemon checks <tt>/etc/dfs/sharetab</tt> to determine which file systems are available for remote mounting
and which systems are allowed to do the remote mounting. You can use the <tt>-v</tt> option and the <tt>-r</tt> option with this command. See
the <tt>mountd</tt>(1M) man
page.</p>
<p>The <tt>-v</tt> option runs the command in verbose mode. Every
time an NFS server determines the access that a client should be granted,
a message is printed on the console. The information that is generated can
be useful when trying to determine why a client cannot access a file system.</p>
<p>The <tt>-r</tt> option rejects all future mount requests from
clients. This option does not affect clients that already have a file system
mounted.</p>
<hr>
<p><b>Note - </b>NFS version 4 does not use this daemon.</p>
<hr>
<a name="rfsrefer-144"></a><h4><tt>nfs4cbd</tt> Daemon</h4>
<a name="indexterm-526"></a><a name="indexterm-527"></a><p><tt>nfs4cbd</tt>, which is for the exclusive use of the NFS
version 4 client, manages the communication endpoints for the NFS version
4 callback program. The daemon has no user-accessible interface. For more
information, see the <tt>nfs4cbd</tt>(1M) man
page.</p>
<a name="rfsrefer-11"></a><h4><tt>nfsd</tt> Daemon</h4>
<a name="indexterm-528"></a><a name="indexterm-529"></a><p>This daemon handles other client file-system requests. You can use several
options with this command. See the <tt>nfsd</tt>(1M) man page for a complete listing. These
options can either be used from the command line or by editing the appropriate
string in <tt>/etc/default/nfs</tt>.</p>
<p>The <tt>NFSD_LISTEN_BACKLOG</tt>=<i>length</i> parameter
in <tt>/etc/default/nfs</tt> sets the length of the connection
queue over connection-oriented transports for NFS and TCP. The default value
is 32 entries. The same selection can be made from the command line by starting <tt>nfsd</tt> with the <tt>-l</tt> option.</p>
<p>The <tt>NFSD_MAX_CONNECTIONS</tt>=<i>#-conn</i> parameter
in <tt>/etc/default/nfs</tt> selects the maximum number of connections
per connection-oriented transport. The default value for <b>#-conn</b> is unlimited.
The same parameter can be used from the command line by starting the daemon
with the <tt>-c</tt> <i>#-conn</i> option.</p>
<p>The <tt>NFSD_SERVER</tt>=<i>nservers</i> parameter
in <tt>/etc/default/nfs</tt> selects the maximum number of concurrent
requests that a server can handle. The default value for <i>nservers</i> is
16. The same selection can be made from the command line by starting <tt>nfsd</tt> with the <tt>nservers</tt> option.</p>
<p>Unlike older versions of this daemon, <tt>nfsd</tt> does not
spawn multiple copies to handle concurrent requests. Checking the process
table with <tt>ps</tt> only shows one copy of the daemon running.</p>
<a name="rfsrefer-7"></a><h4><tt>nfslogd</tt> Daemon</h4>
<a name="indexterm-530"></a><a name="indexterm-531"></a><p>This daemon provides operational logging. NFS operations that are logged
against a server are based on the configuration options that are defined in <tt>/etc/default/nfslogd</tt>. When NFS server logging is enabled, records
of all RPC operations on a selected file system are written to a buffer file
by the kernel. Then <tt>nfslogd</tt> postprocesses these requests.
The name service switch is used to help map UIDs to logins and IP addresses
to host names. The number is recorded if no match can be found through the
identified name services. </p>
<p>Mapping of file handles to path names is also handled by <tt>nfslogd</tt>.
The daemon tracks these mappings in a file-handle-to-path mapping table. One
mapping table exists for each tag that is identified in <tt>/etc/nfs/nfslogd</tt>. After post-processing, the records are written to ASCII log files.</p>
<hr>
<p><b>Note - </b>NFS version 4 does not use this daemon.</p>
<hr>
<a name="rfsrefer-118"></a><h4><tt>nfsmapid</tt> Daemon</h4>
<a name="indexterm-532"></a><a name="indexterm-533"></a><p>Version 4 of the NFS protocol (RFC3530) changed the way user or group
 identifiers (UID or GID) are exchanged between the client and server. The
 protocol requires that a file's owner and group attributes be exchanged between
 an NFS version 4 client and an NFS version 4 server as strings in the form
of  <tt>user@nfsv4_domain</tt> or <tt>group@nfsv4_domain</tt>,
respectively.</p>
<p>For example, user <tt>known_user</tt> has a UID 123456 on
an NFS version 4 client whose fully qualified hostname is <tt>system.example.com</tt>. For the client to make requests to the NFS version 4 server, the
client must map the UID 123456 to <tt>known_user@example.com</tt> and
then send this attribute to the NFS version 4 server. The NFS version 4 server
expects to receive user and group file attributes in the <tt>user_or_group@nfsv4_domain</tt> format. After the server receives <tt>known_user@example.com</tt> from
the client, the server maps the string to the local UID 123456, which is understood
by the underlying file system. This functionality assumes that every UID and
GID in the network is unique and that the NFS version 4 domains on the client
match the NFS version 4 domains on the server.</p>
<hr>
<p><b>Note - </b>If the server does not recognize the given user or group name,
even if  the NFS version 4 domains match, the server is unable to map the
user or group name to its unique ID, an integer value. Under such circumstances,
the server maps the inbound user or group name to the <tt>nobody</tt> user.
To prevent such occurrences, administrators should avoid making special accounts
that only exist on the NFS version 4 client.</p>
<hr>
<p>The NFS version 4 client and server are both capable of performing integer-to-string
 and string-to-integer conversions. For example, in response to a GETATTR
operation, the NFS version 4 server maps UIDs and GIDs obtained from the underlying
file system into their respective string representation and sends this information
to the client. Alternately, the client must also map UIDs and GIDs into string
representations. For example, in response to the <tt>chown</tt> command,
the client maps the new UID or GID to a string representation before sending
a  SETATTR operation to the server.</p>
<p>Note, however, that the client and server respond differently to unrecognized
 strings:</p>
<ul><li><p>If the user does not exist on the server, even within the
same NFS version 4 domain configuration, the server rejects the remote procedure
call (RPC) and returns an error message to the client. This situation limits
the operations that can be performed by the remote user.</p>
</li>
<li><p>If the user exists on both the client and server, but they
have mismatched domains, the server rejects the attribute modifying operations
(such as SETATTR) that require the server to map the inbound user string to
an integer   value that the underlying file system can understand. For NFS
version 4 clients and servers to function properly, their NFS version 4 domains,
the portion of the string after the <tt>@</tt> sign, should match.</p>
</li>
<li><p>If the NFS version 4 client does not recognize a user or group
name from the server, the client is unable to map the string to its unique
ID, an integer value. Under such circumstances, the client maps the inbound
user or group string to the <tt>nobody</tt> user. This mapping to <tt>nobody</tt> creates varied problems for different applications. As for
NFS version 4 functionality, operations that modify file attributes will fail.</p>
</li>
</ul>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p32.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p34.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

