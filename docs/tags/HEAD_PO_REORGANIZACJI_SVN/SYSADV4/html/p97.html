<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Changes in
Version 8.13 of <tt>sendmail</tt> - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Network Services<?GenHTML /ReferencePage> > <a href="p87.html">14.&nbsp;&nbsp;Mail Services (Reference)</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p96.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p98.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="evemx"></a><h3>Changes in
Version 8.13 of <tt>sendmail</tt></h3>
<a name="indexterm-1483"></a><a name="indexterm-1484"></a><p>Starting in the Solaris 10 release,
version 8.13 is the default. Although
this new version of <tt>sendmail</tt> provides
many new features, the <tt>FallBackSmartHost</tt> option
is the most significant addition.
Because of this option you no longer
need to use <tt>main.cf</tt> and <tt>subsidiary.cf</tt>. The <tt>main.cf</tt> file was used in environments
that supported MX records. The <tt>subsidiary.cf</tt> file was
used in environments without a fully
operative DNS. In such environments
a smart host was used instead of MX
records. The <tt>FallBackSmartHost</tt> option provides unified
configuration. It operates like an
MX record of last possible preference
for all environments. To ensure that
mail gets delivered to clients, this
option, if enabled, provides a well-connected
(or smart) host that serves as a backup
(or failover) for MX records that
fail.</p>
<p>For more information about version
8.13, see the following sections:</p>
<ul><li><p><a href="p98.html">Additional Command-Line Options in Version 8.13 of <tt>sendmail</tt></a></p>
</li>
<li><p><a href="p98.html#evenf">Additional and Revised Configuration File Options in Version 8.13 of <tt>sendmail</tt></a></p>
</li>
<li><p><a href="p98.html#evenm">Additional and Revised <tt>FEATURE()</tt> Declarations in Version 8.13 of <tt>sendmail</tt></a></p>
</li>
</ul>
<p>Additionally, starting in the
Solaris 10 1/06 release, SMTP can
run with Transport Layer Security
(TLS). See the following description.</p>
<a name="fvbrb"></a><h4>Support for
Running SMTP With TLS in Version 8.13
of <tt>sendmail</tt></h4>
<a name="indexterm-1485"></a><a name="indexterm-1486"></a><a name="indexterm-1487"></a><a name="indexterm-1488"></a><p>Communications between SMTP
servers and clients are not usually
controlled or trusted on either end.
This lack of security might allow
a third party to monitor and even
alter a communication between a server
and a client. Starting in the Solaris
10 1/06 release, SMTP can use Transport
Layer Security (TLS) in version 8.13
of <tt>sendmail</tt> to
resolve this problem. This extended
service to SMTP servers and clients
provides the following:</p>
<ul><li><p>Private,
authenticated communications over
the Internet</p>
</li>
<li><p>Protection from eavesdroppers
and attackers</p>
</li>
</ul>
<hr>
<p><b>Note - </b>The implementation of
TLS is based on the Secure Sockets
Layer (SSL) protocol.</p>
<hr>
<p><tt>STARTTLS</tt> is
the SMTP keyword that initiates a
secure SMTP connection by using TLS.
This secure connection might be between
two servers or between a server and
a client. A secure connection is defined
as follows:</p>
<ul><li><p>The source email address
and the destination address are encrypted.</p>
</li>
<li><p>The content of the
email message is encrypted.</p>
</li>
</ul>
<p>When the client issues the <tt>STARTTLS</tt> command, the server
responds with one of the following:</p>
<ul><li><p><tt>220 Ready
to start TLS</tt></p>
</li>
<li><p><tt>501 Syntax
error (no parameters allowed)</tt></p>
</li>
<li><p><tt>454 TLS not
available due to temporary reason</tt></p>
</li>
</ul>
<p>The <tt>220</tt> response
requires the client to start the TLS
negotiation. The <tt>501</tt> response
notes that the client incorrectly
issued the <tt>STARTTLS</tt> command.
 <tt>STARTTLS</tt> is issued
with no parameters. The <tt>454</tt> response
necessitates that the client apply
rule set values to determine whether
to accept or maintain the connection.</p>
<p>Note that to maintain the Internet's
SMTP infrastructure, publicly used
servers must not require a TLS negotiation.
However, a server that is used privately
might require the client to perform
a TLS negotiation. In such instances,
the server returns this response:</p>
<pre>530 Must issue a STARTTLS command first</pre><p>The <tt>530</tt> response
instructs the client to issue the <tt>STARTTLS</tt> command to establish
a connection.</p>
<p>The server or client can refuse
a connection if the level of authentication
and privacy is not satisfactory. Alternately,
because most SMTP connections are
not secure, the server and client
might maintain an unsecure connection.
Whether to maintain or refuse a connection
is determined by the configuration
of the server and the client.</p>
<p>Support for running SMTP with
TLS is not enabled by default. TLS
is enabled when the SMTP client issues
the <tt>STARTTLS</tt> command.
Before the SMTP client can issue this
command, you must set up the certificates
that enable <tt>sendmail</tt> to
use TLS. See <a href="p77.html#fxcty">How to Set SMTP to Use TLS</a>. Note
that this procedure includes defining
new configuration file options and
rebuilding your <tt>sendmail.cf</tt> file.</p>
<a name="fvbqb"></a><h5>Configuration
File Options for Running SMTP With
TLS</h5>
<a name="indexterm-1489"></a><a name="indexterm-1490"></a><a name="indexterm-1491"></a><a name="indexterm-1492"></a><p>The following table describes
the configuration file options that
are used to run SMTP with TLS. If
you declare any of these options,
use one of the following syntaxes:</p>
<ul><li><p><tt>O</tt> <i>OptionName</i>=<i>argument</i>          <tt>#
for the configuration file</tt></p>
</li>
<li><p><tt>-O</tt> <i>OptionName</i>=<i>argument</i>         <tt>#
for the command line</tt></p>
</li>
<li><p><tt>define(`</tt><i>m4Name</i>',<i>argument</i><tt>)</tt> 
   <tt># for m4 configuration</tt></p>
</li>
</ul>
<a name="fvzls"></a>Table 14-13 Configuration File
Options for Running SMTP With TLS<table><tr><th><p>Option</p>
</th><th><p>Description</p>
</th></tr>
<tr><td><p><tt>CACertFile</tt></p>
</td><td><p><tt>m4</tt> name: <tt>confCACERT</tt></p>
<p>Argument: <i>filename</i></p>
<p>Default value: undefined</p>
<p>Identifies the file that contains
one CA certificate.</p>
</td></tr>
<tr><td><p><tt>CACertPath</tt></p>
</td><td><p><tt>m4</tt> name: <tt>confCACERT_PATH</tt></p>
<p>Argument: <i>path</i></p>
<p>Default value: undefined</p>
<p>Identifies the path to the directory
that contains certificates of CAs.</p>
</td></tr>
<tr><td><p><tt>ClientCertFile</tt></p>
</td><td><p><tt>m4</tt> name: <tt>confCLIENT_CERT</tt></p>
<p>Argument: <i>filename</i></p>
<p>Default value: undefined</p>
<p>Identifies the file that contains
the certificate of the client. Note
that this certificate is used when <tt>sendmail</tt> acts as a client.</p>
</td></tr>
<tr><td><p><tt>ClientKeyFile</tt></p>
</td><td><p><tt>m4</tt> name: <tt>confCLIENT_KEY</tt></p>
<p>Argument: <i>filename</i></p>
<p>Default value: undefined</p>
<p>Identifies the file that contains
the private key that belongs to the
client certificate.</p>
</td></tr>
<tr><td><p><tt>CRLFile</tt></p>
</td><td><p><tt>m4</tt> name: <tt>confCRL</tt></p>
<p>Argument: <i>filename</i></p>
<p>Default value: undefined</p>
<p>Identifies the file that contains
the certificate revocation status,
which is used for X.509v3 authentication.</p>
</td></tr>
<tr><td><p><tt>DHParameters</tt></p>
</td><td><p><tt>m4</tt> name: <tt>confDH_PARAMETERS</tt></p>
<p>Argument: <i>filename</i></p>
<p>Default value: undefined</p>
<p>Identifies the file that contains
the Diffie-Hellman (DH) parameters.</p>
</td></tr>
<tr><td><p><tt>RandFile</tt></p>
</td><td><p><tt>m4</tt> name: <tt>confRAND_FILE</tt></p>
<p>Argument: <tt>file:</tt><i>filename</i> or <tt>egd:</tt><i>UNIX socket</i></p>
<p>Default value: undefined</p>
<p>Uses the <tt>file:</tt> prefix
to identify the file that contains
random data or uses the <tt>egd:</tt> prefix
to identify the UNIX socket. Note
that because the Solaris OS supports
the <tt>random</tt> number
generator device, this option does
not need to be specified. See the <tt>random</tt>(7D) man
page.</p>
</td></tr>
<tr><td><p><tt>ServerCertFile</tt></p>
</td><td><p><tt>m4</tt> name: <tt>confSERVER_CERT</tt></p>
<p>Argument: <i>filename</i></p>
<p>Default value: undefined</p>
<p>Identifies the file that contains
the server's certificate. This certificate
is used when <tt>sendmail</tt> acts
as a server.</p>
</td></tr>
<tr><td><p><tt>Timeout.starttls</tt></p>
</td><td><p><tt>m4</tt> name: <tt>confTO_STARTTLS</tt></p>
<p>Argument: <i>amount
of time</i></p>
<p>Default value: <tt>1h</tt></p>
<p>Sets the amount of time the
SMTP client waits for a response to
the <tt>STARTTLS</tt> command.</p>
</td></tr>
<tr><td><p><tt>TLSSrvOptions</tt></p>
</td><td><p><tt>m4</tt> name: <tt>confTLS_SRV_OPTIONS</tt></p>
<p>Argument: <tt>V</tt></p>
<p>Default value: undefined</p>
<p>Determines whether the server
asks for a certificate from the client.
If this option is set to <tt>V</tt>,
no client verification is performed.</p>
</td></tr>
</table><p>For <tt>sendmail</tt> to
support SMTP's use of TLS, the following
options must be defined:</p>
<ul><li><p><tt>CACertPath</tt></p>
</li>
<li><p><tt>CACertFile</tt></p>
</li>
<li><p><tt>ServerCertFile</tt></p>
</li>
<li><p><tt>ClientKeyFile</tt></p>
</li>
</ul>
<p>Other options are not required.</p>
<a name="fvbqm"></a><h5>Macros for
Running SMTP With TLS</h5>
<a name="indexterm-1493"></a><a name="indexterm-1494"></a><a name="indexterm-1495"></a><a name="indexterm-1496"></a><p>The following table describes
the macros that are used by the <tt>STARTTLS</tt> command.</p>
<a name="fwaun"></a>Table 14-14 Macros for Running
SMTP With TLS<table><tr><th><p>Macro</p>
</th><th><p>Description</p>
</th></tr>
<tr><td><p><tt>${cert_issuer}</tt></p>
</td><td><p>Holds the distinguished name
(DN) of the certification authority
(CA), which is the certificate issuer.</p>
</td></tr>
<tr><td><p><tt>${cert_subject}</tt></p>
</td><td><p>Holds the DN of the certificate
that is called the <b>cert subject</b>.</p>
</td></tr>
<tr><td><p><tt>${cn_issuer}</tt></p>
</td><td><p>Holds the common name (CN) of
the CA, which is the <b>cert issuer</b>.</p>
</td></tr>
<tr><td><p><tt>${cn_subject}</tt></p>
</td><td><p>Holds the CN of the certificate
that is called the <b>cert subject</b>.</p>
</td></tr>
<tr><td><p><tt>${tls_version}</tt></p>
</td><td><p>Holds the version of TLS that
is used for the connection.</p>
</td></tr>
<tr><td><p><tt>${cipher}</tt></p>
</td><td><p>Holds a set of cryptographic
algorithms (known as a <b>cipher suite</b>)
that is used for the connection.</p>
</td></tr>
<tr><td><p><tt>${cipher_bits}</tt></p>
</td><td><p>Holds in bits the key length
of the symmetric encryption algorithm
that is used for the connection.</p>
</td></tr>
<tr><td><p><tt>${verify}</tt></p>
</td><td><p>Holds the result of the verification
of the certificate that was presented.
Possible values are as follows:</p>
<ul><li><p><tt>OK</tt> &ndash;
The verification succeeded.</p>
</li>
<li><p><tt>NO</tt> &ndash;
No certificate was presented.</p>
</li>
<li><p><tt>NOT</tt> &ndash;
No certificate was requested.</p>
</li>
<li><p><tt>FAIL</tt> &ndash;
The certificate that was presented
could not be verified.</p>
</li>
<li><p><tt>NONE</tt> &ndash; <tt>STARTTLS</tt> has not been performed.</p>
</li>
<li><p><tt>TEMP</tt> &ndash;
Temporary error occurred.</p>
</li>
<li><p><tt>PROTOCOL</tt> &ndash;
SMTP error occurred.</p>
</li>
<li><p><tt>SOFTWARE</tt> &ndash; <tt>STARTTLS</tt> handshake failed.</p>
</li>
</ul>
</td></tr>
<tr><td><p><tt>${server_name}</tt></p>
</td><td><p>Holds the name of the server
with the current outgoing SMTP connection.</p>
</td></tr>
<tr><td><p><tt>${server_addr}</tt></p>
</td><td><p>Holds the address of the server
with the current outgoing SMTP connection.</p>
</td></tr>
</table><a name="fvbrj"></a><h5>Rule Sets
for Running SMTP With TLS</h5>
<a name="indexterm-1497"></a><a name="indexterm-1498"></a><a name="indexterm-1499"></a><a name="indexterm-1500"></a><p>The following table describes
rule sets that determine whether an
SMTP connection that uses TLS should
be accepted, continued, or refused.</p>
<a name="fwadt"></a>Table 14-15 Rule Sets for Running
SMTP With TLS<table><tr><th><p>Rule Set</p>
</th><th><p>Description</p>
</th></tr>
<tr><td><p><tt>tls_server</tt></p>
</td><td><p>Acting as a client, <tt>sendmail</tt> uses this rule set to determine
whether the server is currently supported
by TLS.</p>
</td></tr>
<tr><td><p><tt>tls_client</tt></p>
</td><td><p>Acting as a server, <tt>sendmail</tt> uses this rule set to determine
whether the client is currently supported
by TLS.</p>
</td></tr>
<tr><td><p><tt>tls_rcpt</tt></p>
</td><td><p>This rule set requires verification
of the recipient's MTA. This recipient
restriction makes attacks such as
DNS spoofing impossible.</p>
</td></tr>
<tr><td><p><tt>TLS_connection</tt></p>
</td><td><p>This rule set checks the requirement
that is specified by the RHS of the
access map against the actual parameters
of the current TLS connection.</p>
</td></tr>
<tr><td><p><tt>try_tls</tt></p>
</td><td><p><tt>sendmail</tt> uses
this rule set to determine the feasibility
of using <tt>STARTTLS</tt> when
connecting to another MTA. If the
MTA cannot properly implement <tt>STARTTLS</tt>, then <tt>STARTTLS</tt> is
not used.</p>
</td></tr>
</table><p>For more information, see the
following:</p>
<ul><li><p><i>Sendmail
Installation and Operation Guide</i> &ndash; <a href="http://people.freenet.de/slgig/op_en/rules.html">http://people.freenet.de/slgig/op_en/rules.html</a></p>
</li>
<li><p><tt>cf/README</tt> for <tt>sendmail</tt> &ndash; <a href="http://people.freenet.de/slgig/op_en/rules.html">http://people.freenet.de/slgig/op_en/rules.html</a></p>
</li>
</ul>
<a name="fvbqd"></a><h5>Security
Considerations Related to Running
SMTP With TLS</h5>
<a name="indexterm-1501"></a><a name="indexterm-1502"></a><a name="indexterm-1503"></a><a name="indexterm-1504"></a><p>As a standard mail protocol
that defines mailers that run over
the Internet, SMTP is not an end-to-end
mechanism. Because of this protocol
limitation, TLS security through SMTP
does not include mail user agents.
Mail user agents act as an interface
between users and a mail transfer
agent such as <tt>sendmail</tt>.</p>
<p>Also, mail might be routed through
multiple servers. For complete SMTP
security the entire chain of SMTP
connections must have TLS support.</p>
<p>Finally, the level of negotiated
authentication and privacy between
each pair of servers or a client and
server pair must be considered. For
more information, see Authentication Services in <i>System Administration Guide: Security Services</i>.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p96.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p98.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

