<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p55.html#ipv6-ref-76">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p61.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p63.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipv6-ref-47"></A><h2>IPv6 Tunnels</h2>
<p>To minimize any dependencies at a dual-stack, IPv4/IPv6 site, all the
routers in the path between two IPv6 nodes do not need to support IPv6. The
mechanism that supports such a network configuration is called <b>tunneling</b>. Basically, IPv6 packets are placed inside IPv4 packets, which
are then routed through the IPv4 routers. The following figure illustrates
the tunneling mechanism through IPv4 routers, which are indicated in the figure
by "R."<A NAME="indexterm-1301"></A></p>
<A NAME="ipv6-ref-fig-95"></A><p><b>Figure 11-5 </b>IPv6 Tunneling Mechanism</p>
<IMG src="figures/tunnel.gif" class="figure" alt="Illustrates how IPv6 packets that are placed inside IPv4
packets are tunneled through routers that use IPv4." title="Illustrates how IPv6 packets that are placed inside IPv4
packets are tunneled through routers that use IPv4."><p>The Solaris IPv6 implementation includes two types of tunneling mechanisms:</p>
<ul><li><p>Configured tunnels between two routers, as in <A HREF="p62.html#ipv6-ref-fig-95">Figure 11-5</A></p>
</li>
<li><p>Automatic tunnels that terminate at the endpoint hosts</p>
</li>
</ul>
<p>A configured tunnel is currently used on the Internet for other purposes,
for example, on the MBONE, the IPv4 multicast backbone. Operationally, the
tunnel consists of two routers that are configured to have a virtual point-to-point
link between the two routers over the IPv4 network. This kind of tunnel is
likely to be used on some parts of the Internet for the foreseeable future.</p>
<p><A NAME="indexterm-1302"></A><A NAME="indexterm-1303"></A>Automatic tunnels require IPv4-compatible addresses. Automatic
tunnels  can be used to connect IPv6 nodes when IPv6 routers are not available.
These tunnels can originate either on a dual-stack host or on a dual-stack
router by configuring an automatic tunneling network interface. The tunnels
always terminate on the dual-stack host. These tunnels work by dynamically
determining the destination IPv4 address, which is the endpoint of the tunnel,
by extracting the address from the IPv4-compatible destination address.</p>
<A NAME="ipv6-ref-49"></A><h3>Configured Tunnels</h3>
<A NAME="indexterm-1304"></A><A NAME="indexterm-1305"></A><p>Tunneling interfaces have the following format:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>ip.tun <i>ppa</i></pre>
</td></table><br><p><A NAME="indexterm-1306"></A><i>ppa</i> is the physical point of attachment.</p>
<p><A NAME="indexterm-1307"></A>At system startup, the tunneling module (<tt>tun</tt>)
is pushed, by the <tt>ifconfig</tt> command, on top of IP to create
a virtual interface. The push is accomplished by creating the appropriate <tt>hostname6.*</tt> file.</p>
<p>For example, to create a tunnel to encapsulate IPv6 packets over an
IPv4 network, IPv6 over IPv4, you would create the following file name:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>/etc/hostname6.ip.tun0</pre>
</td></table><br><p><A NAME="indexterm-1308"></A>The content of this file is passed to <tt>ifconfig</tt> after
the interfaces have been plumbed. The content becomes the parameters that
are necessary to configure a point-to-point tunnel.</p>
<A NAME="ipv6-ref-ex-96"></A><p><b>Example 11-11 </b><tt>hostname6.ip.tun0</tt> File
for an IPv6 Over IPv4 Tunnel</p>
<p>The following is an example of entries in the <tt>hostname6.ip.tun0</tt> file:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>tsrc 10.10.10.23 tdst 172.16.7.19 up
addif 2001:db8:3b4c:1:5678:5678::2 up</pre>
</td></table><br><p><A NAME="indexterm-1309"></A>In this example, the IPv4 source and destination addresses are
used as tokens to autoconfigure IPv6 link-local addresses. These addresses
are the source and destination for the <tt>ip.tun0</tt> interface.
 Two interfaces are configured. The <tt>ip.tun0</tt> interface is
configured. A logical interface,  <tt>ip.tun0:1</tt>, is also configured.
The logical interface has the source and destination IPv6 addresses specified
by the <tt>addif</tt> command.</p>
<p>The contents of these configuration files are passed to <tt>ifconfig</tt> without
change when the system is started in multiuser mode. The entries in <A HREF="p62.html#ipv6-ref-ex-96">Example 11-11</A> are equivalent to the
following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig ip.tun0 inet6 plumb</b></tt>
# <tt><b>ifconfig ip.tun0 inet6 tsrc 10.0.0.23 tdst 172.16.7.19 up</b></tt>
# <tt><b>ifconfig ip.tun0 inet6 addif 2001:db8:3b4c:1:5678:5678::2 up</b></tt></pre>
</td></table><br><p>The following shows the output of <tt>ifconfig</tt> <tt>-a</tt> for
this tunnel.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>ip.tun0: flags=2200850&lt;UP,POINTOPOINT,RUNNING,MULTICAST,
  NONUD,IPv6> mtu 1480 index 6
        inet tunnel src 10.0.0.23  tunnel dst 172.16.7.19
        inet6 fe80::c0a8:6417/10 --> fe80::c0a8:713
ip.tun0:1: flags=2200850&lt;UP,POINTOPOINT,RUNNING,MULTICAST,NONUD,IPv6> mtu 1480 
  index 5
        inet6 2001:db8:3b4c:1:5678:5678::2 </pre>
</td></table><br><p>You can configure more logical interfaces by adding lines to the configuration
file by using the following syntax:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>addif IPv6-source IPv6-destination up</pre>
</td></table><br><p><hr size="1" noshade><p><b>Note - </b>When either end of the tunnel is an IPv6 router that advertises
one or more prefixes over the tunnel, you do not need <tt>addif</tt> commands
in the tunnel configuration files. Only <tt>tsrc</tt> and <tt>tdst</tt> might be required because all other addresses are autoconfigured.</p>
<hr size="1" noshade></p><p>In some situations, specific source and destination link-local addresses
need to be manually configured for a particular tunnel. Change the first line
of the configuration file to include these link-local addresses.  The following
line is an example:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>tsrc 10.0.0.23 tdst 172.16.7.19 fe80::1/10 fe80::2 up</pre>
</td></table><br><p>Notice that the source link-local address has a prefix length of 10.
 In this example, the <tt>ip.tun0</tt> interface resembles the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>ip.tun0: flags=2200850&lt;UP,POINTOPOINT,RUNNING,MULTICAST,NONUD,IPv6> mtu 1480 
index 6
        inet tunnel src 10.0.0.23  tunnel dst 172.16.7.19
        inet6 fe80::1/10 --> fe80::2</pre>
</td></table><br><p>To create a tunnel to encapsulate IPv6 packets over an IPv6 network,
IPv6 over IPv6, you create the following file name:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>/etc/hostname6.ip6.tun0</pre>
</td></table><br><A NAME="ipv6-ref-ex-97"></A><p><b>Example 11-12 </b><tt>hostname6.ip6.tun0</tt> File
for an IPv6 over IPv6 Tunnel</p>
<p>The following is an example of entries in the <tt>hostname6.ip6.tun0</tt> file
for IPv6 encapsulation over an IPv6 network:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>tsrc 2001:db8:3b4c:114:a00:20ff:fe72:668c 
        tdst 2001:db8:15fa:25:a00:20ff:fe9b:a1c3
fe80::4 fe80::61 up</pre>
</td></table><br><p>To create a tunnel to encapsulate IPv4 packets over an IPv6 network,
IPv4 over IPv6, you would create the following file name:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>/etc/hostname.ip6.tun0</pre>
</td></table><br><A NAME="ipv6-ref-ex-98"></A><p><b>Example 11-13 </b><tt>hostname.ip6.tun0</tt> File
for an IPv4 Over IPv6 Tunnel</p>
<p>The following is an example of entries in the <tt>hostname.ip6.tun0</tt> file
for IPv4 encapsulation over an IPv6 network:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>tsrc 2001:db8:3b4c:114:a00:20ff:fe72:668c 
         tdst 2001:db8:15fa:25:a00:20ff:fe9b:a1c3
10.0.0.4 10.0.0.61 up</pre>
</td></table><br><p>To create a tunnel to encapsulate IPv4 packets over an IPv4 network,
IPv4 over IPv4, you would create the following file name:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>/etc/hostname.ip.tun0</pre>
</td></table><br><A NAME="ipv6-ref-ex-99"></A><p><b>Example 11-14 </b><tt>hostname.ip.tun0</tt> for
an IPv4 Over IPv4 Tunnel</p>
<p>The following is an example of entries in the <tt>hostname.ip.tun0</tt> file
for IPv4 encapsulation over an IPv4 network:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>tsrc 172.16.86.158 tdst 192.168.86.122
10.0.0.4 10.0.0.61 up</pre>
</td></table><br><p>For specific information about <tt>tun</tt>, see the <tt>tun</tt>(7M)  man page. For a general
description of tunneling concepts during the transition to IPv6, see <A HREF="p13.html#ipv6-overview-160">Overview of IPv6 Tunnels</A>. For a description
of procedures for configuring tunnels, see <A HREF="p37.html#ipv6-config-tasks-17">Tasks for Configuring Tunnels for IPv6 Support (Task Map)</A>.</p>
<A NAME="ipv6-ref-50"></A><h3>6to4 Automatic Tunnels</h3>
<A NAME="indexterm-1310"></A><p><A NAME="indexterm-1311"></A><A NAME="indexterm-1312"></A>The Solaris OS includes 6to4 tunnels as a preferred interim method
for making the transition from IPv4 to IPv6 addressing. 6to4 tunnels enable
isolated IPv6 sites to communicate across an automatic tunnel over an IPv4
network that does not support IPv6. To use 6to4 tunnels, you must configure
a boundary router on your IPv6 network as one endpoint of the 6to4 automatic
tunnel. Thereafter, the 6to4 router can participate in a tunnel to another
6to4 site, or, if required, to a native IPv6, non-6to4 site.</p>
<p>This section provides reference materials on the following 6to4 topics:</p>
<ul><li><p>Topology of the 6to4 tunnel</p>
</li>
<li><p>6to4 addressing, including the format of the advertisement</p>
</li>
<li><p>Description of packet flow across a 6to4 tunnel</p>
</li>
<li><p>Topology of a tunnel between a 6to4 router and a 6to4 relay
router</p>
</li>
<li><p>Points to consider before you configure 6to4 relay router
support</p>
</li>
</ul>
<p>More information about 6to4 routing is available from the following
sources.</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Task or Detail</p></th><th scope="col"><p>For Information</p></th></tr>
<tr><td><p>Tasks for configuring a 6to4 tunnel</p></td><td><p><A HREF="p38.html#ipv6-config-tasks-24">How to Configure a 6to4 Tunnel</A>&nbsp;</p></td></tr>
<tr><td><p>6to4-related RFC</p></td><td><p><A  HREF="ftp://ftp.rfc-editor.org/in-notes/rfc3056.txt">RFC 3056, "Connection of IPv6 Domains via IPv4 Clouds"</A></p></td></tr>
<tr><td><p>Detailed information about the <tt>6to4relay</tt> command,
which enables support for tunnels to a 6to4 relay router</p></td><td><p><tt>6to4relay</tt>(1M)</p></td></tr>
<tr><td><p>6to4 security issues</p></td><td><p><A  HREF="ftp://ftp.rfc-editor.org/in-notes/rfc3964.txt"> Security
Considerations for 6to4</A></p></td></tr>
</table>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p61.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p63.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

