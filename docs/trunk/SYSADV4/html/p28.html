<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>How to Verify the NFS Service on the Server - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Network Services<?GenHTML /ReferencePage> > <a href="p15.html">5.&nbsp;&nbsp;Network File System Administration (Tasks)</a> > <a href="p27.html#rfsadmin-215">NFS Troubleshooting Procedures</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p27.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p29.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="rfsadmin-231"></a><h4><img src="graphics/procedure.gif"> How to Verify the NFS Service on the Server</h4>
<ol><li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information
about roles, see Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i>. To configure
a role with the Primary Administrator profile, see Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i>.</p></li><li><a name="rfsadmin-step-234"></a><b>Check that the server can reach the clients. </b><pre># <tt><b>ping lilac</b></tt>
lilac is alive</pre></li><li><a name="rfsadmin-step-235"></a><b>If the client is not reachable from the
server, ensure that the local name service is running. For NIS+ clients, type
the following:</b><pre>% <tt><b>/usr/lib/nis/nisping -u</b></tt>
Last updates for directory eng.acme.com. :
Master server is eng-master.acme.com.
        Last update occurred at Mon Jun  5 11:16:10 1995

Replica server is eng1-replica-58.acme.com.
        Last Update seen was Mon Jun  5 11:16:10 1995</pre></li><li><a name="rfsadmin-step-236"></a><b>If the name service is running, check the
networking software configuration on the server, for example, <tt>/etc/netmasks</tt> and <tt>/etc/nsswitch.conf</tt>.</b></li><li><a name="rfsadmin-step-239"></a><b><a name="indexterm-398"></a>Type the following command to check whether the <tt>rpcbind</tt> daemon
is running. </b><pre># <tt><b>/usr/bin/rpcinfo -u localhost rpcbind</b></tt>
program 100000 version 1 ready and waiting
program 100000 version 2 ready and waiting
program 100000 version 3 ready and waiting</pre><p><a name="indexterm-399"></a>If the server is running, it prints a list of program and version
numbers that are associated with the UDP protocol. If <tt>rpcbind</tt> seems
to be hung, either reboot the server or follow the steps in <a href="p28.html#rfsadmin-243">How to Warm-Start <tt>rpcbind</tt></a>. </p></li><li><a name="rfsadmin-step-237"></a><b><a name="indexterm-400"></a><a name="indexterm-401"></a>Type the following command to check whether the <tt>nfsd</tt> daemon
is running.  </b><pre># <tt><b>rpcinfo -u localhost nfs</b></tt>
program 100003 version 2 ready and waiting
program 100003 version 3 ready and waiting
# <tt><b>ps -ef | grep nfsd</b></tt>
root    232      1  0  Apr 07     ?     0:01 /usr/lib/nfs/nfsd -a 16
root   3127   2462  1  09:32:57  pts/3  0:00 grep nfsd</pre><hr>
<p><b>Note - </b>NFS version 4 does not support UDP.</p>
<hr>
<p>If the server is running, it prints a list of program and version numbers
that are associated with the UDP protocol. Also use the <tt>-t</tt> option
with <tt>rpcinfo</tt> to check the TCP connection. If these commands
fail, restart the NFS service. See <a href="p28.html#rfsadmin-240">How to Restart NFS Services</a>. </p></li><li><a name="rfsadmin-step-238"></a><b><a name="indexterm-402"></a><a name="indexterm-403"></a><a name="indexterm-404"></a><a name="indexterm-405"></a>Type the following command to check whether the <tt>mountd</tt> daemon
is running.    </b><pre># <tt><b>/usr/bin/rpcinfo -u localhost mountd</b></tt>
program 100005 version 1 ready and waiting
program 100005 version 2 ready and waiting
program 100005 version 3 ready and waiting
# <tt><b>ps -ef | grep mountd</b></tt>
root    145      1 0 Apr 07  ?     21:57 /usr/lib/autofs/automountd
root    234      1 0 Apr 07  ?     0:04  /usr/lib/nfs/mountd
root   3084 2462 1 09:30:20 pts/3  0:00  grep mountd</pre><p>If the server is running, it prints a list of program and version numbers
that are associated with the UDP protocol. Also use the <tt>-t</tt> option
with <tt>rpcinfo</tt> to check the TCP connection. If these commands
fail, restart the NFS service. See <a href="p28.html#rfsadmin-240">How to Restart NFS Services</a>. </p></li></ol><a name="rfsadmin-240"></a><h4><img src="graphics/procedure.gif"> How to Restart NFS Services</h4>
<a name="indexterm-406"></a><ol><li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information
about roles, see Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i>. To configure
a role with the Primary Administrator profile, see Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i>.</p></li><li><a name="rfsadmin-step-242"></a><b>Restart the NFS service on the server.</b><p>Type the following command.</p><pre># <tt><b>svcadm restart network/nfs/server</b></tt></pre></li></ol><a name="rfsadmin-243"></a><h4><img src="graphics/procedure.gif"> How to Warm-Start <tt>rpcbind</tt></h4>
<p><a name="indexterm-407"></a><a name="indexterm-408"></a>If the NFS server cannot be rebooted because of work in progress,
you can restart <tt>rpcbind</tt> without having to restart all of
the services that use RPC. Just complete a warm start by following these steps.</p>
<ol><li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information
about roles, see Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i>. To configure
a role with the Primary Administrator profile, see Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i>.</p></li><li><a name="rfsadmin-step-245"></a><b>Determine the PID for <tt>rpcbind</tt>.</b><p>Run <tt>ps</tt> to get the PID, which is the value
in the second column.</p><pre># <tt><b>ps -ef |grep rpcbind</b></tt>
    root   115     1  0   May 31 ?        0:14 /usr/sbin/rpcbind
    root 13000  6944  0 11:11:15 pts/3    0:00 grep rpcbind</pre></li><li><a name="rfsadmin-step-246"></a><b>Send a SIGTERM signal to the <tt>rpcbind</tt> process.</b><p>In this example, <tt>term</tt> is the signal that is
to be sent and <tt>115</tt> is the PID for the program (see the <tt>kill</tt>(1) man page). This command causes <tt>rpcbind</tt> to create a list of the current registered services in <tt>/tmp/portmap.file</tt> and <tt>/tmp/rpcbind.file</tt>.</p><pre># <tt><b>kill -s term 115</b></tt></pre><hr>
<p><b>Note - </b>If you do not kill the <tt>rpcbind</tt> process with
the <tt>-s</tt> <tt>term</tt> option, you cannot complete
a warm start of <tt>rpcbind</tt>. You must reboot the server to
restore service.</p>
<hr>
</li><li><a name="rfsadmin-step-247"></a><b>Restart <tt>rpcbind</tt>.</b><p>Warm-restart the command so that the files that were created by the <tt>kill</tt> command are consulted. A warm start also ensures that the process
resumes without requiring a restart of all the RPC services. See the <tt>rpcbind</tt>(1M) man page.</p><pre># <tt><b>/usr/sbin/rpcbind -w</b></tt></pre></li></ol><a name="rfsadmin-248"></a><h4>Identifying Which Host Is Providing NFS File
Service</h4>
<a name="indexterm-409"></a><a name="indexterm-410"></a><p>Run the <tt>nfsstat</tt> command with the <tt>-m</tt> option
to gather current NFS information. The name of the current server is printed
after &ldquo;<tt>currserver=</tt>&rdquo;. </p>
<pre>% <tt><b>nfsstat -m</b></tt>
/usr/local from bee,wasp:/export/share/local
 Flags: vers=3,proto=tcp,sec=sys,hard,intr,llock,link,synlink,
		acl,rsize=32768,wsize=32678,retrans=5
 Failover: noresponse=0, failover=0, remap=0, currserver=bee</pre><a name="rfsadmin-251"></a><h4><img src="graphics/procedure.gif"> How to Verify Options Used With the <tt>mount</tt> Command</h4>
<p>In the Solaris 2.6 release and in any versions of the <tt>mount</tt> command
that were patched after the 2.6 release, no warning is issued for invalid
options. The following procedure helps determine whether the options that
were supplied either on the command line or through <tt>/etc/vfstab</tt> were
valid.</p>
<p>For this example, assume that the following command has been run:</p>
<pre># <tt><b>mount -F nfs -o ro,vers=2 bee:/export/share/local /mnt</b></tt></pre><ol><li><a name="rfsadmin-step-253"></a><b>Verify the options by running the following
command.</b><pre>% <tt><b>nfsstat -m</b></tt>
/mnt from bee:/export/share/local
Flags:  vers=2,proto=tcp,sec=sys,hard,intr,dynamic,acl,rsize=8192,wsize=8192,
        retrans=5</pre><p>The file system from <tt>bee</tt> has been mounted with the
protocol version set to <tt>2</tt>. Unfortunately, the <tt>nfsstat</tt> command does not display information about all of the options.
However, using the <tt>nfsstat</tt> command is the most accurate
way to verify the options.</p></li><li><a name="rfsadmin-step-254"></a><b>Check the entry in <tt>/etc/mnttab</tt>.</b><p>The <tt>mount</tt> command does not allow invalid options
to be added to the mount table. Therefore, verify that the options that are
listed in the file match those options that are listed on the command line.
In this way, you can check those options that are not reported by the <tt>nfsstat</tt> command.</p><pre># <tt><b>grep bee /etc/mnttab</b></tt>
bee:/export/share/local /mnt nfs	ro,vers=2,dev=2b0005e 859934818</pre></li></ol>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p27.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p29.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

