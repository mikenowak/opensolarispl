<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>How to Load the Socket Utility Library
for NCA - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Network Services<?GenHTML /ReferencePage> > <a href="p6.html">2.&nbsp;&nbsp;Managing Web Cache Servers</a> > <a href="p7.html">Administering the Caching of Web Pages (Tasks)</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p7.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p9.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="nca-36"></a><h4>How to Load the Socket Utility Library
for NCA</h4>
<a name="indexterm-22"></a><p>Follow this process only if your web server does not provide
native support of the AF_NCA socket.</p>
<p>In the startup script for the web server, add a line that
causes the library to be preloaded. The line should resemble the
following:</p>
<pre><tt><b>LD_PRELOAD=/usr/lib/ncad_addr.so /usr/bin/httpd</b></tt></pre><a name="nca-49"></a><h4><img src="graphics/procedure.gif"> How to Add a New Port to the NCA Service</h4>
<ol><li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information
about roles, see Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i>. To configure
a role with the Primary Administrator profile, see Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i>.</p></li><li><a name="nca-step-50"></a><b>Add a new port.</b><p>Add a new
port entry to <tt>/etc/nca/ncaport.conf</tt>. This example
adds port <tt>8888</tt> on IP address <tt>192.168.84.71</tt>.
See <tt>ncaport.conf</tt>(4) for more information.</p><pre># <tt><b>cat /etc/nca/ncaport.conf</b></tt>
#
# NCA Kernel Module Port Configuration File
#
  .
  .
ncaport=*/80
<tt><b>ncaport=192.168.84.71/8888</b></tt></pre></li><li><a name="nca-step-51"></a><b>Start a new web instance.</b><p>An
address needs to be in the file that contains the NCA port configurations
before a web server can use the address for NCA. If the web server
is running, it must be restarted after the new address is defined.</p></li></ol><a name="gcbjy"></a><h4><img src="graphics/procedure.gif"> How to Configure an Apache 2.0 Web Server
to Use the SSL Kernel Proxy</h4>
<p>This procedure should be used to improve the performance of
SSL packet process on an Apache 2.0 web server.</p>
<h6>Before You Begin</h6><p>The following procedure requires that an Apache 2.0 web server
has been installed and configured. The Apache 2.0 web server is
included in the Solaris 10 release.</p>
<p>To use the SSL kernel proxy, the server private key and the
server certificate need to exist in a single file. If only the <tt>SSLCertificateFile</tt> parameter is specified in the <tt>ssl.conf</tt> file, then the specified file can be used directly for
kernel SSL. If the <tt>SSLCertificateKeyFile</tt> parameter
is also specified, then the certificate file and the private key
file need to be combined. One way to combine the certificate and
the key file is to run the following command:</p>
<pre># <tt><b>cat cert.pem key.pem >cert-and-key.pem</b></tt></pre><ol><li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For
more information about roles, see Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i>. To configure a role
with the Primary Administrator profile, see Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i> The <tt>ksslcfg</tt> command is included in the <tt>Network Security</tt> profile.</p></li><li><b>Stop the web server.</b><p>This command will stop
the web server on a system in which the server is configured to
run using SMF.</p><pre># <tt><b>svcadm disable svc:/network/http:apache2</b></tt></pre><p>If the service has not be converted yet, stop the service
with this command syntax: <tt>/usr/apache2/bin/apachectl stop</tt></p></li><li><b>Determine what parameters to use with the <tt>ksslcfg</tt> command.</b><p>All of the options are listed in the <tt>ksslcfg</tt>(1M) man page. The parameters that you must have information
for are:</p>
<ul><li><p><tt>key-format</tt> &ndash; Used with
the <tt>-f</tt> option to define the certificate and key
format. For the SSL kernel proxy the value should be either <tt>pem</tt> or <tt>pkcs12</tt>.</p>
</li>
<li><p><tt>key-and-certificate-file</tt> &ndash;
Used with the <tt>-i</tt> option to set the location of the
file that stores to server key and the certificate.</p>
</li>
<li><p><tt>password-file</tt> &ndash; Used with
the <tt>-p</tt> option to select the location of the file
that includes the password used to encrypt the private key. This
password is used to allow unattended reboots. The permissions on
the file should be <tt>0400</tt>.</p>
</li>
<li><p><tt>proxy-port</tt> &ndash; Used with
the <tt>-x</tt> option to set the SSL proxy port. Select
a different port than the standard port <tt>80</tt>.</p>
</li>
<li><p><tt>ssl-port</tt> &ndash; Selects the
port of the server application. Normally this is set to <tt>443</tt>.</p>
</li>
</ul>
<hr>
<p><b>Note - </b>The <tt>ssl-port</tt> and the <tt>proxy-port</tt> values can not be configured for NCA since these ports
are used exclusively by the SSL kernel proxy. Usually, port 80 is
used for NCA, port 8080 for the <tt>proxy-port</tt> and
443 for the <tt>ssl-port</tt></p>
<hr>
</li><li><b>Create the service instance.</b><p>The <tt>ksslcfg</tt> command to specify the SSL proxy port and associated
parameters.</p><pre>ksslcfg create -f <i>key-format</i> -i <i>key-and-certificate-file</i> -p <i>password-file</i> -x <i>proxy-port</i> <i>ssl-port</i></pre></li><li><b>Verify that the instance was created properly.</b><p>The service state reported by the following command should
be &ldquo;online&rdquo;.</p><pre># <tt><b>svcs svc:/network/ssl/proxy</b></tt></pre></li><li><b>Configure the web server to listen on the SSL proxy
port.</b><p>Edit the <tt>/etc/apache2/http.conf</tt> file
and add a line to define the SSL proxy port. If you use the servers
IP address, then the web server will only listen on that interface.
The line should look like:</p><pre>Listen 0.0.0.0:<i>proxy-port</i></pre></li><li><b>Set an SMF dependency for the web server.</b><p>The
web server should only be started after the SSL kernel proxy instance.
The following commands establish that dependency.</p><pre># <tt><b>svccfg -s svc:/network/http:apache2</b></tt>
svc:/network/http:apache2> <tt><b>addpg kssl dependency</b></tt>
svc:/network/http:apache2> <tt><b>setprop kssl/entities = fmri:svc:/network/ssl/proxy:kssl-INADDR_ANY-443</b></tt>
svc:/network/http:apache2> <tt><b>setprop kssl/grouping = astring: require_all</b></tt>
svc:/network/http:apache2> <tt><b>setprop kssl/restart_on = astring: refresh</b></tt>
svc:/network/http:apache2> <tt><b>setprop kssl/type = astring: service</b></tt>
svc:/network/http:apache2> <tt><b>end</b></tt></pre></li><li><b>Enable the web server.</b><pre># <tt><b>svcadm enable svc:/network/http:apache2</b></tt></pre><p>If the service is not started using SMF, use the following
command: <tt>/usr/apache2/bin/apachectl startssl</tt></p></li></ol><a name="gcbwm"></a>Example 2-3 Configuring an Apache 2.0 Web Server to Use the SSL Kernel
Proxy<p>The following command creates an instance using the <tt>pem</tt> key
format.</p>
<pre># <tt><b>ksslcfg create -f pem -i cert-and-key.pem -p file -x 8080 443</b></tt></pre><a name="gcbwb"></a><h4><img src="graphics/procedure.gif"> How to Configure a Sun Java System Web Server
to Use the SSL Kernel Proxy</h4>
<p>This procedure should be used to improve the performance of
SSL packet process on a Sun Java System Web Server. See the <i>Sun Java System Web Server 6.1 SP4 Administrator&rsquo;s Guide</i> for
information about this web server.</p>
<h6>Before You Begin</h6><p>The following procedure requires that a Sun Java System Web
Server has been installed and configured.</p>
<ol><li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For
more information about roles, see Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i>. To configure a role
with the Primary Administrator profile, see Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i> The <tt>ksslcfg</tt> command is included in the <tt>Network Security</tt> profile.</p></li><li><b>Stop the web server.</b><p>Use the administrator
web interface to stop the server. See <i>Starting and Stopping
the Server</i> in the <i>Sun Java System Web Server 6.1 SP4 Administrator&rsquo;s Guide</i>for more information.</p></li><li><b>Determine what parameters to use with the <tt>ksslcfg</tt> command.</b><p>All of the options are listed in the <tt>ksslcfg</tt>(1M) man page. The parameters that you must have information
for are:</p>
<ul><li><p><tt>key-format</tt> &ndash; Used with
the <tt>-f</tt> option to define the certificate and key
format.</p>
</li>
<li><p><tt>token-label</tt> &ndash; Used with
the <tt>-T</tt> option to specify the PKCS#11 token.</p>
</li>
<li><p><tt>certificate-label</tt> &ndash; Used
with the <tt>-C</tt> option to select the label in the certificate
object in the PKCS#11 token</p>
</li>
<li><p><tt>password-file</tt> &ndash; Used with
the <tt>-p</tt> option to select the location of the file
that includes the password used to login the user to the PKCS#11
token used by the web server.. This password is used to allow unattended
reboots. The permissions on the file should be <tt>0400</tt>.</p>
</li>
<li><p><tt>proxy-port</tt>&ndash; Used with the <tt>-x</tt> option to set the SSL proxy port. Select a different
port than the standard port <tt>80</tt>.</p>
</li>
<li><p><tt>ssl-port</tt> &ndash; Defines the
port of the server application. This value is set in the <tt>server.xml</tt> file. Normally this value is set to <tt>443</tt>.</p>
</li>
</ul>
<hr>
<p><b>Note - </b>The <tt>ssl-port</tt> and the <tt>proxy-port</tt> values can not be configured for NCA since these ports
are used exclusively by the SSL kernel proxy. Usually, port 80 is
used for NCA, port 8080 for the <tt>proxy-port</tt> and
443 for the <tt>ssl-port</tt></p>
<hr>
</li><li><b>Create the service instance.</b><p>The <tt>ksslcfg</tt> command to specify the SSL proxy port and associated
parameters.</p><pre>ksslcfg create -f <i>key-format</i> -T <i>PKCS#11-token</i> -C <i>certificate-label</i> -p <i>password-file</i> -x <i>proxy-port</i> <i>ssl-port</i></pre></li><li><b>Verify that the instance was created properly.</b><p>The service state reported by the following command should
be &ldquo;online&rdquo;.</p><pre># <tt><b>svcs svc:/network/ssl/proxy</b></tt></pre></li><li><b>Configure the web server to listen on the SSL proxy
port.</b><p>See <i>Adding and Editing Listen Sockets</i> in
the <i>Sun Java System Web Server 6.1 SP4 Administrator&rsquo;s Guide</i> for
more information.</p></li><li><b>Start the web server.</b></li></ol><a name="gcbxf"></a>Example 2-4 Configuring a Sun Java System Web Server to Use the SSL Kernel
Proxy<p>The following command creates an instance using the <tt>pkcs11</tt> key format.</p>
<pre># <tt><b>ksslcfg create -f pkcs11 -T "NSS Internal PKCS #11 Module" -C "Server-Cert" -p file -x 8080 443</b></tt></pre>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p7.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p9.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

