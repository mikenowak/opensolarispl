<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Commands for Troubleshooting NFS Problems - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Network Services<?GenHTML /ReferencePage> > <a href="p31.html">6.&nbsp;&nbsp;Accessing Network File Systems (Reference)</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p45.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p47.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="rfsrefer-37"></a><h3>Commands for Troubleshooting NFS Problems</h3>
<p>These commands can be useful when troubleshooting NFS problems.</p>
<a name="rfsrefer-38"></a><h4><tt>nfsstat</tt> Command</h4>
<a name="indexterm-667"></a><p>You can use this command to gather statistical information about NFS
and RPC connections. The syntax of the command is as follows:</p>
<p><tt>nfsstat</tt> <tt>[</tt>  <tt>-cmnrsz</tt> <tt>]</tt> </p>
<dl><dt><tt>-c</tt></dt>
<dd><p>Displays client-side information</p>
</dd>
<dt><tt>-m</tt></dt>
<dd><p>Displays statistics for each NFS-mounted file system</p>
</dd>
<dt><tt>-n</tt></dt>
<dd><p>Specifies that NFS information is to be displayed on both
the client side and the server side</p>
</dd>
<dt><tt>-r</tt></dt>
<dd><p>Displays RPC statistics</p>
</dd>
<dt><tt>-s</tt></dt>
<dd><p>Displays the server-side information</p>
</dd>
<dt><tt>-z</tt></dt>
<dd><p>Specifies that the statistics should be set to zero</p>
</dd>
</dl>
<p>If no options are supplied on the command line, the <tt>-cnrs</tt> options
are used. </p>
<p>Gathering server-side statistics can be important for debugging problems
when new software or new hardware is added to the computing environment. Running
this command a minimum of once a week, and storing the numbers, provides a
good history of previous performance.</p>
<p>Refer to the following example:</p>
<pre># <tt><b>nfsstat -s</b></tt>

Server rpc:
Connection oriented:
calls      badcalls   nullrecv   badlen     xdrcall    dupchecks  dupreqs    
719949194  0          0          0          0          58478624   33         
Connectionless:
calls      badcalls   nullrecv   badlen     xdrcall    dupchecks  dupreqs    
73753609   0          0          0          0          987278     7254       

Server nfs:
calls                badcalls             
787783794            3516                 
Version 2: (746607 calls)
null       getattr    setattr    root       lookup     readlink   read       
883 0%     60 0%      45 0%      0 0%       177446 23% 1489 0%    537366 71% 
wrcache    write      create     remove     rename     link       symlink    
0 0%       1105 0%    47 0%      59 0%      28 0%      10 0%      9 0%       
mkdir      rmdir      readdir    statfs     
26 0%      0 0%       27926 3%   108 0%     
Version 3: (728863853 calls)
null          getattr       setattr       lookup        access        
1365467 0%    496667075 68% 8864191 1%    66510206 9%   19131659 2%   
readlink      read          write         create        mkdir         
414705 0%     80123469 10%  18740690 2%   4135195 0%    327059 0%     
symlink       mknod         remove        rmdir         rename        
101415 0%     9605 0%       6533288 0%    111810 0%     366267 0%     
link          readdir       readdirplus   fsstat        fsinfo        
2572965 0%    519346 0%     2726631 0%    13320640 1%   60161 0%      
pathconf      commit        
13181 0%      6248828 0%    
Version 4: (54871870 calls)
null                compound            
266963 0%           54604907 99%        
Version 4: (167573814 operations)
reserved            access              close               commit              
0 0%                2663957 1%          2692328 1%          1166001 0%          
create              delegpurge          delegreturn         getattr             
167423 0%           0 0%                1802019 1%          26405254 15%        
getfh               link                lock                lockt               
11534581 6%         113212 0%           207723 0%           265 0%              
locku               lookup              lookupp             nverify             
230430 0%           11059722 6%         423514 0%           21386866 12%        
open                openattr            open_confirm        open_downgrade      
2835459 1%          4138 0%             18959 0%            3106 0%             
putfh               putpubfh            putrootfh           read                
52606920 31%        0 0%                35776 0%            4325432 2%          
readdir             readlink            remove              rename              
606651 0%           38043 0%            560797 0%           248990 0%           
renew               restorefh           savefh              secinfo             
2330092 1%          8711358 5%          11639329 6%         19384 0%            
setattr             setclientid         setclientid_confirm verify              
453126 0%           16349 0%            16356 0%            2484 0%             
write               release_lockowner   illegal             
3247770 1%          0 0%                0 0%                

Server nfs_acl:
Version 2: (694979 calls)
null        getacl      setacl      getattr     access      getxattrdir 
0 0%        42358 6%    0 0%        584553 84%  68068 9%    0 0%        
Version 3: (2465011 calls)
null        getacl      setacl      getxattrdir 
0 0%        1293312 52% 1131 0%     1170568 47% </pre><p>The previous listing is an example of NFS server statistics. The first
five lines relate to RPC and the remaining lines report NFS activities. In
both sets of statistics, knowing the average number of <tt>badcalls</tt> or <tt>calls</tt> and the number of calls per week can help identify a problem.
The <tt>badcalls</tt> value reports the number of bad messages from
a client. This value can indicate network hardware problems.</p>
<p>Some of the connections generate write activity on the disks. A sudden
increase in these statistics could indicate trouble and should be investigated.
For NFS version 2 statistics, the connections to note are <tt>setattr</tt>, <tt>write</tt>, <tt>create</tt>, <tt>remove</tt>, <tt>rename</tt>, <tt>link</tt>, <tt>symlink</tt>, <tt>mkdir</tt>,
and <tt>rmdir</tt>. For NFS version 3 and version 4 statistics,
the value to watch is <tt>commit</tt>. If the <tt>commit</tt> level
is high in one NFS server, compared to another almost identical server, check
that the NFS clients have enough memory. The number of <tt>commit</tt> operations
on the server grows when clients do not have available resources.</p>
<a name="rfsrefer-40"></a><h4><tt>pstack</tt> Command</h4>
<a name="indexterm-668"></a><p>This command displays a stack trace for each process. The <tt>pstack</tt> command
must be run by the owner of the process or by <tt>root</tt>. You
can use <tt>pstack</tt> to determine where a process is hung. The
only option that is allowed with this command is the <tt>PID</tt> of
the process that you want to check. See the <tt>proc</tt>(1) man page.</p>
<p>The following example is checking the <tt>nfsd</tt> process
that is running.</p>
<pre># <tt><b>/usr/bin/pgrep nfsd</b></tt>
243
# <tt><b>/usr/bin/pstack 243</b></tt>
243:    /usr/lib/nfs/nfsd -a 16
 ef675c04 poll     (24d50, 2, ffffffff)
 000115dc ???????? (24000, 132c4, 276d8, 1329c, 276d8, 0)
 00011390 main     (3, efffff14, 0, 0, ffffffff, 400) + 3c8
 00010fb0 _start   (0, 0, 0, 0, 0, 0) + 5c</pre><p>The example shows that the process is waiting for a new connection request,
which  is a normal response. If the stack shows that the process is still
in poll after a request is made, the process might be hung. Follow the instructions
in <a href="p28.html#rfsadmin-240">How to Restart NFS Services</a> to
fix this problem. Review the instructions in <a href="p27.html#rfsadmin-215">NFS Troubleshooting Procedures</a> to fully verify that your problem is a
hung program.</p>
<a name="rfsrefer-41"></a><h4><tt>rpcinfo</tt> Command</h4>
<a name="indexterm-669"></a><p>This command generates information about the RPC service that is running
on a system. You can also use this command to change the RPC service. Many
options are available with this command. See the <tt>rpcinfo</tt>(1M) man page. The following is
a shortened synopsis for some of the options that you can use with the command.</p>
<p><tt>rpcinfo</tt> <tt>[</tt> <tt>-m</tt> <tt>|</tt> <tt>-s</tt> <tt>]</tt> <tt>[</tt> <i>hostname</i> <tt>]</tt></p>
<p><tt>rpcinfo</tt> <tt>-T</tt> <i>transport</i> <i>hostname</i> <tt>[</tt> <i>progname</i> <tt>]</tt></p>
<p><tt>rpcinfo</tt> <tt>[</tt> <tt>-t</tt> <tt>|</tt> <tt>-u</tt> <tt>]</tt> <tt>[</tt> <i>hostname</i> <tt>]</tt> <tt>[</tt> <i>progname</i> <tt>]</tt></p>
<dl><dt><tt>-m</tt></dt>
<dd><p>Displays a table of statistics of the <tt>rpcbind</tt> operations</p>
</dd>
<dt><tt>-s</tt></dt>
<dd><p>Displays a concise list of all registered RPC programs</p>
</dd>
<dt><tt>-T</tt></dt>
<dd><p>Displays information about services that use specific transports
or protocols</p>
</dd>
<dt><tt>-t</tt></dt>
<dd><p>Probes the RPC programs that use TCP</p>
</dd>
<dt><tt>-u</tt></dt>
<dd><p>Probes the RPC programs that use UDP</p>
</dd>
<dt><i>transport</i></dt>
<dd><p>Selects the transport or protocol for the services</p>
</dd>
<dt><i>hostname</i></dt>
<dd><p>Selects the host name of the server that you need information
from</p>
</dd>
<dt><i>progname</i></dt>
<dd><p>Selects the RPC program to gather information about</p>
</dd>
</dl>
<p>If no value is given for <i>hostname</i>, the local
host name is used. You can substitute the RPC program number for <i>progname</i>, but many users can remember the name and not the number. You
can use the <tt>-p</tt> option in place of the <tt>-s</tt> option
on those systems that do not run the NFS version 3 software.</p>
<p>The data that is generated by this command can include the following:</p>
<ul><li><p>The RPC program number</p>
</li>
<li><p>The version number for a specific program</p>
</li>
<li><p>The transport protocol that is being used</p>
</li>
<li><p>The name of the RPC service</p>
</li>
<li><p>The owner of the RPC service</p>
</li>
</ul>
<p>The following example gathers information about the RPC services that
are running on a server. The text that is generated by the command is filtered
by the <tt>sort</tt> command to make the output more readable. Several
lines that list RPC services have been deleted from the example.</p>
<pre>% <tt><b>rpcinfo -s bee |sort -n</b></tt>
   program version(s) netid(s)                         service     owner
    100000  2,3,4     udp6,tcp6,udp,tcp,ticlts,ticotsord,ticots rpcbind     superuser
    100001  4,3,2     ticlts,udp,udp6                  rstatd      superuser
    100002  3,2       ticots,ticotsord,tcp,tcp6,ticlts,udp,udp6 rusersd     superuser
    100003  3,2       tcp,udp,tcp6,udp6                nfs         superuser
    100005  3,2,1     ticots,ticotsord,tcp,tcp6,ticlts,udp,udp6 mountd      superuser
    100007  1,2,3     ticots,ticotsord,ticlts,tcp,udp,tcp6,udp6 ypbind      superuser
    100008  1         ticlts,udp,udp6                  walld       superuser
    100011  1         ticlts,udp,udp6                  rquotad     superuser
    100012  1         ticlts,udp,udp6                  sprayd      superuser
    100021  4,3,2,1   tcp,udp,tcp6,udp6                nlockmgr    superuser
    100024  1         ticots,ticotsord,ticlts,tcp,udp,tcp6,udp6 status      superuser
    100029  3,2,1     ticots,ticotsord,ticlts          keyserv     superuser
    100068  5         tcp,udp                          cmsd        superuser
    100083  1         tcp,tcp6                         ttdbserverd superuser
    100099  3         ticotsord                        autofs      superuser
    100133  1         ticots,ticotsord,ticlts,tcp,udp,tcp6,udp6 -           superuser
    100134  1         ticotsord                        tokenring   superuser
    100155  1         ticots,ticotsord,tcp,tcp6        smserverd   superuser
    100221  1         tcp,tcp6                         -           superuser
    100227  3,2       tcp,udp,tcp6,udp6                nfs_acl     superuser
    100229  1         tcp,tcp6                         metad       superuser
    100230  1         tcp,tcp6                         metamhd     superuser
    100231  1         ticots,ticotsord,ticlts          -           superuser
    100234  1         ticotsord                        gssd        superuser
    100235  1         tcp,tcp6                         -           superuser
    100242  1         tcp,tcp6                         metamedd    superuser
    100249  1         ticots,ticotsord,ticlts,tcp,udp,tcp6,udp6 -           superuser
    300326  4         tcp,tcp6                         -           superuser
    300598  1         ticots,ticotsord,ticlts,tcp,udp,tcp6,udp6 -           superuser
    390113  1         tcp                              -           unknown
 805306368  1         ticots,ticotsord,ticlts,tcp,udp,tcp6,udp6 -           superuser
1289637086  1,5       tcp                              -           26069</pre><p>The following two examples show how to gather information about a particular
RPC service by selecting a particular transport on a server. The first example
checks the <tt>mountd</tt> service that is running over TCP. The
second example checks the NFS service that is running over UDP.</p>
<pre>% <tt><b>rpcinfo -t bee mountd</b></tt>
program 100005 version 1 ready and waiting
program 100005 version 2 ready and waiting
program 100005 version 3 ready and waiting
% <tt><b>rpcinfo -u bee nfs</b></tt>
program 100003 version 2 ready and waiting
program 100003 version 3 ready and waiting</pre>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p45.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p47.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

