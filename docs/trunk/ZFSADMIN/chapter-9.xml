<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML//EN" "docbook.dtd"
[
<!ENTITY % xinclude SYSTEM "xinclude.mod">
]>
<chapter xmlns="http://docbook.org/ns/docbook" version="5.0" xml:id="gavwg">



<title>Usuwanie problemów i odzyskiwanie danych w ZFS-ie</title>
<toc>
<para>Ten rozdział opisuje w jaki sposłób identyfikować i naprawiać błędy w ZFS-ie. Zawarto równierz informacje dotyczącą zapobieganiu powstawania błędow.</para>
<para>W tym rozdziale znajduja sa nastepujace sekcje:</para>
<itemizedlist>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbth">Rodzaje błędów w ZFS-ie</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbwa">Sprawdzanie integralności danych w ZFS-ie</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbuw">Identyfikacja problemów z ZFS</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbve">Naprawa uszkodzonej konfiguracji ZFS</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbvb">Naprawa brakującego urządzenia</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbvf">Naprawa uszkodzonego urządzenia</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbwl">Naprawa uszkodzonych danych</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbwc">Naprawa nie ładującego sie systemu</olink>
</para>
</listitem>
</itemizedlist>
</toc>
<sect1 xml:id="gbbth">
<title>Rodzaje błędów w ZFS-ie</title>
<para>Jako połączenie systemu plików oraz menedżera wolumenu, ZFS może zgłosić wiele
rodzajów błędów. Niniejszy rozdział rozpoczyna się przeglądem rodzajów awarii,
w późniejszej części opisuje w jaki sposób je identyfikować na działającym systemie
Na koniec podjęta jest dyskusja na temat usuwania znalezionych błędów.
ZFS może napotkać trzy podstawowe typy błędów:
<indexterm xml:id="indexterm-508">
<primary>Pule pamięci ZFS</primary>
<secondary>rodzaje błędów</secondary>
</indexterm>
<indexterm xml:id="indexterm-509">
<primary>rodzaje błędów</primary>
</indexterm>
<indexterm xml:id="indexterm-510">
<primary>usuwanie błędów</primary>
<secondary>rodzaje błędów w ZFS-ie</secondary>
</indexterm>
</para>
<itemizedlist>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbxj">Brakujące urządzenia w puli pamięcu ZFS</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbym">Uszkodzone urządzenia w puli pamięcu ZFS</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbwx">Uszkodzone dane ZFS</olink>
</para>
</listitem>
</itemizedlist>
<para>Proszę zwrócić uwagę, że pojedyncza pula może zawierać wszystkie trzy rodzaje
błędów, dlatego pełna procedura naprawy pociąga za sobą znajdowanie i usuwanie
wszystkich typów awarii.
</para>
<sect2 xml:id="gbbxj">
<title>Brakujące urządzenie w puli pamięci ZFS</title>
<para>Jeśli z systemu usunięto urządzenie, ZFS odkrywa, że nie może być
użyte i oznacza je stanem <literal>FAULTED</literal>. W zależności od poziomu 
replikacji, może to spowodować niedostępność całej puli. W przypadku usunięcia z macierzy 
RAID-Z lub mirrorowanego dysku jednego urządzenia, pula pozostaje dostępna. Jeżeli usunięto 
wszystkie mirrorowane komponenty, jedno urządzenie z macierzy RAID-Z, lub pojedynczy dysk 
najwyższego poziomu, pula zostanie oznaczona stanem <literal>FAULTED</literal>. Do czasu 
ponownego podłączenia brakujących urządzeń, dostęp do danych z puli pozostaje 
niedostępny.<indexterm xml:id="indexterm-511">
<primary>Pule pamięci ZFS</primary>
<secondary>brakujące (uszkodzone) urządzenia</secondary>
<tertiary>opis</tertiary>
</indexterm>
<indexterm xml:id="indexterm-512">
<primary>rodzaje błędów</primary>
<secondary>brakujące (uszkodzone) urządzenia</secondary>
</indexterm>
<indexterm xml:id="indexterm-513">
<primary>usuwanie problemów</primary>
<secondary>brakujące (uszkodzone) urządzenia</secondary>
</indexterm>
</para>
</sect2>
<sect2 xml:id="gbbym">
<title>Uszkodzone urządzenia w puli pamięci ZFS</title>
<para>Określenie “uszkodzone” dotyczy szeregu możliwych błędów, które
przestawiono w poniższych przykładach:<indexterm xml:id="indexterm-514">
<primary>Pule pamięci ZFS</primary>
<secondary>uszkodzone urządzenia</secondary>
<tertiary>opis</tertiary>
</indexterm>
<indexterm xml:id="indexterm-515">
<primary>rodzaje błędów</primary>
<secondary>uszkodzone urządzenia</secondary>
</indexterm>
<indexterm xml:id="indexterm-516">
<primary>usuwanie problemów</primary>
<secondary>uszkodzone urządzenia</secondary>
</indexterm>
</para>
<itemizedlist>
<listitem>
<para>Przejściowe błędy we/wy związane z błędami dysku lub kontrolera</para>
</listitem>
<listitem>
<para>Uszkodzenie danych związane z promieniowaniem kosmicznym</para>
</listitem>
<listitem>
<para>Błędy w sterownikach, powodujące nieprawidłowy transfer danych do lub ze złego miejsca</para>
</listitem>
<listitem>
<para>Inny użytkownik, przypadkowo nadpisujący porcje danych na fizycznym urządzeniu</para>
</listitem>
</itemizedlist>
<para>W niektórych przypadkach błędy te są tymczasowe, jak na przykład losowe błędy we/wy podczas problemów z kontrolerem. W reszcie przypadków uszkodzenia są trwałe, jak na przykład fizyczne uszkodzenie dysku. Nawet wtedy, kiedy uszkodzenia są trwałe, błędy niekoniecznie się powtórzą. Na przykład, jeżeli administrator przez przypadek nadpisze część dysku, nie wystąpił błąd sprzętowy i urządzenie nie musi zostać wymienione. Identyfikacja problemów dyskowych nie jest prostym zadaniem i jest opisana bardziej szczegółowo w późniejszej sekcji.</para>
</sect2>
<sect2 xml:id="gbbwx">
<title>Zepsute dane ZFS</title>
<para>Uszkodzenie danych występuje, kiedy jedno lub więcej urządzeń (wliczając brakujące lub zniszczone urządzenia) dotyczy wirtualnego urządzenia najwyższego poziomu. Na przykład połowa mirroru może doświadczyć tysięcy błędów dyskowych, bez utraty danych. Kiedy błąd zostanie napotkany w tej samej lokacji po drugiej strony mirroru, rezultatem będzie uszkodzenie danych. <indexterm xml:id="indexterm-517"><primary>Pule pamięci</primary><secondary>uszkodzone dane</secondary><tertiary>opis</tertiary></indexterm><indexterm xml:id="indexterm-518"><primary>rodzaje błędów</primary><secondary>uszkodzone dane</secondary></indexterm><indexterm xml:id="indexterm-519"><primary>dane</primary><secondary>uszkodzone</secondary></indexterm>
</para>
<para>Zepsucie danych jest zawsze trwałe i wymaga specjalnej uwagi podczas naprawy. Nawet kiedy odpowiednie urządzenia zostaną naprawione lub wymienione, oryginalne dane są utracone na zawsze. W większości przypadków, ten scenariusz wymaga odtworzenia danych z kopi zapasowych. Podczas napotkania, błędy danych są rejestrowane i mogą zostać skontrolowane poprzez rutynową weryfikację danych dysku, co zostało wyjaśnione w kolejnej sekcji. Kiedy popsuty blok zostanie usunięty, kolejna weryfikacja danych rozpoznaje, że uszkodzenie zostało naprawione i usuwa wszelkie ślady błędu z systemu.</para>
</sect2>
</sect1>
<sect1 xml:id="gbbwa">
<title>Sprawdzanie integralności danych w ZFS-ie</title>
<para>Dla ZFS nie istnieje równoważne narzędzie jak <command>fsck</command>. To narzędzie było stosowane w celu naprawiania danych oraz sprawdzania ich poprawności.</para>
<sect2 xml:id="gbbyc">
<title>Naprawa danych</title>
<para>W tradycyjnych systemach plików, sposób w jaki dane są zapisywane jest podatny na uszkodzenia co powoduje błędy w regularności danych. Ponieważ tradycyjne systemy plików nie są transakcyjne, niepowiązane bloki, uszkodzone linki lub inne niespójne struktury danych są dozwolone.  Dodatkowo dzienniki (jouornal) rozwiązują niektóre z tych problemów, ale mogą powodować dodatkowe, kiedy dziennik nie może zostać odtworzony. Żaden z powyższych problemów nie istnieje dla ZFS. Jedynym sposobem na niespójne dane na dysku jest uszkodzenie sprzętowe (w tym wypadku pula powinna była zostać redundantna) lub błąd w oprogramowaniu ZFS.<indexterm xml:id="indexterm-520"><primary>Pule pamięci ZFS</primary><secondary>naprawa danych</secondary><tertiary>opis</tertiary></indexterm><indexterm xml:id="indexterm-521"><primary>sprawdzanie</primary><secondary>Spójność danych ZFS</secondary></indexterm><indexterm xml:id="indexterm-522"><primary>dane</primary><secondary>naprawa</secondary></indexterm>
</para>
<para>Biorąc pod uwagę, że narzędzie <command>fsck</command> zostało stworzone do naprawy znanych problemów specyficznych dla danych systemów plików, napisanie takiego narzędzia dla systemu plików, w którym problemy są nieznane nie jest możliwe. W przyszłości, problemy mogą okazać się na tyle wspólne, że stworzenie takiego narzędzia stanie się możliwe. Jednak problemy te mogą zostać zawsze ominięte przy użyciu redundantnych pul.</para>
<para>Jeśli pule nie są redundantne, szansa niedostępności danych jest zawsze możliwa.</para>
</sect2>
<sect2 xml:id="gbbyd">
<title>Sprawdzanie poprawności danych</title>
<para>Dodatkowo, oprócz naprawy danych, narzędzie <command>fsck</command> sprawdza dane na dysku pod względem ich poprawności. Tradycyjnie to zadanie odbywa się poprzez odmontowanie systemu plików oraz uruchomnienie narzędzia <command>fsck</command>. W tym przypadku może zaistnieć potrzeba uruchomienia systemu w trybie pojedyńczego użytkownika. Ten scenariusz powoduje przestój działania proporcjonalny do rozmiaru sprawdzanego systemu plików. Zamiast konieczności używania odpowiedniego narzędzia do sprawdzania danych, ZFS oferuje mechanizm sprawdzający je rutynowo. Ta funkcjonalność jest znana jako <emphasis>weryfikacja danych (scrubbing)</emphasis> i jest w powrzechnym użyciu w pamięci podręcznej jako metoda wykrywania i zapobiegania błędom, zanim spowodują awarie sprzętową lub programową. <indexterm xml:id="indexterm-523"><primary>Pule pamięci ZFS</primary><secondary>sprawdzanie poprawności danych</secondary><tertiary>opis</tertiary></indexterm><indexterm xml:id="indexterm-524"><primary>dane</primary><secondary>weryfikacja danych (scrubbing)</secondary></indexterm><indexterm xml:id="indexterm-525"><primary>weryfikacja danych</primary><secondary>sprawdzanie poprawności danych</secondary></indexterm>
</para>
</sect2>
<sect2 xml:id="gbbxi">
<title>Kontrola weryfikacji danych ZFS</title>
<para>Ilekroć ZFS napotka błąd poprzez operację weryfikacji lub zwykłego żądania dostępu do pliku, błąd ten jest logowany wewnętrznie. Daje to możliwość szybkiego przeglądu wszystkich znanych błędów w puli. <indexterm xml:id="indexterm-526"><primary>Pule pamięci ZFS</primary><secondary>weryfikacja danych</secondary><tertiary>opis&gt;</tertiary></indexterm><indexterm xml:id="indexterm-527"><primary>kontrola</primary><secondary> sprawdzanie poprawności danych (weryfikacja danych)</secondary></indexterm>
</para>
<sect3 xml:id="gbbws">
<title>Jawna kontrola danych ZFS</title>
<para>Najprostrzą metodą na sprawdzenie integralności danych jest zainicjowanie jawnej kontroli wszystkich danych dla puli. Ta operacja sprawdza jednokrotnie wszystkie dane w puli i weryfikuje, czy wszystkie bloki mogą być odczytane. Weryfikacja danych przebiega z maksymalną dostępną dla urządzenia prędkością, aczkolwiek priorytet każdej szczątkowej operacji we/wy pozostaje poniżej normalnych operacji. Weryfikacja danych może mieć negatywny wpływ na wydajność, jednak system powinien pozostawać czuły podczas weryfikacji. Aby zainicjować jawną kontrolę danych, użyj komendy <command>zpool scrub</command> Na przykład:<indexterm xml:id="indexterm-528"><primary>Pule pamięci ZFS</primary><secondary>weryfikacja danych</secondary><tertiary>(przykład)</tertiary></indexterm><indexterm xml:id="indexterm-529"><primary>weryfikacja</primary><secondary>(przykład)</secondary></indexterm><indexterm xml:id="indexterm-530"><primary>dane</primary><secondary>weryfikacja</secondary><tertiary>(przykład)</tertiary></indexterm>
</para>
<screen># <userinput>zpool scrub tank</userinput>
</screen>
<para>Status aktualnej jawnej kontroli może zostać wyświetlony przy użyciu komendy <command>zpool status</command>. Na przykład:</para>
<screen># <userinput>zpool status -v tank</userinput>
  pool: tank
 state: ONLINE
 scrub: scrub completed with 0 errors on Wed Aug 30 14:02:24 2006
config:

        NAME         STATE     READ WRITE CKSUM
        tank         ONLINE       0     0     0
          mirror     ONLINE       0     0     0
            c1t0d0   ONLINE       0     0     0
            c1t1d0   ONLINE       0     0     0

errors: No known data errors</screen>
<para>Należy zwrócić uwagę, że jednocześnie możliwa jest tylko jedna operacja weryfikacji danych dla każdej z puli.</para>
<para>Można zatrzymać operacje weryfikacji danych, która jest aktualnie wykonywana, używając opcji <option>s</option>Na przykład:</para><screen># zpool scrub -s tank</screen><para>W większości przypadków, operacja weryfikacji danych powinna być ukoćczona, aby być pewnym integralności danych. Zatrzymanie operacji weryfikacji można zatrzymać, gdy wpływa ono na wydajność systemu.</para><para>Wykonywanie rutynowej weryfikacji gwarantuje ciągłość we/wy dla wszystkich dysków w systemie. Rutynowa weryfikacja danych posiada uboczny efekt, powodujący uniemożliwienie menadżerowi zasilania postawienia niepracujących dysków w stanie niskiego poboru energii. Jeśli system w większości przypadków korzysta ciągle z operacji we/wy lub zużycie energii nie jest brane pod uwagę, wtedy ten problem może zostać bezpiecznie zignorowany.</para>
<para>Więcej informacji na temat interpretowania wyniku komendy <command>zpool status</command> można znaleźć w <olink remap="external" targetdoc="chapter-4.xml" targetptr="gaynp">Status puli ZFS</olink>.</para>
</sect3>
<sect3 xml:id="gbbya">
<title>Jawna kontrola danych ZFS i Resilvering</title>
<para>Kiedy urządzenie zostaje wymienione, operacja resilweringu jest inicjowana. Zdrowe dane są kopiowane na nowe urządzenie. Ta akcja jest formą weryfikacji danych dysku. Dlatego jednocześnie tylko jedna taka akcja może się odbywać w obrębie jednej puli. Jeśli operacja weryfikacji danych jest w toku, resilwering usypia weryfikacje i ją restartuje w momencie kiedy zostanie zakończony.<indexterm xml:id="indexterm-531"><primary>Pule pamięci ZFS</primary><secondary>weryfikacja danych i resilwering</secondary><tertiary>opis</tertiary></indexterm><indexterm xml:id="indexterm-532"><primary>resilwering i weryfikacja danych</primary><secondary>opis</secondary></indexterm><indexterm xml:id="indexterm-533"><primary>dane</primary><secondary>resilwering</secondary><tertiary>opis</tertiary></indexterm>
</para>
<para>Więcej informacji na temat resilweringu można znaleźć w <olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbcus">Podgląd statusu resilweringu</olink></para>
</sect3>
</sect2>
</sect1>
<sect1 xml:id="gbbuw">
<title>Identyfikacja problemów z ZFS</title>
<para>Ta sekcja opisuje, w jaki sposób identyfikować problemy w systemach plików ZFS lub w pulach danych.</para>
<itemizedlist>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbcwb">Sprawdzanie, czy problemy istnieją w puli pamięci ZFS</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbcve">Sprawdzanie wyniku komendy: <command>zpool status</command></olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbcvk">Reportowanie Systemowe wiadomości błędów ZFS</olink>
</para>
</listitem>
</itemizedlist>
<para>Można użyć następujących opcji w celu zidentyfikowania problemów konfiguracji ZFS:</para>
<itemizedlist>
<listitem>
<para>Szczegółowa informacja puli danych ZFS, przy użyciu komendy <command>zpool status</command></para>
</listitem>
<listitem>
<para>Błędy puli oraz urządzenia są reportowane przy użyciu diagnostycznych wiadomości ZFS/FMA</para>
</listitem>
<listitem>
<para>Wcześniejsze komendy ZFS, które zmodyfikowały stan puli mogą być wyświetlone przy użyciu komendy <command>zpool history</command></para>
</listitem>
</itemizedlist>
<para>Wykrywanie większości usterek jest skupione wokół komendy <command>zpool status</command> Ta komenda analizuje różne przypadki błędów w systemie i identyfikuje najcięższe. Jako rezultat sugerowana akcja wraz z likami do odpowiednich artykułów zostaje zaprezentowana. Proszę zwrócić uwagę, że komenda ta identyfikuje pojedyńczy problem w puli, podczas gdy wiele problemów może istnieć. Na przykład, błędy uszkodzenia danych zawsze pociągają za sobą uszkodzenie jednego z urządzeń. Wymiana uszkodzonego urządzenia nie naprawia problemu uszkodzenia danych.</para>
<para>Dodatkowo, silnik diagnostyki ZFS zgłasza błędy puli oraz dysku. Błędy suma kontrolnej, we/wy, oraz puli związane z błędami urządzenia lub puli też są zgłaszane. Błędy ZFS zgłaszane przez <command>fmd</command> są wyświetlane zarówno na konsoli jak i w pliku wiadomości systemowych. W wielu przypadkach komunikat komendy <command>fmd</command> kieruje do instrukcji naprawy dla polecenia <command>zpool status</command>.<indexterm xml:id="indexterm-534"><primary>Pule pamięci ZFS</primary><secondary>identyfikowanie problemów</secondary><tertiary>opis</tertiary></indexterm><indexterm xml:id="indexterm-535"><primary>usuwanie problemów</primary><secondary>identyfikowanie problemów</secondary></indexterm>
</para>
<para>Podstawowy proces odtworzenia wygląda następująco:</para>
<itemizedlist>
<listitem>
<para>Jeśli to możliwe, użyj komendy <command>zpool history</command> w celu zidentyfikowania wcześniejszych komend ZFS, które spowodowały błędne działanie. Na przykład:</para>
<screen># <userinput>zpool history</userinput>
History for 'tank':
2007-04-25.10:19:42 zpool create tank mirror c0t8d0 c0t9d0 c0t10d0
2007-04-25.10:19:45 zfs create tank/erick
2007-04-25.10:19:55 zfs set checksum=off tank/erick</screen>
<para>Proszę zwrócić uwagę na powyższy wynik komendy. Sumy kontrolne są wyłączone dla systemu plików <filename>tank/erick</filename>. Ta konfiguracja nie jest rekomendowana.</para>
</listitem>
<listitem>
<para>Indentyfikowanie błędów poprzez komunikaty komendy <command>fmd</command>, które są wyświetlane na konsoli lub w plikach <filename>/var/adm/messages</filename>.</para>
</listitem>
<listitem>
<para>Znajdz przyszłe instrukcje naprawy przy użyciu komendy <command>zpool status -x</command>.</para>
</listitem>
<listitem>
<para>Napraw następujące błędy:</para>
<itemizedlist>
<listitem>
<para>Wymień brakujące lub uszkodzone urządzenie i podnieś je do stanu online.</para>
</listitem>
<listitem>
<para>Odzyskaj brakujące dane lub błędną konfiguracje z kopi zapasowej.</para>
</listitem>
<listitem>
<para>Potwierdź odzyskanie danych używając komende <command>zpool status</command> <option>x</option>.</para>
</listitem>
<listitem>
<para>Stwórz kopie zapasową odzyskanej konfiguracji.</para>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<para>Ten rozdział opisuje w jaki sposób interpretować komunikaty komendy <command>zpool status</command> w celu zdiagnozowania typu błędu i kieruje do odpowiedniej sekcji w celu naprawy problemu. Podczas gdy większość zadań jest wykonwyana automatycznie przez komende, jest ważne aby zrozumieć które błędy zostały zidentyfikowane aby zdiagnozować typ awarii.</para>
<sect2 xml:id="gbcwb">
<title>Sprawdzanie, czy problem istnieje w puli ZFS.</title>
<para>Najprostrzym sposobem na sprawdzenie, czy istnieje jakikolwiek znany błąd w systemie, jest użycie komendy <command>zpool status</command> <option>x</option>. Ta komenda opisuje wyłącznie problemy związane z pulami. Jeśli w systemie nie istnieją uszkodzone pule, komenda wyświetla prosą wiadomość:</para>
<screen># <userinput>zpool status -x</userinput>
all pools are healthy</screen>
<para>Bez flagi <option>x</option>, komenda wyświetla kompletny status dla wszystkich pul (lub dla określonej puli, jeśli została sprecyzowana w lini poleceń), nawet jeśli pule są zdrowe.<indexterm xml:id="indexterm-536"> <primary>Pule pamięci ZFS</primary> <secondary>ustalanie czy istnieją problemy (<command>zpool status</command> <option> x</option>)</secondary> <tertiary>opis</tertiary></indexterm> <indexterm xml:id="indexterm-537"> <primary>usuwanie problemów</primary> <secondary>ustalanie czy istnieją problemy  (<command>zpool status</command> <option> x</option>)</secondary></indexterm> 
</para>
<para>Więcej informacji na temat argumentów komendy <command>zpool status</command> można znaleźć w <olink remap="external" targetdoc="chapter-4.xml" targetptr="gaynp">Zapytania Statusu Puli Pamęci ZFS</olink></para>
</sect2>
<sect2 xml:id="gbcve">
<title>Przegląd wyniku działania komendy <command>zpool status</command></title>
<para>Kompletny wynik komendy <command>zpool status</command> jest podobny do następującego:</para>
<screen># <userinput>zpool status tank</userinput>
  pool: tank
 state: DEGRADED
status: One or more devices has been taken offline by the administrator.
        Sufficient replicas exist for the pool to continue functioning in a
        degraded state.
action: Online the device using 'zpool online' or replace the device with
        'zpool replace'.
 scrub: none requested
 config:

        NAME         STATE     READ WRITE CKSUM
        tank         DEGRADED     0     0     0
          mirror     DEGRADED     0     0     0
            c1t0d0   ONLINE       0     0     0
            
errors: No known data errors</screen>
<para>Wynik jest podzielony na kilka sekcji:</para>
<sect3 xml:id="gbcvl">
<title>Ogólna Informacja Statusu Puli</title>
<para>Nagłówek sekcji komunikatu wyjściowego komendy <command>zpool status</command> zawiera następujące pola (niektóre z pól są wyświetlane wyłącznie dla pul zawierających błędy): <indexterm xml:id="indexterm-538"> <primary>Pule pamięci ZFS</primary> <secondary>ogólna informacja statusu puli dla rozwiązywania problemów </secondary> <tertiary>opis</tertiary></indexterm> <indexterm xml:id="indexterm-539"> <primary>usuwanie problemów</primary> <secondary>ogólna informacja statusu puli </secondary> <tertiary>opis</tertiary> </indexterm>
</para>
<variablelist>
<varlistentry>
<term>
<literal>pool</literal>
</term>
<listitem>
<para>Nazwa puli.</para>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>state</literal>
</term>
<listitem>
<para>Aktualny stan zdrowia puli. Ta informacja odnosi się tylko do zdolności puli do zapewnienia odpowiedniego poziomu replikacji. Pule, które są w stanie <literal>ONLINE</literal>mogą ciągle posiadać urządzenia z wadami lub błędy danych.</para>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>status</literal>
</term>
<listitem>
<para>Opis co jest złego z pulą. To pole jest pominięte, jeśli nie zostały znalezione żadne problemy.</para>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>action</literal>
</term>
<listitem>
<para>Rekomendowane czynności związane z naprawieniem błędów. To pole jest skrócone dla użytkownika do odpowiednich odnośników. To pole jest pominięte, jeśli nie zostały znalezione żadne problemy.</para>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>see</literal>
</term>
<listitem>
<para>Odnośnik do artykułów zawierających szczegółowe informacje na temat naprawy. Artykuły online są aktualizowane częściej niż ten dokument, dlatego znajdują się w nich najbardziej aktualne procedury naprawy. To pole jest pominięte, jeśli nie zostały znalezione żadne problemy.</para>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>scrub</literal>
</term>
<listitem>
<para>Identyfikuje aktualny status operacji weryfikacji danych, która może zawierać datę oraz czas ostatniej operacji, postęp weryfikacji lub informację, że weryfikacja nie była wykonana.</para>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>errors</literal>
</term>
<listitem>
<para>Indentyfikuje znane błędy danych lub ich brak.</para>
</listitem>
</varlistentry>
</variablelist>
</sect3>
<sect3 xml:id="gbcvv">
<title>Informacja o konfiguracji</title>
<para>Pole <literal>config</literal> w komunikacie komendy <command>zpool status</command> opisuje rozmieszczenie urządzeń zawartych w puli, jak również ich status i informacje o jakichkolwiek błędach generowanych przez urządzenia. Stan może być jednym z następujących:  <literal>ONLINE</literal>,  <literal>FAULTED</literal>, <literal>DEGRADED</literal>, <literal>UNAVAILABLE</literal>, lub <literal>OFFLINE</literal>. Jeśli status jest <literal>ONLINE</literal>, tolerancja uszkodzeń puli pozwala na jej dalsze działanie.</para>
<para>Drugia sekcja komunikatu konfiguracyjnego wyświetla statystykę błędów. Te błędy są podzielone na trzy kategorie:</para>
<itemizedlist>
<listitem>
<para>
<literal>READ</literal> – nastąpił błąd we/wy podczas operacji odczytu.</para>
</listitem>
<listitem>
<para>
<literal>WRITE</literal> – błąd we/wy podczas operacji zapisu. </para>
</listitem>
<listitem>
<para>
<literal>CKSUM</literal> – błąd sumy kontrolnej.  Urządzenie zwróciło uszkodzone dane jako rezultat operacji odczytu.</para>
</listitem>
</itemizedlist>
<para>Te błędy pozwalają określić czy uszkodzenie jest trwałe. Mała ilość błędów operacji we/wy może oznaczać tymczasową awarię, podczas gdy ich duża ilość może oznaczać stały problem z urządzeniem. Te błędy niekoniecznie odnoszą się  do błędów danych zgłaszanych przez aplikacje. Jeżeli urządzenie znajduje się w zbytecznej konfiguracji, dyski mogą pokazywać nienaprawialne błędy, jednak żadne błędy nie pojawiają się w mirrorze lub na poziomie macierzy RAID-Z. W przypadku takiego scenariusza, ZFS otrzymuje poprawne dane i próbuje naprawić uszkodzone z istniejących replik.</para>
<para>Więcej informacji na temat interpretowania błędów w celu ustalenia przyczyny uszkodzenia urządzenia, można znaleźć w  <olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbzs">Określanie Typu Uszkodzenia Urządzenia</olink>.</para>
<para>Finalnie, dodatkowa pomocnicza informacja jest wyświetlona w ostatniej kolumnie komunikatu  pochodzącego z komendy <command>zpool status</command>. Te informacje są rozwinięte w polu  <literal>state</literal>, pomagając diagnozować rodzaje błędów. Jeśli urządzenie jest w stanie <literal>FAULTED</literal>, to pole wskazuje niedostępność urządzenia lub uszkodzenie danych na nim. Jeśli urządzenie wykonuje operację resilweringu, to pole pokazuje aktualny postęp operacji.</para>
<para>Więcej informacji na temat monitoringu procesu resilweringu można znaleźć w  <olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbcus">Podgląd Statusu Operacji Resilweringu</olink></para>
</sect3>
<sect3 xml:id="gbcvd">
<title>Status Weryfikacji Danych</title>
<para>Trzecia sekcja komunikatu komendy  <command>zpool status</command>, opisuje aktualny stan jakiejkolwiej operacji weryfikacji. Ta informacja jest odrębna od jakichkolwiek błędów znalezionych w systemie, aczkolwiek mozę być użyta do określenia błędności raportu uszkodzenia danych. Jeśli operacja weryfikacji danych została uokńczona niedawno, w większości przypadków wszystkie znane typy błędów danych zostały odkryte.</para>
<para>Więcej informacji na temat weryfikacji danych oraz interpretacji informacji można znaleźć w <olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbwa">Sprawdzanie Integralnośći Danych ZFS </olink>.</para>
</sect3>
<sect3 xml:id="gbcwe">
<title>Błędy uszkodzenia danych</title>
<para>Polecenie <command>zpool status</command> równierz pokazuje, czy jakiekolwiek znane błędy są powiązane z pulą. Te błędy mogą zostać odnalezione podczas operacji weryfikacji danych lub normalnego użytkowania. ZFS utrzymuje trwały log wszystkich znanych błędów danych związanych z pulą. Ten log jest odnawiany, kiedy kompletna operacja weryfikacji danych zostaje ukończona.</para>
<para>Błędy uszkodzenia danych są zawsze krytyczne. Ich istnienie wskazują, że conajmniej jedna aplikacja doświadczyła błędy we/wy związane z uszkodzeniem danych w puli. Błędy urządzeń w redundantnej puli nie powodują błędów danych i nie są zgłaszane w tym logu. Domyślnie, tylko znalezione błędy są wyświetlane. Kompletna lista błędów, wraz z ich specyfikacją, może zostać znaleciona używając komendy <command>zpool status</command> <option> v</option>. Na przykład: <indexterm xml:id="indexterm-540"> <primary>Pule pamięci ZFS</primary> <secondary>zidentyfikowane błędy danych(<command>zpool status</command> <option> v</option>)</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-541"> <primary>dane</primary> <secondary>identyfikowanie uszkodzenia(<command>zpool status</command><option>v</option>)</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-542"> <primary>usuwanie problemów</primary> <secondary>zidentyfikowane błędy danych  (<command>zpool status</command> <option> v</option>)</secondary> <tertiary>(przykład)</tertiary> </indexterm>
</para>
<screen># <userinput>zpool status -v</userinput>
  pool: tank
 state: DEGRADED
status: One or more devices has experienced an error resulting in data
        corruption.  Applications may be affected.
action: Restore the file in question if possible.  Otherwise restore the
        entire pool from backup.
   see: http://www.sun.com/msg/ZFS-8000-8A
 scrub: resilver completed with 1 errors on Fri Mar 17 15:42:18 2006
config:

        NAME         STATE     READ WRITE CKSUM
        tank         DEGRADED     0     0     1
          mirror     DEGRADED     0     0     1
            c1t0d0   ONLINE       0     0     2
            c1t1d0   UNAVAIL      0     0     0  corrupted data

errors: The following persistent errors have been detected:

          DATASET  OBJECT  RANGE
          5        0       lvl=4294967295 blkid=0</screen>
<para>Podobny komunikat jest wyświetlony przy użyciu komendy  <command>fmd</command> w konsoli systemowej oraz w pliku  <filename>/var/adm/messages</filename>. Ten komunikat może zostać również śledzony używając komendy <command>fmdump</command>.</para>
<para>Więcej informacji na temat interpretowania błędów danych można znaleźć w <olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbcuz">Identyfikowanie Typów Błędów Danych</olink>.</para>
</sect3>
</sect2>
<sect2 xml:id="gbcvk">
<title>Raport Systemowy Błędów ZFS</title>
<para>Jako uzupełnienie śledzenia błędów w puli, ZFS również zgłasza interesujące informacje w logu systemowym (syslog). Następujący scenariusze generują wiadomości, aby poinformować administratora: <indexterm xml:id="indexterm-543"> <primary>Pule pamięci ZFS</primary> <secondary>wiadomości błędów systemowych</secondary> <tertiary>opis</tertiary> </indexterm> <indexterm xml:id="indexterm-544"> <primary>wyświetlanie</primary> <secondary>log systemowy reportujący błędy ZFS</secondary> <tertiary>opis</tertiary> </indexterm> <indexterm xml:id="indexterm-545"> <primary>usuwanie problemów</primary> <secondary>log systemowy reportujący błędy ZFS</secondary> </indexterm>
</para>
<itemizedlist>
<listitem>
<para>
<emphasis role="strong">Device state transition</emphasis> – Jeśli urządzenie zostanie oznaczone stanem <literal>FAULTED</literal>, ZFS loguje wiadomość, przy czym tolerancja uszkodzenia całej puli może zostać wzięta pod uwagę.  Podobna wiadomość zostaje wysłana, jeżeli urządzenie jest później podniesione do stanu online, przywracając pulę do zdrowia.</para>
</listitem>
<listitem>
<para>
<emphasis role="strong">Data corruption</emphasis> –  Jeśli jakiekolwiek uszkodzenie danych jest wykryte, ZFS loguje wiadomość opisującą kiedy i gdzie uszkodzenie zostało odnalezione. Wiadomość jest logowana tylko przy pierwszym odnalezieniu błędu. Kolejny dostęp do uszkodzonych danych nie generuje wiadomości.</para>
</listitem>
<listitem>
<para>
<emphasis role="strong">Pool failures and device failures</emphasis> – Jeśli następuje błąd puli lub urządzenia, demon menadżera błędów zgłasza je poprzez log systemowy jak również poprzez polecenie  <command>fmdump</command>.</para>
</listitem>
</itemizedlist>
<para>Jeśli ZFS wykryje błąd urządzenia i automatycznie je naprawi, żadnen komunikat nie zostanie zgłoszony. Tego rodzaju błędy nie stanowią awarii w nadmiarowej puli lub integralności danych. Co więcej, tego typu błędy są zwykle rezultatem problemu sterownika, który generuje własne komunikaty.</para>
</sect2>
</sect1>
<sect1 xml:id="gbbve">
<title>Naprawa uszkodzonej konfiguracji ZFS</title>
<para>ZFS utrzymuje bufor aktywnych pul i ich konfiguracji w głównym systemu plików. Jeśli plik jest uszkodzony lub w jakiś sposób jest niezsynchronizowany, pula nie może zostać otwarta. ZFS próbuje ominąć taki przypadek, aczkolwiek dowolne uszkodzenie jest zawsze możliwe. Ta sytuacja zwykle powoduje zniknięcie puli z systemu, kiedy w przeciwnym przypadku powinna być dostępna. Sytuacja ta może również zgłosić nieznaną liczbę brakujących urządzeń wirtualnych w najwyższym poziomie. W każdym z przypadków, konfiguracja może zostać odzyskana poprzez eksportowanie puli (jeżeli jest w ogóle widoczna) i ponownym imporcie puli.<indexterm xml:id="indexterm-546"> <primary>Pule pamięci ZFS</primary> <secondary>naprawa uszkodzonej konfiguracji ZFS</secondary> </indexterm> <indexterm xml:id="indexterm-547"> <primary>naprawa</primary> <secondary>uszkodzona konfiguracja ZFS</secondary> <tertiary>opis</tertiary> </indexterm> <indexterm xml:id="indexterm-548"> <primary>usuwanie problemów</primary> <secondary>naprawa uszkodzonej konfiguracji ZFS</secondary> </indexterm>
</para>
<para>Więcej informacji na temat importowania i exportowania puli można znaleźć w <olink remap="external" targetdoc="chapter-4.xml" targetptr="gbchy">Migracja Pul Pamięci ZFS </olink>.</para>
</sect1>
<sect1 xml:id="gbbvb">
<title>Naprawa brakującego urządzenia</title>
<para>Jeśli urządzenie nie może zostać otwarte, wyświetlane zostaje jako   <literal>UNAVAILABLE</literal> w komunikacie komendy <command>zpool status</command> Ten status oznacza, że ZFS nie udało się otworzyć urządzenia, kiedy następował dostęp do puli po raz pierwszy, lub urządzenie zostało niedostępne. Jeśli urządzenie powoduje niedostępność wirtualnego urządzenia najwyższego poziomu, wtedy nic z puli nie jest dostępne. W przeciwnym przypadku, tolerancja uszkodzeń może zostać wzięta pod uwagę. W każdym z przypadków, urządzenie musi zostać ponownie zamontowane w systemie w celu odzyskania normalnej pracy.<indexterm xml:id="indexterm-549"> <primary>Pule pamięci ZFS</primary> <secondary>wymiana brakującego urządzenia</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-550"> <primary>wymiana</primary> <secondary>brakujące urządzenie</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-551"> <primary>usuwanie problemów</primary> <secondary>wymiana brakującego urządzenia</secondary> <tertiary>(przykład)</tertiary> </indexterm>
</para>
<para>Na przykład, po awarii urządzenia, możesz zobaczyć podobny komunikat pochodzący z <command>fmd</command>:</para>
<screen>SUNW-MSG-ID: ZFS-8000-D3, TYPE: Fault, VER: 1, SEVERITY: Major
EVENT-TIME: Thu Aug 31 11:40:59 MDT 2006
PLATFORM: SUNW,Sun-Blade-1000, CSN: -, HOSTNAME: tank
SOURCE: zfs-diagnosis, REV: 1.0
EVENT-ID: e11d8245-d76a-e152-80c6-e63763ed7e4e
DESC: A ZFS device failed.  Refer to http://sun.com/msg/ZFS-8000-D3 for more information.
AUTO-RESPONSE: No automated response will occur.
IMPACT: Fault tolerance of the pool may be compromised.
REC-ACTION: Run 'zpool status -x' and replace the bad device.</screen>
<para>Następnym krokiem jest uzycie komendy <command>zpool status</command> <option>x</option> w celu zobaczenia dokładniejszej informacji na temat problemu urządzenia i podjęcia decyzji. Na przykład:</para>
<screen># <userinput>zpool status -x</userinput>
  pool: tank
 state: DEGRADED
status: One or more devices could not be opened.  Sufficient replicas exist for
        the pool to continue functioning in a degraded state.
action: Attach the missing device and online it using 'zpool online'.
   see: http://www.sun.com/msg/ZFS-8000-D3
 scrub: resilver completed with 0 errors on Thu Aug 31 11:45:59 MDT 2006
config:

        NAME         STATE     READ WRITE CKSUM
        tank         DEGRADED     0     0     0
          mirror     DEGRADED     0     0     0
            c0t1d0   UNAVAIL      0     0     0  cannot open
            c1t1d0   ONLINE       0     0     0</screen>
<para>Z tego komunikatu można zobaczyć, że brakujące urządzenie <literal>c0t1d0</literal> nie pracuje. Jesli zostanie stwierdzone, ze urządzenie jest wadliwe, należy je wymienić.</para>
<para>Wtedy użyj komendy <command>zpool online</command> w celu przywrócenia wymienionego urządzenia do stanu online. Na przykład:</para>
<screen># <userinput>zpool online tank c0t1d0</userinput>
</screen>
<para>Sprawdź, czy pula z wymienionym urządzeniem jest zdrowa.</para>
<screen># <userinput>zpool status -x tank</userinput>
pool 'tank' is healthy</screen>
<sect2 xml:id="gbbxn">
<title>Fizyczne Ponowne Podłączenie Urządzenia</title>
<para>Sposób ponownego podłączenia brakującego urządzenia, zależy od jego typu. Jeśli jest to urządzenie sieciowe, połączenie powinno zostać odzyskane. Jeśli jest to urządzenie USB lub inne wymienne media, powinno zostać ponownie podłączone do systemu. Jeśli jest to lokalny dysk, mogła nastąpić awaria kontrolera, dlatego urządzenie nie jest widoczne przez system. W takim wypadku, kontroler powinien zostać wymieniony. W tym momencie dyski będą ponownie dostępne. Inne problemy mogą istnieć i zależeć od typu sprzętu oraz konfiguracji. Jeśli napęd zostanie uszkodzony i nie jest już widoczny przez system (rzadki przypadek), urządzenie powinno być traktowane jako uszkodzone. Należy wtedy postępować z procedurą, którą omawia podrozdział <olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbvf">Naprawa uszkodzonego urządzenia</olink>.</para>
</sect2>
<sect2 xml:id="gbbyi">
<title>Powiadomienie ZFS o Dostępnośći Urządzenia</title>
<para>W przypadku gdy urządzenie jest ponownie podłączone do systemu, ZFS może, ale nie musi automatycznie wykryć jego istnienie. Jeśli pula była wcześniej w stanie faulted, lub system został zrestartowany jako część procedury podłączania, wtedy ZFS automatycznie przeskanuje wszystkie urządzenia kiedy próbuje otworzyć pule. Jeśli pula była w stanie degraded i urządzenie zostało wymienione w czasie, gdy system był uruchomiony, musisz powiadomić ZFS, że to urządzenie jest dostępne i gotowe do ponownego otwarcia, używając komendy <command>zpool online</command>. Na przykład:<indexterm xml:id="indexterm-552"> <primary>Pule pamięci ZFS</primary> <secondary>powiadomienie ZFS o ponownym podłączeniu urządzenia (<command>zpool online</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-553"> <primary>powiadomienie</primary> <secondary>ZFS o ponownym podłączeniu urządzenia (<command>zpool online</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-554"> <primary>usuwanie problemów</primary> <secondary>powiadomienie ZFS o ponownym podłączeniu urządzenia (<command>zpool online</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm> 
</para>
<screen># <userinput>zpool online tank c0t1d0</userinput>
</screen>
<para>Więcej informacji na temat podnoszenia urządzeń do stanu online, można znaleźć w <olink remap="external" targetdoc="chapter-4.xml" targetptr="gazgk">Podnoszenie Urządzenia do Stanu Online</olink>.</para>
</sect2>
</sect1>
<sect1 xml:id="gbbvf">
<title>Naprawa uszodzonego urządzenia</title>
<para>Ta sekcja opisuje w jaki sposób określić typ błędu urządzenia, wyczyścić tymczasowe błędy oraz wymienić urządzenie.</para>
<sect2 xml:id="gbbzs">
<title>Określanie Typu Błędu Urządzenia</title>
<para>Określenie <emphasis>uszkodzone urządzenie</emphasis> jest szerokie i może opisywać wiele możliwych sytuacji:<indexterm xml:id="indexterm-555"> <primary>Pule pamięci ZFS</primary> <secondary>określanie typu błędy urządzenia</secondary> <tertiary>opis</tertiary> </indexterm> <indexterm xml:id="indexterm-556"> <primary>określanie</primary> <secondary>typ błędu urządzenia</secondary> <tertiary>opis</tertiary> </indexterm> <indexterm xml:id="indexterm-557"> <primary>usuwanie problemów</primary> <secondary>określanie typu błędu urządzenia</secondary> <tertiary>opis</tertiary> </indexterm>
</para>
<itemizedlist>
<listitem>
<para>
<emphasis role="strong">Bit rot</emphasis> – Z czasem, losowe zdarzenia, takie jak na przykład promieniowanie kosmiczne i wpływ pola magnetycznego, może spowodować, że bity zachowane na dysku mogą być w nieprzewidywalnym stanie. Takie zdarzenia należą do rzadkości, jednak są na tyle częste, że powodują potencjalne błędy danych w dużych lub długo działających systemach. Te błędy są zwykle tymczasowe.</para>
</listitem>
<listitem>
<para>
<emphasis role="strong">Misdirected reads or writes</emphasis> – Błędy w oprogramowaniu sprzętowym lub usterki sprzętowe mogą powodować, że odczyt lub zapis całego bloku odwołuje się do złej lokacji na dysku. Te błędy są zwykle tymczasowe, aczkolwiek ich duża ilość może powodować błąd dysku.</para>
</listitem>
<listitem>
<para>
<emphasis role="strong">Administrator error</emphasis> – Administratorzy mogą przypadkowo nadpisać poprawne dane złymi (jak na przykład kopiowanie <filename>/dev/zero</filename> na dysk), co powoduje trwałe uszkodzenie danych na dysku. Te błędy są zawsze tymczasowe.</para>
</listitem>
<listitem>
<para>
<emphasis role="strong">Temporary outage</emphasis>– Dysk może zostać niedostępny na jakiś czas powodując błędy we/wy. Ta sytuacja jest zwykle związana z urządzeniami sieciowymi, aczkolwiek lokalne dyski również mogą być tymczasowo niedostępne. Te błędy mogą, ale nie muszą być tymczasowe.</para>
</listitem>
<listitem>
<para>
<emphasis role="strong">Bad or flaky hardware</emphasis> – Ta sytuacja występuje kiedy występują różnego rodzaju awarie związane z błędnym sprzętem. To mogą być ciągłe błędy we/wy, błędny transport powodujący losowe uszkodzenia lub inne wady. Te błędy są zwykle trwałe.</para>
</listitem>
<listitem>
<para>
<emphasis role="strong">Offlined device</emphasis> – W przypadku, gdy urządzenie jest w trybie offline, przyjmuje się, że to administrator postawił je postawił do takiego stanu, ponieważ uznano je jako uszkodzone. Administrator, który postawił urządzenie w tym stanie może określić czy założenie jest precyzyjne.</para>
</listitem>
</itemizedlist>
<para>Odnalezienie dokładnej przyczyny błędu może być trudnym zadaniem. Pierwszym krokiem jest sprawdzenie licznika błędów, przy użyciu polecenia <command>zpool status</command>, jak pokazano poniżej:</para>
<screen># <userinput>zpool status -v</userinput> <replaceable>pool</replaceable>
</screen>
<para>Te błędy są podzielone na błędy we/wy oraz sumy kontrolnej, w obu przypadkach oznacza to możliwy rodzaj awarii. Typowe działanie wykazuje bardzo małą liczbę błędów (kilka w ciągu długiego czasu). Jeśli zobaczysz dużą ilość błędów, ta sytuacja najprawdopodobniej oznacza bliską lub całkowitą awarie urządzenia.  Jakkolwiek, awarie wynikające z pracy administratora mogą generować dużą ilość błędów. Innym źródłem informacji jest log systemowy. Jeżeli log pokazuje dużą ilość wiadomośći pochodzących z kanału fibre lub SCSI, wtedy najprawdopodobniej oznacza to poważne problemy sprzętowe. Jeśli wiadomości systemowe nie są generowane, wtedy uszkodzenie jest najprawdopodobniej tymczasowe.</para>
<para>Celem jest odpowiedź na następujące pytania:</para>
<para>
<emphasis>Czy występowały inne błędy na tym urządzeniu?</emphasis>
</para>
<para>Błędy które wystąpiły tylko raz, są rozpatrywane jako <emphasis>tymczasowe (transient)</emphasis> i niekoniecznie oznaczają potencjalną awarię. Trwałe błędy, lub kilka, które mogą oznaczać potencjalną awarie sprzętową, są rozpatrywane jako “fatalne (fatal).” Działania pozwalające na określeniu typu błędu jest poza zasięgiem istniejących automatycznych narzędzi, dostępnych wraz z ZFS, tak więc muszą zostać określone ręcznie przec Ciebie, czyli administratora. Kiedy operacja określenia typu błędu jest wykonana, odpowiednie czynności mogą zostać podjęte. Może to być wyczyszczenie ulotnych błędów lub wymiana uszkodzonego urządzenia związana z fatalnymi błędami. Procedura naprawy jest opisana w następnej sekcji.</para>
<para>Nawet gdy błędy urządzenia zostały rozwarzone jako ulotne, mogło to spowodować nienaprawialne błędy danych w puli. Te błędy wymagają specjalnych procedur naprawy, nawet jeśli odpowiednie urządzenie jest uznane jako zdrowe lub w innym przypadku naprawione. Więcej informacji na temat naprawy błędów danych można zobaczyć w <olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbwl">Naprawa Uszkodzonych Danych</olink>.</para>
</sect2>
<sect2 xml:id="gbbzv">
<title>Kasowanie Tymczasowych Błędów</title>
<para>Jeśli błędy urządzenia zostały uznane jako tymczasowe i nie spowodujące przyszłych błędów w zdrowym urządzeniu, mogą zostać bezpiecznie wyczyszczone, aby zpobiec wykazaniu jako błędy fatalne. Aby wyczyścić licznik błędów dla macierzy RAID-Z, użyj komendy <command>zpool clear</command>. Na przykład: <indexterm xml:id="indexterm-558"> <primary>Pule pamięci ZFS</primary> <secondary>kasowanie błędów urządzeń (<command>zpool clear</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-559"> <primary>kasowanie</primary> <secondary>błędy urządzeń (<command>zpool clear</command>)</secondary> <tertiary>(przykłąd)</tertiary> </indexterm> <indexterm xml:id="indexterm-560"> <primary>usuwanie problemów</primary> <secondary>kasowanie błędów urządzeń (<command>zpool clear</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm>
</para>
<screen># <userinput>zpool clear tank c1t0d0</userinput>
</screen>
<para>Ta komenda kasuje wszystkie błędy oraz licznik błędów związany z urządzeniem.</para>
<para>Aby wyczyścić wszystkie błędy związane z wirtualnymi urządzeniami w puli i wyczyścić jakiekolwiek liczniki błędów związanych z pulą, użyj następującej składni:</para>
<screen># <userinput>zpool clear tank</userinput>
</screen>
<para>Więcej informacji na temat kasowania błędów puli: <olink remap="external" targetdoc="chapter-4.xml" targetptr="gazge">Zerowanie liczników błędów urządzeń w puli</olink>.</para>
</sect2>
<sect2 xml:id="gbbzy">
<title>Wymiana Urządzenia w Puli Pamięci ZFS</title>
<para>Jeżeli uszkodzenie urządzenia jest trwałe lub przyszłe uszkodzenie jest prawdopodobne, musi ono zostać wymienione. Czy urządzenie może zostać wymienione, zależy od konfiguracji.</para>
<itemizedlist>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbcfb">Sprawdzenie, czy urządzenie może zostać wymienione</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbcdv">Urządzenie, które nie może zostać wymienione</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbcet">Wymiana urządzenia w puli pamięci ZFS</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbcus">Podgląd statusu operacji weryfikacji danych</olink>
</para>
</listitem>
</itemizedlist>
<sect3 xml:id="gbcfb">
<title>Sprawdzenie czy Urządzenie Może Zostać Wymienione</title>
<para>Aby wymienić urządzenie pula musi być w stanie <literal>ONLINE</literal>. Urządzenie musi być częścią redundantnej konfiguracji, lub musi być w zdrowe (w stanie<literal>ONLINE</literal>).  Jeśli dysk jest częścią redundantnej konfiguracji, wystarczające repliki z których można uzyskać poprawne dane muszą istnieć. Jeśli dwa dyski w macierzy cztero-kierunkowej (four-way mirror) są w stanie fauted, wtedy każdy z dysków może zostać wymieniony, ponieważ istnieją zdrowe repliki. Jakkolwiek, jeśli dwa dyski w cztero-kierunkowej macierzy RAID-Z są w stanie faulted, wtedy żaden z dysków nie może zostać wymieniony, ponieważ nie istnieje wystarczająca ilość replik, aby otrzymać poprawne dane. Jeśli urządzenie jest uszkodzone i nie jest w stanie online, może zostać wymienione tak długo, jak pula nie jest w stanie <literal>FAULTED</literal>. Aczkolwiek, dane są kopiowane na nowe urządzenie, tak długo jak istnieją odpowiednie repliki z dobrymi danymi.<indexterm xml:id="indexterm-561"> <primary>Pule pamięci ZFS</primary> <secondary>sprawdzanie, czy urządzenie może zostać wymienione</secondary> <tertiary>opis</tertiary> </indexterm> <indexterm xml:id="indexterm-562"> <primary>sprawdzanie</primary> <secondary>czy urządzenie może zostać wymienione</secondary> <tertiary>opis</tertiary> </indexterm> <indexterm xml:id="indexterm-563"> <primary>usuwanie problemów</primary> <secondary>sprawdzanie, czy urządzenie może zostać wymienione</secondary> <tertiary>opis</tertiary> </indexterm>
</para>
<para>W następującej konfiguracji dysk <literal>c1t1d0</literal> może zostać wymieniony i wszystkie dane z puli są kopiowane ze zdrowej repliki  <literal>c1t0d0</literal>.</para>
<screen>mirror            DEGRADED
    c1t0d0             ONLINE
    c1t1d0             FAULTED</screen>
<para>Dysk <literal>c1t0d0</literal> również może zostać wymieniony, aczkolwiek dane nie mogą zostać automatycznie naprawione (self-healing), ponieważ nie istnieje żadna poprawna replika.</para>
<para>W następującej konfiguracji, żaden z dysków będących w stanie faulted nie może zostać wymieniony. Dyski w stanie  <literal>ONLINE</literal> również nie mogą zostać wymienione, ponieważ cała pula jest w stanie faulted.</para>
<screen>raidz             FAULTED
    c1t0d0             ONLINE
    c2t0d0             FAULTED
    c3t0d0             FAULTED
    c3t0d0             ONLINE</screen>
<para>W następującej konfiguracji oba dyski najwyższego poziomu mogą zostać wymienione, aczkolwiek żadne błędne dane nie są kopiowane na nowy.</para>
<screen>c1t0d0         ONLINE
c1t1d0         ONLINE</screen>
<para>Jeśli oba dyski będą w stanie faulted, wymiana urządzenia nie może zostać wykonana, ponieważ pula będzie znajdowała się w stanie faulted.</para>
</sect3>
<sect3 xml:id="gbcdv">
<title>Urządzenia, które nie mogą być wymienione</title>
<para>Jeśli zgubienie urządzenia powoduje, że pula zostaje uszkodzona, lub urządzenie zawiera zbyt dużo błędów w nieredundantnej konfiguracji, wtedy nie może ono być bezpiecznie wymienione. Bez wystarczającej redunancji, nie istnieją dobre dane, które mogły by uzdrowić uszkodzone urządzenie. W tym wypadku jedyną możliwością jest zniszczenie puli i ponowne utworzenie jej konfiguracji, wraz z odtworzeniem danych podczas tego procesu.</para>
<para>Więcej informacji na temat odtwarzania całej puli można znaleźć w <olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbctt">Naprawa Szeroko Uszkodzonej Puli ZFS</olink>.</para>
</sect3>
<sect3 xml:id="gbcet">
<title>Wymiana Urządzenia w Puli Pamięci ZFS</title>
<para>W przypadku, gdy zostało ustalone, że urządzenie może zostać wymienione, należy użyć komendy <command>zpool replace</command> w celu jego wymiany. Jeśli wymieniasz uszkodzone urządzenie z innym urządzeniem, użyj nastepującej komendy:<indexterm xml:id="indexterm-564"> <primary>Pule pamięci ZFS</primary> <secondary>wymiana urządzenia (<command>zpool replace</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-565"> <primary>wymiana</primary> <secondary>urządzenie (<command>zpool replace</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-566"> <primary>usuwanie problemów</primary> <secondary>wymiana urządzenia (<command>zpool replace</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm>
</para>
<screen># <userinput>zpool replace tank c1t0d0 c2t0d0</userinput>
</screen>
<para>Ta komenda rozpoczyna migracje danych z uszkodzonego urządzenia na nowe, lub innego z puli, jeśli jest w redundantnej konfiguracji. Kiedy operacja zostanie wykonana, uszkodzone urządzenie zostaje usunięte z konfiguracji. W tym momencie może ono zostać usunięte z systemu. Jeśli urządzenie zostało już wymienione na nowe w tej samej lokalizacji i usunięte z systemu, użyj polecenia z pojedyńczym urządzeniem. Na przykład:</para>
<screen># <userinput>zpool replace tank c1t0d0</userinput>
</screen>
<para>Ta komenda bierze niesformatowany dysk, odpowiednio go formatuje i rozpoczyna proces resilveringu danych z pozostałej konfiguracji.</para>
<para>Więcej informacji na temat komendy <command>zpool replace</command> można znaleźć w <olink remap="external" targetdoc="chapter-4.xml" targetptr="gazgd">Wymiana Urządzeń w Puli Pamięci</olink>.</para>
</sect3>
<sect3 xml:id="gbcus">
<title>Podgląd Statusu Resilveringu</title>
<para>Proces wymiany dysku, może zająć więcej czasu, w zależności od rozmiaru dysku oraz ilości danych w puli. Proces przenoszenia danych z jednego dysku na drugi jest znany jako <emphasis>resilvering</emphasis> i może być monitorowany, przy użyciu komendy  <command>zpool status</command>.</para>
<para>Tradycyjne systemy plików używają operacji resilveringu danych na poziomie bloków. Ponieważ ZFS eliminuje sztuczną warstwę menadżera wolumenu, może wykonać operację resilveringu w bardziej efektywny i kontrolowany sposób. Istnieją dwie główne zalety tej funkcji:</para>
<itemizedlist>
<listitem>
<para>ZFS używa operacji resilveringu tylko dla minimalnej ilości potrzebnych danych. W tym wypadku występuje krótki przestój (w przeciwieństwie do całkowitej wymiany urządzenia), cały dysk może zostać poddany operacji resilveringowi w ciągu minut lub sekund. W wypadku resilveringu całego dysku lub skomplikowanej metody logowania błędnych regionów (¨dirty region¨), które są obsługiwane przez niektóre menadżery wolumenów. Kiedy cały dysk zostaje wymieniony, czas operacji resilweringu jest proporcjonalny do ilości danych użytych na tym dysku. Wymiana dysku o pojemności 500-Gbyte może zająć kilka sekund, jeśli kilka gigabajtów jest użytych w puli.<indexterm xml:id="indexterm-567"> <primary>Pule pamięci ZFS</primary> <secondary>podgląd procesu resilweringu</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-568"> <primary>wymiana</primary> <secondary>urządzenie (<command>zpool replace</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-569"> <primary>usuwanie problemów</primary> <secondary>wymiana urządzenia (<command>zpool replace</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm>
</para>
</listitem>
<listitem>
<para>Operacja resilweringu jest bezpieczna i nie można jej przerwać. Jeśli system straci zasilanie, lub zostanie ponownie uruchomiony, proces resilveringu zostanie wznowiony dokładnie w tym miejscu, w którym skończył, bez potrzeby ręcznej interwencji.</para>
</listitem>
</itemizedlist>
<para>Aby zobaczyć status jawnej kontroli danych, użyj komendy <command>zpool status</command> Na przykład:</para>
<screen># <userinput>zpool status tank</userinput>
  pool: tank
 state: DEGRADED
reason: One or more devices is being resilvered.
action: Wait for the resilvering process to complete.
   see: http://www.sun.com/msg/ZFS-XXXX-08
 scrub: none requested
config:
        NAME                  STATE     READ WRITE CKSUM 
        tank                  DEGRADED     0     0     0
          mirror              DEGRADED     0     0     0
            replacing         DEGRADED     0     0     0  52% resilvered
              c1t0d0          ONLINE       0     0     0
              c2t0d0          ONLINE       0     0     0  
            c1t1d0            ONLINE       0     0     0</screen>
<para>W tym wypadku dysk <literal>c1t0d0</literal> zostaje wymieniony na  <literal>c2t0d0</literal>. To zdarzenie jest obserwowane w istnieniu wirtualnego urządzenia w  statusie wyniku komendy  <emphasis>replacing</emphasis>. To urządzenie nie jest prawdziwe, również nie jest możliwe stworzenie puli przy jego użyciu. Powodem istnienia tego urządzenia jest wyświetlenie procesu resilveringu i identyfikowanie które urzadzenie podlega wymianie.</para>
<para>Prosze zauważyć, że jakakolwiek pula, która wykonuje operacje resilveringu jest w stanie <literal>DEGRADED</literal>, ponieważ nie może zapewnić określonego poziomu redundancji, zanim proces jest zakończony. Proces resilveringu wykonuje się z maksymalną możliwą prędkością, aczkolwiek operacje we/wy są zawsze ustawiane na niższym priorytecie niż operacje we/wy wykonywane przez użytkownika, aby zminimalizować wpływ na działanie systemu. Kiedy operacja resilveringu jest zakończona, konfiguracja zostaje przywrócona do nowej, kompletnej. Na przykład:</para>
<screen># <userinput>zpool status tank</userinput>
  pool: tank
 state: ONLINE
 scrub: scrub completed with 0 errors on Thu Aug 31 11:20:18 2006
config:

        NAME        STATE     READ WRITE CKSUM
        tank        ONLINE       0     0     0
          mirror    ONLINE       0     0     0
            c2t0d0  ONLINE       0     0     0
            c1t1d0  ONLINE       0     0     0

errors: No known data errors</screen>
<para>Pula jest znowu w stanie <literal>ONLINE</literal>, a oryginalny uszkodzony dysk  (<literal>c1t0d0</literal>) został usunięty z konfiguracji.</para>
</sect3>
</sect2>
</sect1>
<sect1 xml:id="gbbwl">
<title>Naprawa uszkodzonych danych</title>
<para>Poniższe sekcje opisują w jaki sposób identyfikować rodzaj uszkodzenia i jeśli to możliwe w jaki sposób naprawić dane.</para>
<itemizedlist>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbcuz">Identyfikowanie Rodzaju Uszkodzenia Danych</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbctx">Naprawa uszkodzonych plików lub katalogów</olink>
</para>
</listitem>
<listitem>
<para>
<olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbctt">Naprawa Szeroko Uszkodzonej Puli ZFS</olink>
</para>
</listitem>
</itemizedlist>
<para>ZFS używa sum kontrolnych, redundancji i automatycznej naprawy danych (self-healing), aby zminimalizować szanse uszkodzenia danych. Co więcej, uszkodzenie danych może nastąpić, jeśli pula nie jest redundantna, uszkodzenie nastąpiło, gdy pula była w stanie degraded lub rzadko spotykane serie zdarzeń powodujące uszkodzenie tych wielu samych kopi danych. Bez względu na źródło, rezultat jest taki sam: Dane są uszkodzone i niedostępne. Wykonane czynności zależą od typu uszkodzenia danych i jest wartością relatywną. Dwa podstawowe typy danych mogą zostać uszkodzone:</para>
<itemizedlist>
<listitem>
<para>Metadane puli - ZFS wymage odpowiedniej ilości danych, które muszą zostać spraswoane w celu otwarcia puli i dostępu do jej danych. Jeśli te dane są uszkodzone, cała pula lub odpowiednie dane w strukturze hierarchii będą niedostępne. </para>
</listitem>
<listitem>
<para>Dane objektowe - W tym wypadku, uszkodzenie nastąpiło w odpowiednim pliku lub katalogu. Ten problem może spowodować, że część pliku lub katalogu, będzie niedostępna, lub może spowodować, ze obiekty będą wspólnie niedostępne.</para>
</listitem>
</itemizedlist>
<para>Dane są sprawdzane podczas normalnych operacji, ale również podczas sprawdzania weryfikacji danych. Więcej informacji na temat weryfikacji spójności danych puli można znaleźć w <olink remap="internal" targetdoc="chapter-9.xml" targetptr="gbbwa">Sprawdzanie Spójności Danych ZFS</olink>.</para>
<sect2 xml:id="gbcuz">
<title>Identyfikowanie rodzaju uszkodzenia danych</title>
<para>Domyślnie komenda  <command>zpool status</command> pokazuje tylko, że uszkodzenie nastąpiło, ale nie zawiera informacji, gdzie wystąpiło. Na przykład:<indexterm xml:id="indexterm-570"> <primary>Pule pamięci ZFS</primary> <secondary>identyfikowanie typu błędów danych (<command>zpool status -v</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-571"> <primary>identyfikowanie</primary> <secondary>typy błedów danch (<command>zpool status -v</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm> <indexterm xml:id="indexterm-572"> <primary>usuwanie problemów</primary> <secondary>identyfikowanie typu błędów danych (<command>zpool status -v</command>)</secondary> <tertiary>(przykład)</tertiary> </indexterm> 
</para>
<screen># <userinput>zpool status tank -v</userinput>
   state: ONLINE
status: One or more devices has experienced an error resulting in data
                            corruption.  Applications may be affected.
	action: Restore the file in question if possible.  Otherwise restore the
                                                                                 entire pool from backup.
	   see: http://www.sun.com/msg/ZFS-8000-8A
	 scrub: none requested
	config:

		NAME         STATE     READ WRITE CKSUM
		tank         ONLINE       1     0     0
		  mirror     ONLINE       1     0     0
		    c2t0d0   ONLINE       2     0     0
		    c1t1d0   ONLINE       2     0     0

	errors: The following persistent errors have been detected:

		  DATASET  OBJECT  RANGE
		  tank     6       0-512</screen>
<screen># <userinput>zpool status</userinput>
   pool: monkey
state: ONLINE
status: One or more devices has experienced an error resulting in data
         corruption.  Applications may be affected.
action: Restore the file in question if possible.  Otherwise restore the
         entire pool from backup.
    see: http://www.sun.com/msg/ZFS-8000-8A
scrub: none requested
config:

         NAME        STATE     READ WRITE CKSUM
         monkey      ONLINE       0     0     0
           c1t1d0s6  ONLINE       0     0     0
           c1t1d0s7  ONLINE       0     0     0

errors: 8 data errors, use '-v' for a list </screen>
<para>Każdy z błędów wskazuje, że błąd wystąpił w danym momencie. Niekoniecznie każdy z błędół jest ciągle obecny w systemie. W zwykłych przypadkach ta sytuacja jest prawdziwa. Pewne tymczasowe awarie mogą spowodować naprawe danych przed ich zakończeniem. Całkowita operacja jawnej kontroli danych dla puli, gwarantuje zbadanie każdego aktywnego bloku w puli, tak więc rejestr błędów jest resetowany, gdy operacja jest ukończona. Jeśli określisz, że błędy zostały usunięte i nie chcesz czekać na zakończenie operacji kontroli danych, zresetuj błędy w puli używając komendy  <command>zpool online</command>&gt;.</para>
<para>Jeśli błędy danych są w metadanych puli, wynik jest nieco inny. Na przykład:</para>
<screen># <userinput>zpool status -v morpheus</userinput>
  pool: morpheus
    id: 1422736890544688191
 state: FAULTED
status: The pool metadata is corrupted.
action: The pool cannot be imported due to damaged devices
   see: http://www.sun.com/msg/ZFS-8000-72
config:

        morpheus    FAULTED   corrupted data
          c1t10d0   ONLINE</screen>
<para>W przypadku globalnego uszkodzenia puli, jest ona postawiona w stanie <literal>FAULTED</literal>, ponieważ nie może zapewnić odpowiedniego poziomu redundancji.</para>
</sect2>
<sect2 xml:id="gbctx">
<title>Naprawa uszkodzonych plików lub katalogów</title>
<para>Jeśli plik lub katalog jest uszkodzony, system może dalej funkcjonować, w zależności od typu awarii. Uszkodzenie jest nie do naprawienia. Żadne zdrowe kopie danych nie istnieją w innych miejscach systemu. Jeśli dane są cenne, nie ma innej możliwości, jak odzyskanie ich z innej zdrowej kopii zapasowej. Nawet wtedy może być możliwe odtworzenie uszkodzonych danych bez odtwarzania całej puli.<indexterm xml:id="indexterm-573"> <primary>Pule pamięci ZFS</primary> <secondary>naprawa uszkodzonego pliku lub katalogu</secondary> <tertiary>opis</tertiary> </indexterm> <indexterm xml:id="indexterm-574"> <primary>naprawa</primary> <secondary>naprawa uszkodzonego pliku lub katalogu</secondary> <tertiary>opis</tertiary> </indexterm> <indexterm xml:id="indexterm-575"> <primary>usuwanie problemów</primary> <secondary>naprawa uszkodzonego pliku lub katalogu</secondary> <tertiary>opis</tertiary> </indexterm> 
</para>
<para>Jeśli uszkodzenie jest w bloku danych pliku, może on zostać bezpiecznie usunięty, usuwając błędy z systemu. Do wyświetlenia listy plików z istniejącymi błędami, użyj komendy: <command>zpool status</command> <option>v</option>. Na przykład:</para>
<screen># <userinput>zpool status -v</userinput>
   pool: monkey
state: ONLINE
status: One or more devices has experienced an error resulting in data
         corruption.  Applications may be affected.
action: Restore the file in question if possible.  Otherwise restore the
         entire pool from backup.
    see: http://www.sun.com/msg/ZFS-8000-8A
scrub: none requested
config:

         NAME        STATE     READ WRITE CKSUM
         monkey      ONLINE       0     0     0
           c1t1d0s6  ONLINE       0     0     0
           c1t1d0s7  ONLINE       0     0     0

errors: Permanent errors have been detected in the following files: 

/monkey/a.txt
/monkey/bananas/b.txt
/monkey/sub/dir/d.txt
/monkey/ghost/e.txt
/monkey/ghost/boo/f.txt</screen>
<para>Powyższy wynik jest opisany w następujący sposób:</para>
<itemizedlist>
<listitem>
<para>Jeśli została odnaleziona pełna ścieżka do pliku i system plików ZFS jest zamontowany, pełna ścieżka do pliku zostanie wyświetlnoa. Na przykład:</para>
<screen>/monkey/a.txt</screen>
</listitem>
<listitem>
<para>Jeśli została odnaleziona pełna ścieżka do pliku, ale system plików ZFS jest niezamontowany, wtedy zostanie wyświetlona ścieżka do pliku w danym systemie plików ZFS bez poprzedzającego znaku slash (/). Na przykład:</para>
<screen>monkey/ghost:/e.txt</screen>
</listitem>
<listitem>
<para>Jeśli numer objektu nie może zostać zamieniony na ścieżkę do pliku, w wyniku błędu lub braku powiązania ścieżki z numerem objektu dla <literal>dnode_t</literal>, wtedy zostaje wyświetlnny numer objektu poprzedzony nazwą systemu plików ZFS. Na przykład: </para>
<screen>monkey/dnode:&lt;0x0&gt;</screen>
</listitem>
<listitem>
<para>Jeśli obiekt jest uszkodzony w danych meta-object (MOS), wtedy wyświetlony zostanie numer objektu poprzedzony specjalnym znacznikiem <literal>&lt;metadata&gt;</literal>.</para>
</listitem>
</itemizedlist>
<para>Jeśli uszkodzenie jest w bloku danych pliku, wtedy plik może być bezpiecznie usunięty, czyszcząc system z błędu. Pierwszy krok prowadzący do zlokalizowania pliku jest przy użyciu komendy <command>find</command> i numeru identyfikującego plik z wyniku komendy <command>zpool status</command> w części <literal>DATASET/OBJECT/RANGE</literal>. Na przykład:</para>
<screen># <userinput>find -inum 6</userinput>
</screen>
<para>Wtedy spróbuj usunąć plik przy pomocy komendy <command>rm</command>.
Jeśli ta komenda nie zadziała, oznacza to, że uszkodzenie jest w metadanych pliku i ZFS nie może określić które bloki danych należą do pliku w celu usunięcia uszkodzenia.</para>
<para>Jeśli uszkodzenie jest w katalogu lub metadanych pliku, jedyną możliwością jest przeniesienie go w inne miejsce. Możesz bezpiecznie przenieść jakikolwiek plik lub katalog w inne wygodne miejsce, pozwalając oryginalnemu objektowi na zwolnienie miejsca.</para>
</sect2>
<sect2 xml:id="gbctt">
<title>Naprawa szeroko uszkodzonej puli pamięci ZFS</title>
<para>Jeśli uszkodzenie wystąpiło w metadanych puli, uniemożliwia ono dostęp do niej. W takim przypadku pula wraz z danymi musi zostać odtworzona z kopii bezpieczeństwa. Użyty mechanizm znacząco różni się ze względu na konfiguracje puli oraz strategie kopii bezpieczeństwa. Najpierw, zachowaj konfiguracje puli uzyskaną przy użyciu komendy <command>zpool status</command>, umożliwi to jej odtworzenie, kiedy zostanie zniszczona. Później użyj komendy <command>zpool destroy</command> <option>f</option> w celu zniszenia puli. Również zachowaj w bezpiecznym miejscu plik opisujący rozmieszczenie danych i różnego rodzaju lokalne parametry, ponieważ te informacje staną się niedostępne, jeśli pula kiedykolwiek zostanie niedostępna. Posiadając konfiguracje puli oraz rozmieszczenie danych, możesz zrekonstruować kompletną konfiguracje po zniszczeniu puli. W takim przypadku dane mogą zostać ponownie zapisane w zależności od kopii zapasowej oraz użytej strategii.<indexterm xml:id="indexterm-576"><primary>Pule pamięci ZFS</primary><secondary>naprawa szeroko uszkodzonej puli</secondary><tertiary>opis</tertiary></indexterm><indexterm xml:id="indexterm-577"><primary>naprawa</primary><secondary>szeroko uszkodzona pula</secondary><tertiary>opis</tertiary></indexterm><indexterm xml:id="indexterm-578"><primary>usuwanie problemów</primary><secondary>naprawa szeroko uszkodzonej puli</secondary><tertiary>opis</tertiary></indexterm>
</para>
</sect2>
</sect1>
<sect1 xml:id="gbbwc">
<title>Naprawa nie ładującego sie systemu</title>
<para>ZFS jest zaprojektowany tak, aby był odporny i stabilny w przypadku napotkania błędów. Jednak różnego rodzaju nieprzewidziane błędy w oprogramowaniu lub inne patologie mogą doprowadzić do awarii systemu w trakcie operacji dostępu do puli. Jako część uruchamiania systemu, każda z pul musi zostać otwarta, co oznacza, że tego typu awaria zostanie zapętlona. Aby wyjść z tej sytuacji, ZFS musi zostać poinformowane, aby nie otwierać żadnej z pul podczas startu systemu. <indexterm xml:id="indexterm-579"><primary>Pule pamięci ZFS</primary><secondary>naprawa nie ładującego się systemu</secondary><tertiary>opis&gt;</tertiary></indexterm><indexterm xml:id="indexterm-580"><primary>naprawa</primary><secondary>nie ładujący się system</secondary><tertiary>opis</tertiary></indexterm><indexterm xml:id="indexterm-581"><primary>usuwanie problemów</primary><secondary>naprawa nie ładującego się systemu</secondary><tertiary>opis</tertiary></indexterm>
</para>
<para>ZFS zachowuje wewnętrzny bufor dostępnych puli i ich konfiguracji w pliku <filename>/etc/zfs/zpool.cache</filename> Lokalizacja pliku oraz jego zawartość są prywatne i mogą się zmienić. Jeśli system nie może zostać uruchomiony, uruchom system w trybie <literal>none</literal> używając opcji <option>milestone=none</option> podczas uruchamiania systemu. Kiedy system jest podniesiony, odmontuj system plików root i zamontuj ponownie jako system plików z możliwością zapisu i usuń plik <filename>/etc/zfs/zpool.cache</filename>. Te akcje spowodują, że ZFS zapomni o istniejących pulach w systemie, zapobiegając próbę dostępu do uszkodzonej puli powodującej problem. Można wtedy uruchomić system w normalnym stanie, używając komendy <command>svcadm milestone all</command>. Podobny proces może zostać użyty, w przypadku uruchomienia systemu z zastępczego systemu plików root w celu wykonania napraw.</para>
<para>Kiedy system jest podniesiony, można spróbować zaimportować pulę, używając komendy <command>zpool import</command>. Jednak to działanie najprawdopodobniej spowoduje wystąpienie tego samego błędu, który wystąpił podczas uruchamiania systemu, ponieważ komenda używa tego samego mechanizmu dostępu do puli. Jeśli w systemie jest więcej niż jedna pula i chcesz zaimportować konkretną, bez dostępu do innych puli, musisz zainicjować ponownie urządzenia w uszkodzonej puli, po czym można bezpiecznie zaimportować zdrową pule.</para>
</sect1>
</chapter>
