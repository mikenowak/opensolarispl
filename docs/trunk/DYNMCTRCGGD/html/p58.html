<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title><tt>uregs[]</tt> Array - Solaris Dynamic Tracing Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2005-09-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >Solaris Dynamic Tracing Guide<?GenHTML /ReferencePage> > <a href="p57.html">33.&nbsp;&nbsp;User Process Tracing</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p57.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p59.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="chp-user-uregs"></a><h3><tt>uregs[]</tt> Array</h3>
<p><a name="indexterm-464"></a>The <tt>uregs[]</tt> array enables you to access individual user registers. The following tables list indices into the <tt>uregs[]</tt> array corresponding to each supported Solaris system architecture.</p>
<a name="chp-user-tbl-uregs-sparc"></a>Table 33-1 SPARC <tt>uregs[]</tt> Constants<table><tr><th><p>Constant</p>
</th><th><p>Register</p>
</th></tr>
<tr><td><p><tt>R_G0..R_G7</tt></p>
</td><td><p><tt>%g0..%g7</tt> global registers</p>
</td></tr>
<tr><td><p><tt>R_O0..R_O7</tt></p>
</td><td><p><tt>%o0..%o7</tt> out registers</p>
</td></tr>
<tr><td><p><tt>R_L0..R_L7</tt></p>
</td><td><p><tt>%l0..%l7</tt> local registers</p>
</td></tr>
<tr><td><p><tt>R_I0..R_I7</tt></p>
</td><td><p><tt>%i0..%i7</tt> in registers</p>
</td></tr>
<tr><td><p><tt>R_CCR</tt></p>
</td><td><p><tt>%ccr</tt> condition code register</p>
</td></tr>
<tr><td><p><tt>R_PC</tt></p>
</td><td><p><tt>%pc</tt> program counter</p>
</td></tr>
<tr><td><p><tt>R_NPC</tt></p>
</td><td><p><tt>%npc</tt> next program counter</p>
</td></tr>
<tr><td><p><tt>R_Y</tt></p>
</td><td><p><tt>%y</tt> multiply/divide register</p>
</td></tr>
<tr><td><p><tt>R_ASI</tt></p>
</td><td><p><tt>%asi</tt> address space identifier register</p>
</td></tr>
<tr><td><p><tt>R_FPRS</tt></p>
</td><td><p><tt>%fprs</tt> floating-point registers state</p>
</td></tr>
</table><a name="chp-user-tbl-uregs-x86"></a>Table 33-2 x86 <tt>uregs[]</tt> Constants<table><tr><th><p>Constant</p>
</th><th><p>Register</p>
</th></tr>
<tr><td><p><tt>R_CS</tt></p>
</td><td><p><tt>%cs</tt></p>
</td></tr>
<tr><td><p><tt>R_GS</tt></p>
</td><td><p><tt>%gs</tt></p>
</td></tr>
<tr><td><p><tt>R_ES</tt></p>
</td><td><p><tt>%es</tt></p>
</td></tr>
<tr><td><p><tt>R_DS</tt></p>
</td><td><p><tt>%ds</tt></p>
</td></tr>
<tr><td><p><tt>R_EDI</tt></p>
</td><td><p><tt>%edi</tt></p>
</td></tr>
<tr><td><p><tt>R_ESI</tt></p>
</td><td><p><tt>%esi</tt></p>
</td></tr>
<tr><td><p><tt>R_EBP</tt></p>
</td><td><p><tt>%ebp</tt></p>
</td></tr>
<tr><td><p><tt>R_EAX</tt></p>
</td><td><p><tt>%eax</tt></p>
</td></tr>
<tr><td><p><tt>R_ESP</tt></p>
</td><td><p><tt>%esp</tt></p>
</td></tr>
<tr><td><p><tt>R_EAX</tt></p>
</td><td><p><tt>%eax</tt></p>
</td></tr>
<tr><td><p><tt>R_EBX</tt></p>
</td><td><p><tt>%ebx</tt></p>
</td></tr>
<tr><td><p><tt>R_ECX</tt></p>
</td><td><p><tt>%ecx</tt></p>
</td></tr>
<tr><td><p><tt>R_EDX</tt></p>
</td><td><p><tt>%edx</tt></p>
</td></tr>
<tr><td><p><tt>R_TRAPNO</tt></p>
</td><td><p><tt>%trapno</tt></p>
</td></tr>
<tr><td><p><tt>R_ERR</tt></p>
</td><td><p><tt>%err</tt></p>
</td></tr>
<tr><td><p><tt>R_EIP</tt></p>
</td><td><p><tt>%eip</tt></p>
</td></tr>
<tr><td><p><tt>R_CS</tt></p>
</td><td><p><tt>%cs</tt></p>
</td></tr>
<tr><td><p><tt>R_ERR</tt></p>
</td><td><p><tt>%err</tt></p>
</td></tr>
<tr><td><p><tt>R_EFL</tt></p>
</td><td><p><tt>%efl</tt></p>
</td></tr>
<tr><td><p><tt>R_UESP</tt></p>
</td><td><p><tt>%uesp</tt></p>
</td></tr>
<tr><td><p><tt>R_SS</tt></p>
</td><td><p><tt>%ss</tt></p>
</td></tr>
</table><p>On AMD64 platforms, the <tt>uregs</tt> array has the same content as it does on x86 platforms, plus the additional elements listed in the following table:</p>
<a name="gelsi"></a>Table 33-3 amd64 <tt>uregs[]</tt> Constants<table><tr><th><p>Constant</p>
</th><th><p>Register</p>
</th></tr>
<tr><td><p><tt>R_RSP</tt></p>
</td><td><p><tt>%rsp</tt></p>
</td></tr>
<tr><td><p><tt>R_RFL</tt></p>
</td><td><p><tt>%rfl</tt></p>
</td></tr>
<tr><td><p><tt>R_RIP</tt></p>
</td><td><p><tt>%rip</tt></p>
</td></tr>
<tr><td><p><tt>R_RAX</tt></p>
</td><td><p><tt>%rax</tt></p>
</td></tr>
<tr><td><p><tt>R_RCX</tt></p>
</td><td><p><tt>%rcx</tt></p>
</td></tr>
<tr><td><p><tt>R_RDX</tt></p>
</td><td><p><tt>%rdx</tt></p>
</td></tr>
<tr><td><p><tt>R_RBX</tt></p>
</td><td><p><tt>%rbx</tt></p>
</td></tr>
<tr><td><p><tt>R_RBP</tt></p>
</td><td><p><tt>%rbp</tt></p>
</td></tr>
<tr><td><p><tt>R_RSI</tt></p>
</td><td><p><tt>%rsi</tt></p>
</td></tr>
<tr><td><p><tt>R_RDI</tt></p>
</td><td><p><tt>%rdi</tt></p>
</td></tr>
<tr><td><p><tt>R_R8</tt></p>
</td><td><p><tt>%r8</tt></p>
</td></tr>
<tr><td><p><tt>R_R9</tt></p>
</td><td><p><tt>%r9</tt></p>
</td></tr>
<tr><td><p><tt>R_R10</tt></p>
</td><td><p><tt>%r10</tt></p>
</td></tr>
<tr><td><p><tt>R_R11</tt></p>
</td><td><p><tt>%r11</tt></p>
</td></tr>
<tr><td><p><tt>R_R12</tt></p>
</td><td><p><tt>%r12</tt></p>
</td></tr>
<tr><td><p><tt>R_R13</tt></p>
</td><td><p><tt>%r13</tt></p>
</td></tr>
<tr><td><p><tt>R_R14</tt></p>
</td><td><p><tt>%r14</tt></p>
</td></tr>
<tr><td><p><tt>R_R15</tt></p>
</td><td><p><tt>%r15</tt></p>
</td></tr>
</table><p>The aliases listed in the following table can be used on all platforms:</p>
<a name="chp-user-tbl-uregs-common"></a>Table 33-4 Common <tt>uregs[]</tt> Constants<table><tr><th><p>Constant</p>
</th><th><p>Register</p>
</th></tr>
<tr><td><p><tt>R_PC</tt></p>
</td><td><p>program counter register</p>
</td></tr>
<tr><td><p><tt>R_SP</tt></p>
</td><td><p>stack pointer register</p>
</td></tr>
<tr><td><p><tt>R_R0</tt></p>
</td><td><p>first return code</p>
</td></tr>
<tr><td><p><tt>R_R1</tt></p>
</td><td><p>second return code</p>
</td></tr>
</table><a name="chp-user-5"></a><h3><tt>pid</tt> Provider</h3>
<p><a name="indexterm-465"></a>The <tt>pid</tt> provider enables you to trace any instruction in a process. Unlike most other providers, <tt>pid</tt> probes are created on demand based on the probe descriptions found in your D programs. As a result, no <tt>pid</tt> probes are listed in the output of <tt>dtrace -l</tt> until you have enabled them yourself.</p>
<a name="chp-user-5.1"></a><h4>User Function Boundary Tracing</h4>
<p><a name="indexterm-466"></a>The simplest mode of operation for the <tt>pid</tt> provider is as the user space analogue to the <tt>fbt</tt> provider. The following example program traces all function entries and returns that are made from a single function. The <tt>$1</tt> macro variable (the first operand on the command line) is the process ID for the process to trace. The <tt>$2</tt> macro variable (the second operand on the command line) is the name of the function from which to trace all function calls.</p>
<a name="ex-userfunc.d"></a>Example 33-1 <tt>userfunc.d</tt>: Trace User Function Entry and Return<pre>pid$1::$2:entry
{
	self->trace = 1;
}

pid$1::$2:return
/self->trace/
{
	self->trace = 0;
}

pid$1:::entry,
pid$1:::return
/self->trace/
{
}</pre><p>Type in the above example script and save it in a file named <tt>userfunc.d</tt>, and then <tt>chmod</tt> it to be executable. This script produces output similar to the following example:</p>
<pre><tt><b># ./userfunc.d 15032 execute</b></tt>
dtrace: script './userfunc.d' matched 11594 probes
  0  -> execute                               
  0    -> execute                             
  0      -> Dfix                              
  0      &lt;- Dfix                              
  0      -> s_strsave                         
  0        -> malloc                          
  0        &lt;- malloc                          
  0      &lt;- s_strsave                         
  0      -> set                               
  0        -> malloc                          
  0        &lt;- malloc                          
  0      &lt;- set                               
  0      -> set1                              
  0        -> tglob                           
  0        &lt;- tglob                           
  0      &lt;- set1                              
  0      -> setq                              
  0        -> s_strcmp                        
  0        &lt;- s_strcmp                        
...</pre><p>The <tt>pid</tt> provider can only be used on processes that are already running. You can use the <tt>$target</tt> macro variable (see <a href="p33.html">Chapter&nbsp;15, Scripting</a>) and the <tt>dtrace</tt> <tt>-c</tt> and <tt>-p</tt> options to create and grab processes of interest and instrument them using DTrace. For example, the following D script can be used to determine the distribution of function calls made to <tt>libc</tt> by a particular subject process:</p>
<pre>pid$target:libc.so::entry
{
	@[probefunc] = count();
}</pre><p>To determine the distribution of such calls made by the <tt>date</tt>(1) command, save the script in a file named <tt>libc.d</tt> and execute the following command:</p>
<pre><tt><b># dtrace -s libc.d -c date</b></tt>
dtrace: script 'libc.d' matched 2476 probes
Fri Jul 30 14:08:54 PDT 2004
dtrace: pid 109196 has exited

  pthread_rwlock_unlock                                             1
  _fflush_u                                                         1
  rwlock_lock                                                       1
  rw_write_held                                                     1
  strftime                                                          1
  _close                                                            1
  _read                                                             1
  __open                                                            1
  _open                                                             1
  strstr                                                            1
  load_zoneinfo                                                     1

...
  _ti_bind_guard                                                   47
  _ti_bind_clear                                                   94</pre><a name="chp-user-5.2"></a><h4>Tracing Arbitrary Instructions</h4>
<p><a name="indexterm-467"></a><a name="indexterm-468"></a>You can use the <tt>pid</tt> provider to trace any instruction in any user function. Upon demand, the <tt>pid</tt> provider will create a probe for every instruction in a function. The name of each probe is the offset of its corresponding instruction in the function expressed as a hexadecimal integer. For example, to enable a probe associated with the instruction at offset 0x1c in function <tt>foo</tt> of module <tt>bar.so</tt> in the process with PID 123, you can use the following command:</p>
<pre><tt><b># dtrace -n pid123:bar.so:foo:1c</b></tt></pre><p>To enable all of the probes in the function <tt>foo</tt>, including the probe for each instruction, you can use the command:</p>
<pre><tt><b># dtrace -n pid123:bar.so:foo:</b></tt></pre><p>This command demonstrates an extremely powerful technique for debugging and analyzing user applications. Infrequent errors can be difficult to debug because they can be difficult to reproduce. Often, you can identify a problem after the failure has occurred, too late to reconstruct the code path. The following example demonstrates how to combine the <tt>pid</tt> provider with speculative tracing (see <a href="p30.html">Chapter&nbsp;13, Speculative Tracing</a>) to solve this problem by tracing every instruction in a function.</p>
<a name="ex-errorpath.d"></a>Example 33-2 <tt>errorpath.d</tt>: Trace User Function Call Error Path<pre>pid$1::$2:entry
{
	self->spec = speculation();
	speculate(self->spec);
	printf("%x %x %x %x %x", arg0, arg1, arg2, arg3, arg4);
}

pid$1::$2:
/self->spec/
{
	speculate(self->spec);
}

pid$1::$2:return
/self->spec &amp;&amp; arg1 == 0/
{
	discard(self->spec);
	self->spec = 0;
}

pid$1::$2:return
/self->spec &amp;&amp; arg1 != 0/
{
	commit(self->spec);
	self->spec = 0;
}</pre><p>Executing <tt>errorpath.d</tt> results in output similar to the following example:</p>
<pre><tt><b># ./errorpath.d 100461 _chdir</b></tt>
dtrace: script './errorpath.d' matched 19 probes
CPU     ID                    FUNCTION:NAME
  0  25253                     _chdir:entry 81e08 6d140 ffbfcb20 656c73 0
  0  25253                     _chdir:entry
  0  25269                         _chdir:0
  0  25270                         _chdir:4
  0  25271                         _chdir:8
  0  25272                         _chdir:c
  0  25273                        _chdir:10
  0  25274                        _chdir:14
  0  25275                        _chdir:18
  0  25276                        _chdir:1c
  0  25277                        _chdir:20
  0  25278                        _chdir:24
  0  25279                        _chdir:28
  0  25280                        _chdir:2c
  0  25268                    _chdir:return</pre>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p57.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p59.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

