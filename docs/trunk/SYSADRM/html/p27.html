<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Physical Memory Control Using the Resource
Capping Daemon (Overview) - System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-05-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Solaris Containers-Resource Management and Solaris Zones<?GenHTML /ReferencePage>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p26.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p28.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="rm.rcapd-1"></a>Chapter&nbsp;10<h3>Physical Memory Control Using the Resource
Capping Daemon (Overview)</h3><p>The resource capping daemon <tt>rcapd</tt> enables you to
regulate physical memory consumption by processes running in projects that
have resource caps defined. If you are running zones on your system, you can
use <tt>rcapd</tt> from the global zone to regulate physical memory
consumption in non-global zones. See <a href="p61.html">Chapter&nbsp;18, Planning and Configuring Non-Global Zones (Tasks)</a>.</p>
<p>The following topics are covered in this chapter.</p>
<ul><li><p><a href="p27.html#rm.rcapd-2">Introduction to the Resource Capping Daemon</a></p>
</li>
<li><p><a href="p27.html#rm.rcapd-3">How Resource Capping Works</a></p>
</li>
<li><p><a href="p27.html#rm.rcapd-4">Attribute to Limit Physical Memory Usage</a></p>
</li>
<li><p><a href="p27.html#rm.rcapd-19"><tt>rcapd</tt> Configuration</a></p>
</li>
<li><p><a href="p28.html#rm.rcapd-22">Monitoring Resource Utilization With <tt>rcapstat</tt></a></p>
</li>
<li><p><a href="p29.html">Commands Used With <tt>rcapd</tt></a></p>
</li>
</ul>
<p>For procedures using the <tt>rcapd</tt> feature, see <a href="p30.html">Chapter&nbsp;11, Administering the Resource Capping Daemon (Tasks)</a>.</p>
<a name="rm.rcapd-2"></a><h3>Introduction to the Resource Capping Daemon</h3>
<p><a name="indexterm-73"></a>A resource <b>cap</b> is an upper bound placed on the consumption of a resource,
such as physical memory. Per-project physical memory caps are supported.</p>
<p><a name="indexterm-74"></a><a name="indexterm-75"></a>The resource
capping daemon and its associated utilities provide mechanisms for physical
memory resource cap enforcement and administration.</p>
<p>Like the resource control, the resource cap can be defined by using
attributes of project entries in the <tt>project</tt> database.
However, while resource controls are synchronously enforced by the kernel,
resource caps are asynchronously enforced at the user level by the resource
capping daemon. With asynchronous enforcement, a small delay occurs as a result
of the sampling interval used by the daemon.</p>
<p>For information about <tt>rcapd</tt>, see the <tt>rcapd</tt>(1M) man page. For information
about projects and the <tt>project</tt> database, see <a href="p6.html">Chapter&nbsp;2, Projects and Tasks (Overview)</a> and
the <tt>project</tt>(4) man
page. For information about resource controls, see <a href="p16.html">Chapter&nbsp;6, Resource Controls (Overview)</a>.</p>
<a name="rm.rcapd-3"></a><h3>How Resource Capping Works</h3>
<p>The daemon repeatedly samples the resource utilization of projects that
have physical memory caps. The sampling interval used by the daemon is specified
by the administrator. See <a href="p28.html#rm.rcapd-23">Determining Sample Intervals</a> for additional information. When the system's physical memory
utilization exceeds the threshold for cap enforcement, and other conditions
are met, the daemon takes action to reduce the resource consumption of projects
with memory caps to levels at or below the caps.</p>
<p>The virtual memory system divides physical memory into segments known
as pages. Pages are the fundamental unit of physical memory in the Solaris
memory management subsystem. To read data from a file into memory, the virtual
memory system reads in one page at a time, or <b>pages in</b> a
file. To reduce resource consumption, the daemon can <b>page out</b>,
or relocate, infrequently used pages to a swap device, which is an area outside
of physical memory.</p>
<p>The daemon manages physical memory by regulating the size of a project
workload's resident set relative to the size of its working set. The resident
set is the set of pages that are resident in physical memory. The working
set is the set of pages that the workload actively uses during its processing
cycle. The working set changes over time, depending on the process's mode
of operation and the type of data being processed. Ideally, every workload
has access to enough physical memory to enable its working set to remain resident.
However, the working set can also include the use of secondary disk storage
to hold the memory that does not fit in physical memory.</p>
<p>Only one instance of <tt>rcapd</tt> can run at any given time.</p>
<a name="rm.rcapd-4"></a><h3>Attribute to Limit Physical Memory Usage</h3>
<p><a name="indexterm-76"></a>To define a physical memory resource cap for a project, establish
a resident set size (RSS) cap by adding this attribute to the <tt>project</tt> database
entry:</p>
<dl><dt><tt>rcap.max-rss</tt></dt>
<dd><p>The total amount of physical memory, in bytes, that is available
to processes in the project.</p>
</dd>
</dl>
<p>For example, the following line in the <tt>/etc/project</tt> file
sets an RSS cap of 10 gigabytes for a project named <tt>db</tt>.</p>
<pre>db:100::db,root::rcap.max-rss=10737418240</pre><hr>
<p><b>Note - </b>The system might round the specified cap value to a page size.</p>
<hr>
<p>You can also use the <tt>projmod</tt> command to set the <tt>rcap.max-rss</tt> attribute in the <tt>/etc/project</tt> file.</p>
<p>For more information, see Setting the Resident Set Size Cap.</p>
<a name="rm.rcapd-19"></a><h3><tt>rcapd</tt> Configuration</h3>
<p><a name="indexterm-77"></a><a name="indexterm-78"></a><a name="indexterm-79"></a>You use the <tt>rcapadm</tt> command to configure
the resource capping daemon. You can perform the following actions:</p>
<ul><li><p>Set the threshold value for cap enforcement</p>
</li>
<li><p>Set intervals for the operations performed by <tt>rcapd</tt></p>
</li>
<li><p>Enable or disable resource capping</p>
</li>
<li><p>Display the current status of the configured resource capping
daemon</p>
</li>
</ul>
<p>To configure the daemon, you must have superuser privileges or have
the Process Management profile in your list of profiles. The System Administrator
role includes the Process Management profile.</p>
<p>Configuration changes can be incorporated into <tt>rcapd</tt> according
to the configuration interval (see <a href="p28.html#rm.rcapd-21"><tt>rcapd</tt> Operation Intervals</a>) or on demand by sending a <tt>SIGHUP</tt> (see
the <tt>kill</tt>(1) man page).</p>
<p>If used without arguments, <tt>rcapadm</tt> displays the current
status of the resource capping daemon if it has been configured.</p>
<p>The following subsections discuss cap enforcement, cap values, and <tt>rcapd</tt> operation intervals.</p>
<a name="fpjwn"></a><h4>Using the Resource Capping Daemon on a System With
Zones Installed</h4>
<p>You can control resident set size (RSS) usage of a zone by setting the <tt>capped-memory</tt> resource when you configure the zone. For more information,
see <a href="p55.html#gejkz">Physical Memory Control and the <tt>capped-memory</tt> Resource</a>. You can run <tt>rcapd</tt> <b>in</b> a
zone, including the global zone, to enforce memory caps on projects in that
zone.</p>
<p>If you are using <tt>rcapd</tt> on a zone to regulate physical
memory consumption by processes running in projects that have resource caps
defined, you must configure the daemon in those zones.</p>
<p>When choosing memory caps for applications in different zones, you generally
do not have to consider that the applications reside in different zones. The
exception is per-zone services. Per-zone services consume memory. This memory
consumption must be considered when determining the amount of physical memory
for a system, as well as memory caps.</p>
<hr>
<p><b>Note - </b>You cannot run <tt>rcapd</tt> in an <tt>lx</tt> branded
zone. However, you can use the daemon from the global zone to cap memory in
the branded zone.</p>
<hr>
<a name="rm.rcapd-17"></a><h4>Memory Cap Enforcement Threshold</h4>
<p><a name="indexterm-80"></a>The <b>memory cap enforcement threshold</b> is the percentage of physical
memory utilization on the system that triggers cap enforcement. When the system
exceeds this utilization, caps are enforced. The physical memory used by applications
and the kernel is included in this percentage. The percentage of utilization
determines the way in which memory caps are enforced.</p>
<p>To enforce caps, memory can be paged out from project workloads.</p>
<ul><li><p>Memory can be paged out to reduce the size of the portion
of memory that is over its cap for a given workload.</p>
</li>
<li><p>Memory can be paged out to reduce the proportion of physical
memory used that is over the memory cap enforcement threshold on the system.</p>
</li>
</ul>
<p>A workload is permitted to use physical memory up to its cap. A workload
can use additional memory as long as the system's memory utilization stays
below the memory cap enforcement threshold.</p>
<p>To set the value for cap enforcement, see <a href="p30.html#rm.rcapd.task-3">How to Set the Memory Cap Enforcement Threshold</a>.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p26.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p28.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

