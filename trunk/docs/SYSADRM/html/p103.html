<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>About Restoring Non-Global Zones - System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-05-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Solaris Containers-Resource Management and Solaris Zones<?GenHTML /ReferencePage> > <a href="p95.html">26.&nbsp;&nbsp;Solaris Zones Administration (Overview)</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p102.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p104.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="gbrip"></a><h3>About Restoring Non-Global Zones</h3>
<p>In the case of a restore where the backups were done from the global
zone, the global administrator can reinstall the affected zones and then restore
that zone's files. Note that this assumes the following:</p>
<ul><li><p>The zone being restored has the same configuration as it did
when the backup was done.</p>
</li>
<li><p>The global zone has not been upgraded or patched between the
time when the backup was done and the time when the zone is restored.</p>
</li>
</ul>
<p>Otherwise, the restore could overwrite some files that should be merged
by hand.</p>
<p>For example, you might need to merge files by hand if a global zone
has been patched after the backup, but prior to the restore of the non-global
zone. In this case, you  would have to be careful when restoring a zone's
files that were backed up since a backed up file might not be compatible with
the newly installed zone that was built after the patches were applied to
the global zone. In this case, you would have to examine the files individually
and compare them to the copies in the newly installed zone. In most cases,
you will find that the file can be copied directly in, but in some cases,
you must merge the changes originally made to the file into the newly installed
or patched copy in the zone.</p>
<hr>
<p><b>Note - </b>If all file systems in the global zone are lost, restoring everything
in the global zone restores the non-global zones as well, as long as the respective
root file systems of the non-global zones were included in the backup.</p>
<hr>
<a name="z.admin.ov-32"></a><h3>Commands Used on a Solaris System With Zones
Installed</h3>
<p><a name="indexterm-325"></a><a name="indexterm-326"></a><a name="indexterm-327"></a>The commands
identified in <a href="p103.html#z.admin.ov-tbl-33">Table 26-3</a> provide
the primary administrative interface to the zones facility.</p>
<a name="z.admin.ov-tbl-33"></a>Table 26-3 Commands Used to Administer
Zones<table><tr><th><p>Command Reference</p>
</th><th><p>Description</p>
</th></tr>
<tr><td><p><tt>zlogin</tt>(1)</p>
</td><td><p>Log in to a non-global zone</p>
</td></tr>
<tr><td><p><tt>zonename</tt>(1)</p>
</td><td><p>Prints the name of the current zone</p>
</td></tr>
<tr><td><p><tt>zoneadm</tt>(1M)</p>
</td><td><p>Administers zones on a system</p>
</td></tr>
<tr><td><p><tt>zonecfg</tt>(1M)</p>
</td><td><p>Used to set up a zone configuration</p>
</td></tr>
<tr><td><p><tt>getzoneid</tt>(3C)</p>
</td><td><p>Used to map between zone ID and name</p>
</td></tr>
<tr><td><p><tt>zones</tt>(5)</p>
</td><td><p>Provides description of zones facility</p>
</td></tr>
<tr><td><p><tt>zcons</tt>(7D)</p>
</td><td><p>Zone console device driver</p>
</td></tr>
</table><p>The <tt>zoneadmd</tt> daemon is the primary process for managing
the zone's virtual platform. The man page for the <tt>zoneadmd</tt> daemon
is <tt>zoneadmd</tt>(1M). The daemon does not constitute a programming interface.</p>
<p>The commands in the next table are used with the resource capping daemon.</p>
<a name="gekhm"></a>Table 26-4 Commands Used With <tt>rcapd</tt><table><tr><th><p>Command Reference</p>
</th><th><p>Description</p>
</th></tr>
<tr><td><p><tt>rcapstat</tt>(1)</p>
</td><td><p>Monitors the resource utilization of capped projects.</p>
</td></tr>
<tr><td><p><tt>rcapadm</tt>(1M)</p>
</td><td><p>Configures the resource capping daemon, displays the current status
of the resource capping daemon if it has been configured, and enables or disables
resource capping</p>
</td></tr>
<tr><td><p><tt>rcapd</tt>(1M)</p>
</td><td><p>The resource capping daemon.</p>
</td></tr>
</table><p>The commands identified in the following table have been modified for
use on a Solaris system with zones installed. These commands have options
that are specific to zones or present information differently. The commands
are listed by man page section.</p>
<a name="z.admin.ov-tbl-34"></a>Table 26-5 Commands Modified for Use
on a Solaris System With Zones Installed<table><tr><th><p>Command Reference</p>
</th><th><p>Description</p>
</th></tr>
<tr><td><p><tt>ipcrm</tt>(1)</p>
</td><td><p>Added <tt>-z</tt> <i>zone</i> option. This
option is only useful when the command is executed in the global zone.</p>
</td></tr>
<tr><td><p><tt>ipcs</tt>(1)</p>
</td><td><p>Added <tt>-z</tt> <i>zone</i> option. This
option is only useful when the command is executed in the global zone.</p>
</td></tr>
<tr><td><p><tt>pgrep</tt>(1)</p>
</td><td><p>Added <tt>-z</tt> <i>zoneidlist</i> option.
This option is only useful when the command is executed in the global zone.</p>
</td></tr>
<tr><td><p><tt>ppriv</tt>(1)</p>
</td><td><p>Added the expression <tt>zone</tt> for use with the <tt>-l</tt> option
to list all privileges available in the current zone. Also use the option <tt>-v</tt> after <tt>zone</tt> to obtain verbose output.</p>
</td></tr>
<tr><td><p><tt>priocntl</tt>(1)</p>
</td><td><p>Zone ID can be used in <i>idlist</i> and <tt>-i</tt> <i>idtype</i> to specify processes. You can use the <tt>priocntl</tt> <tt>-i</tt> <i>zoneid</i> command to move running processes
into a different scheduling class in a non-global zone.</p>
</td></tr>
<tr><td><p><tt>proc</tt>(1)</p>
</td><td><p>Added <tt>-z</tt> <i>zone</i> option to <tt>ptree</tt> only. This option is only useful when the command is executed
in the global zone.</p>
</td></tr>
<tr><td><p><tt>ps</tt>(1)</p>
</td><td><p>Added <i>zonename</i> and <i>zoneid</i> to
list of recognized <tt>format</tt> names used with the <tt>-o</tt> option.</p>
<p>Added <tt>-z</tt> <i>zonelist</i> to list
only processes in the specified zones. Zones can be specified either by zone
name or by zone ID. This option is only useful when the command is executed
in the global zone.</p>
<p>Added <tt>-Z</tt> to print the name of the zone associated with
the process. The name is printed under an additional column header, <tt>ZONE</tt>.</p>
</td></tr>
<tr><td><p><tt>renice</tt>(1)</p>
</td><td><p>Added <i>zoneid</i> to list of valid arguments used
with the <tt>-i</tt> option.</p>
</td></tr>
<tr><td><p><tt>sar</tt>(1)</p>
</td><td><p>If executed in a non-global zone in which the pools facility is enabled,
the <tt>-b</tt>, <tt>-c</tt> <tt>-g</tt>, <tt>-m</tt>, <tt>-p</tt>, <tt>-u</tt>, <tt>-w</tt>, and <tt>-y</tt> options
display values only for processors that are in the processor set of the pool
to which the zone is bound.</p>
</td></tr>
<tr><td><p><tt>auditconfig</tt>(1M)</p>
</td><td><p>Added <tt>zonename</tt> token.</p>
</td></tr>
<tr><td><p><tt>auditreduce</tt>(1M)</p>
</td><td><p>Added <tt>-z</tt> <i>zone-name</i> option.
Added ability to get an audit log of a zone.</p>
</td></tr>
<tr><td><p><tt>coreadm</tt>(1M)</p>
</td><td><p>Added variable <tt>%z</tt> to identify the zone in which process
executed.</p>
</td></tr>
<tr><td><p><tt>df</tt>(1M)</p>
</td><td><p>Added <tt>-Z</tt> option to display mounts in all visible zones.
This option has no effect in a non-global zone.</p>
</td></tr>
<tr><td><p><tt>ifconfig</tt>(1M)</p>
</td><td><p>Added <tt>zone</tt> option for global zone use (the default),
and <tt>-zone</tt> <i>zonename</i> for non-global
zone use.</p>
</td></tr>
<tr><td><p><tt>iostat</tt>(1M)</p>
</td><td><p>If executed in a non-global zone in which the pools facility is enabled,
information is provided only for those processors that are in the processor
set of the pool to which the zone is bound.</p>
</td></tr>
<tr><td><p><tt>kstat</tt>(1M)</p>
</td><td><p>If executed in the global zone, <tt>kstat</tt>s are displayed
for all zones. If executed in a non-global zone, only <tt>kstat</tt>s
with a matching <i>zoneid</i> are displayed.</p>
</td></tr>
<tr><td><p><tt>mpstat</tt>(1M)</p>
</td><td><p>If executed in a non-global zone in which the pools facility is enabled,
command only displays lines for the processors that are in the processor set
of the pool to which the zone is bound.</p>
</td></tr>
<tr><td><p><tt>ndd</tt>(1M)</p>
</td><td><p>When used in the global zone, displays information for all zones. <tt>ndd</tt> on the TCP/IP modules in an exclusive-IP zone only displays
information for that zone.</p>
</td></tr>
<tr><td><p><tt>netstat</tt>(1M)</p>
</td><td><p>Displays information for the current zone only.</p>
</td></tr>
<tr><td><p><tt>nfsstat</tt>(1M)</p>
</td><td><p>Displays statistics for the current zone only.</p>
</td></tr>
<tr><td><p><tt>poolbind</tt>(1M)</p>
</td><td><p>Added <i>zoneid</i> list. Also see <a href="p33.html#rmpool-114">Resource Pools Used in Zones</a> for information
about using zones with resource pools.</p>
</td></tr>
<tr><td><p><tt>prstat</tt>(1M)</p>
</td><td><p>Added <tt>-z</tt> <i>zoneidlist</i> option.
Also added <tt>-Z</tt> option.</p>
<p> If executed in a non-global zone in which the pools facility is enabled,
the percentage of recent CPU time used by the process is displayed only for
the processors in the processor set of the pool to which the zone is bound.</p>
<p>Output of the <tt>-a</tt>, <tt>-t</tt>, <tt>-T</tt>, <tt>-J</tt>, and <tt>-Z</tt> options displays a SWAP instead of a SIZE
column. The swap reported is the total swap consumed by the zone's processes
and <tt>tmpfs</tt> mounts. This value assists in monitoring the
swap reserved by each zone, which can be used to choose a reasonable <tt>zone.max-swap</tt> setting.</p>
</td></tr>
<tr><td><p><tt>psrinfo</tt>(1M)</p>
</td><td><p>If executed in a non-global zone, only information about the processors
visible to the zone is displayed.</p>
</td></tr>
<tr><td><p><tt>traceroute</tt>(1M)</p>
</td><td><p>Usage change. When specified from within a non-global zone, the <tt>-F</tt> option
has no effect because the &ldquo;don't fragment&rdquo; bit is always set.</p>
</td></tr>
<tr><td><p><tt>vmstat</tt>(1M)</p>
</td><td><p>When executed in a non-global zone in which the pools facility is enabled,
statistics are reported only for the processors in the processor set of the
pool to which the zone is bound. Applies to output from the <tt>-p</tt> option
and the <tt>page</tt>, <tt>faults</tt>, and <tt>cpu</tt> report
fields.</p>
</td></tr>
<tr><td><p><tt>auditon</tt>(2)</p>
</td><td><p>Added <tt>AUDIT_ZONENAME</tt> to generate a zone ID token
with each audit record.</p>
</td></tr>
<tr><td><p><tt>priocntl</tt>(2)</p>
</td><td><p>Added <tt>P_ZONEID</tt> <i>id</i> argument.</p>
</td></tr>
<tr><td><p><tt>processor_info</tt>(2)</p>
</td><td><p>If the caller is in a non-global zone and the pools facility is enabled,
but the processor is not in the processor set of the pool to which the zone
is bound, an error is returned.</p>
</td></tr>
<tr><td><p><tt>p_online</tt>(2)</p>
</td><td><p>If the caller is in a non-global zone and the pools facility is enabled,
but the processor is not in the processor set of the pool to which the zone
is bound, an error is returned.</p>
</td></tr>
<tr><td><p><tt>pset_bind</tt>(2)</p>
</td><td><p>Added <tt>P_ZONEID</tt> as <i>idtype</i>.
Added zone to possible choices for <tt>P_MYID</tt> specification.
Added <tt>P_ZONEID</tt> to valid <i>idtype</i> list
in <tt>EINVAL</tt> error description.</p>
</td></tr>
<tr><td><p><tt>pset_info</tt>(2)</p>
</td><td><p>If the caller is in a non-global zone and the pools facility is enabled,
but the processor is not in the processor set of the pool to which the zone
is bound, an error is returned.</p>
</td></tr>
<tr><td><p><tt>pset_list</tt>(2)</p>
</td><td><p>If the caller is in a non-global zone and the pools facility is enabled,
but the processor is not in the processor set of the pool to which the zone
is bound, an error is returned.</p>
</td></tr>
<tr><td><p><tt>pset_setattr</tt>(2)</p>
</td><td><p>If the caller is in a non-global zone and the pools facility is enabled,
but the processor is not in the processor set of the pool to which the zone
is bound, an error is returned.</p>
</td></tr>
<tr><td><p><tt>sysinfo</tt>(2)</p>
</td><td><p>Changed <tt>PRIV_SYS_CONFIG</tt> to <tt>PRIV_SYS_ADMIN</tt>.</p>
</td></tr>
<tr><td><p><tt>umount</tt>(2)</p>
</td><td><p><tt>ENOENT</tt> is returned if file pointed to by <i>file</i> is not an absolute path.</p>
</td></tr>
<tr><td><p><tt>getloadavg</tt>(3C)</p>
</td><td><p>If the caller is in a non-global zone and the pools facility is enabled,
the behavior is equivalent to calling with a <tt>psetid</tt> of <tt>PS_MYID</tt>.</p>
</td></tr>
<tr><td><p><tt>getpriority</tt>(3C)</p>
</td><td><p>Added zone IDs to target processes that can be specified. Added zone
ID to <tt>EINVAL</tt> error description.</p>
</td></tr>
<tr><td><p><tt>priv_str_to_set</tt>(3C)</p>
</td><td><p>Added &ldquo;zone&rdquo; string for the set of all privileges available
within the caller's zone.</p>
</td></tr>
<tr><td><p><tt>pset_getloadavg</tt>(3C)</p>
</td><td><p>If the caller is in a non-global zone and the pools facility is enabled,
but the processor is not in the processor set of the pool to which the zone
is bound, an error is returned.</p>
</td></tr>
<tr><td><p><tt>sysconf</tt>(3C)</p>
</td><td><p>If the caller is in a non-global zone and the pools facility enabled, <tt>sysconf(_SC_NPROCESSORS_CONF)</tt> and <tt>sysconf(_SC_NPROCESSORS_ONLN)</tt> return the number of total and online processors in the processor
set of the pool to which the zone is bound.</p>
</td></tr>
<tr><td><p><tt>ucred_get</tt>(3C)</p>
</td><td><p>Added <tt>ucred_getzoneid()</tt> function, which returns the
zone ID of the process or <tt>-1</tt> if the zone ID is not available.</p>
</td></tr>
<tr><td><p><tt>core</tt>(4)</p>
</td><td><p>Added <tt>n_type: NT_ZONENAME</tt>. This entry contains a
string that describes the name of the zone in which the process was running.</p>
</td></tr>
<tr><td><p><tt>pkginfo</tt>(4)</p>
</td><td><p>Now provides optional parameters and an environment variable in support
of zones.</p>
</td></tr>
<tr><td><p><tt>proc</tt>(4)</p>
</td><td><p>Added capability to obtain information on processes running in zones.</p>
</td></tr>
<tr><td><p><tt>audit_syslog</tt>(5)</p>
</td><td><p>Added <tt>in&lt;</tt><i>zone name</i><tt>></tt> field that is used if the <tt>zonename</tt> audit policy
is set.</p>
</td></tr>
<tr><td><p><tt>privileges</tt>(5)</p>
</td><td><p>Added <tt>PRIV_PROC_ZONE</tt>, which allows a process to trace
or send signals to processes in other zones. See zones(5). </p>
</td></tr>
<tr><td><p><tt>if_tcp</tt>(7P)</p>
</td><td><p>Added zone <tt>ioctl()</tt> calls.</p>
</td></tr>
<tr><td><p><tt>cmn_err</tt>(9F)</p>
</td><td><p>Added zone parameter.</p>
</td></tr>
<tr><td><p><tt>ddi_cred</tt>(9F)</p>
</td><td><p>Added <tt>crgetzoneid()</tt>, which returns the zone ID from
the user credential pointed to by <tt>cr</tt>.</p>
</td></tr>
</table>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p102.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p104.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

