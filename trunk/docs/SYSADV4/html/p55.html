<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Maps That Refer to Other Maps - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Network Services<?GenHTML /ReferencePage> > <a href="p31.html">6.&nbsp;&nbsp;Accessing Network File Systems (Reference)</a> > <a href="p53.html#rfsrefer-75">How Autofs Works</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p54.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p56.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="rfsrefer-92"></a><h4>Maps That Refer to Other Maps</h4>
<p><a name="indexterm-903"></a><a name="indexterm-904"></a><a name="indexterm-905"></a><a name="indexterm-906"></a><a name="indexterm-907"></a><a name="indexterm-908"></a>A map entry +<i>mapname</i> that is used in
a file map causes automount to read the specified map as if it were included
in the current file. If <i>mapname</i> is not preceded
by a slash, autofs treats the map name as a string of characters and uses
the name-service switch policy to find the map name. If the path name is an
absolute path name, <tt>automount</tt> checks a local map of that
name. If the map name starts with a dash (<tt>-</tt>), <tt>automount</tt> consults the appropriate built-in map, such as <tt>hosts</tt>. </p>
<p>This name-service switch file contains an entry for autofs that is labeled
as <tt>automount</tt>, which contains the order in which the name
services are searched. The following file is an example of a name-service
switch file.</p>
<pre>#
# /etc/nsswitch.nis:
#
# An example file that could be copied over to /etc/nsswitch.conf;
# it uses NIS (YP) in conjunction with files.
#
# "hosts:" and "services:" in this file are used only if the /etc/netconfig
# file contains "switch.so" as a nametoaddr library for "inet" transports.
# the following two lines obviate the "+" entry in /etc/passwd and /etc/group.
passwd:         files nis
group:          files nis

# consult /etc "files" only if nis is down.
hosts:          nis [NOTFOUND=return] files
networks:       nis [NOTFOUND=return] files
protocols:      nis [NOTFOUND=return] files
rpc:            nis [NOTFOUND=return] files
ethers:         nis [NOTFOUND=return] files
netmasks:       nis [NOTFOUND=return] files
bootparams:     nis [NOTFOUND=return] files
publickey:      nis [NOTFOUND=return] files
netgroup:       nis
automount:      files nis
aliases:        files nis
# for efficient getservbyname() avoid nis
services:       files nis </pre><p>In this example, the local maps are searched before the NIS maps. Therefore,
 you can have a few entries in your local <tt>/etc/auto_home</tt> map
for the most commonly accessed home directories. You can then use the switch
to fall back to the NIS map for other entries. </p>
<pre>bill               cs.csc.edu:/export/home/bill
bonny              cs.csc.edu:/export/home/bonny</pre><p>After consulting the included map, if no match is found, <tt>automount</tt> continues scanning the current map. Therefore, you can add more
entries after a <tt>+</tt> entry. </p>
<pre>bill               cs.csc.edu:/export/home/bill
bonny              cs.csc.edu:/export/home/bonny
+auto_home </pre><p>The map that is included can be a local file or a built-in map. Remember,
only local files can contain <tt>+</tt> entries. </p>
<pre>+auto_home_finance      # NIS+ map
+auto_home_sales        # NIS+ map
+auto_home_engineering  # NIS+ map
+/etc/auto_mystuff      # local map
+auto_home              # NIS+ map
+-hosts                 # built-in hosts map </pre><hr>
<p><b>Note - </b><a name="indexterm-909"></a><a name="indexterm-910"></a><a name="indexterm-911"></a><a name="indexterm-912"></a>You cannot use <tt>+</tt> entries in NIS+ or NIS maps.
   </p>
<hr>
<a name="rfsrefer-93"></a><h4>Executable Autofs Maps</h4>
<p><a name="indexterm-913"></a><a name="indexterm-914"></a>You can create an autofs map that executes some commands to generate
the autofs mount points. You could benefit from using an executable autofs
map if you need to be able to create the autofs structure from a database
or a flat file. The disadvantage to using an executable map is that the map
needs to be installed on each host. An executable map cannot be included in
either the NIS or the NIS+ name service.</p>
<p>The executable map must have an entry in the <tt>auto_master</tt> file.</p>
<pre>/execute    auto_execute</pre><p>Here is an example of an executable map:</p>
<pre>#!/bin/ksh
#
# executable map for autofs
#

case $1 in
	         src)  echo '-nosuid,hard bee:/export1' ;;
esac</pre><p>For this example to work, the file must be installed as <tt>/etc/auto_execute</tt> and must have the executable bit set. Set permissions to <tt>744</tt>.
Under these circumstances, running the following command causes the <tt>/export1</tt> file system from <tt>bee</tt> to be mounted:</p>
<pre>% ls /execute/src</pre><a name="rfsrefer-94"></a><h4>Modifying How Autofs Navigates the Network
(Modifying Maps)</h4>
<p>You can modify, delete, or add entries to maps to meet the needs of
your environment. As applications and other file systems that users require
change their location, the maps must reflect those changes. You can modify
autofs maps at any time. Whether your modifications are effective the next
time <tt>automountd</tt> mounts a file system depends on which map
you modify and what kind of modification you make. </p>
<a name="rfsrefer-95"></a><h4>Default Autofs Behavior With Name Services</h4>
<p>At boot time autofs is invoked by the service <tt>svc:/system/filesystem/autofs</tt> and autofs checks for the master <tt>auto_master</tt> map.
Autofs is subject to the rules that are discussed subsequently. </p>
<p>Autofs uses the name service that is specified in the automount entry
of the <tt>/etc/nsswitch.conf</tt> file. If NIS+ is specified,
as opposed to local files or NIS, all map names are used as is. If NIS is
selected and autofs cannot find a map that autofs needs, but finds a map name
that contains one or more underscores, the underscores are changed to dots.
This change allows the old NIS file names to work. Then autofs checks the
map again, as shown in <a href="p55.html#rfsrefer-fig-96">Figure 6-6</a>. </p>
<a name="rfsrefer-fig-96"></a>Figure 6-6 How Autofs Uses the Name Service<img src="figures/5365.gif" alt=""></img><p>The screen activity for this session would resemble the following example. </p>
<pre>$ <tt><b>grep /home /etc/auto_master</b></tt>
/home           auto_home

$ <tt><b>ypmatch brent auto_home</b></tt>
Can't match key brent in map auto_home.  Reason: no such map in
server's domain.

$ <tt><b>ypmatch brent auto.home</b></tt>
diskus:/export/home/diskus1/&amp;</pre><p>If &ldquo;files&rdquo; is selected as the name service, all maps are
assumed to be local files in the <tt>/etc</tt> directory. Autofs
interprets a map name that begins with a slash (<tt>/</tt>) as local
regardless of which name service autofs uses.     </p>
<a name="rfsrefer-98"></a><h3>Autofs Reference</h3>
<p><a name="indexterm-915"></a>The remaining sections of this chapter describe more advanced
autofs features and topics. </p>
<a name="rfsrefer-99"></a><h4>Autofs and Metacharacters</h4>
<p><a name="indexterm-916"></a>Autofs recognizes some characters as having a special meaning.
Some characters are used for substitutions, and some characters are used to
protect other characters from the autofs map parser. </p>
<a name="rfsrefer-151"></a><h5>Ampersand (<tt>&amp;</tt>)</h5>
<p><a name="indexterm-917"></a><a name="indexterm-918"></a>If you have a map with many subdirectories specified, as in the
following, consider using string substitutions.  </p>
<pre>john        willow:/home/john
mary        willow:/home/mary
joe         willow:/home/joe
able        pine:/export/able
baker       peach:/export/baker</pre><p>You can use the ampersand character (<tt>&amp;</tt>) to substitute
the key wherever the key appears. If you use the ampersand, the previous map
changes to the following: </p>
<pre>john        willow:/home/&amp;
mary        willow:/home/&amp;
joe         willow:/home/&amp;
able        pine:/export/&amp;
baker       peach:/export/&amp;</pre><p>You could also use key substitutions in a direct map, in situations
such as the following: </p>
<pre>/usr/man						willow,cedar,poplar:/usr/man</pre><p>You can also simplify the entry further as follows:</p>
<pre>/usr/man						willow,cedar,poplar:&amp;</pre><p>Notice that the ampersand substitution uses the whole key string. Therefore,
if the key in a direct map starts with a <tt>/</tt> (as it should),
the slash is included in the substitution. Consequently, for example, you
could not do the following: </p>
<pre>/progs				&amp;1,&amp;2,&amp;3:/export/src/progs </pre><p><a name="indexterm-919"></a>The reason is that autofs would interpret the example as the following: </p>
<pre>/progs 				/progs1,/progs2,/progs3:/export/src/progs</pre><a name="rfsrefer-150"></a><h5>Asterisk (<tt>*</tt>)</h5>
<p><a name="indexterm-920"></a><a name="indexterm-921"></a>You can use the universal substitute character, the asterisk (<tt>*</tt>), to match any key. You could mount the <tt>/export</tt> file
system from all hosts through this map entry.  </p>
<pre>*						&amp;:/export</pre><p>Each ampersand is substituted by the value of any given key. Autofs
interprets the asterisk as an end-of-file character.</p>
<a name="rfsrefer-100"></a><h4>Autofs and Special Characters</h4>
<p><a name="indexterm-922"></a><a name="indexterm-923"></a><a name="indexterm-924"></a><a name="indexterm-925"></a>If you have a map entry that contains special characters, you
might have to mount directories that have names that confuse the autofs map
parser. The autofs parser is sensitive to names that contain colons, commas,
and spaces, for example. These names should be enclosed in double-quotes,
as in the following: </p>
<pre>/vms    -ro    vmsserver: -  -  - "rc0:dk1 - "
/mac    -ro    gator:/ - "Mr Disk - "</pre><a name="slptm"></a>Part&nbsp;IIISLP Topics<p>The section provides overview, planning, task and reference information
for the Service Location Protocol (SLP) service.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p54.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p56.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

