<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p41.html#ipv6-admintasks-1">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p45.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p47.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipv6-admintasks-670"></A><h2>Monitoring Packet Transfers With the <tt>snoop</tt> Command</h2>
<p><A NAME="indexterm-885"></A><A NAME="indexterm-886"></A><A NAME="indexterm-887"></A><A NAME="indexterm-888"></A><A NAME="indexterm-889"></A>You can use the <tt>snoop</tt> command to monitor the
state of data transfers. <tt>snoop</tt> captures network packets
and displays their contents in the format that you specify. Packets can be
displayed as soon as they are received, or saved to a file.  When <tt>snoop</tt> writes
to an intermediate file, packet loss under busy trace conditions is unlikely.
 <tt>snoop</tt> itself is then used to interpret the file. </p>
<p>To capture packets to and from the default interface in promiscuous
mode, you must assume the Network Management role or become superuser. In
summary form, <tt>snoop</tt> displays only the data that pertains
to the highest-level protocol. For example, an NFS packet only displays NFS
information. The underlying RPC, UDP, IP, and Ethernet frame information is
suppressed but can be displayed if either of the verbose options is chosen.</p>
<p>Use <tt>snoop</tt> frequently and consistently to become familiar
with normal system behavior. For assistance in analyzing packets, look for
a recent white paper and RFC, and seek the advice of an expert in a particular
area, such as NFS or NIS. For details on using <tt>snoop</tt> and
its options, refer to the <tt>snoop</tt>(1M) man
page. <A NAME="indexterm-890"></A><A NAME="indexterm-891"></A><A NAME="indexterm-892"></A></p>
<A NAME="ipv6-admintasks-67"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Check Packets From All Interfaces</h3>
<A NAME="indexterm-893"></A><ol><li><p><b>On the local host, assume the Network Management role or become
superuser.</b></p><p>Roles contain authorizations and privileged commands.
For more information about roles, see "Configuring RBAC (Task Map)" in <i>System Administration Guide: Security Services</i>.</p>
</li>
<li><p><b>Print information about the interfaces that are attached to the
system. </b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig -a</b></tt></pre>
</td></table><br><p>The <tt>snoop</tt> command normally uses the first non-loopback
device, typically the primary network interface.</p>
</li>
<li><p><b>Begin packet capture by typing <tt>snoop</tt> without
arguments, as shown in <A HREF="p46.html#eojbm">Example 8-19</A></b></p></li>
<A NAME="ipv6-admintasks-step-70"></A><li><p><b>Use Control-C to halt the process.</b></p></li>
</ol><A NAME="eojbm"></A><h5>Example 8-19 &nbsp;&nbsp;Output From the snoop Command</h5>
<p>The basic <tt>snoop</tt> command returns output that resembles
the following, for a dual-stack host.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>% <tt><b>snoop</b></tt>
Using device /dev/hme (promiscuous mode)
farhost.remote.com -> myhost       RLOGIN C port=993 
    myhost -> farhost.remote.com   RLOGIN R port=993 Using device /dev/hme
router5.local.com -> router5.local.com ARP R 10.0.0.13, router5.local.com is
    0:10:7b:31:37:80
router5.local.com -> BROADCAST     TFTP Read "network-confg" (octet)
myhost -> DNSserver.local.com      DNS C 192.168.10.10.in-addr.arpa. Internet PTR ?
DNSserver.local.com  myhost        DNS R 192.168.10.10.in-addr.arpa. Internet PTR niserve2.
.
.
farhost.remote.com-> myhost        RLOGIN C port=993 
    myhost -> farhost.remote.com   RLOGIN R port=993 fe80::a00:20ff:febb:
.
fe80::a00:20ff:febb:e09 -> ff02::9 RIPng R (5 destinations)</pre>
</td></table><br><p>The packets that are captured in this output show a remote login section,
including lookups to the NIS and DNS servers for address resolution. Also
included are periodic ARP packets from the local router and advertisements
of the IPv6 link-local address to <tt>in.ripngd</tt>.</p>
<A NAME="ipv6-admintasks-674"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Capture <tt>snoop</tt> Output
Into a File</h3>
<ol><li><p><b>On the local host, assume the Network Management role or become
superuser.</b></p><p>Roles contain authorizations and privileged commands.
For more information about roles, see "Configuring RBAC (Task Map)" in <i>System Administration Guide: Security Services</i>.</p>
</li>
<li><p><b>Capture a <tt>snoop</tt> session into a file.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>snoop -o</b></tt> <i>filename</i></pre>
</td></table><br><p>For example:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>snoop /tmp/cap</b></tt>
Using device /dev/eri (promiscuous mode)
30 snoop: 30 packets captured</pre>
</td></table><br><p>In the example, 30 packets have been captured in a file named <tt>/tmp/cap</tt>. The file can be in any directory with enough disk space. The
number of packets that are captured is displayed on the command line, enabling
you to press Control-C to abort at any time.</p>
<p><tt>snoop</tt> creates
a noticeable networking load on the host machine, which can distort the results.
To see the actual results, run <tt>snoop</tt> from a third system.</p>
</li>
<li><p><b>Inspect the <tt>snoop</tt> output captures file.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>snoop -i</b></tt> <i>filename</i></pre>
</td></table><br></li>
</ol><A NAME="eojbn"></A><h5>Example 8-20 &nbsp;&nbsp;Contents of a <tt>snoop</tt> Output Captures File</h5>
<p>The following output shows a variety of captures such as you might receive
as output from the <tt>snoop -i</tt> command.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>snoop -i /tmp/cap</b></tt>
1   0.00000 fe80::a00:20ff:fee9:2d27 -> fe80::a00:20ff:fecd:4375 
    ICMPv6 Neighbor advertisement
2   0.16198 farhost.com   -> myhost     RLOGIN C port=985 
3   0.00008 myhost -> farhost.com       RLOGIN R port=985 
10  0.91493    10.0.0.40 -> (broadcast)  ARP C Who is 10.0.0.40, 10.0.0.40 ?
34  0.43690 nearserver.here.com  -> 224.0.1.1  IP  D=224.0.1.1 S=10.0.0.40 LEN=28, 
      ID=47453, TO =0x0, TTL=1
35  0.00034  10.0.0.40 -> 224.0.1.1    IP  D=224.0.1.1 S=10.0.0.40 LEN=28, ID=57376, 
     TOS=0x0, TTL=47  </pre>
</td></table><br><A NAME="ipv6-admintasks-676"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Check Packets Between an IPv4
Server and a Client</h3>
<A NAME="indexterm-894"></A><ol><li><p><b>Establish a <tt>snoop</tt> system off a hub that is
connected to either the client or the server. </b></p><p>The third system
(the <tt>snoop</tt> system) checks all the intervening traffic,
so the <tt>snoop</tt> trace reflects what is actually happening
on the wire.</p>
</li>
<li><p><b>On the <tt>snoop</tt> system, assume the Network Management
role or become superuser.</b></p><p>Roles contain authorizations and privileged
commands. For more information about roles, see "Configuring RBAC (Task Map)" in <i>System Administration Guide: Security Services</i>.</p>
</li>
<li><p><b>Type <tt>snoop</tt> with options and save the output
to a file.</b></p></li>
<li><p><b>Inspect and interpret the output. </b></p><p><A NAME="indexterm-895"></A><A NAME="indexterm-896"></A>Refer to <A  HREF="http://www.ietf.org/rfc/rfc1761.txt?number=1761">RFC 1761, Snoop Version 2 Packet Capture File Format</A> for
details of the <tt>snoop</tt> capture file. </p>
</li>
</ol><A NAME="ipv6-admintasks-10"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Monitor IPv6 Network Traffic</h3>
<A NAME="indexterm-897"></A><A NAME="indexterm-898"></A><p>You can use the <tt>snoop</tt> command to display only IPv6
packets.</p>
<ol><li><p><b>On the local node, assume the Network Management role or become
superuser.</b></p><p>Roles contain authorizations and privileged commands.
For more information about roles, see "Configuring RBAC (Task Map)" in <i>System Administration Guide: Security Services</i>.</p>
</li>
<li><p><b>Capture IPv6 packets.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>snoop ip6</b></tt></pre>
</td></table><br><p>For more information on the <tt>snoop</tt> command, see the <tt>snoop</tt>(1M) man page.</p>
</li>
</ol><A NAME="ipv6-admintasks-26"></A><h5>Example 8-21 &nbsp;&nbsp;Displaying Only IPv6 Network Traffic</h5>
<p>The following example shows typical output such as you might receive
from running the <tt>snoop ip6</tt> command on a node.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>snoop ip6</b></tt>
fe80::a00:20ff:fecd:4374 -> ff02::1:ffe9:2d27 ICMPv6 Neighbor solicitation
fe80::a00:20ff:fee9:2d27 -> fe80::a00:20ff:fecd:4375 ICMPv6 Neighbor 
      solicitation
fe80::a00:20ff:fee9:2d27 -> fe80::a00:20ff:fecd:4375 ICMPv6 Neighbor 
      solicitation
fe80::a00:20ff:febb:e09 -> ff02::9      RIPng R (11 destinations)
fe80::a00:20ff:fee9:2d27 -> ff02::1:ffcd:4375 ICMPv6 Neighbor solicitation</pre>
</td></table><br>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p45.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p47.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

