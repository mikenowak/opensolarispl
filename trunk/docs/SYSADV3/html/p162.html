<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p160.html#deploynetmult-56">31.&nbsp;&nbsp;Administering IPMP (Tasks)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p160.html#deploynetmult-57">Configuring IPMP Groups</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p161.html#emqul">How to Configure an IPMP Group With Multiple Interfaces</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p161.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p163.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="etmkd"></A><h4>Configuring Target Systems</h4>
<A NAME="indexterm-2944"></A><A NAME="indexterm-2945"></A><p>Probe-based failure detection involves the use of target systems, as
explained in <A HREF="p158.html#emqra">Probe-Based Failure Detection</A>.
For some IPMP groups, the default targets used by <tt>in.mpathd</tt> is
sufficient. However, for some IPMP groups, you might want to configure specific
targets for probe-based failure detection. You accomplish probe-based failure
detection by setting up host routes in the routing table as probe targets.
Any host routes that are configured in the routing table are listed before
the default router. Therefore, IPMP uses the explicitly defined host routes
for target selection. You can use either of two methods for directly specifying
targets: manually setting host routes or creating a shell script that can
become a startup script. </p>
<p>Consider the following criteria when evaluating which hosts on your
network might make good targets. </p>
<ul><li><p>Make sure that the prospective targets are available and running.
Make a list of their IP addresses.</p>
</li>
<li><p>Ensure that the target interfaces are on the same network
as the IPMP group that you are configuring.</p>
</li>
<li><p>The netmask and broadcast address of the target systems must
be the same as the addresses in the IPMP group.</p>
</li>
<li><p>The target host must be able to answer ICMP requests from
the interface that is using probe-based failure detection. </p>
</li>
</ul>
<A NAME="etmem"></A><p><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Manually Specify Target Systems for Probe-Based
Failure Detection</p>
<A NAME="indexterm-2946"></A><A NAME="indexterm-2947"></A><ol><li><p><b>Log in with your user account to the system where you are configuring
probe-based failure detection.</b></p></li>
<li><p><b>Add a route to a particular host to be used as a target in probe-based
failure detection.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>$ <tt><b>route add -host</b></tt> <i>destination-IP</i> <i>gateway-IP</i> <tt><b>-static</b></tt></pre>
</td></table><br><p>Replace the values of <i>destination-IP</i> and <i>gateway-IP</i> with the IPv4 address of the host to be used as a
target. For example, you would type the following to specify the target system <tt>192.168.85.137</tt>, which is on the same subnet as the interfaces in
IPMP group <tt>testgroup1</tt>.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>$ <tt><b>route add -host 192.168.85.137 192.168.85.137 -static</b></tt> </pre>
</td></table><br></li>
<li><p><b>Add routes to additional hosts on the network to be used as target
systems.</b></p></li>
</ol><A NAME="etmis"></A><p><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Specify Target Systems in a Shell Script</p>
<A NAME="indexterm-2948"></A><A NAME="indexterm-2949"></A><ol><li><p><b>On the system where you have configured an IPMP group, assume
the Primary Administrator role or become superuser.</b></p><p>The Primary
Administrator role includes the Primary Administrator profile. To create the
role and assign the role to a user, see Chapter 2, "Working With the Solaris Management Console (Tasks)," in <i>System Administration Guide: Basic Administration</i>.</p>
</li>
<li><p><b>Create a shell script that sets up static routes to  your proposed
targets. </b></p><p>For example, you could create a shell script called
 <tt>ipmp.targets</tt> with the following contents:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>TARGETS="192.168.85.117 192.168.85.127 192.168.85.137"

case "$1" in
        'start')
            /usr/bin/echo "Adding static routes for use as IPMP targets"
		for target in $TARGETS; do
	  /usr/sbin/route add -host $target $target
		done
                  ;;
        'stop')
              /usr/bin/echo "Removing static routes for use as IPMP targets"
		 for target in $TARGETS; do
		/usr/sbin/route delete -host $target $target
		 done
                  ;;
  esac  </pre>
</td></table><br></li>
<li><p><b>Copy the shell script to the startup script directory. </b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre> # <tt><b>cp ipmp.targets /etc/init.d</b></tt>  </pre>
</td></table><br></li>
<li><p><b>Change the permissions on the new startup script.  </b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>chmod 744 /etc/init.d/ipmp.targets</b></tt></pre>
</td></table><br></li>
<li><p><b>Change ownership of the new startup script.  </b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>chown root:sys /etc/init.d/ipmp.targets</b></tt></pre>
</td></table><br></li>
<li><p><b>Create a link for the startup script in the <tt>/etc/init.d</tt> directory.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ln <tt><b>/etc/init.d/ipmp.targets /etc/rc2.d/S70ipmp.targets</b></tt></pre>
</td></table><br><p>The S70 prefix in the file name <tt>S70ipmp.targets</tt> orders
the new script properly with respect to other startup scripts.</p>
</li>
</ol><A NAME="ettlz"></A><h4>Configuring Standby Interfaces</h4>
<p>Use this procedure if you want the IPMP group to have an active-standby
configuration. For more information on this type of configuration, refer to <A HREF="p157.html#eobra">IPMP Interface Configurations</A>. </p>
<A NAME="enfiu"></A><p><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Configure a Standby Interface for an IPMP Group</p>
<A NAME="indexterm-2950"></A><A NAME="indexterm-2951"></A><A NAME="indexterm-2952"></A><h5>Before You Begin</h5><ul><li><p>You must have configured all interfaces as members of the
IPMP group.</p>
</li>
<li><p>You should not have configured a test address on the interface
to become the standby interface.</p>
</li>
</ul>
<p>For information on configuring an IPMP group and assigning test addresses,
refer to <A HREF="p161.html#emqul">How to Configure an IPMP Group With Multiple Interfaces</A>.</p>
<ol><li><p><b>On the system with the standby interfaces to be configured, assume
the Primary Administrator role or become superuser.</b></p><p>The Primary
Administrator role includes the Primary Administrator profile. To create the
role and assign the role to a user, see Chapter 2, "Working With the Solaris Management Console (Tasks)," in <i>System Administration Guide: Basic Administration</i>.</p>
</li>
<A NAME="enfja"></A><li><p><b>Configure an interface as a standby and assign the
test address.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ifconfig <i>interface</i> plumb <i>ip-address</i> &lt;other-parameters> deprecated -failover standby up</pre>
</td></table><br><p>A standby interface can have only one IP address, the test address.
You must set the <tt>-failover</tt> option before you set the <tt>standby
up</tt> option. For <tt>&lt;other-parameters></tt>, use the
parameters that are required by your configuration, as described in the <tt>ifconfig</tt>(1M) man page. </p>
<ul><li><p>For example, to create an IPv4 test address, you would type
the following command:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig hme1 plumb 192.168.85.22 netmask + broadcast + deprecated -failover standby up</b></tt></pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p><tt>hme1</tt></p></td><td valign="top"><p>Defines <tt>hme1</tt> as the physical interface
to be configured as the standby interface.</p>
</td></tr><tr><td valign="top"><p><tt>192.168.85.22</tt></p></td><td valign="top"><p>Assigns this test address to the standby interface.</p>
</td></tr><tr><td valign="top"><p><tt>deprecated</tt></p></td><td valign="top"><p>Indicates that the test address is not used for outbound packets. </p>
</td></tr><tr><td valign="top"><p><tt>-failover</tt></p></td><td valign="top"><p>Indicates that the test address does not fail over if the
interface fails.</p>
</td></tr><tr><td valign="top"><p><tt>standby</tt></p></td><td valign="top"><p>Marks the interface as a standby interface.</p>
</td></tr></table>
</li>
<li><p>For example, to create an IPv6 test address, you would type
the following command:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig hme1 plumb -failover standby up</b></tt></pre>
</td></table><br></li>
</ul>
</li>
<li><p><b>Check the results of the standby interface configuration.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig hme1</b></tt>
hme1: flags=69040843&lt;UP,BROADCAST,RUNNING,MULTICAST,DEPRECATED,IPv4,NOFAILOVER,
      STANDBY,INACTIVE mtu 1500 
         index 4 inet 192.168.85.22 netmask ffffff00 broadcast 19.16.85.255
         groupname test</pre>
</td></table><br><p>The <tt>INACTIVE</tt> flag indicates that this interface is
not used for any outbound packets. When a failover occurs on this standby
interface, the <tt>INACTIVE</tt> flag is cleared.</p>
<p><hr size="1" noshade><p><b>Note - </b>You can always view the current status of an interface by typing
the <tt>ifconfig</tt> <i>interface</i> command.
For more information on viewing interface status, refer to <A HREF="p41.html#ipconfig-46">How to Get Information About a Specific Interface</A>.</p>
<hr size="1" noshade></p></li>
<A NAME="enfjb"></A><li><p><b><A NAME="indexterm-2953"></A><A NAME="indexterm-2954"></A><A NAME="indexterm-2955"></A><A NAME="indexterm-2956"></A><A NAME="indexterm-2957"></A><A NAME="indexterm-2958"></A><A NAME="indexterm-2959"></A>(Optional) Preserve the IPv4 standby interface across reboots.</b></p><p>Assign the standby interface to the same IPMP group, and configure a
test address for the standby interface.</p>
<p>For example, to configure <tt>hme1</tt> as the standby interface, you would add the following line
to the <tt>/etc/hostname.hme1</tt> file:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>192.168.85.22 netmask + broadcast + deprecated group test -failover standby up </pre>
</td></table><br></li>
<li><p><b>(Optional) Preserve the IPv6 standby interface across reboots.</b></p><p>Assign the standby interface to the same IPMP group, and configure a
test address for the standby interface.</p>
<p>For example, to configure <tt>hme1</tt> as the standby interface, add the following line to the <tt>/etc/hostname6.hme1</tt> file:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>-failover group test standby up</pre>
</td></table><br></li>
</ol><A NAME="enfjf"></A><h5>Example 31-4 &nbsp;&nbsp;Configuring a Standby Interface for an IPMP Group</h5>
<p>Suppose you want to  create a test address with the following configuration:</p>
<ul><li><p>Physical interface <tt>hme2</tt> as a standby interface</p>
</li>
<li><p>Test address of <tt>192.168.85.22</tt></p>
</li>
<li><p><tt>deprecated</tt> and <tt>-failover</tt> options
set</p>
</li>
<li><p>Netmask and broadcast address set to the default value</p>
</li>
</ul>
<p>You would type the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ifconfig hme2 plumb 192.168.85.22 netmask + broadcast + deprecated -failover standby up</pre>
</td></table><br><p>The interface is marked as a standby interface only after the address
is marked as a <tt>NOFAILOVER</tt> address.</p>
<p>You would remove the standby status of an interface by typing the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ifconfig <i>interface</i> -standby</pre>
</td></table><br>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p161.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p163.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

