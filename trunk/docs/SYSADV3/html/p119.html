<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p118.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p120.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ike-task-1"></A><b>Chapter&nbsp;23</b><h1>Configuring IKE (Tasks)</h1>
<p>This chapter describes how to configure IKE for your systems. After
IKE is configured, it automatically generates keying material for IPsec on
your network. This chapter contains the following information:</p>
<ul><li><p><A HREF="p119.html#ike-task-7">Configuring IKE (Task Map)</A></p>
</li>
<li><p><A HREF="p119.html#ike-task-13">Configuring IKE With Preshared Keys (Task Map)</A></p>
</li>
<li><p><A HREF="p121.html#ike-task-12">Configuring IKE With Public Key Certificates (Task Map)</A></p>
</li>
<li><p><A HREF="p124.html#ike-task-38">Configuring IKE for Mobile Systems (Task Map)</A></p>
</li>
<li><p><A HREF="p125.html#ike-task-17">Configuring IKE to Find Attached Hardware (Task Map)</A></p>
</li>
<li><p><A HREF="p125.html#ike-task-19">Changing IKE Transmission Parameters (Task Map)</A></p>
</li>
</ul>
<p>For overview information about IKE, see <A HREF="p117.html#ike-1">Chapter&nbsp;22, Internet Key Exchange (Overview)</A>. For reference information about
IKE, see <A HREF="p126.html#ikeref-1">Chapter&nbsp;24, Internet Key Exchange (Reference)</A>. For more procedures, see the Examples sections of the <tt>ikeadm</tt>(1M), <tt>ikecert</tt>(1M),  and <tt>ike.config</tt>(4) man pages.</p>
<A NAME="ike-task-7"></A><h2>Configuring IKE (Task Map)</h2>
<p>You can use preshared keys, self-signed certificates, and certificates
from a Certificate Authority (CA) to authenticate IKE. A rule links the particular
IKE authentication method with the end points that are being protected. Therefore,
you can use one or all IKE authentication methods on a system. A pointer to
a PKCS&nbsp;#11 library enables certificates to use an attached hardware accelerator.</p>
<p><A NAME="indexterm-2010"></A><A NAME="indexterm-2011"></A><A NAME="indexterm-2012"></A><A NAME="indexterm-2013"></A><A NAME="indexterm-2014"></A>After configuring IKE, complete the IPsec
task that uses the IKE configuration. The following table refers you to task
maps that focus on a specific IKE configuration.</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Task</p></th><th scope="col"><p>Description</p></th><th scope="col"><p>For Instructions</p></th></tr>
<tr><td><p>Configure IKE with preshared keys</p></td><td><p>Protects communications between two systems by having the systems share
a secret key.</p></td><td><p><A HREF="p119.html#ike-task-13">Configuring IKE With Preshared Keys (Task Map)</A>&nbsp;</p></td></tr>
<tr><td><p>Configure IKE with public key certificates</p></td><td><p>Protects communications with public key certificates. The certificates
can be self-signed, or they can be vouched for by a PKI organization.</p></td><td><p><A HREF="p121.html#ike-task-12">Configuring IKE With Public Key Certificates (Task Map)</A>&nbsp;</p></td></tr>
<tr><td><p>Cross a NAT boundary</p></td><td><p>Configures IPsec and IKE to communicate with a mobile system</p></td><td><p><A HREF="p124.html#ike-task-38">Configuring IKE for Mobile Systems (Task Map)</A>&nbsp;</p></td></tr>
<tr><td><p>Configure IKE to generate and store public key certificates on attached
hardware</p></td><td><p>Enables a Sun Crypto Accelerator 1000 board or a Sun Crypto Accelerator 4000 board to accelerate IKE operations.
Also enables the Sun Crypto Accelerator 4000 board to store public key certificates.</p></td><td><p><A HREF="p125.html#ike-task-17">Configuring IKE to Find Attached Hardware (Task Map)</A>&nbsp;</p></td></tr>
<tr><td><p>Tune Phase 1 key negotiation parameters</p></td><td><p>Changes the timing of IKE key negotiations.</p></td><td><p><A HREF="p125.html#ike-task-19">Changing IKE Transmission Parameters (Task Map)</A>&nbsp;</p></td></tr>
</table><A NAME="ike-task-13"></A><h2>Configuring IKE With Preshared Keys
(Task Map)</h2>
<p><A NAME="indexterm-2015"></A><A NAME="indexterm-2016"></A><A NAME="indexterm-2017"></A><A NAME="indexterm-2018"></A>The following table points to procedures to configure and maintain
IKE with preshared keys.</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Task</p></th><th scope="col"><p>Description</p></th><th scope="col"><p>For Instructions</p></th></tr>
<tr><td><p>Configure IKE with preshared keys</p></td><td><p>Creates an IKE policy file and one key to be shared.</p></td><td><p><A HREF="p119.html#ike-task-24">How to Configure IKE With Preshared Keys</A>&nbsp;</p></td></tr>
<tr><td><p>Refresh preshared keys on a running IKE system</p></td><td><p>Adds fresh keying material for IKE on communicating systems.</p></td><td><p><A HREF="p120.html#ike-task-10">How to Refresh IKE Preshared Keys</A>&nbsp;</p></td></tr>
<tr><td><p>Add preshared keys to a running IKE system</p></td><td><p>Adds a new IKE policy entry and new keying material to a system that
is currently enforcing IKE policy.</p></td><td><p><A HREF="p120.html#ike-task-18">How to Add an IKE Preshared Key for a New Policy Entry in <tt>ipsecinit.conf</tt></A>&nbsp;</p></td></tr>
<tr><td><p>Check that preshared keys are identical</p></td><td><p>Displays the preshared keys on both systems to see that the keys are
identical.</p></td><td><p><A HREF="p121.html#ike-task-44">How to Verify That IKE Preshared Keys Are Identical</A>&nbsp;</p></td></tr>
</table><A NAME="ike-task-15"></A><h2>Configuring IKE With Preshared Keys</h2>
<p>Preshared keys is the simplest authentication method for IKE. If you
are configuring two systems to use IKE, and you are the administrator for
both of the systems, using preshared keys is a good choice. However, unlike
public key certificates, preshared keys are tied to particular IP addresses.
Preshared keys cannot be used with mobile systems or systems that might be
renumbered. Also, when you use preshared keys, you cannot offload IKE computations
to attached hardware.</p>
<A NAME="ike-task-24"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Configure IKE With Preshared Keys</h3>
<p>The IKE implementation offers algorithms whose keys vary in length.
The key length that you choose is determined by site security. In general,
longer keys provide more security than shorter keys.</p>
<p>These procedures use the system names <tt>enigma</tt> and <tt>partym</tt>.
Substitute the names of your systems for the names <tt>enigma</tt> and <tt>partym</tt>.</p>
<ol><li><p><b>On the system console, assume the Primary Administrator role or
become superuser.</b></p><p>The Primary Administrator role includes the
Primary Administrator profile. To create the role and assign the role to a
user, see Chapter 2, "Working With the Solaris Management Console (Tasks)," in <i>System Administration Guide: Basic Administration</i>.</p>
<p><hr size="1" noshade><p><b>Note - </b><A NAME="indexterm-2019"></A>Logging in remotely exposes security-critical traffic to eavesdropping.
Even if you somehow protect the remote login, the security of the system is
reduced to the security of the remote login session.</p>
<hr size="1" noshade></p></li>
<li><p><b><A NAME="indexterm-2020"></A>On each system, copy the file <tt>/etc/inet/ike/config.sample</tt> to
the file <tt>/etc/inet/ike/config</tt>. </b></p></li>
<A NAME="ike-task-config-1"></A><li><p><b><A NAME="indexterm-2021"></A>Enter rules and global parameters in the <tt>ike/config</tt> file
on each system.</b></p><p>The rules and global parameters in this file should
permit the IPsec policy in the system's <tt>ipsecinit.conf</tt> file
to succeed. The following <tt>ike/config</tt> examples work with
the <tt>ipsecinit.conf</tt> examples in <A HREF="p107.html#ipsec-mgtasks-3">How to Secure Traffic Between Two Systems With IPsec</A>.</p>
<ol Type="a"><li><p><b>For example, modify the <tt>/etc/inet/ike/config</tt> file
on the <tt>enigma</tt> system:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>### ike/config file on enigma, 192.168.116.16

## Global parameters
#
## Phase 1 transform defaults
p1_lifetime_secs 14400
p1_nonce_len 40
#
## Defaults that individual rules can override.
p1_xform
  { auth_method preshared oakley_group 5 auth_alg sha encr_alg des }
p2_pfs 2
#
<tt><b>## The rule to communicate with partym
#  Label must be unique
{ label "enigma-partym"
  local_addr 192.168.116.16
  remote_addr 192.168.13.213
  p1_xform
   { auth_method preshared oakley_group 5 auth_alg md5 encr_alg 3des }
  p2_pfs 5
}</b></tt></pre>
</td></table><br><p><hr size="1" noshade><p><b>Note - </b>All arguments to the <tt>auth_method</tt> parameter
must be on the same line. </p>
<hr size="1" noshade></p></li>
<li><p><b>Modify the <tt>/etc/inet/ike/config</tt> file on the <tt>partym</tt> system:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>### ike/config file on partym, 192.168.13.213
## Global Parameters
#
p1_lifetime_secs 14400
p1_nonce_len 40
#
p1_xform
  { auth_method preshared oakley_group 5 auth_alg sha encr_alg des }
p2_pfs 2

<tt><b>## The rule to communicate with enigma
#  Label must be unique
{ label "partym-enigma"
  local_addr 192.168.13.213
  remote_addr 192.168.116.16
p1_xform
   { auth_method preshared oakley_group 5 auth_alg md5 encr_alg 3des }
p2_pfs 5
}</b></tt></pre>
</td></table><br></li>
</ol>
</li>
<li><p><b><A NAME="indexterm-2022"></A><A NAME="indexterm-2023"></A><A NAME="indexterm-2024"></A><A NAME="indexterm-2025"></A><A NAME="indexterm-2026"></A>On each system, check the validity of the file.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>/usr/lib/inet/in.iked -c -f /etc/inet/ike/config</b></tt></pre>
</td></table><br></li>
<A NAME="ike-task-gennumber-1"></A><li><p><b><A NAME="indexterm-2027"></A><A NAME="indexterm-2028"></A>Generate random numbers for use as keying material. </b></p><p>If
your site has a random number generator, use that generator. On a Solaris
system, you can use the <tt>od</tt> command. For example, the following
command prints two lines of hexadecimal numbers:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>% <tt><b>od -X -A n /dev/random | head -2</b></tt>
         f47cb0f4 32e14480 951095f8 2b735ba8
         0a9467d0 8f92c880 68b6a40e 0efe067d</pre>
</td></table><br><p>For an explanation of the <tt>od</tt> command, see <A HREF="p108.html#ipsec-mgtasks-12">How to Generate Random Numbers on a Solaris System</A> and
the <tt>od</tt>(1) man page.</p>
<p><hr size="1" noshade><p><b>Note - </b>Other operating systems can require
ASCII keying material. To generate the identical key in hexadecimal and ASCII
formats, see <A HREF="p119.html#iketask-key-ex-1">Example 23-1</A>.</p>
<hr size="1" noshade></p></li>
<li><p><b>From the output of <A HREF="p119.html#ike-task-gennumber-1">Step&nbsp;5</A>, construct one key.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>f47cb0f432e14480951095f82b735ba80a9467d08f92c88068b6a40e</pre>
</td></table><br><p>The authentication algorithm in this procedure is MD5, as shown in <A HREF="p119.html#ike-task-config-1">Step&nbsp;3</A>. The size of the hash, that
is, the size of the authentication algorithm's output, determines the minimum
recommended size of a preshared key. The output of the MD5 algorithm is 128
bits, or 32 characters. The example key is 56 characters long, which provides
additional keying material for IKE to use.</p>
</li>
<li><p><b><A NAME="indexterm-2029"></A>Create the file <tt>/etc/inet/secret/ike.preshared</tt> on
each system.</b></p><p>Put the preshared key in each file.</p>
<ol Type="a"><li><p><b>For example, on the <tt>enigma</tt> system, the <tt>ike.preshared</tt> file would appear similar to the following:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ike.preshared on enigma, 192.168.116.16
#...
{ localidtype IP
	localid 192.168.116.16
	remoteidtype IP
	remoteid 192.168.13.213
	# enigma and partym's shared key in hex (192 bits)
	key f47cb0f432e14480951095f82b735ba80a9467d08f92c88068b6a40e
	}</pre>
</td></table><br></li>
<li><p><b>On the <tt>partym</tt> system, the <tt>ike.preshared</tt> file would appear similar to the following:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ike.preshared on partym, 192.168.13.213
#...
{ localidtype IP
	localid 192.168.13.213
	remoteidtype IP
	remoteid 192.168.116.16
	# partym and enigma's shared key in hex (192 bits)
	key f47cb0f432e14480951095f82b735ba80a9467d08f92c88068b6a40e
	}</pre>
</td></table><br></li>
</ol>
<p><hr size="1" noshade><p><b>Note - </b>The preshared keys on each system must be identical.</p>
<hr size="1" noshade></p></li>
</ol><A NAME="iketask-key-ex-1"></A><h5>Example 23-1 &nbsp;&nbsp;Generating Identical Key Material for Two Systems With Different Operating
Systems</h5>
<p><A NAME="indexterm-2030"></A><A NAME="indexterm-2031"></A><A NAME="indexterm-2032"></A>Solaris IPsec interoperates with other operating systems. If your
system is communicating with a system that requires ASCII preshared keys,
you need to generate one key in two formats, ASCII and hexadecimal.</p>
<p>In this example, the Solaris system administrator wants 56 characters
of keying material. The administrator uses the following command to generate
a hexadecimal key from an ASCII passphrase. The option <tt>-tx1</tt> prints
the bytes one at a time on all Solaris systems.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>/bin/echo "papiermache with cashews and\c" | od -tx1 | cut -c 8-55 | \</b></tt>
<tt><b>tr -d '\n' | tr -d ' ' | awk '{print}'</b></tt>
7061706965726d616368652077697468206361736865777320616e64</pre>
</td></table><br><p>By removing the offsets and concatenating the hexadecimal output, the
hexadecimal key for the Solaris system is <tt>7061706965726d616368652077697468206361736865777320616e64</tt>. The administrator places this value in the <tt>ike.preshared</tt> file
on the Solaris system.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># Shared key in hex (192 bits)
key 7061706965726d616368652077697468206361736865777320616e64</pre>
</td></table><br><p>On the system that requires ASCII preshared keys, the passphrase is
the preshared key. The Solaris system administrator telephones the other administrator
with the passphrase, <tt>papiermache with cashews and</tt>.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p118.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p120.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

