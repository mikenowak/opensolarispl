<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p125.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p127.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ikeref-1"></A><b>Chapter&nbsp;24</b><h1>Internet Key Exchange (Reference)</h1>
<p>This chapter contains the following reference information about IKE:</p>
<ul><li><p><A HREF="p126.html#ike-17">IKE Daemon</A></p>
</li>
<li><p><A HREF="p126.html#ike-6">IKE Policy File</A></p>
</li>
<li><p><A HREF="p126.html#ike-19">IKE Administration Command</A></p>
</li>
<li><p><A HREF="p126.html#ike-15">IKE Preshared Keys Files</A></p>
</li>
<li><p><A HREF="p126.html#ike-20">IKE Public Key Databases and Commands</A></p>
</li>
</ul>
<p><A NAME="indexterm-2199"></A>For instructions on implementing IKE, see <A HREF="p119.html#ike-task-1">Chapter&nbsp;23, Configuring IKE (Tasks)</A>. For
overview information, see <A HREF="p117.html#ike-1">Chapter&nbsp;22, Internet Key Exchange (Overview)</A>.</p>
<A NAME="ike-17"></A><h2>IKE Daemon</h2>
<p><A NAME="indexterm-2200"></A><A NAME="indexterm-2201"></A><A NAME="indexterm-2202"></A><A NAME="indexterm-2203"></A><A NAME="indexterm-2204"></A><A NAME="indexterm-2205"></A><A NAME="indexterm-2206"></A><A NAME="indexterm-2207"></A>The <tt>in.iked</tt> daemon automates the management
of cryptographic keys for IPsec on a Solaris system. The daemon negotiates
with a remote system that is running the same protocol to provide authenticated
keying materials for security associations (SAs) in a protected manner. The
daemon must be running on all systems that plan to communicate securely.</p>
<p>The IKE daemon is automatically loaded at boot time if the configuration
file for the IKE policy, <tt>/etc/inet/ike/config</tt>, exists.
The daemon checks the syntax of the configuration file.</p>
<p>When the IKE daemon runs, the system authenticates itself to its peer
IKE entity in the Phase 1 exchange. The peer is defined in the IKE policy
file, as are the authentication methods. The daemon then establishes the keys
for the Phase 2 exchange. At an interval specified in the policy file, the
IKE keys are refreshed automatically. The <tt>in.iked</tt> daemon
listens for incoming IKE requests from the network and for requests for outbound
traffic through the <tt>PF_KEY</tt> socket. For more information,
see the <tt>pf_key</tt>(7P) man
page.</p>
<p><A NAME="indexterm-2208"></A><A NAME="indexterm-2209"></A><A NAME="indexterm-2210"></A><A NAME="indexterm-2211"></A>Two commands support the IKE daemon. The <tt>ikeadm</tt> command
enables you to view and modify the IKE policy. The <tt>ikecert</tt> command
enables you to view and manage the public key databases. This command manages
the local databases, <tt>ike.privatekeys</tt> and <tt>publickeys</tt>. This command also manages public key operations and the storage
of public keys on hardware.</p>
<A NAME="ike-6"></A><h2>IKE Policy File</h2>
<p><A NAME="indexterm-2212"></A><A NAME="indexterm-2213"></A><A NAME="indexterm-2214"></A><A NAME="indexterm-2215"></A><A NAME="indexterm-2216"></A>The configuration file for the IKE policy, <tt>/etc/inet/ike/config</tt>, manages the keys for the interfaces that are being protected
in the IPsec policy file, <tt>/etc/inet/ipsecinit.conf</tt>. The
IKE policy file manages keys for IKE, and for the IPsec SAs. The IKE daemon
itself requires keying material in the Phase 1 exchange.</p>
<p>Key management with IKE includes rules and global parameters. An IKE
rule identifies the systems or networks that the keying material secures.
The rule also specifies the authentication method. Global parameters include
such items as the path to an attached hardware accelerator. For examples of
IKE policy files, see <A HREF="p119.html#ike-task-13">Configuring IKE With Preshared Keys (Task Map)</A>. For examples and descriptions of IKE policy
entries, see the <tt>ike.config</tt>(4) man
page.</p>
<p>The IPsec SAs that IKE supports protect the IP datagrams according to
policies that are set up in the configuration file for the IPsec policy, <tt>/etc/inet/ipsecinit.conf</tt>. The IKE policy file determines if perfect
forward security (PFS) is used when creating the IPsec SAs.</p>
<p>The <tt>ike/config</tt> file can include the path to a library
that is implemented according to the following standard: RSA Security Inc.
PKCS&nbsp;#11 Cryptographic Token Interface (Cryptoki). IKE uses this PKCS&nbsp;#11
library to access hardware for key acceleration and key storage.</p>
<p><A NAME="indexterm-2217"></A>The security considerations for the <tt>ike/config</tt> file
are similar to the considerations for the <tt>ipsecinit.conf</tt> file.
For details, see <A HREF="p115.html#ipsecref-42">Security Considerations for <tt>ipsecinit.conf</tt> and <tt>ipsecconf</tt></A>.</p>
<A NAME="ike-19"></A><h2>IKE Administration Command</h2>
<p><A NAME="indexterm-2218"></A><A NAME="indexterm-2219"></A><A NAME="indexterm-2220"></A>You can use the <tt>ikeadm</tt> command to do the following:</p>
<ul><li><p>View aspects of the IKE daemon process.</p>
</li>
<li><p>Change the parameters that are passed to the IKE daemon.</p>
</li>
<li><p>Display statistics on SA creation during the Phase 1 exchange.</p>
</li>
<li><p>Debug IKE processes.</p>
</li>
</ul>
<p>For examples and a full description of this command's options, see the <tt>ikeadm</tt>(1M) man
page. The privilege level of the running IKE daemon determines which aspects
of the IKE daemon can be viewed and  modified. You can choose from three levels
of privilege.</p>
<table border="0" cellspacing="5"><tr><td valign="top"><p><tt>0x0</tt>, or base level</p></td><td valign="top"><p>You cannot view nor modify keying material. The base level
is the default level at which the <tt>in.iked</tt> daemon runs.</p>
</td></tr><tr><td valign="top"><p><tt>0x1</tt>, or modkeys level</p></td><td valign="top"><p>You can remove, change, and add preshared keys.</p>
</td></tr><tr><td valign="top"><p><tt>0x2</tt>, or keymat level</p></td><td valign="top"><p>You can view the actual keying material with the <tt>ikeadm</tt> command.</p>
</td></tr></table>
<p>The security considerations for the <tt>ikeadm</tt> command
are similar to the considerations for the <tt>ipseckey</tt> command.
For details, see <A HREF="p116.html#ipsecref-41">Security Considerations for <tt>ipseckey</tt></A>.</p>
<A NAME="ike-15"></A><h2>IKE Preshared Keys Files</h2>
<p><A NAME="indexterm-2221"></A><A NAME="indexterm-2222"></A><A NAME="indexterm-2223"></A><A NAME="indexterm-2224"></A><A NAME="indexterm-2225"></A><A NAME="indexterm-2226"></A><A NAME="indexterm-2227"></A>When you create preshared keys manually, the keys are stored in
files in the <tt>/etc/inet/secret</tt> directory.
The <tt>ike.preshared</tt> file contains the preshared keys for
Internet Security Association and Key Management Protocol (ISAKMP) SAs. The <tt>ipseckeys</tt> file contains the preshared keys for IPsec SAs. The files
are protected at <tt>0600</tt>. The <tt>secret</tt> directory
is protected at <tt>0700</tt>.</p>
<ul><li><p>You create an <tt>ike.preshared</tt> file when
you configure the <tt>ike/config</tt> file to require preshared
keys. You enter keying material for ISAKMP SAs, that is, for IKE authentication,
in the <tt>ike.preshared</tt> file. Because the preshared keys
are used to authenticate the Phase 1 exchange, the file must be valid before
the <tt>in.iked</tt> daemon starts.</p>
</li>
<li><p>The <tt>ipseckeys</tt> file contains keying material
for IPsec SAs. For examples of manually managing the file, see <A HREF="p109.html#ipsec-mgtasks-13">How to Manually Create IPsec Security Associations</A>.
The IKE daemon does not use this file. The keying material that IKE generates
for IPsec SAs is stored in the kernel.</p>
</li>
</ul>
<p><hr size="1" noshade><p><b>Note - </b>Preshared keys cannot take advantage of hardware storage. Preshared
keys are generated and are stored on the system.</p>
<hr size="1" noshade></p><A NAME="ike-20"></A><h2>IKE Public Key Databases and Commands</h2>
<A NAME="indexterm-2228"></A><A NAME="indexterm-2229"></A><A NAME="indexterm-2230"></A><p><A NAME="indexterm-2231"></A><A NAME="indexterm-2232"></A><A NAME="indexterm-2233"></A>The <tt>ikecert</tt> command manipulates the local system's
public key databases. You use this command when the <tt>ike/config</tt> file
requires public key certificates. Because IKE uses these databases to authenticate
the Phase 1 exchange, the databases must be populated before activating the <tt>in.iked</tt> daemon. Three subcommands handle each of the three databases: <tt>certlocal</tt>, <tt>certdb</tt>, and <tt>certrldb</tt>.</p>
<p><A NAME="indexterm-2234"></A><A NAME="indexterm-2235"></A><A NAME="indexterm-2236"></A><A NAME="indexterm-2237"></A><A NAME="indexterm-2238"></A><A NAME="indexterm-2239"></A><A NAME="indexterm-2240"></A>The <tt>ikecert</tt> command also handles key storage.
Keys can be stored on disk, on an attached Sun Crypto Accelerator 4000 board, or in a softtoken
keystore. The softtoken keystore is available when the metaslot in the Solaris
cryptographic framework is used to communicate with the hardware device. The <tt>ikecert</tt> command uses the PKCS&nbsp;#11 library to locate key storage.</p>
<ul><li><p><b>Solaris 10 1/06</b>: In this
release, the library does not have to be specified. By default, the PKCS&nbsp;#11
library is <tt>/usr/lib/libpkcs11.so</tt>.</p>
</li>
<li><p><b>Solaris 10</b>: In this release,
the PKCS&nbsp;#11 entry must be specified. Otherwise, the <tt>-T</tt> option
to the <tt>ikecert</tt> command cannot work. The entry appears similar
to the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>pkcs11_path <tt><b>"/opt/SUNWconn/cryptov2/lib/libvpkcs11.so"</b></tt></pre>
</td></table><br></li>
</ul>
<p>For more information, see the <tt>ikecert</tt>(1M) man page. For
information about metaslot and the softtoken keystore, see the <tt>cryptoadm</tt>(1M) man
page.</p>
<A NAME="ike-25"></A><h3><tt>ikecert tokens</tt> Command</h3>
<p><A NAME="indexterm-2241"></A>The <tt>tokens</tt> argument lists the token IDs that
are available. Token IDs enable the <tt>ikecert certlocal</tt> and <tt>ikecert certdb</tt> commands to generate public key certificates and
certificate requests. The certificates and certificate requests can also be
stored by the cryptographic framework in the softtoken
keystore, or on an attached Sun Crypto Accelerator 4000 board. The <tt>ikecert</tt> command
uses the PKCS&nbsp;#11 library to locate certificate storage.</p>
<A NAME="ike-27"></A><h3><tt>ikecert certlocal</tt> Command</h3>
<p><A NAME="indexterm-2242"></A><A NAME="indexterm-2243"></A><A NAME="indexterm-2244"></A><A NAME="indexterm-2245"></A><A NAME="indexterm-2246"></A><A NAME="indexterm-2247"></A><A NAME="indexterm-2248"></A>The <tt>certlocal</tt> subcommand manages the private
key database. Options to this subcommand enable you to add, view, and remove
private keys. This subcommand also creates either a self-signed certificate
or a certificate request. The <tt>-ks</tt> option creates a self-signed
certificate. The <tt>-kc</tt> option creates a certificate request.
Keys are stored on the system in the <tt>/etc/inet/secret/ike.privatekeys</tt> directory, or on attached hardware with the <tt>-T</tt> option.</p>
<p><A NAME="indexterm-2249"></A>When you create a private key, the options to the <tt>ikecert
certlocal</tt> command must have related entries in the <tt>ike/config</tt> file. The correspondences between <tt>ikecert</tt> options
and <tt>ike/config</tt> entries are shown in the following
table.</p>
<A NAME="ike-tbl-1"></A><p><b>Table 24-1 </b>Correspondences Between <tt>ikecert</tt> Options and <tt>ike/config</tt> Entries</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p><tt>ikecert</tt> Option</p></th><th scope="col"><p><tt>ike/config</tt> Entry</p></th><th scope="col"><p>Description</p></th></tr>
<tr><td><p><A NAME="indexterm-2250"></A><A NAME="indexterm-2251"></A><tt>-A</tt> <i>subject-alternate-name</i></p></td><td><p><A NAME="indexterm-2252"></A><tt>cert_trust</tt> <i>subject-alternate-name</i></p></td><td><p>A nickname that uniquely identifies the certificate. Possible values
are an IP address, an email address, or a domain name.</p></td></tr>
<tr><td><p><A NAME="indexterm-2253"></A><tt>-D</tt> <i>X.509-distinguished-name</i></p></td><td><p><i>X.509-distinguished-name</i></p></td><td><p>The full name of the certificate authority that includes the country
(C), organization name (ON), organizational unit (OU), and common name (CN).</p></td></tr>
<tr><td><p><A NAME="indexterm-2254"></A><A NAME="indexterm-2255"></A><tt>-t dsa-sha1</tt></p></td><td><p><A NAME="indexterm-2256"></A><A NAME="indexterm-2257"></A><A NAME="indexterm-2258"></A><tt>auth_method dss_sig</tt></p></td><td><p>An authentication method that is slightly slower than <A HREF="p193.html#glossary-59">RSA</A>.</p></td></tr>
<tr><td><p><tt>-t rsa-md5</tt> and</p><p><tt>-t rsa-sha1</tt></p></td><td><p><tt>auth_method rsa_sig</tt></p></td><td><p>An authentication method that is slightly faster than <A HREF="p193.html#glossary-45">DSA</A>.</p><p>The RSA public key must be large enough to encrypt the biggest <A HREF="p193.html#glossary-122">payload</A>. Typically, an identity payload,
such as the X.509 distinguished name, is the biggest payload.</p></td></tr>
<tr><td><p><tt>-t rsa-md5</tt> and</p><p><tt>-t rsa-sha1</tt></p></td><td><p><A NAME="indexterm-2259"></A><A NAME="indexterm-2260"></A><tt>auth_method rsa_encrypt</tt></p></td><td><p>RSA encryption hides identities in IKE from eavesdroppers, but requires
that the IKE peers know each other's public keys.</p></td></tr>
<tr><td><p><A NAME="indexterm-2261"></A><A NAME="indexterm-2262"></A><tt>-T</tt></p></td><td><p><A NAME="indexterm-2263"></A><A NAME="indexterm-2264"></A><A NAME="indexterm-2265"></A><A NAME="indexterm-2266"></A><tt>pkcs11_path</tt></p></td><td><p>The PKCS&nbsp;#11 library handles key acceleration on the Sun Crypto Accelerator 1000 board and
the Sun Crypto Accelerator 4000 board. The library also provides the tokens that handle key storage
on the Sun Crypto Accelerator 4000 board.</p></td></tr>
</table><p><A NAME="indexterm-2267"></A>If you issue a certificate request with the <tt>ikecert certlocal
-kc</tt> command, you send the output of the command to a PKI organization
or to a certificate authority (CA). If your company runs its own PKI, you
send the output to your PKI administrator. The PKI organization, the CA, or
your PKI administrator then creates certificates. The certificates that the
PKI or CA returns to you are input to the <tt>certdb</tt> subcommand.
The certificate revocation list (CRL) that the PKI returns to you is input
for the <tt>certrldb</tt> subcommand.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p125.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p127.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

