<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p142.html#mipoverview-1">27.&nbsp;&nbsp;Mobile IP (Overview)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p143.html#mipoverview-12">Mobile IP Registration</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p143.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p145.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="mipoverview-33"></A><h3>Network Access Identifier (NAI)</h3>
<p>Authentication, authorization, and accounting (AAA) servers, in use within the
Internet, provide authentication and authorization services for dialup computers.
These services are likely to be equally valuable for mobile nodes that use Mobile
IP when the nodes attempt to connect to foreign domains with AAA servers. AAA servers
use the Network Access Identifier (NAI) to identify clients. A mobile node can identify
itself by including the NAI in the Mobile IP registration request.</p>
<p>Because the NAI is typically used to uniquely identify the mobile node, the
home address of the mobile node is not always necessary to provide that function.
Thus, a mobile node can authenticate itself. Consequently, a mobile node can be authorized
for connection to the foreign domain without even having a home address. To request
that a home address be assigned, a message that contains the mobile node NAI extension
can set the home address field to zero in the registration request.</p>
<A NAME="mipoverview-13"></A><h3>Mobile IP Message Authentication</h3>
<A NAME="indexterm-2556"></A><A NAME="indexterm-2557"></A><p><A NAME="indexterm-2558"></A><A NAME="indexterm-2559"></A><A NAME="indexterm-2560"></A><A NAME="indexterm-2561"></A><A NAME="indexterm-2562"></A><A NAME="indexterm-2563"></A><A NAME="indexterm-2564"></A><A NAME="indexterm-2565"></A><A NAME="indexterm-2566"></A><A NAME="indexterm-2567"></A><A NAME="indexterm-2568"></A>Each mobile node, foreign agent, and home agent supports a mobility security
association between the various Mobile IP components. The security association is
indexed by the security parameter index (SPI) and IP address. In the instance of the
mobile node, this address is the home address of the mobile node. Registration messages
between a mobile node and the home agent are authenticated with the mobile-home authentication
extension. In addition to mobile-home authentication, which is mandatory, you can
use the optional mobile-foreign agent and home-foreign agent authentications.</p>
<A NAME="mipoverview-14"></A><h3>Mobile Node Registration Request</h3>
<p><A NAME="indexterm-2569"></A><A NAME="indexterm-2570"></A><A NAME="indexterm-2571"></A><A NAME="indexterm-2572"></A><A NAME="indexterm-2573"></A><A NAME="indexterm-2574"></A><A NAME="indexterm-2575"></A>A mobile node uses a <b>registration request</b> message
to register with the home agent. Thus, the home agent can create or modify a mobility
binding for that mobile node (for example, with a new lifetime). The foreign agent
can relay the registration request to the home agent. However, if the mobile node
is registering a colocated care-of address, then the mobile node can send the registration
request directly to the home agent. If the foreign agent advertises that registration
messages must be sent to the foreign agent, then the mobile node must send the registration
request to the foreign agent.</p>
<A NAME="mipoverview-15"></A><h3>Registration Reply Message</h3>
<A NAME="indexterm-2576"></A><A NAME="indexterm-2577"></A><p><A NAME="indexterm-2578"></A><A NAME="indexterm-2579"></A><A NAME="indexterm-2580"></A><A NAME="indexterm-2581"></A>A mobility agent returns a <b>registration reply</b> message
to a mobile node that has sent a registration request message. If the mobile node
requests service from a foreign agent, that foreign agent receives the reply from
the home agent. Subsequently, the foreign agent relays the reply to the mobile node.
The reply message contains the necessary codes to inform the mobile node and the foreign
agent about the status of the registration request. The message also contains the
lifetime that is granted by the home agent. The lifetime can be smaller than the original
request. The registration reply can also contain a dynamic home address assignment.</p>
<A NAME="mipoverview-16"></A><h3>Foreign Agent Considerations</h3>
<A NAME="indexterm-2582"></A><p><A NAME="indexterm-2583"></A><A NAME="indexterm-2584"></A><A NAME="indexterm-2585"></A><A NAME="indexterm-2586"></A>The foreign agent plays a mostly passive role in Mobile IP registration.
The foreign agent adds all mobile nodes that are registered to the visitor table.
The foreign agent relays registration requests between mobile nodes and home agents.
Also, when the foreign agent provides the care-of address, the foreign agent de-encapsulates
datagrams for delivery to the mobile node. The foreign agent also sends periodic agent
advertisement messages to advertise the presence of the foreign agent.</p>
<p>If home agents and foreign agents support reverse tunnels, and the mobile node
requests a reverse tunnel, the foreign agent then tunnels all the packets from the
mobile node to the home agent. The home agent then sends the packets to the correspondent
node. This process is the reverse of the home agent tunneling all of the mobile node's
packets to the foreign agent for delivery to the mobile node. A foreign agent that
supports reverse tunnels advertises that the reverse tunnel is supported for registration.
Because of the local policy, the foreign agent can deny a registration request when
the reverse tunnel flag is not set. The foreign agent can only distinguish multiple
mobile nodes with the same (private) IP address when these mobile nodes are visiting
different interfaces on the foreign agent. In the forward tunnel situation, the foreign
agent distinguishes between multiple mobile nodes that share the same private addresses
by looking at the incoming tunnel interface. The incoming tunnel interface maps to
a unique home agent address.</p>
<A NAME="mipoverview-17"></A><h3>Home Agent Considerations</h3>
<p><A NAME="indexterm-2587"></A><A NAME="indexterm-2588"></A><A NAME="indexterm-2589"></A><A NAME="indexterm-2590"></A><A NAME="indexterm-2591"></A><A NAME="indexterm-2592"></A><A NAME="indexterm-2593"></A>Home agents play an active role in the registration process. The home
agent receives registration requests from the mobile node. The registration request
might be relayed by the foreign agent. The home agent updates its record of the mobility
bindings for this mobile node. The home agent issues a suitable registration reply
in response to each registration request. The home agent also forwards packets to
the mobile node when the mobile node is away from the home network.</p>
<p>A home agent might not have to have a physical subnet configured for mobile
nodes. However, the home agent must recognize the home address of the mobile node
through the <tt>mipagent.conf</tt> file or some other mechanism when the
home agent grants registration. For more information about <tt>mipagent.conf</tt>, refer to <A HREF="p145.html#mipimplementing-2">Creating the Mobile IP Configuration File</A>.</p>
<p>A home agent can support private addressed mobile nodes by configuring the private
addressed mobile nodes in the <tt>mipagent.conf</tt> file. The home addresses
that are used by the home agent must be unique.</p>
<A NAME="mipoverview-32"></A><h3>Dynamic Home Agent Discovery</h3>
<A NAME="indexterm-2594"></A><p>In some situations, the mobile node might not know the home agent address when
the mobile node attempts to register. If the mobile node does not know the home agent
address, the mobile node can use dynamic home agent address resolution to learn the
address. In this situation, the mobile node sets the home agent field of the registration
request to the subnet-directed broadcast address of its home network. Each home agent
that receives a registration request with a broadcast destination address rejects
the mobile node's registration by returning a rejection registration reply. By doing
so, the mobile node can use the home agent's unicast IP address that is indicated
in the rejection reply when the mobile node next attempts registration.</p>
<A NAME="mipoverview-18"></A><h2>Routing Datagrams to and From Mobile Nodes</h2>
<p>This section describes how mobile nodes, home agents, and foreign agents cooperate
to route datagrams for mobile nodes that are connected to a foreign network. See <A HREF="p150.html#mipmanaging-23">Overview of the Solaris Mobile IP Implementation</A> for
Mobile IP functions that are supported in the Solaris OS.</p>
<A NAME="mipoverview-19"></A><h3>Encapsulation Methods</h3>
<A NAME="indexterm-2595"></A><A NAME="indexterm-2596"></A><p><A NAME="indexterm-2597"></A><A NAME="indexterm-2598"></A><A NAME="indexterm-2599"></A>Home agents and foreign agents use one of the available encapsulation
methods to support datagrams that use a tunnel. Defined encapsulation methods are
IP-in-IP Encapsulation, Minimal Encapsulation, and Generic Routing Encapsulation.
Foreign agent and home agent cases, or indirect colocated mobile node and home agent
cases, must support the same encapsulation method. All Mobile IP entities are required
to support IP-in-IP Encapsulation.</p>
<A NAME="mipoverview-20"></A><h3>Unicast Datagram Routing</h3>
<A NAME="indexterm-2600"></A><A NAME="indexterm-2601"></A><p><A NAME="indexterm-2602"></A><A NAME="indexterm-2603"></A><A NAME="indexterm-2604"></A>When registered on a foreign network, the mobile node uses the following
rules to choose a default router:</p>
<ul><li><p>If the mobile node is registered and uses a foreign agent care-of
address, the process is straightforward. The mobile node chooses its default router
from among the router addresses that are advertised in the ICMP router advertisement
portion of that  agent advertisement. The mobile node can also consider the IP source
address of the agent advertisement as another possible choice for the IP address of
a default router.</p>
</li>
<li><p><A NAME="indexterm-2605"></A><A NAME="indexterm-2606"></A>The mobile node might be registered directly with the home agent by using
a colocated care-of address. Then, the mobile node chooses its default router from
among those routers that are advertised in any ICMP router advertisement message that
it receives. The network prefix of the chosen default router must match the network
prefix of the care-of address of the mobile node that is externally obtained. The
address might match the IP source address of the agent advertisement under the network
prefix. Then, the mobile node can also consider that IP source address as another
possible choice for the IP address of a default router.</p>
</li>
<li><p><A NAME="indexterm-2607"></A><A NAME="indexterm-2608"></A>If the mobile node is registered, a foreign agent that supports reverse
tunnels routes unicast datagrams from the mobile node to the home agent through the
reverse tunnel. If the mobile node is registered with a foreign agent that provides
reverse tunnel support, the mobile node must use that foreign agent as its default
router.</p>
</li>
</ul>
<A NAME="mipoverview-21"></A><h3>Broadcast Datagrams</h3>
<A NAME="indexterm-2609"></A><A NAME="indexterm-2610"></A><A NAME="indexterm-2611"></A><A NAME="indexterm-2612"></A><p>When a home agent receives a broadcast datagram or multicast datagram, the home
agent only forwards the datagram to mobile nodes that have specifically requested
that they receive them. How the home agent forwards broadcast and multicast datagrams
to mobile nodes depends primarily on two factors. Either that mobile node is using
a foreign-agent provided care-of address, or the mobile node is using its own colocated
care-of address. The former means that the datagram must be double encapsulated. The
first IP header identifies the mobile node for which the datagram is to be delivered.
This first IP header is not present in the broadcast or multicast datagram. The second
IP header identifies the care-of address, and is the usual tunnel header. In the latter
instance, the mobile node is decapsulating its own datagrams, and the datagram needs
only to be sent through the regular tunnel.</p>
<A NAME="mipoverview-22"></A><h3>Multicast Datagram Routing</h3>
<A NAME="indexterm-2613"></A><A NAME="indexterm-2614"></A><p>To begin receiving multicast traffic when a mobile node is visiting a foreign
subnet, a mobile node can join a multicast group in any of the following ways:</p>
<ul><li><p><A NAME="indexterm-2615"></A>If the mobile node is using a colocated care-of address, the mobile node
can use this address as the source IP address of any Internet Group Management Protocol
(IGMP) join messages. However, a multicast router must be present on the visited subnet.</p>
</li>
<li><p>If the mobile node wants to join the ICMP group from its home subnet,
the mobile node must use a reverse tunnel to send IGMP join messages to the home agent.
However, the mobile node's home agent must be a multicast router. The home agent then
forwards multicast datagrams through the tunnel to the mobile node.</p>
</li>
<li><p>If the mobile node is using a colocated care-of address, the mobile
node can use this address as the source IP address of any IGMP join messages.  However,
a multicast router must be present on the visited subnet. After the mobile node has
joined the group, the mobile node can participate by sending its own multicast packets
directly on the visited network.</p>
</li>
</ul>
<ul><li><p>Send directly on the visited network.</p>
</li>
<li><p>Send through a tunnel to the home agent.</p>
</li>
</ul>
<p>Multicast routing depends on the IP source address.  A mobile node that is sending
a multicast datagram must send the datagram from a valid source address on that link.
 So a mobile node that is sending multicast datagrams directly on the visited network
must use a colocated care-of address as the IP source address. Also, the mobile node
must have joined the multicast group that is associated with the address.  Similarly,
a mobile node that joined a multicast group while on its home subnet before roaming,
or joined the multicast group while roaming through a reverse tunnel to its home agent,
must use its home address as the IP source address of the multicast datagram. Thus,
the mobile node must have these datagrams reverse-tunneled to its home subnet as well,
either through itself by using its colocated care-of address, or through a foreign
agent reverse tunnel.</p>
<p><A NAME="indexterm-2616"></A><A NAME="indexterm-2617"></A>While it seems more efficient for a mobile node to always join from the
subnet that the mobile node is visiting, it is still a mobile node. Consequently,
the mobile node would have to repeat the join every time the mobile node switches
subnets. The more efficient way is for the mobile node to join through its home agent,
and not have to carry this overhead. Also, multicast sessions might be present that
are only available from the home subnet. Other considerations might also force the
 mobile node to participate in a specific way.</p>
<A NAME="mipoverview-23"></A><h2>Security Considerations for Mobile IP</h2>
<A NAME="indexterm-2618"></A><A NAME="indexterm-2619"></A><p><A NAME="indexterm-2620"></A><A NAME="indexterm-2621"></A><A NAME="indexterm-2622"></A>In many situations, mobile computers use wireless links to connect to
the network. Wireless links are particularly vulnerable to passive eavesdropping,
active replay attacks, and other active attacks.</p>
<p>Because Mobile IP recognizes its inability to reduce or eliminate this vulnerability,
Mobile IP uses a form of authentication to protect Mobile IP registration messages
from these types of attack. The default algorithm that is used is MD5, with a key
size of 128 bits. The default operational mode requires that this 128-bit key precede
and succeed the data to be hashed. The foreign agent uses MD5 to support authentication.
The foreign agent also uses key sizes of 128 bits or greater, with manual key distribution.
Mobile IP can support more authentication algorithms, algorithm modes, key distribution
methods, and key sizes.</p>
<p>These methods do prevent Mobile IP registration messages from being altered.
However, Mobile IP also uses a form of replay protection to alert Mobile IP entities
when they receive duplicates of previous Mobile IP registration messages. If this
protection method were not used, the mobile node and its home agent might become unsynchronized
when either of them receives a registration message. Hence, Mobile IP updates its
state. For example, a home agent receives a duplicate deregistration message while
the mobile node is registered through a foreign agent. </p>
<p>Replay protection is ensured either by a method known as <b>nonces,</b> or <b>timestamps</b>. Nonces and timestamps are exchanged by home agents and mobile
nodes within the Mobile IP registration messages. Nonces and timestamps are protected
from change by an authentication mechanism. Consequently, if a home agent or mobile
node receives a duplicate message, the duplicate message can be thrown away.</p>
<p><A NAME="indexterm-2623"></A>The use of tunnels can be a significant vulnerability, especially if registration
is not authenticated. Also, the Address Resolution Protocol (ARP)  is not authenticated,
and can potentially be used to steal another host's traffic.</p>
<A NAME="mipoverview-44"></A><h3>Use of IPsec With Mobile IP</h3>
<A NAME="indexterm-2624"></A><A NAME="indexterm-2625"></A><p>In general, because home agents and foreign agents are fixed entities, they
can use IPsec authentication or encryption to protect both Mobile IP registration
messages and forward and reverse tunnel traffic.  This process works completely independently
of Mobile IP, and only depends on the workstation's ability to perform IPsec functions.
Mobile nodes can also use IPsec authentication to protect their registration traffic.
If the mobile node registers through a foreign agent, in general the mobile node cannot
use IPsec encryption. The reason that the mobile node cannot use IPsec encryption
is because the foreign agent must be able to check the information in the registration
packet. While IPsec encryption could be used when a foreign agent is not needed, the
issue of colocation makes this difficult to achieve. IPsec is an IP-level security
relationship. Consequently, a home agent would have to know the mobile node's colocated
address without prior information or registration messages.  For more information
about IPsec, see <A HREF="p103.html#ipsec-ov-1">Chapter&nbsp;19, IP Security Architecture (Overview)</A> or <A HREF="p107.html#ipsec-mgtasks-1">Chapter&nbsp;20, Configuring IPsec (Tasks)</A>.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p143.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p145.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

