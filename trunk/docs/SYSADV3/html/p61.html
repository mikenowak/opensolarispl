<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p55.html#ipv6-ref-76">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p60.html#ipv6-ref-34">IPv6 Neighbor Discovery Protocol</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p60.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p62.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ipv6-ref-38"></A><h3>Neighbor Solicitation and Unreachability</h3>
<p><A NAME="indexterm-1269"></A><A NAME="indexterm-1270"></A><A NAME="indexterm-1271"></A>Neighbor Discovery uses <b>neighbor solicitation</b> messages
to determine if more than one node is assigned the same unicast address. <b>Neighbor unreachability detection</b> detects the failure of a neighbor
or the failure of the forward path to the neighbor. This detection requires
positive confirmation that packets that are sent to a neighbor are actually
reaching that neighbor. Neighbor unreachability detection also determines
that packets are being processed properly by the node's IP layer.</p>
<p>Neighbor unreachability detection uses confirmation from two sources:
upper-layer protocols and neighbor solicitation messages. When possible, upper-layer
protocols provide a positive confirmation that a connection is making <b>forward
progress</b>.  For example, when new TCP acknowledgments are received,
it is confirmed that previously sent data has been delivered correctly.</p>
<p>When a node does not get positive confirmation from upper-layer protocols,
the node sends unicast neighbor solicitation messages. These messages solicit
neighbor advertisements as reachability confirmation from the next hop. To
reduce unnecessary network traffic, probe messages are sent only to neighbors
to which the node is actively sending packets. </p>
<A NAME="chapter1-52"></A><h3>Duplicate Address Detection Algorithm</h3>
<p><A NAME="indexterm-1272"></A><A NAME="indexterm-1273"></A>To ensure that all configured addresses are likely to be unique
on a particular link, nodes run a <b>duplicate address detection</b> algorithm
on addresses. The nodes must run the algorithm before assigning the addresses
to an interface. The duplicate address detection algorithm is performed on
all addresses.</p>
<p>The autoconfiguration process that is described in this section applies
only to hosts, and not routers. Because host autoconfiguration uses information
that is advertised by routers, routers need to be configured by some other
means. However, routers generate link-local addresses by using the mechanism
that is described in this chapter. In addition, routers are expected to successfully
pass the duplicate address detection algorithm on all addresses prior to assigning
the address to an interface.</p>
<A NAME="eobqo"></A><h3>Proxy Advertisements</h3>
<p>A router that accepts packets on behalf of a target address can issue
non-override neighbor advertisements. The router can accept packets for a
target address that is unable to respond to neighbor solicitations.  Currently,
the use of proxy is not specified. However, proxy advertising can potentially
be used to handle cases such as mobile nodes that have moved off-link. Note
that the use of proxy is not intended as a general mechanism to handle nodes
that do not implement this protocol.</p>
<A NAME="eobqn"></A><h3>Inbound Load Balancing</h3>
<p>Nodes with replicated interfaces might need to load balance the reception
of incoming packets across multiple network interfaces on the same link. Such
nodes have multiple link-local addresses assigned to the same interface. For
example, a single network driver can represent multiple network interface
cards as a single logical interface that has multiple link-local addresses.</p>
<p>Load balancing is handled by allowing routers to omit the source link-local
address from router advertisement packets. Consequently, neighbors must use
neighbor solicitation messages to learn link-local addresses of routers. Returned
neighbor advertisement messages can then contain link-local addresses that
differ, depending on which issued the solicitation.<A NAME="indexterm-1274"></A><A NAME="indexterm-1275"></A></p>
<A NAME="eobqr"></A><h3>Link-Local Address Change</h3>
<A NAME="indexterm-1276"></A><p>A node that knows its link-local address has been changed can send out
multicast  unsolicited, neighbor advertisement packets. The node can send
multicast packets to all nodes to update cached link-local addresses that
have become invalid. The sending of unsolicited advertisements is a performance
enhancement only. The detection algorithm for neighbor unreachability ensures
that all nodes reliably discover the new address, though the delay might be
somewhat longer.</p>
<A NAME="chapter1-41"></A><h3>Comparison of Neighbor Discovery to ARP and
Related IPv4 Protocols</h3>
<A NAME="indexterm-1277"></A><A NAME="indexterm-1278"></A><A NAME="indexterm-1279"></A><p>The functionality of the IPv6 Neighbor Discovery protocol corresponds
to a combination of the IPv4 protocols: Address Resolution Protocol (ARP),
Internet Control Message Protocol (ICMP) Router Discovery, and ICMP Redirect.
IPv4 does not have a generally agreed on protocol or mechanism for neighbor
unreachability detection. However, host requirements do specify some possible
algorithms for dead gateway detection. Dead gateway detection is a subset
of the problems that neighbor unreachability detection solves.</p>
<p>The following list compares the Neighbor Discovery protocol to the related
set of IPv4 protocols.</p>
<ul><li><p><A NAME="indexterm-1280"></A><A NAME="indexterm-1281"></A>Router discovery is part of the base IPv6 protocol set. IPv6 hosts
do not need to <tt>snoop</tt> the routing protocols to find a router.
IPv4 uses ARP, ICMP router discovery, and ICMP redirect for router discovery.</p>
</li>
<li><p><A NAME="indexterm-1282"></A><A NAME="indexterm-1283"></A>IPv6 router advertisements carry link-local addresses. No additional
packet exchange is needed to resolve the router's link-local address.  </p>
</li>
<li><p><A NAME="indexterm-1284"></A>Router advertisements carry site prefixes for a link. A separate
mechanism is not needed to configure the netmask, as is the case with IPv4.</p>
</li>
<li><p>Router advertisements enable address autoconfiguration. Autoconfiguration
is not implemented in IPv4.</p>
</li>
<li><p><A NAME="indexterm-1285"></A>Neighbor Discovery enables IPv6 routers to advertise an MTU for
hosts to use on the link. Consequently, all nodes use the same MTU value on
links that lack a well-defined MTU. IPv4 hosts on the same network might have
different MTUs.</p>
</li>
<li><p><A NAME="indexterm-1286"></A><A NAME="indexterm-1287"></A>Unlike IPv4 broadcast addresses, IPv6 address resolution multicasts
are spread over 4 billion (2^32)  multicast addresses, greatly reducing address
resolution-related interrupts on nodes other than the target. Moreover, non-IPv6
machines should not be interrupted at all.</p>
</li>
<li><p><A NAME="indexterm-1288"></A><A NAME="indexterm-1289"></A>IPv6 redirects contain the link-local address of the new first
hop. Separate address resolution is not needed on receiving a redirect.</p>
</li>
<li><p>Multiple site prefixes can be associated with the same IPv6
network. By default, hosts learn all local site prefixes from router advertisements.
However, routers can be configured to omit some or all prefixes from router
advertisements. In such instances, hosts assume that destinations are on remote
networks. Consequently, hosts send the traffic to routers. A router can then
issue redirects, as appropriate.</p>
</li>
<li><p><A NAME="indexterm-1290"></A>Unlike IPv4, the recipient of an IPv6 redirect message assumes
that the new next-hop is on the local network. In IPv4, a host ignores redirect
messages that specify a next-hop that is not on the local network, according
to the network mask. The IPv6 redirect mechanism is analogous to the XRedirect
facility in IPv4. The redirect mechanism is useful on non-broadcast and shared
media links. On these networks, nodes should not  check for all prefixes for
local link destinations.</p>
</li>
<li><p><A NAME="indexterm-1291"></A><A NAME="indexterm-1292"></A>IPv6 neighbor unreachability detection improves packet delivery
in the presence of failing routers. This capability improves packet delivery
over partially failing or partitioned links. This capability also improves
packet delivery over nodes that change their link-local addresses. For example,
mobile nodes can move off the local network without losing any connectivity
because of stale ARP caches. IPv4 has no corresponding method for neighbor
unreachability detection.</p>
</li>
<li><p>Unlike ARP, Neighbor Discovery detects half-link failures
by  using neighbor unreachability detection. Neighbor Discovery avoids sending
traffic to neighbors when two-way connectivity is absent.</p>
</li>
<li><p><A NAME="indexterm-1293"></A><A NAME="indexterm-1294"></A>By using link-local addresses to uniquely identify routers, IPv6
hosts can maintain the router associations. The ability to identify routers
is required for router advertisements and for redirect messages. Hosts need
to maintain router associations if the site uses new global prefixes. IPv4
does not have a comparable method for identifying routers.</p>
</li>
<li><p>Because Neighbor Discovery messages have a hop limit of 255
upon receipt, the protocol is immune to spoofing attacks originating from
off-link nodes. In contrast, IPv4 off-link nodes can send ICMP redirect messages.
IPv4 off-link nodes can also send router advertisement messages.</p>
</li>
<li><p>By placing address resolution at the ICMP layer, Neighbor
Discovery becomes more media independent than ARP. Consequently, standard
IP authentication and security mechanisms can be used.</p>
</li>
</ul>
<A NAME="ipv6-ref-33"></A><h2>IPv6 Routing</h2>
<p><A NAME="indexterm-1295"></A><A NAME="indexterm-1296"></A>Routing in IPv6 is almost identical to IPv4 routing under Classless
Inter-Domain Routing (CIDR). The only difference is that the addresses are
128-bit IPv6 addresses instead of 32-bit IPv4 addresses. With very straightforward
extensions, all of IPv4's routing algorithms, such as OSPF, RIP, IDRP, and
IS-IS, can be used to route IPv6.</p>
<p>IPv6 also includes simple routing extensions that support powerful new
routing capabilities. The following list describes the new routing capabilities:</p>
<ul><li><p>Provider selection that is based on policy, performance, cost,
and so on</p>
</li>
<li><p>Host mobility, route to current location</p>
</li>
<li><p>Auto-readdressing, route to new address</p>
</li>
</ul>
<p>You obtain the new routing capabilities by creating sequences of IPv6
addresses that use the IPv6 routing option. An IPv6 source uses the routing
option to list one or more intermediate nodes, or topological group, to be
visited on the way to a packet's destination. This function is very similar
in function to IPv4's loose source and record route option.</p>
<p>To make address sequences a general function, IPv6 hosts are required,
in most instances, to reverse routes in a packet that a host receives. The
packet must be successfully authenticated by using the IPv6 authentication
header. The packet must contain address sequences in order to return the packet
to its originator. This technique forces IPv6 host implementations to support
the handling and reversal of source routes. The handling and reversal of source
routes is the key that enables providers to work with hosts that implement
the new IPv6 capabilities such as provider selection and extended addresses.</p>
<A NAME="ipv6-ref-35"></A><h3>Router Advertisement</h3>
<A NAME="indexterm-1297"></A><p>On multicast-capable links and point-to-point links, each router periodically
sends to the multicast group a router advertisement packet that announces
its availability. A host receives router advertisements from all routers,
building a list of default routers. Routers generate router advertisements
frequently enough so that hosts learn of their presence within a few minutes.
However, routers do not advertise frequently enough to rely on an absence
of advertisements to detect router failure. A separate detection algorithm
that determines neighbor unreachability provides failure detection. </p>
<A NAME="ipv6-ref-36"></A><h4>Router Advertisement Prefixes</h4>
<p><A NAME="indexterm-1298"></A><A NAME="indexterm-1299"></A>Router advertisements contain a list of subnet prefixes that is
used to determine if a host is on the same link (on-link) as the router. The
list of prefixes is also used for  autonomous address configuration. Flags
that are associated with the prefixes specify the intended uses of a particular
prefix. Hosts use the advertised on-link prefixes to build and maintain a
list that is used to decide when a packet's destination is on-link or beyond
a router. A destination can be on-link even though the destination is not
covered by any advertised on-link prefix. In such instances, a router can
send a redirect. The redirect informs the sender that the destination is a
neighbor.</p>
<p>Router advertisements, and per-prefix flags, enable routers to inform
hosts how to perform stateless address autoconfiguration. </p>
<A NAME="ipv6-ref-37"></A><h4>Router Advertisement Messages</h4>
<p><A NAME="indexterm-1300"></A>Router advertisement messages also contain Internet parameters,
such as the hop limit, that hosts should use in outgoing packets. Optionally,
router advertisement messages also contain link parameters, such as the link
MTU. This feature enables the centralized administration of critical parameters.
The parameters can be set on routers and automatically propagated to all hosts
that are attached.    </p>
<p>Nodes accomplish address resolution by sending to the multicast group
a neighbor solicitation that asks the target node to return its link-layer
address. Multicast neighbor solicitation messages are sent to the solicited-node
multicast address of the target address. The target returns its link-layer
address in a unicast neighbor advertisement message. A single request-response
pair of packets is sufficient for both the initiator and the target to resolve
each other's link-layer addresses. The initiator includes its link-layer address
in the neighbor solicitation.     </p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p60.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p62.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

