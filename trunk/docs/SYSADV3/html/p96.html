<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p94.html#dhcp-trouble-1">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p95.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p97.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="dhcp-trouble-5"></A><h2>Troubleshooting DHCP Client Configuration Problems</h2>
<p><A NAME="indexterm-1557"></A>The problems that you might encounter with a DHCP client fall into the
following categories:</p><ul><li><p><A HREF="p96.html#dhcp-trouble-12">Problems Communicating With the DHCP Server</A></p>
</li>
<li><p><A HREF="p99.html#dhcp-trouble-38">Problems With Inaccurate DHCP Configuration Information</A></p>
</li>
</ul>
<A NAME="dhcp-trouble-12"></A><h3>Problems Communicating With the DHCP Server</h3>
<p>This section describes problems that you might encounter as you add DHCP clients
to the network.</p>
<p>After you enable the client software and reboot the system, the client tries
to reach the DHCP server to obtain its network configuration. If the client fails
to reach the server, you might see error messages such as the following: </p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>DHCP or BOOTP server not responding </pre>
</td></table><br><p>Before you can determine the problem, you must gather diagnostic information
from both the client and the server. To gather information, you can perform the following
tasks:</p><ol Type="1"><li><p><A HREF="p96.html#dhcp-trouble-proc-14">How to Run the DHCP Client in Debugging Mode</A></p>
</li>
<li><p><A HREF="p96.html#dhcp-trouble-proc-18">How to Run the DHCP Server in Debugging Mode</A></p>
</li>
<li><p><A HREF="p96.html#dhcp-trouble-proc-21">How to Use <tt>snoop</tt> to Monitor DHCP Network Traffic</A></p>
</li>
</ol>
<p>You can do these things separately or concurrently.</p>
<p>The information that you gather can help you determine if the problem is with
the client, server, or a relay agent. Then, you can find a solution.</p>
<A NAME="dhcp-trouble-proc-14"></A><h4><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Run the DHCP Client in Debugging Mode</h4>
<A NAME="indexterm-1558"></A><p>If the client is not a Solaris DHCP client, refer to the client's documentation
for information about how to run the client in debugging mode. </p>
<p>If you have a Solaris DHCP client, use the following steps.</p>
<ol><A NAME="dhcp-trouble-step-16"></A><li><p><b>Become superuser on the DHCP client system.</b></p></li>
<A NAME="dhcp-trouble-step-17"></A><li><p><b>Kill the DHCP client daemon.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>pkill -x dhcpagent</b></tt></pre>
</td></table><br></li>
<li><p><b>Restart the daemon in debugging mode.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>/sbin/dhcpagent -d1 -f &amp;</b></tt></pre>
</td></table><br><p>The <tt>-d</tt> switch puts the DHCP client in debugging mode with
level 1 verbosity. The <tt>-f</tt> switch causes output to be sent to the
console instead of to <tt>syslog</tt>.</p>
</li>
<li><p><b>Configure the interface to start DHCP negotiation.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ifconfig </tt><i>interface<tt></i> dhcp start</b></tt></pre>
</td></table><br><p>Replace <i>interface</i> with the name of the network interface
of the client, such as <tt>ge0</tt>.</p>
<p>When run in debugging mode,
the client daemon displays messages to your screen while performing DHCP requests.
See <A HREF="p96.html#dhcp-trouble-13">Output from DHCP Client in Debugging Mode</A> for
information about client debugging mode output.</p>
</li>
</ol><A NAME="dhcp-trouble-proc-18"></A><h4><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Run the DHCP Server in Debugging Mode</h4>
<A NAME="indexterm-1559"></A><A NAME="indexterm-1560"></A><ol><A NAME="dhcp-trouble-step-19"></A><li><p><b>Become superuser on the server system.</b></p></li>
<A NAME="dhcp-trouble-step-20"></A><li><p><b>Stop the DHCP server temporarily.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>svcadm disable -t svc:/network/dhcp-server</b></tt></pre>
</td></table><br><p>You can also use DHCP Manager or <tt>dhcpconfig</tt> to stop the server.</p>
</li>
<li><p><b>Restart the daemon in debugging mode.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>/usr/lib/inet/in.dhcpd -d -v</b></tt></pre>
</td></table><br><p>You should also use any <tt>in.dhcpd</tt> command-line options that
you normally use when you run the daemon. For example, if you run the daemon as a
BOOTP relay agent, include the <tt>-r</tt> option with the <tt>in.dhcpd
-d -v</tt> command.</p>
<p>When run in debugging mode, the daemon displays
messages to your screen while processing DHCP or BOOTP requests. See <A HREF="p97.html#dhcp-trouble-20">Output from the DHCP Server in Debugging Mode</A> for information about server
debugging mode output.</p>
</li>
</ol><A NAME="dhcp-trouble-proc-21"></A><h4><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Use <tt>snoop</tt> to Monitor
DHCP Network Traffic</h4>
<A NAME="indexterm-1561"></A><ol><A NAME="dhcp-trouble-step-22"></A><li><p><b>Become superuser on the DHCP server system.</b></p></li>
<A NAME="dhcp-trouble-step-23"></A><li><p><b>Start <tt>snoop</tt> to begin tracing
network traffic across the server's network interface.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>/usr/sbin/snoop -d </tt><i>interface<tt></i> -o </tt><i>snoop-output-filename<tt></i> udp port 67 or udp port 68</b></tt></pre>
</td></table><br><p>For example, you might type the following command:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>#  <tt><b>/usr/sbin/snoop -d hme0 -o /tmp/snoop.output udp port 67 or udp port 68</b></tt></pre>
</td></table><br><p><tt>snoop</tt> continues to monitor the interface until you stop <tt>snoop</tt> by pressing Control-C after you have the information that you need.</p>
</li>
<A NAME="dhcp-trouble-step-24"></A><li><p><b>Boot the client system, or restart the <tt>dhcpagent</tt> on the client system.</b></p><p><A HREF="p96.html#dhcp-trouble-proc-14">How to Run the DHCP Client in Debugging Mode</A> describes how to restart <tt>dhcpagent</tt>.</p>
</li>
<A NAME="dhcp-trouble-step-26"></A><li><p><b>On the server system, use <tt>snoop</tt> to
display the output file with the contents of network packets:</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>/usr/sbin/snoop -i </tt><i>snoop-output-filename<tt></i> -x0 -v</b></tt></pre>
</td></table><br><p>For example, you might type the following command:</p>
<pre style="font-family:arial,helvetica,sans-serif"># <tt><b>/usr/sbin/snoop -i /tmp/snoop.output -x0 -v</b></tt></pre>
</li>
</ol><h5>See Also</h5><p>See <A HREF="p98.html#dhcp-trouble-30">DHCP <tt>snoop</tt> Output</A> for information
about interpreting the output.</p>
<A NAME="dhcp-trouble-13"></A><h4>Output from DHCP Client in Debugging Mode</h4>
<p><A NAME="indexterm-1562"></A>The following example shows normal output when a DHCP client in debugging
mode sends its DHCP request and receives its configuration information from a DHCP
server.</p>
<A NAME="dhcp-trouble-ex-33"></A><p><b>Example 17-1 </b>Normal Output from the DHCP Client in Debugging
Mode</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>/sbin/dhcpagent: debug: set_packet_filter: set filter 0x27fc8 (DHCP filter) 
/sbin/dhcpagent: debug: init_ifs: initted interface hme0 
/sbin/dhcpagent: debug: insert_ifs: hme0: sdumax 1500, optmax 1260, hwtype 1, hwlen 6 
/sbin/dhcpagent: debug: insert_ifs: inserted interface hme0 
/sbin/dhcpagent: debug: register_acknak: registered acknak id 5 
/sbin/dhcpagent: debug: unregister_acknak: unregistered acknak id 5 
/sbin/dhcpagent: debug: set_packet_filter: set filter 0x26018 (ARP reply filter)
/sbin/dhcpagent: info: setting IP netmask on hme0 to 255.255.192.0 
/sbin/dhcpagent: info: setting IP address on hme0 to 10.23.3.233 
/sbin/dhcpagent: info: setting broadcast address on hme0 to 10.23.63.255 
/sbin/dhcpagent: info: added default router 10.23.0.1 on hme0 
/sbin/dhcpagent: debug: set_packet_filter: set filter 0x28054 (blackhole filter) 
/sbin/dhcpagent: debug: configure_if: bound ifsp->if_sock_ip_fd 
/sbin/dhcpagent: info: hme0 acquired lease, expires Tue Aug 10 16:18:33 2006 
/sbin/dhcpagent: info: hme0 begins renewal at Tue Aug 10 15:49:44 2006 
/sbin/dhcpagent: info: hme0 begins rebinding at Tue Aug 10 16:11:03 2006</pre>
</td></table><br><p>If the client cannot reach the DHCP server, you might see debugging mode output
that is similar to the output shown in the following example.</p>
<A NAME="dhcp-trouble-ex-34"></A><p><b>Example 17-2 </b>Output Indicating a Problem from the DHCP
Client in Debugging Mode</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>/sbin/dhcpagent: debug: set_packet_filter: set filter 0x27fc8 (DHCP filter)
/sbin/dhcpagent: debug: init_ifs: initted interface hme0 
/sbin/dhcpagent: debug: select_best: no valid OFFER/BOOTP reply
/sbin/dhcpagent: debug: select_best: no valid OFFER/BOOTP reply
/sbin/dhcpagent: debug: select_best: no valid OFFER/BOOTP reply
 </pre>
</td></table><br><p>If you see this message, the client request never reached the server, or the
server cannot send a response to the client. Run <tt>snoop</tt> on the server
as described in <A HREF="p96.html#dhcp-trouble-proc-21">How to Use <tt>snoop</tt> to Monitor DHCP Network Traffic</A> to determine if packets from the client have reached
the server.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p95.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p97.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

