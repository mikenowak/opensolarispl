<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p119.html#ike-task-1">23.&nbsp;&nbsp;Configuring IKE (Tasks)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p121.html#ike-task-25">Configuring IKE With Public Key Certificates</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p123.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p125.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="ike-task-22"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Handle a Certificate Revocation List</h3>
<p>A certificate revocation list (CRL) contains outdated or compromised
certificates from a Certificate Authority. You have four ways to handle CRLs.</p>
<ul><li><p>You must instruct IKE to ignore CRLs if your CA organization
does not issue CRLs. This option is shown in <A HREF="p122.html#ike-task-trcert-1">Step&nbsp;6</A> in <A HREF="p122.html#ike-task-41">How to Configure IKE With Certificates Signed by a CA</A>.</p>
</li>
<li><p><A NAME="indexterm-2137"></A>You can instruct IKE to access the CRLs from a URI (uniform resource
indicator) whose address is embedded in the public key certificate from the
CA.</p>
</li>
<li><p><A NAME="indexterm-2138"></A>You can instruct IKE to access the CRLs from an LDAP server whose
DN (directory name) entry is embedded in the public key certificate from the
CA.</p>
</li>
<li><p><A NAME="indexterm-2139"></A>You can provide the CRL as an argument to the <tt>ikecert
certrldb</tt> command. For an example, see <A HREF="p124.html#ike-task-23">Example 23-4</A>.</p>
</li>
</ul>
<p>The following procedure describes how to instruct IKE to use CRLs from
a central distribution point.</p>
<ol><li><p><b><A NAME="indexterm-2140"></A>Display the certificate that you received from the CA.</b></p><table cellpadding="4" border="1" cols="1" width="100%"><td><pre># ikecert certdb -lv <i>certspec</i></pre>
</td></table><br><table border="0" cellspacing="5"><tr><td valign="top"><p><tt>-l</tt></p></td><td valign="top"><p>Lists certificates in the IKE certificate database.</p>
</td></tr><tr><td valign="top"><p><tt>-v</tt></p></td><td valign="top"><p>Lists the certificates in verbose mode. Use this option with
care.</p>
</td></tr><tr><td valign="top"><p><i>certspec</i></p></td><td valign="top"><p>Is a pattern that matches a certificate in the IKE certificate
database.</p>
</td></tr></table>
<p><A NAME="indexterm-2141"></A><A NAME="indexterm-2142"></A>For example, the following certificate was issued by Sun Microsystems.
Details have been altered.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certdb -lv example-protect.sun.com</b></tt>
Certificate Slot Name: 0   Type: dsa-sha1
   (Private key in certlocal slot 0)
 Subject Name: &lt;O=Sun Microsystems Inc, CN=example-protect.sun.com>
 Issuer Name: &lt;CN=Sun Microsystems Inc CA (Cl B), O=Sun Microsystems Inc>
 SerialNumber: 14000D93
   Validity:
      Not Valid Before: 2002 Jul 19th, 21:11:11 GMT
      Not Valid After:  2005 Jul 18th, 21:11:11 GMT
   Public Key Info:
      Public Modulus  (n) (2048 bits): C575A...A5
      Public Exponent (e) (  24 bits): 010001
   Extensions:
      Subject Alternative Names:
              DNS = example-protect.sun.com
      Key Usage: DigitalSignature KeyEncipherment
      [CRITICAL]
   <tt><b>CRL Distribution Points</b></tt>:
      Full Name:
         URI = #Ihttp://www.sun.com/pki/pkismica.crl#i
         DN = &lt;CN=Sun Microsystems Inc CA (Cl B), O=Sun Microsystems Inc>
      CRL Issuer: 
      Authority Key ID:
      Key ID:              4F ... 6B
      SubjectKeyID:        A5 ... FD
      Certificate Policies
      Authority Information Access</pre>
</td></table><br><p>Notice the <tt>CRL Distribution Points</tt> entry. The URI
entry indicates that this organization's CRL is available on the web. The
DN entry indicates that the CRL is available on an LDAP server. Once accessed
by IKE, the CRL is cached for further use.</p>
<p>To access the CRL,
you need to reach a distribution point.</p>
</li>
<li><p><b>Choose one of the following methods to access the CRL from a central
distribution point.</b></p><ul><li><p><b><A NAME="indexterm-2143"></A><A NAME="indexterm-2144"></A><A NAME="indexterm-2145"></A>Use the URI.</b></p><p>Add the keyword <tt>use_http</tt> to
the host's <tt>/etc/inet/ike/config</tt> file. For example, the <tt>ike/config</tt> file would appear similar to the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># Use CRL from organization's URI
<tt><b>use_http</b></tt>
...</pre>
</td></table><br></li>
<li><p><b><A NAME="indexterm-2146"></A><A NAME="indexterm-2147"></A>Use a web proxy.</b></p><p>Add the keyword <tt>proxy</tt> to
the <tt>ike/config</tt> file. The <tt>proxy</tt> keyword
takes a URL as an argument, as in the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># Use own web proxy
<tt><b>proxy "http://proxy1:8080"</b></tt></pre>
</td></table><br></li>
<li><p><b><A NAME="indexterm-2148"></A><A NAME="indexterm-2149"></A>Use an LDAP server.</b></p><p>Name the LDAP server as an argument
to the <tt>ldap-list</tt> keyword in the host's <tt>/etc/inet/ike/config</tt> file. Your organization provides the name of the LDAP server.
The entry in the <tt>ike/config</tt> file would appear similar
to the following:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># Use CRL from organization's LDAP
ldap-list "ldap1.sun.com:389,ldap2.sun.com"
...</pre>
</td></table><br></li>
</ul>
<p>IKE retrieves the CRL and caches the CRL until the certificate expires.</p>
</li>
</ol><A NAME="ike-task-23"></A><h5>Example 23-4 &nbsp;&nbsp;Pasting a CRL Into the Local <tt>certrldb</tt> Database</h5>
<p><A NAME="indexterm-2150"></A><A NAME="indexterm-2151"></A><A NAME="indexterm-2152"></A>If the PKI organization's CRL is not available from a central
distribution point, you can add the CRL manually to the local <tt>certrldb</tt> database.
Follow the PKI organization's instructions for extracting the CRL into a file, then add the
CRL to the database with the <tt>ikecert certrldb -a</tt> command.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># <tt><b>ikecert certrldb -a &lt; Sun.Cert.CRL</b></tt></pre>
</td></table><br><A NAME="ike-task-38"></A><h2>Configuring IKE for Mobile Systems
(Task Map)</h2>
<p><A NAME="indexterm-2153"></A><A NAME="indexterm-2154"></A>The following table points to procedures to configure IKE to handle
systems that log in remotely to a central site.</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Task</p></th><th scope="col"><p>Description</p></th><th scope="col"><p>For Instructions</p></th></tr>
<tr><td><p>Communicate with a central site from off-site</p></td><td><p>Enables off-site systems to communicate with a central site. The off-site
systems might be mobile.</p></td><td><p><A HREF="p124.html#ike-task-40">How to Configure IKE for Off-Site Systems</A>&nbsp;</p></td></tr>
<tr><td><p>Use a root certificate and IKE on a central system that accepts traffic
from mobile systems</p></td><td><p>Configures a gateway system to accept IPsec traffic from a system that
does not have a fixed IP address.</p></td><td><p><A HREF="p124.html#ike-task-39">Example 23-5</A>&nbsp;</p></td></tr>
<tr><td><p>Use a root certificate and IKE on a system that does not have a fixed
IP address</p></td><td><p>Configures a mobile system to protect its traffic to a central site,
such as company headquarters.</p></td><td><p><A HREF="p124.html#ike-task-43">Example 23-6</A>&nbsp;</p></td></tr>
<tr><td><p>Use self-signed certificates and IKE on a central system that accepts
traffic from mobile systems</p></td><td><p>Configures a gateway system with self-signed certificates to accept
IPsec traffic from a mobile system.</p></td><td><p><A HREF="p124.html#ike-task-47">Example 23-7</A>&nbsp;</p></td></tr>
<tr><td><p>Use self-signed certificates and IKE on a system that does not have
a fixed IP address</p></td><td><p>Configures a mobile system with self-signed certificates to protect
its traffic to a central site.</p></td><td><p><A HREF="p124.html#ike-task-49">Example 23-8</A>&nbsp;</p></td></tr>
</table><A NAME="ike-task-48"></A><h2>Configuring IKE for Mobile Systems</h2>
<A NAME="indexterm-2155"></A><A NAME="indexterm-2156"></A><A NAME="indexterm-2157"></A><A NAME="indexterm-2158"></A><A NAME="indexterm-2159"></A><p>When configured properly, home offices and mobile laptops can use IPsec
and IKE to communicate with their company's central computers. A blanket IPsec
policy that is combined with a public key authentication method enables off-site
systems to protect their traffic to a central system.</p>
<A NAME="ike-task-40"></A><h3><IMG border="0" alt="Procedure" src="graphics/procedure.gif">How to Configure IKE for Off-Site Systems</h3>
<p>IPsec and IKE require a unique ID to identify source and destination.
For off-site or mobile systems that do not have a unique IP address, you must
use another ID type. ID types such as DNS, DN, or email can be used to uniquely
identify a system. </p>
<p>Off-site or mobile systems that have unique IP addresses are still best
configured with a different ID type. For example, if the systems attempt to
connect to a central site from behind a NAT box, their unique addresses are
not used. A NAT box assigns an arbitrary IP address, which the central system
would not recognize.</p>
<p>Preshared keys also do not work well as an authentication mechanism
for mobile systems, because preshared keys require fixed IP addresses. Self-signed
certificates, or certificates from a PKI enable mobile systems to communicate
with the central site.</p>
<ol><li><p><b>On the system console of the central system, assume the Primary
Administrator role or become superuser.</b></p><p>The Primary Administrator
role includes the Primary Administrator profile. To create the role and assign
the role to a user, see Chapter 2, "Working With the Solaris Management Console (Tasks)," in <i>System Administration Guide: Basic Administration</i>.</p>
<p><hr size="1" noshade><p><b>Note - </b>Logging in remotely exposes security-critical traffic to eavesdropping.
Even if you somehow protect the remote login, the security of the system is
reduced to the security of the remote login session.</p>
<hr size="1" noshade></p></li>
<li><p><b>Configure the central system to recognize mobile systems.</b></p><ol Type="a"><li><p><b>Set up the <tt>/etc/hosts</tt> file.</b></p><p>The
central system does not have to recognize specific addresses for the mobile
systems.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># /etc/hosts on <i>central</i>
<i>central</i> 192.<i>xxx.xxx.x</i></pre>
</td></table><br></li>
<li><p><b>Set up the <tt>ipsecinit.conf</tt> file.</b></p><p>The
central system needs a policy that allows a wide range of IP addresses. Later,
certificates in the IKE policy ensure that the connecting systems are legitimate.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># /etc/inet/ipsecinit.conf on <i>central</i>
# Keep everyone out unless they use this IPsec policy:
{} ipsec {encr_algs aes encr_auth_algs md5 sa shared}</pre>
</td></table><br></li>
<li><p><b>Set up the <tt>ike.config</tt> file.</b></p><p>DNS
identifies the central system. Certificates are used to authenticate the system.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/inet/ike/ike.config on <i>central</i>
# Global parameters
#
# Find CRLs by URI, URL, or LDAP
# Use CRL from organization's URI
use_http
#
# Use web proxy
proxy "http://<i>somecache.domain:port</i>/"
#
# Use LDAP server
ldap_server   "<i>ldap-server1.domain.org</i>,<i>ldap2.domain.org:port</i>"
#
# List CA-signed certificates
cert_root    "C=US, O=<i>Domain</i> <i>Org</i>, CN=<i>Domain STATE</i>"
#
# List self-signed certificates - trust server and enumerated others
#cert_trust    "DNS=<i>central.domain.org</i>"
#cert_trust    "DNS=<i>mobile.domain.org</i>"
#cert_trust    "DN=CN=<i>Domain Org STATE</i> (<i>CLASS</i>), O=<i>Domain Org</i>
#cert_trust    "email=root@<i>central.domain.org</i>"
#cert_trust    "email=<i>user1@mobile.domain.org</i>"
#

# Rule for mobile systems with certificate
{
  label "Mobile systems with certificate"
  local_id_type DNS

# Any mobile system who knows my DNS or IP can find me.

  local_id "<i>central.domain.org</i>"
  local_addr 192.<i>xxx.xxx.x</i>

# Root certificate ensures trust,
# so allow any remote_id and any remote IP address.
  remote_id ""
  remote_addr 0.0.0.0/0

p2_pfs 5

p1_xform
{auth_method rsa_sig oakley_group 5 encr_alg blowfish auth_alg md5 }
}</pre>
</td></table><br></li>
</ol>
</li>
<li><p><b>Log in to each mobile system, and configure the system to find
the central system.</b></p><ol Type="a"><li><p><b>Set up the <tt>/etc/hosts</tt> file.</b></p><p>The <tt>/etc/hosts</tt> file does not need an address for the mobile system,
but can provide one. The file must contain a public IP address for the central
system.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># /etc/hosts on <i>mobile</i>
<i>mobile</i> 10.<i>x.x.xx</i>
<i>central</i> 192.<i>xxx.xxx.x</i></pre>
</td></table><br></li>
<li><p><b>Set up the <tt>ipsecinit.conf</tt> file.</b></p><p>The
mobile system needs to find the central system by its public IP address. The
systems must configure the same IPsec policy.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># /etc/inet/ipsecinit.conf on <i>mobile</i>
# Find <i>central</i>
{raddr 192.<i>xxx.xxx.x</i>} ipsec {encr_algs aes encr_auth_algs md5 sa shared}</pre>
</td></table><br></li>
<li><p><b>Set up the <tt>ike.config</tt> file. </b></p><p>The
identifier cannot be an IP address. The following identifiers are valid for
mobile systems:</p>
<ul><li><p><tt>DN=</tt><i>ldap-directory-name</i></p>
</li>
<li><p><tt>DNS=</tt><i>domain-name-server-address</i></p>
</li>
<li><p><tt>email=</tt><i>email-address</i></p>
</li>
</ul>
<p>Certificates are used to authenticate the mobile system.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/inet/ike/ike.config on <i>mobile</i>
# Global parameters
#
# Find CRLs by URI, URL, or LDAP
# Use CRL from organization's URI
use_http
#
# Use web proxy
proxy "http://<i>somecache.domain:port</i>/"
#
# Use LDAP server
ldap_server   "<i>ldap-server1.domain.org</i>,<i>ldap2.domain.org:port</i>"
#
# List CA-signed certificates
cert_root    "C=US, O=<i>Domain</i> <i>Org</i>, CN=<i>Domain STATE</i>"
#
# Self-signed certificates - trust me and enumerated others
#cert_trust    "DNS=<i>mobile.domain.org</i>"
#cert_trust    "DNS=<i>central.domain.org</i>"
#cert_trust    "DN=CN=<i>Domain Org STATE</i> (<i>CLASS</i>), O=<i>Domain Org</i>
#cert_trust    "email=<i>user1@domain.org</i>"
#cert_trust    "email=root@<i>central.domain.org</i>"
#
# Rule for off-site systems with root certificate
{
	label "Off-site <i>mobile</i> with certificate"
	local_id_type DNS

# NAT-T can translate local_addr into any public IP address
# <i>central</i> knows me by my DNS

	local_id "<i>mobile.domain.org</i>"
	local_addr 0.0.0.0/0

# Find <i>central</i> and trust the root certificate
	remote_id "<i>central.domain.org</i>"
	remote_addr 192.<i>xxx.xxx.x</i>

p2_pfs 5

p1_xform
{auth_method rsa_sig oakley_group 5 encr_alg blowfish auth_alg md5 }
}</pre>
</td></table><br></li>
</ol>
</li>
<li><p><b>Reboot each system when it is configured.</b></p><p>Or, stop
and start the <tt>in.iked</tt> daemon.</p>
</li>
</ol><A NAME="ike-task-39"></A><h5>Example 23-5 &nbsp;&nbsp;Configuring a Central Computer to Accept IPsec Traffic From a Mobile
System</h5>
<A NAME="indexterm-2160"></A><A NAME="indexterm-2161"></A><p>IKE can initiate negotiations from behind a NAT box. However, the ideal
setup for IKE is without an intervening NAT box. In the following example,
root certificates have been issued by a CA. The CA certificates have been
 placed on the mobile system and the central system. A central system accepts IPsec negotiations
from a system behind a NAT box. <tt>main1</tt> is the company
system that can accept connections from off-site systems. To set up the off-site
systems, see <A HREF="p124.html#ike-task-43">Example 23-6</A>.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/hosts on main1
main1 192.168.0.100</pre>
</td></table><br><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/inet/ipsecinit.conf on main1
# Keep everyone out unless they use this IPsec policy:
{} ipsec {encr_algs aes encr_auth_algs md5 sa shared}</pre>
</td></table><br><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/inet/ike/ike.config on main1
# Global parameters
#
# Find CRLs by URI, URL, or LDAP
# Use CRL from organization's URI
use_http
#
# Use web proxy
proxy "http://cache1.domain.org:8080/"
#
# Use LDAP server
ldap_server   "ldap1.domain.org,ldap2.domain.org:389"
#
# List CA-signed certificate
cert_root "C=US, O=ExamplePKI Inc, OU=PKI-Example, CN=Example PKI"
#
# Rule for off-site systems with root certificate
{
  label "Off-site system with root certificate"
  local_id_type DNS
  local_id "main1.domain.org"
  local_addr 192.168.0.100

# Root certificate ensures trust,
# so allow any remote_id and any remote IP address.
  remote_id ""
  remote_addr 0.0.0.0/0

p2_pfs 5

p1_xform
{auth_method rsa_sig oakley_group 5 encr_alg blowfish auth_alg md5}
p1_xform
{auth_method rsa_sig oakley_group 5 encr_alg 3des auth_alg md5}
p1_xform
{auth_method rsa_sig oakley_group 5 encr_alg blowfish auth_alg sha}
p1_xform
{auth_method rsa_sig oakley_group 5 encr_alg 3des auth_alg sha}
}</pre>
</td></table><br><A NAME="ike-task-43"></A><h5>Example 23-6 &nbsp;&nbsp;Configuring a System Behind a NAT With IPsec</h5>
<p>In the following example, root certificates have been issued by a CA
and placed on the mobile system and the central system. <tt>mobile1</tt> is connecting
to the company headquarters from home. The Internet service provider (ISP)
network uses a NAT box to enable the ISP to assign <tt>mobile1</tt> a
private address. The NAT box then translates the private address into a public
IP address that is shared with other ISP network nodes. Company headquarters
is not behind a NAT. For setting up the computer at company headquarters,
see <A HREF="p124.html#ike-task-39">Example 23-5</A>.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/hosts on mobile1
mobile1 10.1.3.3
main1 192.168.0.100</pre>
</td></table><br><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/inet/ipsecinit.conf on mobile1
# Find main1
{raddr 192.168.0.100} ipsec {encr_algs aes encr_auth_algs md5 sa shared}</pre>
</td></table><br><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/inet/ike/ike.config on mobile1
# Global parameters
#
# Find CRLs by URI, URL, or LDAP
# Use CRL from organization's URI
use_http
#
# Use web proxy
proxy "http://cache1.domain.org:8080/"
#
# Use LDAP server
ldap_server   "ldap1.domain.org,ldap2.domain.org:389"
#
# List CA-signed certificate
cert_root "C=US, O=ExamplePKI Inc, OU=PKI-Example, CN=Example PKI"
#
# Rule for off-site systems with root certificate
{
  label "Off-site mobile1 with root certificate"
  local_id_type DNS
  local_id "mobile1.domain.org"
  local_addr 0.0.0.0/0

# Find main1 and trust the root certificate
  remote_id "main1.domain.org"
  remote_addr 192.168.0.100

p2_pfs 5

p1_xform
{auth_method rsa_sig oakley_group 5 encr_alg blowfish auth_alg md5 }
}</pre>
</td></table><br><A NAME="ike-task-47"></A><h5>Example 23-7 &nbsp;&nbsp;Accepting Self-Signed Certificates From a Mobile System</h5>
<A NAME="indexterm-2162"></A><A NAME="indexterm-2163"></A><p>In the following example, self-signed certificates have been issued
and are on the mobile and the central system. <tt>main1</tt> is
the company system that can accept connections from off-site systems. To set
up the off-site systems, see <A HREF="p124.html#ike-task-49">Example 23-8</A>.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/hosts on main1
main1 192.168.0.100</pre>
</td></table><br><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/inet/ipsecinit.conf on main1
# Keep everyone out unless they use this IPsec policy:
{} ipsec {encr_algs aes encr_auth_algs md5 sa shared}</pre>
</td></table><br><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/inet/ike/ike.config on main1
# Global parameters
#
# Self-signed certificates - trust me and enumerated others
cert_trust    "DNS=main1.domain.org"
cert_trust    "jdoe@domain.org"
cert_trust    "user2@domain.org"
cert_trust    "user3@domain.org"
#
# Rule for off-site systems with trusted certificate
{
  label "Off-site systems with trusted certificates"
  local_id_type DNS
  local_id "main1.domain.org"
  local_addr 192.168.0.100

# Trust the self-signed certificates
# so allow any remote_id and any remote IP address.
  remote_id ""
  remote_addr 0.0.0.0/0

p2_pfs 5

p1_xform
{auth_method rsa_sig oakley_group 5 encr_alg blowfish auth_alg md5 }
}</pre>
</td></table><br><A NAME="ike-task-49"></A><h5>Example 23-8 &nbsp;&nbsp;Using Self-Signed Certificates to Contact a Central System</h5>
<p>In the following example, <tt>mobile1</tt> is connecting
to the company headquarters from home. The certificates have been issued and
placed on the mobile and the central system. The ISP network uses a NAT box
to enable the ISP to assign <tt>mobile1</tt> a private address.
The NAT box then translates the private address into a public IP address that
is shared with other ISP network nodes. Company headquarters is not behind
a NAT. To set up the computer at company headquarters, see <A HREF="p124.html#ike-task-47">Example 23-7</A>.</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/hosts on mobile1
mobile1 10.1.3.3
main1 192.168.0.100</pre>
</td></table><br><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/inet/ipsecinit.conf on mobile1
# Find main1
{raddr 192.168.0.100} ipsec {encr_algs aes encr_auth_algs md5 sa shared}</pre>
</td></table><br><table cellpadding="4" border="1" cols="1" width="100%"><td><pre>## /etc/inet/ike/ike.config on mobile1
# Global parameters

# Self-signed certificates - trust me and the central system
cert_trust    "jdoe@domain.org"
cert_trust    "DNS=main1.domain.org"
#
# Rule for off-site systems with trusted certificate
{
  label "Off-site mobile1 with trusted certificate"
  local_id_type email
  local_id "jdoe@domain.org"
  local_addr 0.0.0.0/0

# Find main1 and trust the certificate
  remote_id "main1.domain.org"
  remote_addr 192.168.0.100

p2_pfs 5

p1_xform
{auth_method rsa_sig oakley_group 5 encr_alg blowfish auth_alg md5 }
}</pre>
</td></table><br>
</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p123.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p125.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

