<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@16097-->
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=iso-8859-1">
<title>System Administration Guide: IP Services</title>
<link rel="stylesheet" type="text/css" href="css/default.css">
<!--stopindex-->
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<A href="toc.html">System Administration Guide: IP Services</A> <font color="red">&gt;&gt;</font> <nobr><A HREF="p150.html#mipmanaging-22">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p150.html#mipmanaging-26">Mobile IP Configuration File</A></nobr> <font color="red">&gt;&gt;</font> <nobr><A HREF="p152.html#mipmanaging-5">Configuration File Sections and Labels</A></nobr>&nbsp;
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="grey1"><td></td><td align="right"><A HREF="p153.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p155.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<A NAME="mipmanaging-30"></A><h5>Mobile Node Identified by Its NAI</h5>
<A NAME="indexterm-2774"></A><A NAME="indexterm-2775"></A><p><A NAME="indexterm-2776"></A>The <tt>Address</tt> section for a mobile node that is identified
by its NAI contains the <tt>Type</tt>, <tt>SPI</tt>, and <tt>Pool</tt> labels. The NAI parameter enables you to identify mobile nodes through
their NAI. The <tt>Address</tt> section, using the NAI parameter, has the
following syntax:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>[Address <i>NAI</i>]
     Type = Node
     SPI = <i>SPI-identifier</i>
     Pool = <i>pool-identifier</i></pre>
</td></table><br><p>To use pools, you identify mobile nodes through their NAI. The <tt>Address</tt> section permits you to configure an NAI, as opposed to a home address.
An NAI uses the format <tt>user@domain</tt>. You use the <tt>Pool</tt> label
to specify which address pool to use in order to allocate the home address to the
mobile node.</p>
<p><A NAME="indexterm-2777"></A>The following table describes the labels and values that you can use in
the <tt>Address</tt> section for a mobile node that is identified by its
NAI.</p>
<A NAME="mipmanaging-tbl-32"></A><p><b>Table 29-7 </b><tt>Address</tt> Section
Labels and Values (Mobile Node Identified by Its NAI)</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Label</p></th><th scope="col"><p>Value</p></th><th scope="col"><p>Description</p></th></tr>
<tr><td><p><tt>Type</tt></p></td><td><p><tt>node</tt></p></td><td><p><A NAME="indexterm-2778"></A>Specifies that the entry is for a mobile node</p></td></tr>
<tr><td><p><tt>SPI</tt></p></td><td><p><tt>n</tt></p></td><td><p><A NAME="indexterm-2779"></A>Specifies the SPI value for the associated entry</p></td></tr>
<tr><td><p><tt>Pool</tt></p></td><td><p><tt>n</tt></p></td><td><p><A NAME="indexterm-2780"></A>Allocates the pool from which an address is assigned to a mobile node</p></td></tr>
</table><p>You must have corresponding <tt>SPI</tt> and <tt>Pool</tt> sections
for the <tt>SPI</tt> and <tt>Pool</tt> labels that are defined
in an <tt>Address</tt> section with a mobile node that is identified by
its NAI, as shown in the following figure.</p>
<A NAME="mipmanaging-fig-35"></A><p><b>Figure 29-1 </b>Corresponding <tt>SPI</tt> and <tt>Pool</tt> Sections for Address Section With Mobile Node Identified by Its NAI</p>
<IMG src="figures/AddressRelation.gif" class="figure" alt="Shows that an SPI of 251 and POOL of 10 correspond to the same
SPI and POOL numbers in the ADDRESS NAI section." title="Shows that an SPI of 251 and POOL of 10 correspond to the same
SPI and POOL numbers in the ADDRESS NAI section."><A NAME="mipmanaging-31"></A><h5>Default Mobile Node</h5>
<A NAME="indexterm-2781"></A><A NAME="indexterm-2782"></A><p>The <tt>Address</tt> section for a default mobile node contains the <tt>Type</tt>, <tt>SPI</tt>, and <tt>Pool</tt> labels. The <tt>Node-Default</tt> parameter enables you to permit all mobile nodes to get service
if they have the correct SPI (defined in this section). The <tt>Address</tt> section,
using the <tt>Node-Default</tt> parameter, has the following syntax:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>[Address Node-Default]
     Type = Node
     SPI = <i>SPI-identifier</i>
     Pool = <i>pool-identifier</i></pre>
</td></table><br><p>The <tt>Node-Default</tt> parameter enables you to reduce the size
of the configuration file. Otherwise, each mobile node requires its own section. However,
the <tt>Node-Default</tt> parameter does pose a security risk. If a mobile
node is no longer trusted for any reason, you need to update the security information
on all trusted mobile nodes. This task can be very tedious. However, you can use the <tt>Node-Default</tt> parameter in networks that consider security risks unimportant. </p>
<p><A NAME="indexterm-2783"></A>The following table describes the labels and values that you can use in
the <tt>Address</tt> section for a default mobile node.</p>
<A NAME="mipmanaging-tbl-33"></A><p><b>Table 29-8 </b><tt>Address</tt> Section
Labels and Values (Default Mobile Node)</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Label</p></th><th scope="col"><p>Value</p></th><th scope="col"><p>Description</p></th></tr>
<tr><td><p><tt>Type</tt></p></td><td><p><tt>node</tt></p></td><td><p><A NAME="indexterm-2784"></A>Specifies that the entry is for a mobile node</p></td></tr>
<tr><td><p><tt>SPI</tt></p></td><td><p><tt>n</tt></p></td><td><p><A NAME="indexterm-2785"></A>Specifies the SPI value for the associated entry</p></td></tr>
<tr><td><p><tt>Pool</tt></p></td><td><p><tt>n</tt></p></td><td><p><A NAME="indexterm-2786"></A>Allocates the pool from which an address is assigned to a mobile node</p></td></tr>
</table><p>You must have corresponding <tt>SPI</tt> and <tt>Pool</tt> sections
for the <tt>SPI</tt> and <tt>Pool</tt> labels that are defined
in the <tt>Address</tt> section with a default mobile node, as shown in
the following figure.</p>
<A NAME="mipmanaging-fig-34"></A><p><b>Figure 29-2 </b>Corresponding <tt>SPI</tt> and <tt>Pool</tt> Sections for Address Section With a Default Mobile Node</p>
<IMG src="figures/AddressRelationDefault.gif" class="figure" alt="Shows that an SPI of 251 and POOL of 10 correspond to the same
SPI and POOL numbers in the ADDRESS NODE-DEFAULT section." title="Shows that an SPI of 251 and POOL of 10 correspond to the same
SPI and POOL numbers in the ADDRESS NODE-DEFAULT section."><A NAME="mipmanaging-1"></A><h2>Configuring the Mobility IP Agent</h2>
<p><A NAME="indexterm-2787"></A><A NAME="indexterm-2788"></A><A NAME="indexterm-2789"></A>You can use the <tt>mipagentconfig</tt> command to configure
the mobility agent. This command enables you to create or modify any parameter in
the <tt>/etc/inet/mipagent.conf</tt> configuration file. Specifically,
you can change any setting. Also, you can add or delete mobility clients, pools, and
SPIs. The <tt>mipagentconfig</tt> command has the following syntax:</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre># mipagentconfig &lt;command> &lt;parameter> &lt;value></pre>
</td></table><br><p><A NAME="indexterm-2790"></A>The following table describes the commands that you can use with <tt>mipagentconfig</tt> to create or modify parameters in the <tt>/etc/inet/mipagent.conf</tt> configuration file.</p>
<A NAME="mipmanaging-tbl-19"></A><p><b>Table 29-9 </b><tt>mipagentconfig</tt> Subcommands</p>

<table cellspacing="5" border="1">
<tr><th scope="col"><p>Command</p></th><th scope="col"><p>Description</p></th></tr>
<tr><td><p><tt>add</tt></p></td><td><p>Used to add advertisement parameters, security parameters,	SPIs, and addresses
to the configuration file</p></td></tr>
<tr><td><p><tt>change</tt></p></td><td><p>Used to change advertisement parameters, security parameters, SPIs, and addresses
in the configuration file</p></td></tr>
<tr><td><p><tt>delete</tt></p></td><td><p>Used to delete advertisement parameters, security parameters, SPIs, and addresses
from the configuration file</p></td></tr>
<tr><td><p><tt>get</tt></p></td><td><p>Used to display current values in the configuration file</p></td></tr>
</table><p>See the <tt>mipagentconfig</tt>(1M) man
page for a description of command parameters and acceptable values. <A HREF="p146.html#mipimplementing-63">Modifying the Mobile IP Configuration File</A> provides procedures that use the <tt>mipagentconfig</tt> command.</p>
<A NAME="mipmanaging-3"></A><h2>Mobile IP Mobility Agent Status</h2>
<p><A NAME="indexterm-2791"></A><A NAME="indexterm-2792"></A><A NAME="indexterm-2793"></A><A NAME="indexterm-2794"></A><A NAME="indexterm-2795"></A><A NAME="indexterm-2796"></A><A NAME="indexterm-2797"></A>You can use the <tt>mipagentstat</tt> command to display a foreign
agent's visitor list and a home agent's binding table. You can also display the security
associations with an agent's mobility agent peers. To display the foreign agent visitor
list, you use the <tt>mipagentstat</tt> command's <tt>-f</tt> option.
To display the home agent binding table, you use the <tt>mipagentstat</tt> command's <tt>-h</tt> option. To display the security associations with an agent's
mobility agent peers, you use the <tt>mipagentstat</tt> command's <tt>-p</tt> option. The following examples show typical output when the <tt>mipagentstat</tt> command is used with these options.</p>
<A NAME="mipmanaging-ex-20"></A><p><b>Example 29-1 </b>Foreign Agent Visitor List</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>Mobile Node     Home Agent     Time (s)     Time (s)  Flags
                               Granted      Remaining
--------------- -------------- ------------ --------- -----
foobar.xyz.com  ha1.xyz.com    600          125       .....T.
10.1.5.23       10.1.5.1       1000         10        .....T.</pre>
</td></table><br><A NAME="mipmanaging-ex-21"></A><p><b>Example 29-2 </b>Home Agent Binding Table</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>Mobile Node     Home Agent     Time (s)     Time (s)  Flags
                               Granted      Remaining
--------------- -------------- ------------ --------- -----
foobar.xyz.com  fa1.tuv.com    600          125       .....T.
10.1.5.23       123.2.5.12     1000         10        .....T.</pre>
</td></table><br><A NAME="mipmanaging-ex-45"></A><p><b>Example 29-3 </b>Mobility Agent Peer
Security Association Table</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>Foreign                  ..... Security Association(s).....
Agent                    Requests Replies  FTunnel  RTunnel
----------------------   -------- -------- -------- --------
forn-agent.eng.sun.com   AH       AH       ESP      ESP

Home                     ..... Security Association(s) .....
Agent                    Requests Replies  FTunnel  RTunnel
----------------------   -------- -------- -------- --------
home-agent.eng.sun.com   AH       AH       ESP      ESP
ha1.xyz.com              AH,ESP   AH       AH,ESP   AH,ESP</pre>
</td></table><br><p>See the <tt>mipagentstat</tt>(1M) man
page for more information about the command's options. <A HREF="p148.html#mipimplementing-5">Displaying Mobility Agent Status</A> provides procedures that use the <tt>mipagentstat</tt> command.</p>
<A NAME="mipmanaging-36"></A><h2>Mobile IP State Information</h2>
<A NAME="indexterm-2798"></A><A NAME="indexterm-2799"></A><p><A NAME="indexterm-2800"></A><A NAME="indexterm-2801"></A><A NAME="indexterm-2802"></A><A NAME="indexterm-2803"></A><A NAME="indexterm-2804"></A>On shutdown, the <tt>mipagent</tt> daemon stores internal state
information in <tt>/var/inet/mipagent_state</tt>. This event occurs only
when the <tt>mipagent</tt> provides services as a home agent. This state
information includes the list of mobile nodes that are being supported as a home agent,
their current care-of addresses, and remaining registration lifetimes. This state
information also includes the security association configuration with mobility agent
peers. If the <tt>mipagent</tt> daemon is terminated for maintenance and
restarted, <tt>mipagent_state</tt> is used to recreate as much of the
mobility agent's internal state as possible. The intention is to minimize service
disruption for mobile nodes that might be visiting other networks. If <tt>mipagent_state</tt> exists, it is read immediately after <tt>mipagent.conf</tt> every
time <tt>mipagent</tt> is started or restarted. </p>
<A NAME="mipmanaging-41"></A><h2><tt>netstat</tt> Extensions for Mobile
IP</h2>
<A NAME="indexterm-2805"></A><p>Mobile IP extensions have been added to the <tt>netstat</tt> command
to identify Mobile IP forwarding routes. Specifically, you can use the <tt>netstat</tt> command to display a new routing table that is called "Source-Specific."
See the <tt>netstat</tt>(1M) man page for
more information.</p>
<p>The following example shows the output of <tt>netstat</tt> when you
use the <tt>-nr</tt> flags.</p>
<A NAME="mipmanaging-ex-42"></A><p><b>Example 29-4 </b>Mobile IP Output From <tt>netstat</tt> Command</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>Routing Table:   IPv4 Source-Specific     
Destination      In If     Source      Gateway Flags  Use  Out If
--------------  ------- ------------ --------- -----  ---- -------
10.6.32.11      ip.tun1      --      10.6.32.97  UH      0 hme1
    --          hme1    10.6.32.11       --      U       0 ip.tun1</pre>
</td></table><br><p>The example shows the routes for a foreign agent that uses a reverse tunnel.
The first line indicates that the destination IP address <tt>10.6.32.11</tt> and
the incoming interface <tt>ip.tun1</tt> select <tt>hme1</tt> as
the interface that forwards the packets. The next line indicates that any packet that
originates from interface <tt>hme1</tt> and source address <tt>10.6.32.11</tt> must be forwarded to <tt>ip.tun1</tt>.</p>
<A NAME="mipmanaging-37"></A><h2><tt>snoop</tt> Extensions for Mobile IP</h2>
<A NAME="indexterm-2806"></A><p>Mobile IP extensions have been added to the <tt>snoop</tt> command
to identify Mobile IP traffic on the link. See the <tt>snoop</tt>(1M) man
page for more information.</p>
<p>The following example shows the output of <tt>snoop</tt> that runs
on the mobile node, <tt>mip-mn2</tt>.</p>
<A NAME="mipmanaging-ex-40"></A><p><b>Example 29-5 </b>Mobile IP Output From <tt>snoop</tt> Command</p>
<table cellpadding="4" border="1" cols="1" width="100%"><td><pre>mip-mn2# <tt><b>snoop</b></tt>
Using device /dev/hme (promiscuous mode)
  mip-fa2 -> 224.0.0.1    ICMP Router advertisement (Lifetime 200s [1]: 
{mip-fa2-80 2147483648}), (Mobility Agent Extension), (Prefix Lengths), 
(Padding)
  mip-mn2 -> mip-fa2   Mobile IP reg rqst 
  mip-fa2 -> mip-mn2   Mobile IP reg reply (OK code 0)</pre>
</td></table><br><p>This example shows that the mobile node received one of the periodically sent
mobility agent advertisements from the foreign agent, <tt>mip-fa2</tt>.
Then, <tt>mip-mn2</tt> sent a  registration request to <tt>mip-fa2</tt>, and in response, received a registration reply. The registration reply
indicates that the mobile node successfully registered with its home agent.</p>
<p>The <tt>snoop</tt> command also supports IPsec extensions. Consequently,
you can show how registration and tunnel packets are being protected.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr class="suntab"><td></td><td align="right"><A HREF="p153.html"><IMG BORDER="0" ALT="Previous" SRC="graphics/prev.gif"> Previous</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="toc.html">Contents</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="idx.html">Index</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="p155.html">Next <IMG BORDER="0" ALT="Next" SRC="graphics/next.gif"></A></td></tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2007 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

