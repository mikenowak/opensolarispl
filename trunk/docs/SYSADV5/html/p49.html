<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>LDAP Troubleshooting (Reference) - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-09-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)<?GenHTML /ReferencePage>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p48.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p50.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="setupproblems-1"></a>Chapter&nbsp;13<h3>LDAP Troubleshooting (Reference)</h3><a name="indexterm-505"></a><p>This chapter describes configuration problems and suggests solutions
for resolving them.</p>
<hr>
<p><b>Note - </b>The LDAP service is managed by the Service Management Facility.
Administrative actions on this service, such as enabling, disabling, or restarting,
can be performed by using the <tt>svcadm</tt> command. See <a href="p45.html#clientsetup-95">LDAP and the Service Management Facility</a> for
more information about using the Facility with LDAP. For an overview of the
Facility, refer to Chapter 14, Managing Services (Overview), in <i>System Administration Guide: Basic Administration</i>.
Also refer to the <tt>svcadm</tt>(1M) and <tt>svcs</tt>(1) man pages for more details.</p>
<hr>
<a name="clientsetup-66"></a><h3>Monitoring LDAP Client Status</h3>
<p>The following sections show various commands to help determine the state
of the LDAP client environment. Also see the man pages for additional information
about the options that can be used.</p>
<p>For an overview of the Service Management Facility, refer to Chapter 14, Managing Services (Overview), in <i>System Administration Guide: Basic Administration</i>.
Also refer to the <tt>svcadm</tt>(1M) and <tt>svcs</tt>(1) man pages for more details.</p>
<a name="clientsetup-67"></a><h4>Verifying <tt>ldap_cachemgr</tt> Is
Running</h4>
<p>The <tt>ldap_cachemgr</tt> daemon must be running and functioning
correctly at all times. Otherwise, the system doesn't work. When you start
the LDAP client, the client starts <tt>ldap_cachemgr</tt> daemon
automatically. So, if the <tt>ldap_cachemgr</tt> is not running,
the LDAP client will be disabled. Following are two methods for determining
if the LDAP client is online.</p>
<ul><li><p>Use the <tt>svcs</tt> command.</p>
<pre># <tt><b>svcs \*ldap\*</b></tt>
STATE          STIME    FMRI
disabled       Aug_24   svc:/network/ldap/client:default</pre><p>or</p>
<pre># <tt><b>svcs</b></tt> <tt>-l</tt> <tt><b>network/ldap/client:default</b></tt>
fmri         svc:/network/ldap/client:default
enabled      true
state        online
next_state   none
restarter    svc:/system/svc/restarter:default
contract_id  1598 
dependency   require_all/none file://localhost/var/ldap/ldap_client_file (-)
dependency   require_all/none svc:/network/initial (online)
dependency   require_all/none svc:/system/filesystem/minimal (online)</pre></li>
<li><p>Pass the <tt>-g</tt> option to <tt>ldap_cachemgr</tt>.</p>
<p>This option provides more extensive status information, which
is useful when you diagnose a problem.</p>
<pre># <tt><b>/usr/lib/ldap/ldap_cachemgr</b></tt> <tt>-g</tt><tt><b></b></tt>
cachemgr configuration:
server debug level          0
server log file "/var/ldap/cachemgr.log"
number of calls to ldapcachemgr         19

cachemgr cache data statistics:
Configuration refresh information:
  Previous refresh time: 2001/11/16 18:33:28
  Next refresh time:     2001/11/16 18:43:28
Server information:
  Previous refresh time: 2001/11/16 18:33:28
  Next refresh time:     2001/11/16 18:36:08
  server: 192.168.0.0, status: UP
  server: 192.168.0.1, status: ERROR
    error message: Can't connect to the LDAP server
Cache data information:
  Maximum cache entries:          256
  Number of cache entries:          2</pre></li>
</ul>
<p>For more information about the <tt>ldap_cachemgr</tt> daemon,
see the <tt>ldap_cachemgr</tt>(1M) man page.</p>
<a name="clientsetup-68"></a><h4>Checking the Current Profile Information</h4>
<p>Become superuser or assume an equivalent role, and run <tt>ldapclient</tt> with
the <tt>list</tt> option.</p>
<pre># <tt><b>ldapclient list</b></tt>
NS_LDAP_FILE_VERSION= 2.0
NS_LDAP_BINDDN= cn=proxyagent,ou=profile,dc=west,dc=example,dc=com
NS_LDAP_BINDPASSWD= {NS1}4a3788e8c053424f
NS_LDAP_SERVERS= 192.168.0.1, 192.168.0.10
NS_LDAP_SEARCH_BASEDN= dc=west,dc=example,dc=com
NS_LDAP_AUTH= simple
NS_LDAP_SEARCH_REF= TRUE
NS_LDAP_SEARCH_SCOPE= one
NS_LDAP_SEARCH_TIME= 30
NS_LDAP_SERVER_PREF= 192.168.0.1
NS_LDAP_PROFILE= pit1
NS_LDAP_CREDENTIAL_LEVEL= proxy
NS_LDAP_SERVICE_SEARCH_DESC= passwd:ou=people,?sub
NS_LDAP_SERVICE_SEARCH_DESC= group:ou=group,dc=west,dc=example,dc=com?one
NS_LDAP_BIND_TIME= 5</pre><p>Currently the <tt>/var/ldap</tt> files are in ASCII format.
Because the files could change to binary at some time, concatenating the files
would cause problems.  <tt>ldapclient</tt> <tt>list</tt> is
the supported method for accessing this information. See the <tt>ldapclient</tt>(1M) man page
for more information.</p>
<a name="clientsetup-70"></a><h4>Verifying Basic Client-Server Communication</h4>
<p>The best way to show that your client is talking to the LDAP server
is with the <tt>ldaplist</tt> command.  Using <tt>ldaplist</tt> with
no arguments dumps all the containers on the server.  This works as long as
the containers exist, and do not have to be populated. See the <tt>ldaplist</tt>(1) man page for
more information.</p>
<p>If the first step works, you can try <tt>ldaplist passwd <i>username</i></tt> or <tt>ldaplist hosts <i>hostname</i></tt> but if they contain lots of data you might want to
pick a less populated service, or pipe them to <tt>head</tt> or <tt>more</tt>.</p>
<a name="clientsetup-69"></a><h4>Checking Server Data From a Non-Client Machine</h4>
<p>Most of the commands in the previous sections assume you already have
created an LDAP client.  If you have not created a client and want to check
the data on the server, use the <tt>ldapsearch</tt> command.  The
following example lists all of the containers.</p>
<pre># <tt><b>ldapsearch</b></tt> <tt>-h</tt> <tt><b>server1</b></tt> <tt>-b</tt> <tt><b>"dc=west,dc=example,dc=com"</b></tt> <tt>-s</tt> <tt><b>one "objectclass=*"</b></tt></pre><p>In Solaris 9 and earlier releases, the <tt>ldapsearch</tt> command,
by default, produced output in a nonstandard textual representation. The default
output for <tt>ldapsearch</tt> in later Solaris releases is the
industry standardized LDIF format that is defined by RFC-2849. All versions
of <tt>ldapsearch</tt> can output LDIF format using the <tt>-L</tt> option.</p>
<a name="setupproblems-3"></a><h3>LDAP Configuration Problems and Solutions</h3>
<p>The following sections describe LDAP configuration problems and suggests
solutions to the problems.</p>
<a name="setupproblems-13"></a><h4>Unresolved Hostname</h4>
<p><a name="indexterm-506"></a><a name="indexterm-507"></a>The Solaris platform LDAP client back end returns fully qualified
host names for host lookups, such as host names returned by <tt>gethostbyname()</tt> and <tt>getaddrinfo()</tt>.  If the name stored is qualified,
that is, contains at least one dot, the client returns the name as is. For
example, if the name stored is <tt>hostB.eng</tt>, the returned
name is <tt>hostB.eng</tt>.</p>
<p>If the name stored in the LDAP directory is not qualified (it does not
contain a dot), the client back end appends the domain part to the name. For
example, if the name stored is <tt>hostA</tt>, the returned name
is <tt>hostA.domainname</tt>.</p>
<a name="setupproblems-7"></a><h4>Unable to Reach Systems in the LDAP Domain
Remotely</h4>
<p><a name="indexterm-508"></a><a name="indexterm-509"></a>If the DNS domain name is different from the LDAP domain name,
then the LDAP naming service cannot be used to serve host names unless the
host names are stored fully qualified.</p>
<a name="setupproblems-9"></a><h4>Login Does Not Work</h4>
<p><a name="indexterm-510"></a>LDAP clients use the PAM modules for user authentication during
login. When using the standard UNIX PAM module, the password is read from
the server and checked on the client side. This can fail due to one of the
following reasons:</p>
<ol><li><p><tt>ldap</tt> is not used by the <tt>passwd</tt> service
in the <tt>/etc/nsswitch.conf</tt> file.</p>
</li>
<li><p>The user's <tt>userPassword</tt> attribute on the
server list is not readable by the proxy agent. You need to allow at least
the proxy agent to read the password because the proxy agent returns it to
the client for comparison. <tt>pam_ldap</tt> does not require read
access to the password.</p>
</li>
<li><p>The proxy agent might not have the correct password.</p>
</li>
<li><p>The entry does not have the <tt>shadowAccount</tt> object
class.</p>
</li>
<li><p>No password is defined for the user.</p>
<p>When you
use <tt>ldapaddent</tt>, you must use the <tt>-p</tt> option
to ensure that the password is added to the user entry. If you use <tt>ldapaddent</tt> without the <tt>-p</tt> option, the user's password is not
stored in the directory unless you also add the <tt>/etc/shadow</tt> file
by using <tt>ldapaddent</tt>.</p>
</li>
<li><p>No LDAP servers are reachable.</p>
<p>Check the status
of the servers.</p>
<pre># <tt><b>/usr/lib/ldap/ldap_cachemgr</b></tt> <tt>-g</tt><tt><b></b></tt></pre></li>
<li><p><tt>pam.conf</tt> is configured incorrectly.</p>
</li>
<li><p>The user is not defined in the LDAP namespace.</p>
</li>
<li><p><tt>NS_LDAP_CREDENTIAL_LEVEL</tt> is set to <tt>anonymous</tt> for <tt>pam_unix</tt>, and <tt>userPassword</tt> is
not available to anonymous users.</p>
</li>
<li><p>The password is not stored in <tt>crypt</tt> format.</p>
</li>
<li><p>If <tt>pam_ldap</tt> is configured to support account
management, login failure could be the result of one of the following:</p>
<ul><li><p>The user's password has expired.</p>
</li>
<li><p>The user's account is locked out due to too many failed login
attempts.</p>
</li>
<li><p>The user's account has been deactivated by the administrator.</p>
</li>
<li><p>The user tried to log in using a nonpassword-based program,
such as <tt>rsh</tt>, <tt>rlogin</tt>, <tt>ssh</tt>,
or <tt>sftp</tt>.</p>
</li>
</ul>
</li>
<li><p>If per-user
authentication and sasl/GSSAPI are being used, then some component of Kerberos
or the <tt>pam_krb5</tt> configuration is setup incorrectly.  Refer
to the <i>System Administration Guide: Security Services</i> for details on resolving these
issues.</p>
</li>
</ol>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p48.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p50.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2006 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

