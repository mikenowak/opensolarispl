<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Examples of Custom Maps - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-09-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)<?GenHTML /ReferencePage> > <a href="p55.html">15.&nbsp;&nbsp;Transitioning From NIS to LDAP (Overview/Tasks)</a> > <a href="p56.html#nis2ldap-2">Setting Up the NIS-to-LDAP Service</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p57.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p59.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="nis2ldap-63"></a><h4>Examples of Custom Maps</h4>
<a name="indexterm-557"></a><p>The following two examples show how you might customize maps. Use your preferred text editor to modify the <tt>/var/yp/NISLDAPmapping</tt> file as needed. For more information about file attributes and syntax, see the <tt>NISLDAPmapping</tt>(4) man page
and the LDAP naming services information in <a href="p34.html">Chapter&nbsp;9, LDAP Basic Components and Concepts (Overview)</a>.</p>
<a name="nis2ldap-44"></a><h5>Example 1&ndash;Moving Host Entries</h5>
<p>This example shows how to move host entries from the default location to another (nonstandard) location in the DIT.</p>
<p>Change the <tt>nisLDAPobjectDN</tt> attribute in the <tt>NISLDAPmapping</tt> file to the new base LDAP distinguished name (DN). For this example, the internal structure of the LDAP objects is unchanged, so <tt>objectClass</tt> entries are unchanged.</p>
<p>Change:</p>
<pre>nisLDAPobjectDN hosts: \
                        ou=hosts,?one?, \
                        objectClass=device, \
                        objectClass=ipHost</pre><p>To:</p>
<pre>nisLDAPobjectDN hosts: \
                        <b>ou=newHosts</b>,?one?, \
                        objectClass=device, \
                        objectClass=ipHost</pre><p>This change causes entries to be mapped under</p>
<p>&nbsp;&nbsp;&nbsp;<tt>dn: ou=newHosts, dom=domain1, dc=sun, dc=com</tt></p>
<p>instead of under</p>
<p>&nbsp;&nbsp;&nbsp;<tt>dn: ou=hosts, dom=domain1, dc=sun, dc=com</tt>. </p>
<a name="nis2ldap-45"></a><h5>Example 2&ndash;Implementing a Custom Map</h5>
<p>This example shows how to implement a custom map.</p>
<p>A hypothetical map, <b>servdate.bynumber</b>, contains information about the servicing dates for systems. This map is indexed by the machine's serial number which, in this example, is 123. Each entry consists of the machine owner's name, a colon, and a comma-separated list of service dates, such as John Smith:1/3/2001,4/5/2003.</p>
<p>The old map structure is to be mapped onto LDAP entries of the following form:</p>
<pre>dn: number=123,ou=servdates,dc=... \
                 number: 123 \
                 userName: John Smith \
                 date: 1/3/2001 \
                 date: 4/5/2003 \
                  .
                  .
                  .
                 objectClass: servDates</pre><p>By examining the <tt>NISLDAPmapping</tt> file, you can see that the mapping closest to the required pattern is <tt>group</tt>. The custom mappings can be modeled on the <tt>group</tt> mapping. Since there is only one map, no <tt>nisLDAPdatabaseIdMapping</tt> attribute is required. The attributes to be added to <tt>NISLDAPmapping</tt> are the following:</p>
<pre>nisLDAPentryTtl servdate.bynumber:1800:5400:3600

nisLDAPnameFields servdate.bynumber: \
                        ("%s:%s", uname, dates)

nisLDAPobjectDN servdate.bynumber: \
                        ou=servdates, ?one? \
                        objectClass=servDates:

nisLDAPattributeFromField servdate.bynumber: \
                        dn=("number=%s,", rf_key), \
                        number=rf_key, \
                        userName=uname, \
                        (date)=(dates, ",")

nisLDAPfieldFromAttribute servdate.bynumber: \
                        rf_key=number, \
                        uname=userName, \
                        dates=("%s,", (date), ",")  </pre><a name="nis2ldap-16"></a><h3>NIS-to-LDAP Best Practices With Sun Java System Directory Server</h3>
<a name="indexterm-558"></a><p>The N2L service supports Sun Java System Directory Server (formerly Sun ONE Directory Server) and compatible versions of directory servers offered by Sun Microsystems, Inc. Other (third party) LDAP servers might work with the N2L service, but they are not supported by Sun. If you are using an LDAP server other than the Sun Java System Directory Server or compatible Sun servers,
you must manually configure the server to support RFC 2307, or its successors', schemas.</p>
<p>If you are using the Sun Java System Directory Server, you can enhance the directory server to improve performance. To make these enhancements, you must have LDAP administrator privileges on the Sun Java System Directory Server. In addition, the directory server might need to be rebooted, a task that must be coordinated with the server's LDAP clients. The Sun Java System Directory Server (and Sun ONE and iPlanet Directory Server) documentation is available on the <a href="http://docs.sun.com/db/prod/s1dirsrv#hic">docs.sun.com</a> web site.</p>
<a name="nis2ldap-39"></a><h4>Creating Virtual List View Indexes With Sun Java System Directory Server</h4>
<a name="indexterm-559"></a><p>For large maps, LDAP virtual list view (VLV) indexes must be used to ensure LDAP searches return complete results. For information about setting up VLV indexes on the Sun Java System Directory Server, see the Sun Java System Directory Server documentation on the <a href="http://docs.sun.com/db/prod/s1dirsrv#hic">docs.sun.com</a> web site.</p>
<p>VLV search results use a fixed page size of 50000. If VLVs are used with Sun Java System Directory Server, both the LDAP server and N2L server must be able to handle transfers of  this size. If all of your maps are known to be smaller than this limit, you do not need to use VLV indexes. However, if your maps are larger than the size limit, or you are unsure of the size of all maps, use VLV indexes to avoid incomplete returns.</p>
<p>If you are using VLV indexes, set up the appropriate size limits as follows.</p>
<ul><li><p>On the Sun Java System Directory Server: <tt>nsslapd-sizelimit</tt> attribute must be set greater than or equal to 50000 or <tt>-1</tt>.  See the <tt>idsconfig</tt>(1M) man page.</p>
</li>
<li><p>On the N2L server: <tt>nisLDAPsearchSizelimit</tt> attribute must be set greater than or equal to 50000 or zero.  For more information, see the <tt>NISLDAPmapping</tt>(4) man page.</p>
</li>
</ul>
<p>Once VLV indexes have been created, activate them by running <tt>directoryserver</tt> with the <tt>vlvindex</tt> option on the Sun Java System Directory Server. See the <tt>directoryserver</tt>(1M) man page for more information.</p>
<a name="nis2ldap-1"></a><h5>VLVs for Standard Maps</h5>
<p>Use the Sun Java System Directory Server <tt>idsconfig</tt> command to set up VLVs if the following conditions apply:</p>
<ul><li><p>You are using the Sun Java System Directory Server.</p>
</li>
<li><p>You are mapping standard maps to RFC 2307 LDAP entries.</p>
</li>
</ul>
<p>VLVs are domain specific, so each time <tt>idsconfig</tt> is run, VLVs are created for one NIS domain. Therefore, during the NIS&ndash;to&ndash;LDAP transition, you must run <tt>idsconfig</tt> once for <b>each</b> <tt>nisLDAPdomainContext</tt> attribute included in the <tt>NISLDAPmapping</tt> file.</p>
<a name="nis2ldap-4"></a><h5>VLVs for Custom and Nonstandard Maps</h5>
<p>You must manually create new Sun Java System Directory Server VLVs for maps, or copy and modify existing VLV indexes, if the following conditions apply:</p>
<ul><li><p>You are using the Sun Java System Directory Server.</p>
</li>
<li><p>You have large custom maps or have standard maps that are mapped to nonstandard DIT locations.</p>
</li>
</ul>
<p>To view existing VLV indexes, type the following:</p>
<pre># <tt><b>ldapsearch</b></tt> <tt>-h</tt> <tt><b></tt><i>hostname</i><tt></b></tt> <tt>-s</tt> <tt><b>sub</b></tt> <tt>-b</tt> <tt><b>"cn=ldbm database,cn=plugins,cn=config" \</b></tt>
<tt><b>"objectClass=vlvSearch"</b></tt></pre><a name="nis2ldap-43"></a><h4>Avoiding Server Timeouts With Sun Java System Directory Server</h4>
<a name="indexterm-560"></a><p>When the N2L server refreshes a map, the result might be a large LDAP directory access. If the Sun Java System Directory Server is not correctly configured, the refresh operation might time out before completion. To avoid directory server timeouts, modify the following Sun Java System Directory Server attributes manually or by running the <tt>idsconfig</tt> command.</p>
<p>For example, to increase the minimum amount of time in seconds that the server should spend performing the search request, modify these attributes:</p>
<pre>dn: cn=config
nsslapd-timelimit: -1</pre><p>For testing purposes, you can use an attribute value of <tt>-1</tt>, which indicates no limit. When you have determined the optimum limit value, change the attribute value. Do <b>not</b> maintain any attribute settings at <tt>-1</tt> on a production server. With no limits, the server might be vulnerable to Denial of Service attacks.</p>
<p>For more information about configuring Sun Java System Directory Server with LDAP, see <a href="p41.html">Chapter&nbsp;11, Setting Up Sun Java System Directory Server With LDAP Clients (Tasks)</a> of this book.</p>
<a name="nis2ldap-40"></a><h4>Avoiding Buffer Overruns With Sun Java System Directory Server</h4>
<a name="indexterm-561"></a><p>To avoid buffer overruns, modify the Sun Java System Directory Server attributes manually or by running the <tt>idsconfig</tt> command.</p>
<ol><li><p>For example, to increase the maximum number of entries that are returned for a client search query, modify these attributes:</p>
<pre>dn: cn=config
nsslapd-sizelimit: -1</pre></li>
<li><p>To increase the maximum number of entries that are verified for a client search query, modify these attributes:</p>
<pre>dn: cn=config, cn=ldbm database, cn=plugins, cn=config
nsslapd-lookthroughlimit: -1</pre></li>
</ol>
<p>For testing purposes, you can use an attribute value of <tt>-1</tt>, which indicates no limit. When you have determined the optimum limit value, change the attribute value. Do <b>not</b> maintain any attribute settings at <tt>-1</tt> on a production server. With no limits, the server might be vulnerable to Denial of Service attacks.</p>
<p>If VLVs are being used, the <tt>sizelimit</tt> attribute values should be set as defined in <a href="p58.html#nis2ldap-39">Creating Virtual List View Indexes With Sun Java System Directory Server</a>. If VLVs are not being used, the size limit should be set large enough to accommodate the largest container.</p>
<p>For more information about configuring Sun Java System Directory Server with LDAP, see <a href="p41.html">Chapter&nbsp;11, Setting Up Sun Java System Directory Server With LDAP Clients (Tasks)</a>.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p57.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p59.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2006 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

