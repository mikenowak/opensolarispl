<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- GenHTML@17046-->
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>When Server Binding is Not Possible - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-09-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"  class="a0v0">
<!--stopindex-->

<a name="top"></a>

<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1">
<div class="a1v0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com">sun.com</a>
<a href="http://docs.sun.com/" class="dividelink">docs.sun.com</a>
</span>
</td><td align="right" nowrap="nowrap">
<span class="toolbarlinks">
<a href="http://www.sun.com/MySun/">My Sun</a>
<a href="http://www.sun.com/worldwide/" class="dividelink">Worldwide Sites</a>
</span>
</td></tr>
</table>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->

<!-- BEGIN A2 COMPONENT V.0 -->
<div class="a2" id="a2v0">
<div class="cornerTL">
<div class="cornerTR">
<div class="cornerBL">
<div class="cornerBR">
<div class="a2topiclinks">
<table cellpadding="1" cellspacing="0" border="0">
<tr valign="bottom">
<td><a href="http://www.sun.com/" title="Home Page"><img src="css/a.gif" alt="Home Page" width="104" height="58" border="0" class="sunlogo"></a></td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip1"></td>
<td class="navlinks" id="navlink1">
<div>
<a id="glink1" href="http://www.sun.com/products/">Products</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip2"></td>
<td class="navlinks" id="navlink2">
<div>
<a id="glink2" href="http://www.sun.com/downloads/">Downloads</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip3"></td><td class="navlinks" id="navlink3">
<div>
<a id="glink3" href="http://www.sun.com/service/">Service &amp; Solutions</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip4"></td><td class="navlinks" id="navlink4">
<div>
<a id="glink4" href="http://www.sun.com/support/">Support</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip5"></td><td class="navlinks" id="navlink5">
<div>
<a id="glink5" href="http://www.sun.com/training/">Training</a>
</div>
</td><td><img src="css/a.gif" alt="" width="1" height="1" border="0" id="ip6"></td><td class="navlinks" id="navlink6">
<div>
<a id="glink6" href="http://research.sun.com/">Research</a>
</div>
</td>
</tr>
</table>
</div>

</div></div></div></div>
</div>
<!-- END A2 COMPONENT V.0 -->

<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<?GenHTML ReferencePage >System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)<?GenHTML /ReferencePage> > <a href="p29.html">7.&nbsp;&nbsp;NIS Troubleshooting</a> > <a href="p29.html#abtrbl-30969">NIS Binding Problems</a> > <a href="p29.html#abtrbl-28251">NIS Problems Affecting One Client</a>
</div><br />
<!-- END BREADCRUMB -->

<!-- BEGIN WRAPPER TABLE, 1 COLUMN, MAIN -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tr valign="bottom"><td width="100%" valign="top">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&nbsp;</td>
<td><a href="p29.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p31.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->

</td></tr>
<tr><td width="100%" valign="top">
<a name="skip2content"> </a>

<!--startindex-->
<div class="maincontent">
<a name="abtrbl-58"></a><h5>When Server Binding is Not Possible</h5>
<a name="indexterm-438"></a><p>In extreme cases where local server binding is not possible, use of the <tt>ypset</tt> command can temporarily allow binding to another server, if available, on another network or subnet. However, in order to use the <tt>-ypset</tt> option, <tt>ypbind</tt> must be started with either the <tt>-ypset</tt> or <tt>-ypsetme</tt> options.</p>
<hr>
<p><b>Note - </b>For security reasons, the use of the <tt>-ypset</tt> and <tt>-ypsetme</tt> options should be limited to debugging purposes under controlled circumstances. Use of the <tt>-ypset</tt> and <tt>-ypsetme</tt> options can result in serious security breaches because while the daemons are running, anyone can alter server bindings causing trouble for others and permitting unauthorized access to sensitive data. If you must start <tt>ypbind</tt> with these options,
once you have fixed the problem you should kill <tt>ypbind</tt> and restart it again without those options.</p>
<hr>
<a name="abtrbl-10745"></a><h5><tt>ypbind</tt> Crashes</h5>
<a name="indexterm-439"></a><a name="indexterm-440"></a><p>If <tt>ypbind</tt> crashes almost immediately each time it is started, look for a problem in some other part of the system. Check for the presence of the <tt>rpcbind</tt> daemon by typing the following.</p>
<pre>% <tt><b>ps</b></tt> <tt>-e</tt> <tt><b>| grep rpcbind</b></tt></pre><p>If <tt>rpcbind</tt> is not present or does not stay up or behaves strangely, consult your RPC documentation.</p>
<p>You might be able to communicate with <tt>rpcbind</tt> on the problematic client from a machine operating normally. From the functioning machine, type the following.</p>
<pre>% <tt><b>rpcinfo </tt><i>client</i><tt></b></tt></pre><p>If <tt>rpcbind</tt> on the problematic machine is fine, <tt>rpcinfo</tt> produces the following output.</p>
<pre>program	version	netid	address	service	owner
...
100007	2	udp	0.0.0.0.2.219	ypbind	superuser
100007	1	udp	0.0.0.0.2.219	ypbind	superuser
100007	1	tcp	0.0.0.0.2.220	ypbind	superuser
100007	2	tcp	0.0.0.0.128.4	ypbind	superuser
100007	2	ticotsord	\000\000\020H	ypbind	superuser
100007	2	ticots	\000\000\020K	ypbind	superuser
...</pre><p>Your machine will have different addresses. If the addresses are not displayed, <tt>ypbind</tt> has been unable to register its services. Reboot the machine and run <tt>rpcinfo</tt> again. If the <tt>ypbind</tt> processes are there and they change each time you try to restart the NIS service, reboot the system, even if the <tt>rpcbind</tt> daemon is running.</p>
<a name="abtrbl-22854"></a><h4>NIS Problems Affecting Many Clients</h4>
<p>If only one or two clients are experiencing symptoms that indicate NIS binding difficulty, the problems probably are on those clients. See <a href="p29.html#abtrbl-28251">NIS Problems Affecting One Client</a>. If many NIS clients are failing to bind properly, the problem probably exists on one or more of the NIS servers.</p>
<a name="abtrbl-6555"></a><h5><tt>rpc.yppasswdd</tt> Considers a Non-Restricted Shell That Begins With <tt>r</tt> to be Restricted</h5>
<ol><li><p>Create <tt>/etc/default/yppasswdd</tt> that contains a special string:  <tt>"check_restricted_shell_name=1"</tt>.</p>
</li>
<li><p>If the <tt>"check_restricted_shell_name=1"</tt> string is commented out, the 'r' check will no occur.</p>
</li>
</ol>
<a name="abtrbl-59"></a><h5>Network or Servers Are Overloaded</h5>
<a name="indexterm-441"></a><p><a name="indexterm-442"></a><a name="indexterm-443"></a>NIS can hang if the network or NIS servers are so overloaded that <tt>ypserv</tt> cannot get a response back to the client <tt>ypbind</tt> process within
the time-out period.</p>
<p>Under these circumstances, every client on the network experiences the same or similar problems. In most cases, the condition is temporary. The messages usually go away when the NIS server reboots and restarts <tt>ypserv</tt>, or when the load on the NIS servers or network itself decreases.</p>
<a name="abtrbl-60"></a><h5>Server Malfunction</h5>
<a name="indexterm-444"></a><p><a name="indexterm-445"></a>Make sure the servers are up and running. If you are not physically near the servers, use the <tt>ping</tt> command. </p>
<a name="abtrbl-61"></a><h5>NIS Daemons Not Running</h5>
<a name="indexterm-446"></a><a name="indexterm-447"></a><p>If the servers are up and running, try to find a client machine behaving normally, and run the <tt>ypwhich</tt> command. If <tt>ypwhich</tt> does not respond, kill it. Then log in as <tt>root</tt> on the NIS server and check if the NIS process is running by entering the following.</p>
<pre># <tt><b>ps</b></tt> <tt>-e</tt> <tt><b>| grep yp</b></tt></pre><hr>
<p><b>Note - </b>Do not use the <tt>-f</tt> option with <tt>ps</tt> because this option attempts to translate user IDs to names, which causes more naming service lookups that might not succeed.</p>
<hr>
<p>If neither the NIS server (ypserv) nor the NIS client (ypbind) daemons are running, restart them by typing one of the following.</p>
<pre># <tt><b>svcadm restart network/nis/server</b></tt>
or
# <tt><b>/usr/lib/netsvc/yp/ypstop</b></tt>
# <tt><b>/usr/lib/netsvc/yp/ypstart</b></tt></pre><p>If both the <tt>ypserv</tt> and <tt>ypbind</tt> processes are running on the NIS server, then run <tt>ypwhich</tt>. If <tt>ypwhich</tt> does not respond, <tt>ypserv</tt> has probably hung and should be restarted. While logged in as <tt>root</tt> on the server, restart the NIS service by typing one of the following.</p>
<pre># <tt><b>svcadm restart network/nis/server</b></tt>
or
# <tt><b>/usr/lib/netsvc/yp/ypstop</b></tt>
# <tt><b>/usr/lib/netsvc/yp/ypstart</b></tt></pre><a name="abtrbl-62"></a><h5>Servers Have Different Versions of an NIS Map</h5>
<a name="indexterm-448"></a><p>Because NIS propagates maps among servers, occasionally you might find different versions of the same map on various NIS servers on the network. This version discrepancy is normal add acceptable if the differences do not last for more than a short time.</p>
<p>The most common cause of map discrepancy is that something is preventing normal map propagation. For example, an NIS server or router between NIS servers is down. When all NIS servers and the routers between them are running, <tt>ypxfr</tt> should succeed.</p>
<p>If the servers and routers are functioning properly, check the following:</p>
<ul><li><p>Log <tt>ypxfr</tt> output (see <a href="p30.html#abtrbl-10102">Logging <tt>ypxfr</tt> Output</a>).</p>
</li>
<li><p>Check the control files (see <a href="p30.html#abtrbl-22313">Check the <tt>crontab</tt> File and <tt>ypxfr</tt> Shell Script</a>).</p>
</li>
<li><p>Check the <tt>ypservers</tt> map on the master. See <a href="p30.html#abtrbl-15678">Check the <tt>ypservers</tt> Map</a>.</p>
</li>
</ul>
<a name="abtrbl-10102"></a><h5>Logging <tt>ypxfr</tt> Output</h5>
<a name="indexterm-449"></a><p>If a particular slave server has problems updating maps, log in to that server and run <tt>ypxfr</tt> interactively. If <tt>ypxfr</tt> fails, it tells you why it failed, and you can fix the problem. If <tt>ypxfr</tt> succeeds, but you suspect it has occasionally failed, create a log file to enable logging of messages. To create a log file, enter the following
on the slave.</p>
<pre>ypslave# <tt><b>cd /var/yp</b></tt>
ypslave# <tt><b>touch ypxfr.log</b></tt></pre><p>This creates a <tt>ypxfr.log</tt> file that saves all output from <tt>ypxfr</tt>.</p>
<p>The output resembles the output <tt>ypxfr</tt> displays when run interactively, but each line in the log file is time stamped. (You might see unusual ordering in the time-stamps. That is okay&mdash;the time-stamp tells you when <tt>ypxfr</tt> started to run. If copies of <tt>ypxfr</tt> ran simultaneously but their work took differing amounts of time, they might actually write their summary status line to the log files in an order different from that which they were
invoked.) Any pattern of intermittent failure shows up in the log.</p>
<hr>
<p><b>Note - </b>When you have fixed the problem, turn off logging by removing the log file. If you forget to remove it, it continues to grow without limit.</p>
<hr>
<a name="abtrbl-22313"></a><h5>Check the <tt>crontab</tt> File and <tt>ypxfr</tt> Shell Script</h5>
<a name="indexterm-450"></a><a name="indexterm-451"></a><p><a name="indexterm-452"></a><a name="indexterm-453"></a>Inspect the root <tt>crontab</tt>
 file, and check the <tt>ypxfr</tt> shell script it invokes. Typographical errors in these files can cause propagation problems. Failures to refer to a shell script within the <tt>/var/spool/cron/crontabs/root</tt> file, or failures to refer to a map within any shell script can also cause errors.</p>
<a name="abtrbl-15678"></a><h5>Check the <tt>ypservers</tt> Map</h5>
<p><a name="indexterm-454"></a><a name="indexterm-455"></a>Also, make sure that the NIS slave server is listed in the <tt>ypservers</tt> map on the master server for the domain. If it is not, the slave server still operates perfectly as a server, but <tt>yppush</tt> does not propagate map changes to the slave
server.</p>
<a name="abtrbl-63"></a><h5>Work Around</h5>
<p><a name="indexterm-456"></a><a name="indexterm-457"></a>If the NIS slave server problem is not obvious, you can work around it while you debug using <tt>rcp</tt> or <tt>ftp</tt> to copy a recent version of the inconsistent map from any healthy NIS server. The following shows how to transfer the problem map.</p>
<pre>ypslave# <tt><b>rcp ypmaster:/var/yp/</tt><i>mydomain</i><tt>/</tt><i>map</i><tt>.\* /var/yp/</tt><i>mydomain</i><tt></b></tt></pre><p>The * character has been escaped in the command line, so that it will be expanded on ypmaster, instead of locally on ypslave.</p>

</div>
<!--stopindex-->

<!-- END CENTRAL COLUMN COMPONENTS -->
</td></tr>

<!-- BEGIN SPACER ROW -->
<tr><td><img src="css/a.gif" width="780" height="1" border="0" alt="" /></td></tr>
<!-- END SPACER ROW -->

<tr><td>

<!-- BEGIN PAGE CONTROL ROW -->
<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p29.html"><img style="padding-right: 3px" src="graphics/prev.gif" border="0">Previous</a></td>
<td><a href="toc.html">Contents</a></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p31.html">Next<img style="padding-left: 3px" src="graphics/next.gif" border="0"></a></td>
</tr>
</table>
<!-- END PAGE CONTROL ROW -->
</td></tr>

</table>
<!-- END WRAPPER TABLE, 1 COLUMN, MAIN -->


<!-- BEGIN A5 COMPONENT V.0 -->
<div class="a5" id="a5v0">
<span class="footerlinks">
<a href="http://www.sun.com/company/">Company Info</a>
<a href="http://www.sun.com/contact/">Contact</a>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>
<a href="http://www.sun.com/privacy/">Privacy</a>

<span class="footercopy">Copyright 1994-2006 Sun Microsystems, Inc.</span>
</span>
</div>
<!-- END A5 COMPONENT V.0 -->

</body>
</html>

